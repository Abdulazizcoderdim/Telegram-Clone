(()=>{var e={};e.id=735,e.ids=[735],e.modules={56037:e=>{"use strict";e.exports=require("mongoose")},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},12412:e=>{"use strict";e.exports=require("assert")},79428:e=>{"use strict";e.exports=require("buffer")},55511:e=>{"use strict";e.exports=require("crypto")},94735:e=>{"use strict";e.exports=require("events")},81630:e=>{"use strict";e.exports=require("http")},55591:e=>{"use strict";e.exports=require("https")},11723:e=>{"use strict";e.exports=require("querystring")},79551:e=>{"use strict";e.exports=require("url")},28354:e=>{"use strict";e.exports=require("util")},74075:e=>{"use strict";e.exports=require("zlib")},16047:(e,t,r)=>{"use strict";let i,n,s,a,o,l,u,c,h,p,f,d,m,g,b,x,y,v,_,S,w,k,C,O,E;r.r(t),r.d(t,{patchFetch:()=>Hg,routeModule:()=>Hp,serverHooks:()=>Hm,workAsyncStorage:()=>Hf,workUnitAsyncStorage:()=>Hd});var I,F,R={};r.r(R),r.d(R,{LoggerTypeId:()=>Jn,add:()=>Ja,addEffect:()=>Jo,addScoped:()=>Jl,batched:()=>Jf,defaultLogger:()=>JT,filterLogLevel:()=>Jh,isLogger:()=>JJ,json:()=>JL,jsonLogger:()=>JN,logFmt:()=>J$,logfmtLogger:()=>JA,make:()=>Js,map:()=>Jp,mapInput:()=>Ju,mapInputOptions:()=>Jc,minimumLogLevel:()=>JB,none:()=>Jb,pretty:()=>JU,prettyLogger:()=>JM,prettyLoggerDefault:()=>Jz,remove:()=>Jx,replace:()=>Jy,replaceEffect:()=>Jv,replaceScoped:()=>J_,simple:()=>JS,stringLogger:()=>Jj,structured:()=>Jq,structuredLogger:()=>JP,succeed:()=>Jw,sync:()=>Jk,test:()=>JC,tracerLogger:()=>JD,withConsoleError:()=>Jg,withConsoleLog:()=>Jd,withLeveledConsole:()=>Jm,withMinimumLogLevel:()=>JO,withSpanAnnotations:()=>JE,zip:()=>JI,zipLeft:()=>JF,zipRight:()=>JR});var T={};r.r(T),r.d(T,{GET:()=>Hc,POST:()=>Hh});var N=r(42706),A=r(28203),j=r(45994);let M=function(e,t){if("function"==typeof e)return function(){return e(arguments)?t.apply(this,arguments):e=>t(e,...arguments)};switch(e){case 0:case 1:throw RangeError(`Invalid arity ${e}`);case 2:return function(e,r){return arguments.length>=2?t(e,r):function(r){return t(r,e)}};case 3:return function(e,r,i){return arguments.length>=3?t(e,r,i):function(i){return t(i,e,r)}};case 4:return function(e,r,i,n){return arguments.length>=4?t(e,r,i,n):function(n){return t(n,e,r,i)}};case 5:return function(e,r,i,n,s){return arguments.length>=5?t(e,r,i,n,s):function(s){return t(s,e,r,i,n)}};default:return function(){if(arguments.length>=e)return t.apply(this,arguments);let r=arguments;return function(e){return t(e,...r)}}}},z=e=>e,P=e=>()=>e,D=P(!0),L=P(!1),$=P(void 0);function U(e,t,r,i,n,s,a,o,l){switch(arguments.length){case 1:return e;case 2:return t(e);case 3:return r(t(e));case 4:return i(r(t(e)));case 5:return n(i(r(t(e))));case 6:return s(n(i(r(t(e)))));case 7:return a(s(n(i(r(t(e))))));case 8:return o(a(s(n(i(r(t(e)))))));case 9:return l(o(a(s(n(i(r(t(e))))))));default:{let e=arguments[0];for(let t=1;t<arguments.length;t++)e=arguments[t](e);return e}}}let q=()=>"3.12.0",B=Symbol.for(`effect/GlobalValue/globalStoreId/${q()}`);B in globalThis||(globalThis[B]=new Map);let J=globalThis[B],H=(e,t)=>(J.has(e)||J.set(e,t()),J.get(e)),K=e=>"string"==typeof e,V=e=>"number"==typeof e,W=e=>"boolean"==typeof e,G=e=>"bigint"==typeof e,Y=e=>"symbol"==typeof e,Q=e=>"function"==typeof e,Z=e=>void 0===e,X=e=>void 0!==e,ee=e=>null!==e,et=e=>!1,er=e=>"object"==typeof e&&null!==e,ei=e=>er(e)||Q(e),en=M(2,(e,t)=>ei(e)&&t in e),es=M(2,(e,t)=>en(e,"_tag")&&e._tag===t),ea=e=>null==e,eo=e=>null!=e,el=e=>e instanceof Date,eu=e=>en(e,Symbol.iterator),ec=e=>er(e)&&!Array.isArray(e),eh=e=>en(e,"then")&&Q(e.then),ep=((e,t)=>r=>e(r)||t(r),e=>`BUG: ${e} - please report an issue at https://github.com/Effect-TS/effect/issues`);Symbol.iterator;class ef{constructor(e){this.called=!1,this.self=e}next(e){return this.called?{value:e,done:!0}:(this.called=!0,{value:this.self,done:!1})}return(e){return{value:e,done:!0}}throw(e){throw e}[Symbol.iterator](){return new ef(this.self)}}class ed{constructor(e,t,r,i){return ea(t)&&ea(e)?(t=0xffffffff*Math.random()>>>0,e=0):ea(t)&&(t=e,e=0),ea(i)&&ea(r)?(i=this._state?this._state[3]:0xf767814f,r=this._state?this._state[2]:0x14057b7e):ea(i)&&(i=r,r=0),this._state=new Int32Array([0,0,r>>>0,(1|(i||0))>>>0]),this._next(),em(this._state,this._state[0],this._state[1],e>>>0,t>>>0),this._next(),this}getState(){return[this._state[0],this._state[1],this._state[2],this._state[3]]}setState(e){this._state[0]=e[0],this._state[1]=e[1],this._state[2]=e[2],this._state[3]=1|e[3]}integer(e){return Math.round(this.number()*Number.MAX_SAFE_INTEGER)%e}number(){return(0x8000000*((0x3ffffff&this._next())*1)+(0x7ffffff&this._next())*1)/0x20000000000000}_next(){var e;let t,r,i,n;let s=this._state[0]>>>0,a=this._state[1]>>>0;e=this._state,t=(a>>>16)*32557>>>0,r=(65535&a)*19605>>>0,i=(65535&a)*32557>>>0,n=(a>>>16)*19605+((r>>>16)+(t>>>16))>>>0,(i=i+(r=r<<16>>>0)>>>0)>>>0<r>>>0&&(n=n+1>>>0),(i=i+(t=t<<16>>>0)>>>0)>>>0<t>>>0&&(n=n+1>>>0),n=(n=n+Math.imul(a,0x5851f42d)>>>0)+Math.imul(s,0x4c957f2d)>>>0,e[0]=n,e[1]=i,em(this._state,this._state[0],this._state[1],this._state[2],this._state[3]);let o=s>>>18,l=(a>>>18|s<<14)>>>0;o=(o^s)>>>0;let u=((l=(l^a)>>>0)>>>27|o<<5)>>>0,c=s>>>27;return(u>>>c|u<<((-c>>>0&31)>>>0))>>>0}}function em(e,t,r,i,n){let s=t+i>>>0,a=r+n>>>0;a>>>0<r>>>0&&(s=s+1|0),e[0]=s,e[1]=a}let eg=Symbol.for("effect/Utils/YieldWrap");class eb{#e;constructor(e){this.#e=e}[eg](){return this.#e}}function ex(e){if("object"==typeof e&&null!==e&&eg in e)return e[eg]();throw Error(ep("yieldWrapGet"))}let ey=H("effect/Utils/isStructuralRegion",()=>({enabled:!1,tester:void 0})),ev=(e=>{let t={[e]:e=>e()};return function(r){return t[e](r)}})("effect_internal_function"),e_=(function*(){}).constructor,eS=e=>ei(e)&&e.constructor===e_,ew=H(Symbol.for("effect/Hash/randomHashCache"),()=>new WeakMap),ek=Symbol.for("effect/Hash"),eC=e=>{if(!0===ey.enabled)return 0;switch(typeof e){case"number":return eR(e);case"bigint":return eT(e.toString(10));case"boolean":case"symbol":return eT(String(e));case"string":return eT(e);case"undefined":return eT("undefined");case"function":case"object":if(null===e)return eT("null");if(e instanceof Date)return eC(e.toISOString());if(eF(e))return e[ek]();return eO(e);default:throw Error(`BUG: unhandled typeof ${typeof e} - please report an issue at https://github.com/Effect-TS/effect/issues`)}},eO=e=>(ew.has(e)||ew.set(e,eR(Math.floor(Math.random()*Number.MAX_SAFE_INTEGER))),ew.get(e)),eE=e=>t=>53*t^e,eI=e=>0xbfffffff&e|e>>>1&0x40000000,eF=e=>en(e,ek),eR=e=>{if(e!=e||e===1/0)return 0;let t=0|e;for(t!==e&&(t^=0xffffffff*e);e>0xffffffff;)t^=e/=0xffffffff;return eI(t)},eT=e=>{let t=5381,r=e.length;for(;r;)t=33*t^e.charCodeAt(--r);return eI(t)},eN=(e,t)=>{let r=12289;for(let i=0;i<t.length;i++)r^=U(eT(t[i]),eE(eC(e[t[i]])));return eI(r)},eA=e=>eN(e,Object.keys(e)),ej=e=>{let t=6151;for(let r=0;r<e.length;r++)t=U(t,eE(eC(e[r])));return eI(t)},eM=function(){if(1==arguments.length){let e=arguments[0];return function(t){return Object.defineProperty(e,ek,{value:()=>t,enumerable:!1}),t}}let e=arguments[0],t=arguments[1];return Object.defineProperty(e,ek,{value:()=>t,enumerable:!1}),t},ez=Symbol.for("effect/Equal");function eP(){return 1==arguments.length?e=>eD(e,arguments[0]):eD(arguments[0],arguments[1])}function eD(e,t){if(e===t)return!0;let r=typeof e;if(r!==typeof t)return!1;if("object"===r||"function"===r){if(null!==e&&null!==t){if(eL(e)&&eL(t))return!!(eC(e)===eC(t)&&e[ez](t))||!!ey.enabled&&!!ey.tester&&ey.tester(e,t);if(e instanceof Date&&t instanceof Date)return e.toISOString()===t.toISOString()}if(ey.enabled){if(Array.isArray(e)&&Array.isArray(t))return e.length===t.length&&e.every((e,r)=>eD(e,t[r]));if(Object.getPrototypeOf(e)===Object.prototype&&Object.getPrototypeOf(e)===Object.prototype){let r=Object.keys(e),i=Object.keys(t);if(r.length===i.length){for(let i of r)if(!(i in t&&eD(e[i],t[i])))return!!ey.tester&&ey.tester(e,t);return!0}}return!!ey.tester&&ey.tester(e,t)}}return!!ey.enabled&&!!ey.tester&&ey.tester(e,t)}let eL=e=>en(e,ez),e$=()=>eP,eU=Symbol.for("nodejs.util.inspect.custom"),eq=e=>{try{if(en(e,"toJSON")&&Q(e.toJSON)&&0===e.toJSON.length)return e.toJSON();if(Array.isArray(e))return e.map(eq)}catch(e){return{}}return eZ(e)},eB=e=>JSON.stringify(e,null,2),eJ={toJSON(){return eq(this)},[eU](){return this.toJSON()},toString(){return eB(this.toJSON())}};class eH{[eU](){return this.toJSON()}toString(){return eB(this.toJSON())}}let eK=(e,t=2)=>{if("string"==typeof e)return e;try{return"object"==typeof e?eV(e,t):String(e)}catch(t){return String(e)}},eV=(e,t)=>{let r=[],i=JSON.stringify(e,(e,t)=>"object"==typeof t&&null!==t?r.includes(t)?void 0:r.push(t)&&(void 0!==eY.fiberRefs&&eG(t)?t[eW](eY.fiberRefs):t):t,t);return r=void 0,i},eW=Symbol.for("effect/Inspectable/Redactable"),eG=e=>"object"==typeof e&&null!==e&&eW in e,eY=H("effect/Inspectable/redactableState",()=>({fiberRefs:void 0})),eQ=(e,t)=>{let r=eY.fiberRefs;eY.fiberRefs=e;try{return t()}finally{eY.fiberRefs=r}},eZ=e=>eG(e)&&void 0!==eY.fiberRefs?e[eW](eY.fiberRefs):e,eX=(e,t)=>{switch(t.length){case 0:return e;case 1:return t[0](e);case 2:return t[1](t[0](e));case 3:return t[2](t[1](t[0](e)));case 4:return t[3](t[2](t[1](t[0](e))));case 5:return t[4](t[3](t[2](t[1](t[0](e)))));case 6:return t[5](t[4](t[3](t[2](t[1](t[0](e))))));case 7:return t[6](t[5](t[4](t[3](t[2](t[1](t[0](e)))))));case 8:return t[7](t[6](t[5](t[4](t[3](t[2](t[1](t[0](e))))))));case 9:return t[8](t[7](t[6](t[5](t[4](t[3](t[2](t[1](t[0](e)))))))));default:{let r=e;for(let e=0,i=t.length;e<i;e++)r=t[e](r);return r}}},e0="Async",e1="Commit",e2="Failure",e3="OnFailure",e5="OnSuccess",e4="OnSuccessAndFailure",e6="Success",e8="Sync",e7="UpdateRuntimeFlags",e9="While",te="Iterator",tt="WithRuntime",tr="Yield",ti="RevertFlags",tn=Symbol.for("effect/Effect"),ts=Symbol.for("effect/Stream"),ta=Symbol.for("effect/Sink"),to=Symbol.for("effect/Channel"),tl={_R:e=>e,_E:e=>e,_A:e=>e,_V:q()},tu={[tn]:tl,[ts]:tl,[ta]:{_A:e=>e,_In:e=>e,_L:e=>e,_E:e=>e,_R:e=>e},[to]:{_Env:e=>e,_InErr:e=>e,_InElem:e=>e,_InDone:e=>e,_OutErr:e=>e,_OutElem:e=>e,_OutDone:e=>e},[ez](e){return this===e},[ek](){return eM(this,eO(this))},[Symbol.iterator](){return new ef(new eb(this))},pipe(){return eX(this,arguments)}},tc={[ek](){return eM(this,eA(this))},[ez](e){let t=Object.keys(this),r=Object.keys(e);if(t.length!==r.length)return!1;for(let r of t)if(!(r in e&&eP(this[r],e[r])))return!1;return!0}},th={...tu,_op:e1},tp={...th,...tc},tf=function(){function e(){}return e.prototype=th,e}(),td=function(){function e(){}return e.prototype=tp,e}(),tm=Symbol.for("effect/Option"),tg={...tu,[tm]:{_A:e=>e},[eU](){return this.toJSON()},toString(){return eB(this.toJSON())}},tb=Object.assign(Object.create(tg),{_tag:"Some",_op:"Some",[ez](e){return tv(e)&&tS(e)&&eP(this.value,e.value)},[ek](){return eM(this,eE(eC(this._tag))(eC(this.value)))},toJSON(){return{_id:"Option",_tag:this._tag,value:eq(this.value)}}}),tx=eC("None"),ty=Object.assign(Object.create(tg),{_tag:"None",_op:"None",[ez]:e=>tv(e)&&t_(e),[ek]:()=>tx,toJSON(){return{_id:"Option",_tag:this._tag}}}),tv=e=>en(e,tm),t_=e=>"None"===e._tag,tS=e=>"Some"===e._tag,tw=Object.create(ty),tk=e=>{let t=Object.create(tb);return t.value=e,t},tC=Symbol.for("effect/Either"),tO={...tu,[tC]:{_R:e=>e},[eU](){return this.toJSON()},toString(){return eB(this.toJSON())}},tE=Object.assign(Object.create(tO),{_tag:"Right",_op:"Right",[ez](e){return tF(e)&&tT(e)&&eP(this.right,e.right)},[ek](){return eE(eC(this._tag))(eC(this.right))},toJSON(){return{_id:"Either",_tag:this._tag,right:eq(this.right)}}}),tI=Object.assign(Object.create(tO),{_tag:"Left",_op:"Left",[ez](e){return tF(e)&&tR(e)&&eP(this.left,e.left)},[ek](){return eE(eC(this._tag))(eC(this.left))},toJSON(){return{_id:"Either",_tag:this._tag,left:eq(this.left)}}}),tF=e=>en(e,tC),tR=e=>"Left"===e._tag,tT=e=>"Right"===e._tag,tN=e=>{let t=Object.create(tI);return t.left=e,t},tA=e=>{let t=Object.create(tE);return t.right=e,t},tj=M(2,(e,t)=>t_(e)?tN(t()):tA(e.value)),tM=e=>{if(Q(e))try{return tA(e())}catch(e){return tN(e)}else try{return tA(e.try())}catch(t){return tN(e.catch(t))}},tz=M(2,(e,t)=>tR(e)?tN(t(e.left)):tA(e.right)),tP=M(2,(e,t)=>tT(e)?tA(t(e.right)):tN(e.left)),tD=M(2,(e,{onLeft:t,onRight:r})=>tR(e)?t(e.left):r(e.right)),tL=tD({onLeft:z,onRight:z}),t$=M(2,(e,t)=>{if(tT(e))return e.right;throw t(e.left)}),tU=t$(()=>Error("getOrThrow called on a Left")),tq=e=>(t,r)=>t===r||e(t,r),tB=M(2,(e,t)=>tq((r,i)=>e(t(r),t(i)))),tJ=e=>tq((t,r)=>{if(t.length!==r.length)return!1;for(let i=0;i<t.length;i++)if(!e(t[i],r[i]))return!1;return!0}),tH=e=>e.length>0,tK=()=>tw,tV=M(2,(e,{onNone:t,onSome:r})=>t_(e)?t():r(e.value)),tW=M(2,(e,t)=>t_(e)?t():e.value),tG=M(2,(e,t)=>t_(e)?t():e),tY=M(2,(e,t)=>t_(e)?tk(t()):e),tQ=e=>null==e?tK():tk(e),tZ=tW($),tX=e=>(...t)=>{try{return tk(e(...t))}catch(e){return tK()}},t0=M(2,(e,t)=>{if(tS(e))return e.value;throw t()})(()=>Error("getOrThrow called on a None")),t1=M(2,(e,t)=>t_(e)?tK():tk(t(e.value))),t2=M(2,(e,t)=>t_(e)?tK():t(e.value)),t3=e=>{if(Symbol.iterator in e){let t=[];for(let r of e){if(t_(r))return tK();t.push(r.value)}return tk(t)}let t={};for(let r of Object.keys(e)){let i=e[r];if(t_(i))return tK();t[r]=i.value}return tk(t)},t5=M(2,(e,t)=>t_(e)?tK():t(e.value)),t4=M(2,(e,t)=>t5(e,e=>t(e)?tk(e):tw)),t6=e=>tq((t,r)=>t_(t)?t_(r):!t_(r)&&e(t.value,r.value)),t8=(m=e$(),M(2,(e,t)=>!t_(e)&&m(e.value,t))),t7=M(2,(e,t)=>!t_(e)&&t(e.value)),t9=e=>{let t=e[Symbol.iterator]().next();if(t.done)throw Error("unsafeHead: empty iterable");return t.value};Symbol.iterator,()=>re;let re={next:()=>({done:!0,value:void 0})},rt=e=>(t,r)=>t===r?0:e(t,r),rr=rt((e,t)=>e<t?-1:1),ri=((e,t)=>e<t?-1:1,M(2,(e,t)=>rt((r,i)=>e(t(r),t(i))))),rn=e=>0===rl(e).length;Object.fromEntries,(e,t)=>{let r=[];for(let i of rl(e))r.push(t(i,e[i]));return r};let rs=M(2,(e,t)=>Object.prototype.hasOwnProperty.call(e,t)),ra=M(2,(e,t)=>{if(!rs(e,t))return{...e};let r={...e};return delete r[t],r}),ro=M(2,(e,t)=>{let r={...e};for(let i of rl(e))r[i]=t(e[i],i);return r}),rl=e=>Object.keys(e),ru=M(3,(e,t,r)=>({...e,[t]:r})),rc=(...e)=>e,rh=(...e)=>e,rp=e=>Array(e),rf=(e,t)=>{let r=Math.max(1,Math.floor(e)),i=Array(r);for(let e=0;e<r;e++)i[e]=t(e);return i},rd=e=>Array.isArray(e)?e:Array.from(e),rm=e=>Array.isArray(e)?e:[e],rg=M(2,(e,{onEmpty:t,onNonEmpty:r})=>rw(e)?r(e):t()),rb=M(2,(e,{onEmpty:t,onNonEmpty:r})=>rw(e)?r(rF(e),rN(e)):t()),rx=M(2,(e,t)=>[t,...e]),ry=M(2,(e,t)=>[...e,t]),rv=M(2,(e,t)=>rd(e).concat(rd(t))),r_=Array.isArray,rS=e=>0===e.length,rw=tH,rk=(e,t)=>e<0||e>=t.length,rC=(e,t)=>Math.floor(Math.min(Math.max(0,e),t.length)),rO=M(2,(e,t)=>{let r=Math.floor(t);return rk(r,e)?tK():tk(e[r])}),rE=M(2,(e,t)=>{let r=Math.floor(t);if(rk(r,e))throw Error(`Index ${r} out of bounds`);return e[r]}),rI=rO(0),rF=rE(0),rR=e=>rw(e)?tk(rT(e)):tK(),rT=e=>e[e.length-1],rN=e=>e.slice(1),rA=(e,t)=>{let r=0;for(let i of e){if(!t(i,r))break;r++}return r},rj=M(2,(e,t)=>rU(e,rA(e,t))),rM=M(2,(e,t)=>{let r=rd(e);return r.slice(rC(t,r),r.length)}),rz=((e,t)=>{let r=rd(e);for(let e=r.length-1;e>=0;e--){let i=r[e],n=t(i,e);if(W(n)){if(n)return tk(i)}else if(tS(n))return n}return tK()},e=>Array.from(e).reverse()),rP=M(2,(e,t)=>{let r=Array.from(e);return r.sort(t),r}),rD=M(2,(e,t)=>rL(e,t,rc)),rL=M(3,(e,t,r)=>{let i=rd(e),n=rd(t);if(rw(i)&&rw(n)){let e=[r(rF(i),rF(n))],t=Math.min(i.length,n.length);for(let s=1;s<t;s++)e[s]=r(i[s],n[s]);return e}return[]}),r$=e$(),rU=M(2,(e,t)=>{let r=Array.from(e),i=Math.floor(t);return rw(r)?i>=1?rq(r,i):[[],r]:[r,[]]}),rq=M(2,(e,t)=>{let r=Math.max(1,Math.floor(t));return r>=e.length?[rB(e),[]]:[rx(e.slice(1,r),rF(e)),e.slice(r)]}),rB=e=>e.slice(),rJ=M(3,(e,t,r)=>{let i=rd(e),n=rd(t);return rw(i)?rw(n)?r6(r)(rv(i,n)):i:n}),rH=M(2,(e,t)=>rJ(e,t,r$)),rK=()=>[],rV=e=>[e],rW=M(2,(e,t)=>e.map(t)),rG=M(2,(e,t)=>{if(rS(e))return[];let r=[];for(let i=0;i<e.length;i++){let n=t(e[i],i);for(let e=0;e<n.length;e++)r.push(n[e])}return r}),rY=rG(z),rQ=M(2,(e,t)=>{let r=rd(e),i=[];for(let e=0;e<r.length;e++){let n=t(r[e],e);tS(n)&&i.push(n.value)}return i}),rZ=M(2,(e,t)=>{let r=0,i=[];for(let n of e){let e=t(n,r);if(tS(e))i.push(e.value);else break;r++}return i}),rX=M(2,(e,t)=>{let r=[],i=[],n=rd(e);for(let e=0;e<n.length;e++){let s=t(n[e],e);tR(s)?r.push(s.left):i.push(s.right)}return[r,i]}),r0=rQ(z),r1=M(2,(e,t)=>{let r=rd(e),i=[];for(let e=0;e<r.length;e++)t(r[e],e)&&i.push(r[e]);return i}),r2=M(3,(e,t,r)=>rd(e).reduce((e,t,i)=>r(e,t,i),t)),r3=M(3,(e,t,r)=>rd(e).reduceRight((e,t,i)=>r(e,t,i),t)),r5=M(2,(e,t)=>e.every(t)),r4=(e,t)=>{let r;let i=[],n=e;for(;tS(r=t(n));){let[e,t]=r.value;i.push(e),n=t}return i},r6=M(2,(e,t)=>{let r=rd(e);if(rw(r)){let e=[rF(r)];for(let i of rN(r))e.every(e=>!t(i,e))&&e.push(i);return e}return[]}),r8=e=>r6(e,e$()),r7=M(2,(e,t)=>rd(e).join(t)),r9=M(3,(e,t,r)=>{let i=0,n=t,s=[];for(let t of e){let e=r(n,t,i);n=e[0],s.push(e[1]),i++}return[n,s]}),ie=Symbol.for("effect/Chunk"),it=[],ir=tq((e,t)=>e.length===t.length&&id(e).every((e,r)=>eP(e,iy(t,r)))),ii={[ie]:{_A:e=>e},toString(){return eB(this.toJSON())},toJSON(){return{_id:"Chunk",values:id(this).map(eq)}},[eU](){return this.toJSON()},[ez](e){return ia(e)&&ir(this,e)},[ek](){return eM(this,ej(id(this)))},[Symbol.iterator](){switch(this.backing._tag){case"IArray":return this.backing.array[Symbol.iterator]();case"IEmpty":return it[Symbol.iterator]();default:return id(this)[Symbol.iterator]()}},pipe(){return eX(this,arguments)}},is=e=>{let t=Object.create(ii);switch(t.backing=e,e._tag){case"IEmpty":t.length=0,t.depth=0,t.left=t,t.right=t;break;case"IConcat":t.length=e.left.length+e.right.length,t.depth=1+Math.max(e.left.depth,e.right.depth),t.left=e.left,t.right=e.right;break;case"IArray":t.length=e.array.length,t.depth=0,t.left=io,t.right=io;break;case"ISingleton":t.length=1,t.depth=0,t.left=io,t.right=io;break;case"ISlice":t.length=e.length,t.depth=e.chunk.depth+1,t.left=io,t.right=io}return t},ia=e=>en(e,ie),io=is({_tag:"IEmpty"}),il=()=>io,iu=(...e)=>1===e.length?ic(e[0]):ix(e),ic=e=>is({_tag:"ISingleton",a:e}),ih=e=>ia(e)?e:is({_tag:"IArray",array:rd(e)}),ip=(e,t,r)=>{switch(e.backing._tag){case"IArray":!function(e,t,r,i,n){for(let t=0;t<Math.min(e.length,0+n);t++)r[i+t-0]=e[t]}(e.backing.array,0,t,r,e.length);break;case"IConcat":ip(e.left,t,r),ip(e.right,t,r+e.left.length);break;case"ISingleton":t[r]=e.backing.a;break;case"ISlice":{let i=0,n=r;for(;i<e.length;)t[n]=iy(e,i),i+=1,n+=1}}},id=e=>{switch(e.backing._tag){case"IEmpty":return it;case"IArray":return e.backing.array;default:{let t=Array(e.length);return ip(e,t,0),e.backing={_tag:"IArray",array:t},e.left=io,e.right=io,e.depth=0,t}}},im=e=>{switch(e.backing._tag){case"IEmpty":case"ISingleton":return e;case"IArray":return is({_tag:"IArray",array:rz(e.backing.array)});case"IConcat":return is({_tag:"IConcat",left:im(e.backing.right),right:im(e.backing.left)});case"ISlice":return ib(rz(id(e)))}},ig=M(2,(e,t)=>t<0||t>=e.length?tK():tk(iy(e,t))),ib=e=>is({_tag:"IArray",array:e}),ix=e=>ib(e),iy=M(2,(e,t)=>{switch(e.backing._tag){case"IEmpty":throw Error("Index out of bounds");case"ISingleton":if(0!==t)throw Error("Index out of bounds");return e.backing.a;case"IArray":if(t>=e.length||t<0)throw Error("Index out of bounds");return e.backing.array[t];case"IConcat":return t<e.left.length?iy(e.left,t):iy(e.right,t-e.left.length);case"ISlice":return iy(e.backing.chunk,t+e.backing.offset)}}),iv=M(2,(e,t)=>iC(e,ic(t))),i_=M(2,(e,t)=>iC(ic(t),e)),iS=M(2,(e,t)=>{if(t<=0)return io;if(t>=e.length)return e;switch(e.backing._tag){case"ISlice":return is({_tag:"ISlice",chunk:e.backing.chunk,length:t,offset:e.backing.offset});case"IConcat":if(t>e.left.length)return is({_tag:"IConcat",left:e.left,right:iS(e.right,t-e.left.length)});return iS(e.left,t);default:return is({_tag:"ISlice",chunk:e,offset:0,length:t})}}),iw=M(2,(e,t)=>{if(t<=0)return e;if(t>=e.length)return io;switch(e.backing._tag){case"ISlice":return is({_tag:"ISlice",chunk:e.backing.chunk,offset:e.backing.offset+t,length:e.backing.length-t});case"IConcat":if(t>e.left.length)return iw(e.right,t-e.left.length);return is({_tag:"IConcat",left:iw(e.left,t),right:e.right});default:return is({_tag:"ISlice",chunk:e,offset:t,length:e.length-t})}}),ik=M(2,(e,t)=>{let r=id(e),i=r.length,n=0;for(;n<i&&t(r[n]);)n++;return iw(e,n)}),iC=M(2,(e,t)=>{if("IEmpty"===e.backing._tag)return t;if("IEmpty"===t.backing._tag)return e;let r=t.depth-e.depth;if(1>=Math.abs(r))return is({_tag:"IConcat",left:e,right:t});if(r<-1){if(e.left.depth>=e.right.depth){let r=iC(e.right,t);return is({_tag:"IConcat",left:e.left,right:r})}{let r=iC(e.right.right,t);if(r.depth===e.depth-3){let t=is({_tag:"IConcat",left:e.right.left,right:r});return is({_tag:"IConcat",left:e.left,right:t})}{let t=is({_tag:"IConcat",left:e.left,right:e.right.left});return is({_tag:"IConcat",left:t,right:r})}}}if(t.right.depth>=t.left.depth)return is({_tag:"IConcat",left:iC(e,t.left),right:t.right});{let r=iC(e,t.left.left);if(r.depth===t.depth-3){let e=is({_tag:"IConcat",left:r,right:t.left.right});return is({_tag:"IConcat",left:e,right:t.right})}{let e=is({_tag:"IConcat",left:t.left.right,right:t.right});return is({_tag:"IConcat",left:r,right:e})}}}),iO=M(2,(e,t)=>ib(rQ(e,t))),iE=M(2,(e,t)=>ib(r1(e,t))),iI=((e,t)=>ib(rZ(e,t)),M(2,(e,t)=>{if("ISingleton"===e.backing._tag)return t(e.backing.a,0);let r=io,i=0;for(let n of e)r=iC(r,t(n,i++));return r})),iF=M(2,(e,t)=>id(e).forEach(t)),iR=iI(z),iT=e=>0===e.length,iN=e=>e.length>0,iA=ig(0),ij=e=>iy(e,0),iM=e=>iy(e,e.length-1),iz=M(2,(e,t)=>"ISingleton"===e.backing._tag?ic(t(e.backing.a,0)):ib(U(id(e),rW((e,r)=>t(e,r))))),iP=((e,t,r)=>{let[i,n]=r9(e,t,r);return[i,ib(n)]},M(2,(e,t)=>[iS(e,t),iw(e,t)])),iD=M(2,(e,t)=>{let r=0;for(let i of id(e)){if(t(i))break;r++}return iP(e,r)}),iL=e=>iw(e,1),i$=M(2,(e,t)=>iw(e,e.length-t)),iU=M(2,(e,t)=>{let r=[];for(let i of id(e))if(t(i))r.push(i);else break;return ib(r)}),iq=M(3,(e,t,r)=>ib(rL(e,t,r))),iB=M(2,(e,t)=>ih(rf(e,t))),iJ=(e,t)=>e<=t?iB(t-e+1,t=>e+t):ic(e),iH=M(2,(e,t)=>rd(e).some(t));function iK(e,t){var r;return r=e&t-1,r-=r>>1&0x55555555,r=(r=(0x33333333&r)+(r>>2&0x33333333))+(r>>4)&0xf0f0f0f,r+=r>>8,127&(r+=r>>16)}let iV=(e,t)=>({value:e,previous:t});function iW(e,t,r,i){let n=i;if(!e){let e=i.length;n=Array(e);for(let t=0;t<e;++t)n[t]=i[t]}return n[t]=r,n}function iG(e,t,r){let i=r.length-1,n=0,s=0,a=r;if(e)n=s=t;else for(a=Array(i);n<t;)a[s++]=r[n++];for(++n;n<=i;)a[s++]=r[n++];return e&&(a.length=i),a}class iY{modify(e,t,r,i,n,s){let a=r(tK());return t_(a)?new iY:(++s.value,new iX(e,i,n,a))}constructor(){this._tag="EmptyNode"}}function iQ(e){return es(e,"EmptyNode")}function iZ(e,t){return!iQ(e)&&t===e.edit}class iX{constructor(e,t,r,i){this._tag="LeafNode",this.edit=e,this.hash=t,this.key=r,this.value=i}modify(e,t,r,i,n,s){if(eP(n,this.key)){let t=r(this.value);return t===this.value?this:t_(t)?(--s.value,new iY):iZ(this,e)?(this.value=t,this):new iX(e,i,n,t)}let a=r(tK());return t_(a)?this:(++s.value,i3(e,t,this.hash,this,i,new iX(e,i,n,a)))}}class i0{constructor(e,t,r){this._tag="CollisionNode",this.edit=e,this.hash=t,this.children=r}modify(e,t,r,i,n,s){if(i===this.hash){let t=iZ(this,e),i=this.updateCollisionList(t,e,this.hash,this.children,r,n,s);return i===this.children?this:i.length>1?new i0(e,this.hash,i):i[0]}let a=r(tK());return t_(a)?this:(++s.value,i3(e,t,this.hash,this,i,new iX(e,i,n,a)))}updateCollisionList(e,t,r,i,n,s,a){let o=i.length;for(let l=0;l<o;++l){let o=i[l];if("key"in o&&eP(s,o.key)){let u=o.value,c=n(u);if(c===u)return i;if(t_(c))return--a.value,iG(e,l,i);return iW(e,l,new iX(t,r,s,c),i)}}let l=n(tK());return t_(l)?i:(++a.value,iW(e,o,new iX(t,r,s,l),i))}}class i1{constructor(e,t,r){this._tag="IndexedNode",this.edit=e,this.mask=t,this.children=r}modify(e,t,r,i,n,s){let a;let o=this.mask,l=this.children,u=i>>>t&31,c=1<<u,h=iK(o,c),p=o&c,f=iZ(this,e);if(!p){let a=new iY().modify(e,t+5,r,i,n,s);return a?l.length>=16?function(e,t,r,i,n){let s=[],a=i,o=0;for(let e=0;a;++e)1&a&&(s[e]=n[o++]),a>>>=1;return s[t]=r,new i2(e,o+1,s)}(e,u,a,o,l):new i1(e,o|c,function(e,t,r,i){let n=i.length;if(e){let e=n;for(;e>=t;)i[e--]=i[e];return i[t]=r,i}let s=0,a=0,o=Array(n+1);for(;s<t;)o[a++]=i[s++];for(o[t]=r;s<n;)o[++a]=i[s++];return o}(f,h,a,l)):this}let d=l[h],m=d.modify(e,t+5,r,i,n,s);if(d===m)return this;let g=o;if(iQ(m)){var b;if(!(g&=~c))return new iY;if(l.length<=2&&(iQ(b=l[1^h])||"LeafNode"===b._tag||"CollisionNode"===b._tag))return l[1^h];a=iG(f,h,l)}else a=iW(f,h,m,l);return f?(this.mask=g,this.children=a,this):new i1(e,g,a)}}class i2{constructor(e,t,r){this._tag="ArrayNode",this.edit=e,this.size=t,this.children=r}modify(e,t,r,i,n,s){let a,o=this.size,l=this.children,u=i>>>t&31,c=l[u],h=(c||new iY).modify(e,t+5,r,i,n,s);if(c===h)return this;let p=iZ(this,e);if(iQ(c)&&!iQ(h))++o,a=iW(p,u,h,l);else if(!iQ(c)&&iQ(h)){if(--o<=8)return function(e,t,r,i){let n=Array(t-1),s=0,a=0;for(let e=0,t=i.length;e<t;++e)if(e!==r){let t=i[e];t&&!iQ(t)&&(n[s++]=t,a|=1<<e)}return new i1(e,a,n)}(e,o,u,l);a=iW(p,u,new iY,l)}else a=iW(p,u,h,l);return p?(this.size=o,this.children=a,this):new i2(e,o,a)}}function i3(e,t,r,i,n,s){let a;let o=t;for(;;){let t=function(e,t,r,i,n,s){if(r===n)return new i0(e,r,[s,i]);let a=r>>>t&31,o=n>>>t&31;return a===o?t=>new i1(e,1<<a|1<<o,[t]):new i1(e,1<<a|1<<o,a<o?[i,s]:[s,i])}(e,o,r,i,n,s);if("function"==typeof t)a=iV(t,a),o+=5;else{let e=t;for(;null!=a;)e=a.value(e),a=a.previous;return e}}}let i5="effect/HashMap",i4=Symbol.for(i5),i6={[i4]:i4,[Symbol.iterator](){return new i7(this,(e,t)=>[e,t])},[ek](){let e=eC(i5);for(let t of this)e^=U(eC(t[0]),eE(eC(t[1])));return eM(this,e)},[ez](e){if(nn(e)){if(e._size!==this._size)return!1;for(let t of this){let r=U(e,na(t[0],eC(t[0])));if(t_(r)||!eP(t[1],r.value))return!1}return!0}return!1},toString(){return eB(this.toJSON())},toJSON(){return{_id:"HashMap",values:Array.from(this).map(eq)}},[eU](){return this.toJSON()},pipe(){return eX(this,arguments)}},i8=(e,t,r,i)=>{let n=Object.create(i6);return n._editable=e,n._edit=t,n._root=r,n._size=i,n};class i7{constructor(e,t){this.map=e,this.f=t,this.v=ne(this.map._root,this.f,void 0)}next(){if(t_(this.v))return{done:!0,value:void 0};let e=this.v.value;return this.v=i9(e.cont),{done:!1,value:e.value}}[Symbol.iterator](){return new i7(this.map,this.f)}}let i9=e=>e?nt(e[0],e[1],e[2],e[3],e[4]):tK(),ne=(e,t,r)=>{switch(e._tag){case"LeafNode":if(tS(e.value))return tk({value:t(e.key,e.value.value),cont:r});return i9(r);case"CollisionNode":case"ArrayNode":case"IndexedNode":{let i=e.children;return nt(i.length,i,0,t,r)}default:return i9(r)}},nt=(e,t,r,i,n)=>{for(;r<e;){let s=t[r++];if(s&&!iQ(s))return ne(s,i,[e,t,r,i,n])}return i9(n)},nr=i8(!1,0,new iY,0),ni=()=>nr,nn=e=>en(e,i4),ns=M(2,(e,t)=>na(e,t,eC(t))),na=M(3,(e,t,r)=>{let i=e._root,n=0;for(;;)switch(i._tag){case"LeafNode":return eP(t,i.key)?i.value:tK();case"CollisionNode":if(r===i.hash){let e=i.children;for(let r=0,i=e.length;r<i;++r){let i=e[r];if("key"in i&&eP(t,i.key))return i.value}}return tK();case"IndexedNode":{let e=1<<(r>>>n&31);if(i.mask&e){i=i.children[iK(i.mask,e)],n+=5;break}return tK()}case"ArrayNode":if(i=i.children[r>>>n&31]){n+=5;break}return tK();default:return tK()}}),no=M(2,(e,t)=>tS(na(e,t,eC(t)))),nl=M(3,(e,t,r)=>nd(e,t,()=>tk(r))),nu=M(3,(e,t,r)=>e._editable?(e._root=t,e._size=r,e):t===e._root?e:i8(e._editable,e._edit,t,r)),nc=e=>new i7(e,e=>e),nh=e=>e._size,np=e=>i8(!0,e._edit+1,e._root,e._size),nf=e=>(e._editable=!1,e),nd=((e,t)=>{let r=np(e);return t(r),nf(r)},M(3,(e,t,r)=>nm(e,t,eC(t),r))),nm=M(4,(e,t,r,i)=>{let n={value:e._size},s=e._root.modify(e._editable?e._edit:NaN,0,i,r,t,n);return U(e,nu(s,n.value))}),ng=M(2,(e,t)=>nd(e,t,tK)),nb=M(2,(e,t)=>ny(e,ni(),(e,r,i)=>nl(e,i,t(r,i)))),nx=M(2,(e,t)=>ny(e,void 0,(e,r,i)=>t(r,i))),ny=M(3,(e,t,r)=>{let i;let n=e._root;if("LeafNode"===n._tag)return tS(n.value)?r(t,n.value.value,n.key):t;if("EmptyNode"===n._tag)return t;let s=[n.children];for(;i=s.pop();)for(let e=0,n=i.length;e<n;){let n=i[e++];n&&!iQ(n)&&("LeafNode"===n._tag?tS(n.value)&&(t=r(t,n.value.value,n.key)):s.push(n.children))}return t}),nv="effect/HashSet",n_=Symbol.for(nv),nS={[n_]:n_,[Symbol.iterator](){return nc(this._keyMap)},[ek](){return eM(this,eE(eC(this._keyMap))(eC(nv)))},[ez](e){return!!nk(e)&&nh(this._keyMap)===nh(e._keyMap)&&eP(this._keyMap,e._keyMap)},toString(){return eB(this.toJSON())},toJSON(){return{_id:"HashSet",values:Array.from(this).map(eq)}},[eU](){return this.toJSON()},pipe(){return eX(this,arguments)}},nw=e=>{let t=Object.create(nS);return t._keyMap=e,t},nk=e=>en(e,n_),nC=nw(ni()),nO=()=>nC,nE=M(2,(e,t)=>no(e._keyMap,t)),nI=M(2,(e,t)=>{let r=!1;for(let i of e)if(r=t(i))break;return r}),nF=M(2,(e,t)=>!nI(e,e=>!t(e))),nR=e=>nw(np(e._keyMap)),nT=e=>(e._keyMap._editable=!1,e),nN=M(2,(e,t)=>{let r=nR(e);return t(r),nT(r)}),nA=M(2,(e,t)=>e._keyMap._editable?(nl(t,!0)(e._keyMap),e):nw(nl(t,!0)(e._keyMap))),nj=M(2,(e,t)=>e._keyMap._editable?(ng(t)(e._keyMap),e):nw(ng(t)(e._keyMap))),nM=M(2,(e,t)=>nN(e,e=>{for(let r of t)nj(e,r)})),nz=M(2,(e,t)=>nN(nO(),r=>{for(let i of(nP(e,e=>nA(r,e)),t))nA(r,i)})),nP=M(2,(e,t)=>nx(e._keyMap,(e,r)=>t(r))),nD=M(3,(e,t,r)=>ny(e._keyMap,t,(e,t,i)=>r(e,i))),nL=e=>{let t=nR(nO());for(let r of e)nA(t,r);return nT(t)},n$=(...e)=>{let t=nR(nO());for(let r of e)nA(t,r);return nT(t)},nU=e=>nh(e._keyMap),nq="Empty",nB="Fail",nJ="Interrupt",nH="Parallel",nK="Sequential",nV="effect/Cause",nW=Symbol.for(nV),nG={[nW]:{_E:e=>e},[ek](){return U(eC(nV),eE(eC(sc(this))),eM(this))},[ez](e){return n2(e)&&su(this,e)},pipe(){return eX(this,arguments)},toJSON(){switch(this._tag){case"Empty":return{_id:"Cause",_tag:this._tag};case"Die":return{_id:"Cause",_tag:this._tag,defect:eq(this.defect)};case"Interrupt":return{_id:"Cause",_tag:this._tag,fiberId:this.fiberId.toJSON()};case"Fail":return{_id:"Cause",_tag:this._tag,failure:eq(this.error)};case"Sequential":case"Parallel":return{_id:"Cause",_tag:this._tag,left:eq(this.left),right:eq(this.right)}}},toString(){return sv(this)},[eU](){return this.toJSON()}},nY=(()=>{let e=Object.create(nG);return e._tag=nq,e})(),nQ=e=>{let t=Object.create(nG);return t._tag=nB,t.error=e,t},nZ=e=>{let t=Object.create(nG);return t._tag="Die",t.defect=e,t},nX=e=>{let t=Object.create(nG);return t._tag=nJ,t.fiberId=e,t},n0=(e,t)=>{let r=Object.create(nG);return r._tag=nH,r.left=e,r.right=t,r},n1=(e,t)=>{let r=Object.create(nG);return r._tag=nK,r.left=e,r.right=t,r},n2=e=>en(e,nW),n3=e=>"Die"===e._tag,n5=e=>e._tag===nq||sx(e,!0,(e,t)=>{switch(t._tag){case nq:return tk(e);case"Die":case nB:case nJ:return tk(!1);default:return tK()}}),n4=e=>tS(sr(e)),n6=e=>sy(void 0,sd)(e),n8=e=>im(sx(e,il(),(e,t)=>t._tag===nB?tk(U(e,i_(t.error))):tK())),n7=e=>im(sx(e,il(),(e,t)=>"Die"===t._tag?tk(U(e,i_(t.defect))):tK())),n9=e=>sx(e,nO(),(e,t)=>t._tag===nJ?tk(U(e,nA(t.fiberId))):tK()),se=e=>sp(e,e=>e._tag===nB?tk(e.error):tK()),st=e=>{let t=se(e);switch(t._tag){case"None":return tA(e);case"Some":return tN(t.value)}},sr=e=>sp(e,e=>e._tag===nJ?tk(e.fiberId):tK()),si=e=>sb(e,{onEmpty:tK(),onFail:e=>tk(nZ(e)),onDie:e=>tk(nZ(e)),onInterrupt:()=>tK(),onSequential:(e,t)=>tS(e)&&tS(t)?tk(n1(e.value,t.value)):tS(e)&&t_(t)?tk(e.value):t_(e)&&tS(t)?tk(t.value):tK(),onParallel:(e,t)=>tS(e)&&tS(t)?tk(n0(e.value,t.value)):tS(e)&&t_(t)?tk(e.value):t_(e)&&tS(t)?tk(t.value):tK()}),sn=e=>sb(e,{onEmpty:nY,onFail:()=>nY,onDie:e=>nZ(e),onInterrupt:e=>nX(e),onSequential:n1,onParallel:n0}),ss=e=>sb(e,{onEmpty:nY,onFail:e=>nZ(e),onDie:e=>nZ(e),onInterrupt:e=>nX(e),onSequential:(e,t)=>n1(e,t),onParallel:(e,t)=>n0(e,t)}),sa=M(2,(e,t)=>sb(e,{onEmpty:tk(nY),onFail:e=>tk(nQ(e)),onDie:e=>tS(t(e))?tK():tk(nZ(e)),onInterrupt:e=>tk(nX(e)),onSequential:(e,t)=>tS(e)&&tS(t)?tk(n1(e.value,t.value)):tS(e)&&t_(t)?tk(e.value):t_(e)&&tS(t)?tk(t.value):tK(),onParallel:(e,t)=>tS(e)&&tS(t)?tk(n0(e.value,t.value)):tS(e)&&t_(t)?tk(e.value):t_(e)&&tS(t)?tk(t.value):tK()})),so=M(2,(e,t)=>sl(e,e=>nQ(t(e)))),sl=M(2,(e,t)=>sb(e,{onEmpty:nY,onFail:e=>t(e),onDie:e=>nZ(e),onInterrupt:e=>nX(e),onSequential:(e,t)=>n1(e,t),onParallel:(e,t)=>n0(e,t)})),su=(e,t)=>{let r=ic(e),i=ic(t);for(;iN(r)&&iN(i);){let[e,t]=U(ij(r),sx([nO(),il()],([e,t],r)=>{let[i,n]=sf(r);return tk([U(e,nz(i)),U(t,iC(n))])})),[n,s]=U(ij(i),sx([nO(),il()],([e,t],r)=>{let[i,n]=sf(r);return tk([U(e,nz(i)),U(t,iC(n))])}));if(!eP(e,n))return!1;r=t,i=s}return!0},sc=e=>sh(ic(e),il()),sh=(e,t)=>{for(;;){let[r,i]=U(e,r2([nO(),il()],([e,t],r)=>{let[i,n]=sf(r);return[U(e,nz(i)),U(t,iC(n))]})),n=nU(r)>0?U(t,i_(r)):t;if(iT(i))return im(n);e=i,t=n}throw Error(ep("Cause.flattenCauseLoop"))},sp=M(2,(e,t)=>{let r=[e];for(;r.length>0;){let e=r.pop(),i=t(e);switch(i._tag){case"None":switch(e._tag){case nK:case nH:r.push(e.right),r.push(e.left)}break;case"Some":return i}}return tK()}),sf=e=>{let t=e,r=[],i=nO(),n=il();for(;void 0!==t;)switch(t._tag){case nq:if(0===r.length)return[i,n];t=r.pop();break;case nB:if(i=nA(i,iu(t._tag,t.error)),0===r.length)return[i,n];t=r.pop();break;case"Die":if(i=nA(i,iu(t._tag,t.defect)),0===r.length)return[i,n];t=r.pop();break;case nJ:if(i=nA(i,iu(t._tag,t.fiberId)),0===r.length)return[i,n];t=r.pop();break;case nK:switch(t.left._tag){case nq:t=t.right;break;case nK:t=n1(t.left.left,n1(t.left.right,t.right));break;case nH:t=n0(n1(t.left.left,t.right),n1(t.left.right,t.right));break;default:n=i_(n,t.right),t=t.left}break;case nH:r.push(t.right),t=t.left}throw Error(ep("Cause.evaluateCauseLoop"))},sd={emptyCase:D,failCase:L,dieCase:L,interruptCase:D,sequentialCase:(e,t,r)=>t&&r,parallelCase:(e,t,r)=>t&&r},sm="SequentialCase",sg="ParallelCase",sb=M(2,(e,{onDie:t,onEmpty:r,onFail:i,onInterrupt:n,onParallel:s,onSequential:a})=>sy(e,void 0,{emptyCase:()=>r,failCase:(e,t)=>i(t),dieCase:(e,r)=>t(r),interruptCase:(e,t)=>n(t),sequentialCase:(e,t,r)=>a(t,r),parallelCase:(e,t,r)=>s(t,r)})),sx=M(3,(e,t,r)=>{let i=t,n=e,s=[];for(;void 0!==n;){let e=r(i,n);switch(i=tS(e)?e.value:i,n._tag){case nK:case nH:s.push(n.right),n=n.left;break;default:n=void 0}void 0===n&&s.length>0&&(n=s.pop())}return i}),sy=M(3,(e,t,r)=>{let i=[e],n=[];for(;i.length>0;){let e=i.pop();switch(e._tag){case nq:n.push(tA(r.emptyCase(t)));break;case nB:n.push(tA(r.failCase(t,e.error)));break;case"Die":n.push(tA(r.dieCase(t,e.defect)));break;case nJ:n.push(tA(r.interruptCase(t,e.fiberId)));break;case nK:i.push(e.right),i.push(e.left),n.push(tN({_tag:sm}));break;case nH:i.push(e.right),i.push(e.left),n.push(tN({_tag:sg}))}}let s=[];for(;n.length>0;){let e=n.pop();switch(e._tag){case"Left":switch(e.left._tag){case sm:{let e=s.pop(),i=s.pop(),n=r.sequentialCase(t,e,i);s.push(n);break}case sg:{let e=s.pop(),i=s.pop(),n=r.parallelCase(t,e,i);s.push(n)}}break;case"Right":s.push(e.right)}}if(0===s.length)throw Error("BUG: Cause.reduceWithContext - please report an issue at https://github.com/Effect-TS/effect/issues");return s.pop()}),sv=(e,t)=>n6(e)?"All fibers interrupted without errors.":sI(e).map(function(e){return t?.renderErrorCause!==!0||void 0===e.cause?e.stack:`${e.stack} {
${s_(e.cause,"  ")}
}`}).join("\n"),s_=(e,t)=>{let r=e.stack.split("\n"),i=`${t}[cause]: ${r[0]}`;for(let e=1,n=r.length;e<n;e++)i+=`
${t}${r[e]}`;return e.cause&&(i+=` {
${s_(e.cause,`${t}  `)}
${t}}`),i};class sS extends globalThis.Error{constructor(e){let t="object"==typeof e&&null!==e,r=Error.stackTraceLimit;Error.stackTraceLimit=1,super(sw(e),t&&"cause"in e&&void 0!==e.cause?{cause:new sS(e.cause)}:void 0),this.span=void 0,""===this.message&&(this.message="An error has occurred"),Error.stackTraceLimit=r,this.name=e instanceof Error?e.name:"Error",t&&(sE in e&&(this.span=e[sE]),Object.keys(e).forEach(t=>{t in this||(this[t]=e[t])})),this.stack=sO(`${this.name}: ${this.message}`,e instanceof Error&&e.stack?e.stack:"",this.span)}}let sw=e=>{if("string"==typeof e)return e;if("object"==typeof e&&null!==e&&e instanceof Error)return e.message;try{if(en(e,"toString")&&Q(e.toString)&&e.toString!==Object.prototype.toString&&e.toString!==globalThis.Array.prototype.toString)return e.toString()}catch{}return eV(e)},sk=/\((.*)\)/g,sC=H("effect/Tracer/spanToTrace",()=>new WeakMap),sO=(e,t,r)=>{let i=[e],n=t.startsWith(e)?t.slice(e.length).split("\n"):t.split("\n");for(let e=1;e<n.length&&!n[e].includes("Generator.next");e++){if(n[e].includes("effect_internal_function")){i.pop();break}i.push(n[e].replace(/at .*effect_instruction_i.*\((.*)\)/,"at $1").replace(/EffectPrimitive\.\w+/,"<anonymous>"))}if(r){let e=r,t=0;for(;e&&"Span"===e._tag&&t<10;){let r=sC.get(e);if("function"==typeof r){let t=r();if("string"==typeof t){let r=t.matchAll(sk),n=!1;for(let[,t]of r)n=!0,i.push(`    at ${e.name} (${t})`);n||i.push(`    at ${e.name} (${t.replace(/^at /,"")})`)}else i.push(`    at ${e.name}`)}else i.push(`    at ${e.name}`);e=tZ(e.parent),t++}}return i.join("\n")},sE=Symbol.for("effect/SpanAnnotation"),sI=e=>sy(e,void 0,{emptyCase:()=>[],dieCase:(e,t)=>[new sS(t)],failCase:(e,t)=>[new sS(t)],interruptCase:()=>[],parallelCase:(e,t,r)=>[...t,...r],sequentialCase:(e,t,r)=>[...t,...r]}),sF=Symbol.for("effect/Context/Tag"),sR=Symbol.for("effect/Context/Reference"),sT=Symbol.for("effect/STM"),sN={...tu,_op:"Tag",[sT]:tl,[sF]:{_Service:e=>e,_Identifier:e=>e},toString(){return eB(this.toJSON())},toJSON(){return{_id:"Tag",key:this.key,stack:this.stack}},[eU](){return this.toJSON()},of:e=>e,context(e){return sU(this,e)}},sA={...sN,[sR]:sR},sj=Symbol.for("effect/Context"),sM={[sj]:{_Services:e=>e},[ez](e){if(sD(e)&&this.unsafeMap.size===e.unsafeMap.size){for(let t of this.unsafeMap.keys())if(!e.unsafeMap.has(t)||!eP(this.unsafeMap.get(t),e.unsafeMap.get(t)))return!1;return!0}return!1},[ek](){return eM(this,eR(this.unsafeMap.size))},pipe(){return eX(this,arguments)},toString(){return eB(this.toJSON())},toJSON(){return{_id:"Context",services:Array.from(this.unsafeMap).map(eq)}},[eU](){return this.toJSON()}},sz=e=>{let t=Object.create(sM);return t.unsafeMap=e,t},sP=e=>{let t=Error(`Service not found${e.key?`: ${String(e.key)}`:""}`);if(e.stack){let r=e.stack.split("\n");if(r.length>2){let e=r[2].match(/at (.*)/);e&&(t.message=t.message+` (defined at ${e[1]})`)}}if(t.stack){let e=t.stack.split("\n");e.splice(1,3),t.stack=e.join("\n")}return t},sD=e=>en(e,sj),sL=e=>en(e,sR),s$=sz(new Map),sU=(e,t)=>sz(new Map([[e.key,t]])),sq=M(3,(e,t,r)=>{let i=new Map(e.unsafeMap);return i.set(t.key,r),sz(i)}),sB=H("effect/Context/defaultValueCache",()=>new Map),sJ=e=>{if(sB.has(e.key))return sB.get(e.key);let t=e.defaultValue();return sB.set(e.key,t),t},sH=(e,t)=>e.unsafeMap.has(t.key)?e.unsafeMap.get(t.key):sJ(t),sK=M(2,(e,t)=>{if(!e.unsafeMap.has(t.key)){if(sR in t)return sJ(t);throw sP(t)}return e.unsafeMap.get(t.key)}),sV=M(2,(e,t)=>e.unsafeMap.has(t.key)?tk(e.unsafeMap.get(t.key)):sL(t)?tk(sJ(t)):tw),sW=M(2,(e,t)=>{let r=new Map(e.unsafeMap);for(let[e,i]of t.unsafeMap)r.set(e,i);return sz(r)}),sG=e=>{let t=Error.stackTraceLimit;Error.stackTraceLimit=2;let r=Error();Error.stackTraceLimit=t;let i=Object.create(sN);return Object.defineProperty(i,"stack",{get:()=>r.stack}),i.key=e,i},sY=e=>en(e,sF),sQ=()=>s$,sZ=e=>()=>{let t=Error.stackTraceLimit;Error.stackTraceLimit=2;let r=Error();function i(){}return Error.stackTraceLimit=t,Object.setPrototypeOf(i,sN),i.key=e,Object.defineProperty(i,"stack",{get:()=>r.stack}),i},sX=()=>(e,t)=>{let r=Error.stackTraceLimit;Error.stackTraceLimit=2;let i=Error();function n(){}return Error.stackTraceLimit=r,Object.setPrototypeOf(n,sA),n.key=e,n.defaultValue=t.defaultValue,Object.defineProperty(n,"stack",{get:()=>i.stack}),n},s0=Symbol.for("effect/Duration"),s1=BigInt(0),s2=BigInt(24),s3=BigInt(60),s5=BigInt(1e3),s4=BigInt(1e6),s6=BigInt(1e9),s8=/^(-?\d+(?:\.\d+)?)\s+(nanos?|micros?|millis?|seconds?|minutes?|hours?|days?|weeks?)$/,s7=e=>{if(ai(e))return e;if(V(e))return al(e);if(G(e))return aa(e);if(Array.isArray(e)){if(2===e.length&&V(e[0])&&V(e[1]))return aa(BigInt(e[0])*s6+BigInt(e[1]))}else if(K(e)){s8.lastIndex=0;let t=s8.exec(e);if(t){let[e,r,i]=t,n=Number(r);switch(i){case"nano":case"nanos":return aa(BigInt(r));case"micro":case"micros":return ao(BigInt(r));case"milli":case"millis":return al(n);case"second":case"seconds":return au(n);case"minute":case"minutes":return ac(n);case"hour":case"hours":return ah(n);case"day":case"days":return ap(n);case"week":case"weeks":return af(n)}}}throw Error("Invalid DurationInput")},s9={_tag:"Millis",millis:0},ae={_tag:"Infinity"},at={[s0]:s0,[ek](){return eM(this,eA(this.value))},[ez](e){return ai(e)&&ak(this,e)},toString(){return`Duration(${aO(this)})`},toJSON(){switch(this.value._tag){case"Millis":return{_id:"Duration",_tag:"Millis",millis:this.value.millis};case"Nanos":return{_id:"Duration",_tag:"Nanos",hrtime:ab(this)};case"Infinity":return{_id:"Duration",_tag:"Infinity"}}},[eU](){return this.toJSON()},pipe(){return eX(this,arguments)}},ar=e=>{let t=Object.create(at);return V(e)?isNaN(e)||e<=0?t.value=s9:Number.isFinite(e)?Number.isInteger(e)?t.value={_tag:"Millis",millis:e}:t.value={_tag:"Nanos",nanos:BigInt(Math.round(1e6*e))}:t.value=ae:e<=s1?t.value=s9:t.value={_tag:"Nanos",nanos:e},t},ai=e=>en(e,s0),an=e=>"Infinity"!==e.value._tag,as=ar(0),aa=e=>ar(e),ao=e=>ar(e*s5),al=e=>ar(e),au=e=>ar(1e3*e),ac=e=>ar(6e4*e),ah=e=>ar(36e5*e),ap=e=>ar(864e5*e),af=e=>ar(6048e5*e),ad=e=>ax(e,{onMillis:e=>e,onNanos:e=>Number(e)/1e6}),am=e=>ax(e,{onMillis:e=>e/1e3,onNanos:e=>Number(e)/1e9}),ag=e=>{let t=s7(e);switch(t.value._tag){case"Infinity":throw Error("Cannot convert infinite duration to nanos");case"Nanos":return t.value.nanos;case"Millis":return BigInt(Math.round(1e6*t.value.millis))}},ab=e=>{let t=s7(e);switch(t.value._tag){case"Infinity":return[1/0,0];case"Nanos":return[Number(t.value.nanos/s6),Number(t.value.nanos%s6)];case"Millis":return[Math.floor(t.value.millis/1e3),Math.round(t.value.millis%1e3*1e6)]}},ax=M(2,(e,t)=>{let r=s7(e);switch(r.value._tag){case"Nanos":return t.onNanos(r.value.nanos);case"Infinity":return t.onMillis(1/0);case"Millis":return t.onMillis(r.value.millis)}}),ay=M(3,(e,t,r)=>{let i=s7(e),n=s7(t);if("Infinity"===i.value._tag||"Infinity"===n.value._tag)return r.onMillis(ad(i),ad(n));if("Nanos"===i.value._tag||"Nanos"===n.value._tag){let e="Nanos"===i.value._tag?i.value.nanos:BigInt(Math.round(1e6*i.value.millis)),t="Nanos"===n.value._tag?n.value.nanos:BigInt(Math.round(1e6*n.value.millis));return r.onNanos(e,t)}return r.onMillis(i.value.millis,n.value.millis)}),av=(e,t)=>ay(e,t,{onMillis:(e,t)=>e===t,onNanos:(e,t)=>e===t}),a_=M(2,(e,t)=>ay(e,t,{onMillis:(e,t)=>ar(e+t),onNanos:(e,t)=>ar(e+t)})),aS=((e,t)=>ay(e,t,{onMillis:(e,t)=>e<t,onNanos:(e,t)=>e<t}),M(2,(e,t)=>ay(e,t,{onMillis:(e,t)=>e>t,onNanos:(e,t)=>e>t}))),aw=M(2,(e,t)=>ay(e,t,{onMillis:(e,t)=>e>=t,onNanos:(e,t)=>e>=t})),ak=M(2,(e,t)=>av(s7(e),s7(t))),aC=e=>{let t=s7(e);if("Infinity"===t.value._tag)return{days:1/0,hours:1/0,minutes:1/0,seconds:1/0,millis:1/0,nanos:1/0};let r=ag(t),i=r/s4,n=i/s5,s=n/s3,a=s/s3;return{days:Number(a/s2),hours:Number(a%s2),minutes:Number(s%s3),seconds:Number(n%s3),millis:Number(i%s5),nanos:Number(r%s4)}},aO=e=>{let t=s7(e);if("Infinity"===t.value._tag)return"Infinity";let r=aC(t),i=[];return 0!==r.days&&i.push(`${r.days}d`),0!==r.hours&&i.push(`${r.hours}h`),0!==r.minutes&&i.push(`${r.minutes}m`),0!==r.seconds&&i.push(`${r.seconds}s`),0!==r.millis&&i.push(`${r.millis}ms`),0!==r.nanos&&i.push(`${r.nanos}ns`),i.join(" ")},aE=Symbol.for("effect/MutableRef"),aI={[aE]:aE,toString(){return eB(this.toJSON())},toJSON(){return{_id:"MutableRef",current:eq(this.current)}},[eU](){return this.toJSON()},pipe(){return eX(this,arguments)}},aF=e=>{let t=Object.create(aI);return t.current=e,t},aR=M(3,(e,t,r)=>!!eP(t,e.current)&&(e.current=r,!0)),aT=e=>e.current,aN=M(2,(e,t)=>(e.current=t,e)),aA="effect/FiberId",aj=Symbol.for(aA),aM="None",az="Runtime",aP="Composite",aD=eT(`${aA}-${aM}`);class aL{[ek](){return aD}[ez](e){return aB(e)&&e._tag===aM}toString(){return eB(this.toJSON())}toJSON(){return{_id:"FiberId",_tag:this._tag}}[eU](){return this.toJSON()}constructor(){this[aj]=aj,this._tag=aM,this.id=-1,this.startTimeMillis=-1}}class a${constructor(e,t){this[aj]=aj,this._tag=az,this.id=e,this.startTimeMillis=t}[ek](){return eM(this,eT(`${aA}-${this._tag}-${this.id}-${this.startTimeMillis}`))}[ez](e){return aB(e)&&e._tag===az&&this.id===e.id&&this.startTimeMillis===e.startTimeMillis}toString(){return eB(this.toJSON())}toJSON(){return{_id:"FiberId",_tag:this._tag,id:this.id,startTimeMillis:this.startTimeMillis}}[eU](){return this.toJSON()}}class aU{constructor(e,t){this[aj]=aj,this._tag=aP,this.left=e,this.right=t}[ek](){return U(eT(`${aA}-${this._tag}`),eE(eC(this.left)),eE(eC(this.right)),eM(this))}[ez](e){return aB(e)&&e._tag===aP&&eP(this.left,e.left)&&eP(this.right,e.right)}toString(){return eB(this.toJSON())}toJSON(){return{_id:"FiberId",_tag:this._tag,left:eq(this.left),right:eq(this.right)}}[eU](){return this.toJSON()}}let aq=new aL,aB=e=>en(e,aj),aJ=e=>e._tag===aM||U(aY(e),nF(e=>aJ(e))),aH=M(2,(e,t)=>e._tag===aM?t:t._tag===aM?e:new aU(e,t)),aK=M(2,(e,t)=>aJ(e)?t:e),aV=e=>{switch(e._tag){case aM:return nO();case az:return n$(e.id);case aP:return U(aV(e.left),nz(aV(e.right)))}},aW=H(Symbol.for("effect/Fiber/Id/_fiberCounter"),()=>aF(0)),aG=e=>Array.from(aV(e)).map(e=>`#${e}`).join(","),aY=e=>{switch(e._tag){case aM:return nO();case az:return n$(e);case aP:return U(aY(e.left),nz(aY(e.right)))}},aQ=aq,aZ=(e,t)=>new a$(e,t),aX=(e,t)=>new aU(e,t),a0=()=>{let e=aT(aW);return U(aW,aN(e+1)),new a$(e,Date.now())},a1=e=>{let t=np(ni());for(let r of e)nl(t,r[0],r[1]);return nf(t)},a2=e=>e&&iQ(e._root),a3=Symbol.for("effect/List"),a5=e=>rd(e),a4=tB(tJ(eP),a5),a6={[a3]:a3,_tag:"Cons",toString(){return eB(this.toJSON())},toJSON(){return{_id:"List",_tag:"Cons",values:a5(this).map(eq)}},[eU](){return this.toJSON()},[ez](e){return oe(e)&&this._tag===e._tag&&a4(this,e)},[ek](){return eM(this,ej(a5(this)))},[Symbol.iterator](){let e=!1,t=this;return{next(){if(e)return this.return();if("Nil"===t._tag)return e=!0,this.return();let r=t.head;return t=t.tail,{done:e,value:r}},return:t=>(e||(e=!0),{done:!0,value:t})}},pipe(){return eX(this,arguments)}},a8=(e,t)=>{let r=Object.create(a6);return r.head=e,r.tail=t,r},a7=eT("Nil"),a9=Object.create({[a3]:a3,_tag:"Nil",toString(){return eB(this.toJSON())},toJSON:()=>({_id:"List",_tag:"Nil"}),[eU](){return this.toJSON()},[ek]:()=>a7,[ez](e){return oe(e)&&this._tag===e._tag},[Symbol.iterator]:()=>({next:()=>({done:!0,value:void 0})}),pipe(){return eX(this,arguments)}}),oe=e=>en(e,a3),ot=e=>"Nil"===e._tag,or=e=>"Cons"===e._tag,oi=(e,t)=>a8(e,t),on=()=>a9,os=e=>a8(e,a9),oa=M(2,(e,t)=>ol(t,e)),oo=M(2,(e,t)=>oi(t,e)),ol=M(2,(e,t)=>{if(ot(e))return t;if(ot(t))return e;{let r=a8(t.head,e),i=r,n=t.tail;for(;!ot(n);){let t=a8(n.head,e);i.tail=t,i=t,n=n.tail}return r}}),ou=M(3,(e,t,r)=>{let i=t,n=e;for(;!ot(n);)i=r(i,n.head),n=n.tail;return i}),oc=e=>{let t=on(),r=e;for(;!ot(r);)t=oo(t,r.head),r=r.tail;return t},oh="Expected List to be non-empty",op=e=>{if(ot(e))throw Error(oh);return e.head},of=e=>{if(ot(e))throw Error(oh);return e.tail};Array.prototype;let od=function(){function e(e){e&&Object.assign(this,e)}return e.prototype=tc,e}(),om=e=>Object.assign(Object.create(tc),e),og=Symbol.for("effect/DifferChunkPatch");function ob(e){return e}({...od.prototype,[og]:{_Value:ob,_Patch:ob}});let ox=Symbol.for("effect/DifferContextPatch");function oy(e){return e}let ov={...od.prototype,[ox]:{_Value:oy,_Patch:oy}},o_=Object.create(Object.assign(Object.create(ov),{_tag:"Empty"})),oS=()=>o_,ow=Object.assign(Object.create(ov),{_tag:"AndThen"}),ok=(e,t)=>{let r=Object.create(ow);return r.first=e,r.second=t,r},oC=Object.assign(Object.create(ov),{_tag:"AddService"}),oO=(e,t)=>{let r=Object.create(oC);return r.key=e,r.service=t,r},oE=Object.assign(Object.create(ov),{_tag:"RemoveService"}),oI=e=>{let t=Object.create(oE);return t.key=e,t},oF=Object.assign(Object.create(ov),{_tag:"UpdateService"}),oR=(e,t)=>{let r=Object.create(oF);return r.key=e,r.update=t,r},oT=(e,t)=>{let r=new Map(e.unsafeMap),i=oS();for(let[e,n]of t.unsafeMap.entries())if(r.has(e)){let t=r.get(e);r.delete(e),eP(t,n)||(i=oN(oR(e,()=>n))(i))}else r.delete(e),i=oN(oO(e,n))(i);for(let[e]of r.entries())i=oN(oI(e))(i);return i},oN=M(2,(e,t)=>ok(e,t)),oA=M(2,(e,t)=>{if("Empty"===e._tag)return t;let r=!1,i=ic(e),n=new Map(t.unsafeMap);for(;iN(i);){let e=ij(i),t=iL(i);switch(e._tag){case"Empty":i=t;break;case"AddService":n.set(e.key,e.service),i=t;break;case"AndThen":i=i_(i_(t,e.second),e.first);break;case"RemoveService":n.delete(e.key),i=t;break;case"UpdateService":n.set(e.key,e.update(n.get(e.key))),r=!0,i=t}}if(!r)return sz(n);let s=new Map;for(let[e]of t.unsafeMap)n.has(e)&&(s.set(e,n.get(e)),n.delete(e));for(let[e,t]of n)s.set(e,t);return sz(s)}),oj=Symbol.for("effect/DifferHashMapPatch");function oM(e){return e}({...od.prototype,[oj]:{_Value:oM,_Key:oM,_Patch:oM}});let oz=Symbol.for("effect/DifferHashSetPatch");function oP(e){return e}let oD={...od.prototype,[oz]:{_Value:oP,_Key:oP,_Patch:oP}},oL=Object.create(Object.assign(Object.create(oD),{_tag:"Empty"})),o$=()=>oL,oU=Object.assign(Object.create(oD),{_tag:"AndThen"}),oq=(e,t)=>{let r=Object.create(oU);return r.first=e,r.second=t,r},oB=Object.assign(Object.create(oD),{_tag:"Add"}),oJ=e=>{let t=Object.create(oB);return t.value=e,t},oH=Object.assign(Object.create(oD),{_tag:"Remove"}),oK=e=>{let t=Object.create(oH);return t.value=e,t},oV=(e,t)=>{let[r,i]=nD([e,o$()],([e,t],r)=>nE(r)(e)?[nj(r)(e),t]:[e,oW(oJ(r))(t)])(t);return nD(i,(e,t)=>oW(oK(t))(e))(r)},oW=M(2,(e,t)=>oq(e,t)),oG=M(2,(e,t)=>{if("Empty"===e._tag)return t;let r=t,i=ic(e);for(;iN(i);){let e=ij(i),t=iL(i);switch(e._tag){case"Empty":i=t;break;case"AndThen":i=i_(e.first)(i_(e.second)(t));break;case"Add":r=nA(e.value)(r),i=t;break;case"Remove":r=nj(e.value)(r),i=t}}return r}),oY=Symbol.for("effect/DifferOrPatch");function oQ(e){return e}let oZ={...od.prototype,[oY]:{_Value:oQ,_Key:oQ,_Patch:oQ}},oX=Object.create(Object.assign(Object.create(oZ),{_tag:"Empty"})),o0=Object.assign(Object.create(oZ),{_tag:"AndThen"}),o1=(e,t)=>{let r=Object.create(o0);return r.first=e,r.second=t,r},o2=Object.assign(Object.create(oZ),{_tag:"SetLeft"}),o3=Object.assign(Object.create(oZ),{_tag:"SetRight"}),o5=Object.assign(Object.create(oZ),{_tag:"UpdateLeft"}),o4=Object.assign(Object.create(oZ),{_tag:"UpdateRight"}),o6=((e,t)=>o1(e,t),Symbol.for("effect/DifferReadonlyArrayPatch"));function o8(e){return e}let o7={...od.prototype,[o6]:{_Value:o8,_Patch:o8}},o9=Object.create(Object.assign(Object.create(o7),{_tag:"Empty"})),le=()=>o9,lt=Object.assign(Object.create(o7),{_tag:"AndThen"}),lr=(e,t)=>{let r=Object.create(lt);return r.first=e,r.second=t,r},li=Object.assign(Object.create(o7),{_tag:"Append"}),ln=e=>{let t=Object.create(li);return t.values=e,t},ls=Object.assign(Object.create(o7),{_tag:"Slice"}),la=(e,t)=>{let r=Object.create(ls);return r.from=e,r.until=t,r},lo=Object.assign(Object.create(o7),{_tag:"Update"}),ll=(e,t)=>{let r=Object.create(lo);return r.index=e,r.patch=t,r},lu=e=>{let t=0,r=le();for(;t<e.oldValue.length&&t<e.newValue.length;){let i=e.oldValue[t],n=e.newValue[t],s=e.differ.diff(i,n);eP(s,e.differ.empty)||(r=lc(r,ll(t,s))),t+=1}return t<e.oldValue.length&&(r=lc(r,la(0,t))),t<e.newValue.length&&(r=lc(r,ln(rM(t)(e.newValue)))),r},lc=M(2,(e,t)=>lr(e,t)),lh=M(3,(e,t,r)=>{if("Empty"===e._tag)return t;let i=t.slice(),n=rV(e);for(;tH(n);){let e=rF(n),t=rN(n);switch(e._tag){case"Empty":n=t;break;case"AndThen":t.unshift(e.first,e.second),n=t;break;case"Append":for(let t of e.values)i.push(t);n=t;break;case"Slice":i=i.slice(e.from,e.until),n=t;break;case"Update":i[e.index]=r.patch(e.patch,i[e.index]),n=t}}return i}),lp={[Symbol.for("effect/Differ")]:{_P:z,_V:z}},lf=e=>{let t=Object.create(lp);return t.empty=e.empty,t.diff=e.diff,t.combine=e.combine,t.patch=e.patch,t},ld=()=>lf({empty:oS(),combine:(e,t)=>oN(t)(e),diff:(e,t)=>oT(e,t),patch:(e,t)=>oA(t)(e)}),lm=()=>lf({empty:o$(),combine:(e,t)=>oW(t)(e),diff:(e,t)=>oV(e,t),patch:(e,t)=>oG(t)(e)}),lg=e=>lf({empty:le(),combine:(e,t)=>lc(e,t),diff:(t,r)=>lu({oldValue:t,newValue:r,differ:e}),patch:(t,r)=>lh(t,r,e)}),lb=()=>lx((e,t)=>t),lx=e=>lf({empty:z,combine:(e,t)=>e===z?t:t===z?e:r=>t(e(r)),diff:(e,t)=>eP(e,t)?z:P(t),patch:(t,r)=>e(r,t(r))}),ly=e=>255&e,lv=e=>e>>8&255,l_=(e,t)=>(255&e)+((t&e&255)<<8),lS=l_(0,0),lw=M(2,(e,t)=>l_(ly(e)&~t,lv(e))),lk=M(2,(e,t)=>e|t),lC=e=>~e>>>0&255,lO=e=>lR(e,32),lE=((e,t)=>e&~t,M(2,(e,t)=>e|t)),lI=e=>lF(e)&&!lj(e),lF=e=>lR(e,1),lR=M(2,(e,t)=>(e&t)!=0),lT=(...e)=>e.reduce((e,t)=>e|t,0),lN=lT(0),lA=e=>lR(e,4),lj=e=>lR(e,16),lM=M(2,(e,t)=>l_(e^t,t)),lz=M(2,(e,t)=>e&(lC(ly(t))|lv(t))|ly(t)&lv(t)),lP=lf({empty:lS,diff:(e,t)=>lM(e,t),combine:(e,t)=>lk(t)(e),patch:(e,t)=>lz(t,e)}),lD=e=>l_(e,e),lL=e=>l_(e,0),l$="Pending",lU="Done",lq=Symbol.for("effect/Deferred"),lB={_E:e=>e,_A:e=>e},lJ=e=>({_tag:l$,joiners:e}),lH=e=>({_tag:lU,effect:e});class lK{constructor(e){this.called=!1,this.self=e}next(e){return this.called?{value:e,done:!0}:(this.called=!0,{value:this.self,done:!1})}return(e){return{value:e,done:!0}}throw(e){throw e}[Symbol.iterator](){return new lK(this.self)}}let lV=Symbol.for("effect/EffectError"),lW=e=>en(e,lV),lG=e=>({[lV]:lV,_tag:"EffectError",cause:e}),lY=(e,t)=>{let r=new l0("Blocked");return r.effect_instruction_i0=e,r.effect_instruction_i1=t,r},lQ=e=>{let t=new l0("RunBlocked");return t.effect_instruction_i0=e,t},lZ=Symbol.for("effect/Effect");class lX{constructor(e,t){this._op=ti,this.patch=e,this.op=t}}class l0{constructor(e){this.effect_instruction_i0=void 0,this.effect_instruction_i1=void 0,this.effect_instruction_i2=void 0,this.trace=void 0,this[lZ]=tl,this._op=e}[ez](e){return this===e}[ek](){return eM(this,eO(this))}pipe(){return eX(this,arguments)}toJSON(){return{_id:"Effect",_op:this._op,effect_instruction_i0:eq(this.effect_instruction_i0),effect_instruction_i1:eq(this.effect_instruction_i1),effect_instruction_i2:eq(this.effect_instruction_i2)}}toString(){return eB(this.toJSON())}[eU](){return this.toJSON()}[Symbol.iterator](){return new lK(new eb(this))}}class l1{constructor(e){this.effect_instruction_i0=void 0,this.effect_instruction_i1=void 0,this.effect_instruction_i2=void 0,this.trace=void 0,this[lZ]=tl,this._op=e,this._tag=e}[ez](e){return ht(e)&&"Failure"===e._op&&eP(this.effect_instruction_i0,e.effect_instruction_i0)}[ek](){return U(eT(this._tag),eE(eC(this.effect_instruction_i0)),eM(this))}get cause(){return this.effect_instruction_i0}pipe(){return eX(this,arguments)}toJSON(){return{_id:"Exit",_tag:this._op,cause:this.cause.toJSON()}}toString(){return eB(this.toJSON())}[eU](){return this.toJSON()}[Symbol.iterator](){return new lK(new eb(this))}}class l2{constructor(e){this.effect_instruction_i0=void 0,this.effect_instruction_i1=void 0,this.effect_instruction_i2=void 0,this.trace=void 0,this[lZ]=tl,this._op=e,this._tag=e}[ez](e){return ht(e)&&"Success"===e._op&&eP(this.effect_instruction_i0,e.effect_instruction_i0)}[ek](){return U(eT(this._tag),eE(eC(this.effect_instruction_i0)),eM(this))}get value(){return this.effect_instruction_i0}pipe(){return eX(this,arguments)}toJSON(){return{_id:"Exit",_tag:this._op,value:eq(this.value)}}toString(){return eB(this.toJSON())}[eU](){return this.toJSON()}[Symbol.iterator](){return new lK(new eb(this))}}let l3=e=>en(e,lZ),l5=e=>{let t=new l0(tt);return t.effect_instruction_i0=e,t},l4=M(3,(e,t,r)=>uW(i=>ux(e,e=>ux(uh(uq(()=>i(t(e)))),t=>uq(()=>r(e,t)).pipe(uw({onFailure:e=>{switch(t._tag){case e2:return ud(n1(t.effect_instruction_i0,e));case e6:return ud(e)}},onSuccess:()=>t})))))),l6=M(2,(e,t)=>ux(e,()=>uU(t))),l8=e=>l6(e,void 0),l7=function(){let e=new l0(e1);switch(arguments.length){case 2:e.effect_instruction_i0=arguments[0],e.commit=arguments[1];break;case 3:e.effect_instruction_i0=arguments[0],e.effect_instruction_i1=arguments[1],e.commit=arguments[2];break;case 4:e.effect_instruction_i0=arguments[0],e.effect_instruction_i1=arguments[1],e.effect_instruction_i2=arguments[2],e.commit=arguments[3];break;default:throw Error(ep("you're not supposed to end up here"))}return e},l9=(e,t=aQ)=>{let r;let i=new l0(e0);return i.effect_instruction_i0=t=>{r=e(t)},i.effect_instruction_i1=t,uz(i,e=>l3(r)?r:uG)},ue=(e,t=aQ)=>uq(()=>l9(e,t)),ut=(e,t=aQ)=>l7(e,function(){let e,r,i,n;function s(t){e?e(t):void 0===r&&(r=t)}let a=new l0(e0);return a.effect_instruction_i0=t=>{e=t,r&&t(r)},a.effect_instruction_i1=t,1!==this.effect_instruction_i0.length?(n=new AbortController,i=ev(()=>this.effect_instruction_i0(s,n.signal))):i=ev(()=>this.effect_instruction_i0(s)),i||n?uz(a,e=>(n&&n.abort(),i??uG)):a}),ur=M(2,(e,t)=>{let r=new l0(e3);return r.effect_instruction_i0=e,r.effect_instruction_i1=t,r}),ui=M(2,(e,t)=>uk(e,{onFailure:t,onSuccess:uU})),un=M(3,(e,t,r)=>ur(e,e=>{let i=st(e);switch(i._tag){case"Left":return t(i.left)?r(i.left):ud(e);case"Right":return ud(i.right)}})),us=Symbol.for("effect/SpanAnnotation"),ua=Symbol.for("effect/OriginalAnnotation"),uo=(e,t)=>tS(t)?new Proxy(e,{has:(e,t)=>t===us||t===ua||t in e,get:(r,i)=>i===us?t.value:i===ua?e:r[i]}):e,ul=e=>!ei(e)||us in e?ud(nZ(e)):l5(t=>ud(nZ(uo(e,hL(t))))),uu=e=>um(()=>nZ(new cZ(e))),uc=e=>uk(e,{onFailure:e=>uU(tN(e)),onSuccess:e=>uU(tA(e))}),uh=e=>uS(e,{onFailure:hu,onSuccess:hg}),up=e=>!ei(e)||us in e?ud(nQ(e)):l5(t=>ud(nQ(uo(e,hL(t))))),uf=e=>ux(uB(e),up),ud=e=>{let t=new l1(e2);return t.effect_instruction_i0=e,t},um=e=>ux(uB(e),ud),ug=l5(e=>uU(e.id())),ub=e=>l5(t=>e(t.id())),ux=M(2,(e,t)=>{let r=new l0(e5);return r.effect_instruction_i0=e,r.effect_instruction_i1=t,r}),uy=M(2,(e,t)=>ux(e,e=>{let r="function"==typeof t?t(e):t;return l3(r)?r:eh(r)?l9(e=>{r.then(t=>e(uU(t)),t=>e(up(new he(t))))}):uU(r)})),uv=e=>{let t=new l0("OnStep");return t.effect_instruction_i0=e,t},u_=e=>ux(e,z),uS=M(2,(e,t)=>uw(e,{onFailure:e=>uU(t.onFailure(e)),onSuccess:e=>uU(t.onSuccess(e))})),uw=M(2,(e,t)=>{let r=new l0(e4);return r.effect_instruction_i0=e,r.effect_instruction_i1=t.onFailure,r.effect_instruction_i2=t.onSuccess,r}),uk=M(2,(e,t)=>uw(e,{onFailure:e=>{if(n7(e).length>0)return ud(ss(e));let r=n8(e);return r.length>0?t.onFailure(ij(r)):ud(e)},onSuccess:t.onSuccess})),uC=M(2,(e,t)=>uq(()=>{let r=rd(e),i=rp(r.length),n=0;return l6(uZ({while:()=>n<r.length,body:()=>t(r[n],n),step:e=>{i[n++]=e}}),i)})),uO=M(2,(e,t)=>uq(()=>{let r=rd(e),i=0;return uZ({while:()=>i<r.length,body:()=>t(r[i],i),step:()=>{i++}})})),uE=M(e=>"boolean"==typeof e[0]||l3(e[0]),(e,t)=>l3(e)?ux(e,e=>e?t.onTrue():t.onFalse()):e?t.onTrue():t.onFalse()),uI=ux(ug,e=>uF(e)),uF=e=>ud(nX(e)),uR=e=>{let t=new l0(e7);return t.effect_instruction_i0=lD(1),t.effect_instruction_i1=()=>e,t},uT=M(2,(e,t)=>uW(r=>ux(uh(r(e)),e=>hE(t,e)))),uN=M(2,(e,t)=>ux(e,e=>uB(()=>t(e)))),uA=M(2,(e,t)=>uk(e,{onFailure:e=>uf(()=>t.onFailure(e)),onSuccess:e=>uB(()=>t.onSuccess(e))})),uj=M(2,(e,t)=>uw(e,{onFailure:e=>{let r=st(e);switch(r._tag){case"Left":return uf(()=>t(r.left));case"Right":return ud(r.right)}},onSuccess:uU})),uM=((e,t)=>uM(e,e=>hi(e)?uG:t(e.effect_instruction_i0)),M(2,(e,t)=>uW(r=>uw(r(e),{onFailure:e=>{let r=hu(e);return uw(t(r),{onFailure:t=>hu(n1(e,t)),onSuccess:()=>r})},onSuccess:e=>{let r=hg(e);return u5(t(r),r)}})))),uz=M(2,(e,t)=>uM(e,hd({onFailure:e=>n6(e)?l8(t(n9(e))):uG,onSuccess:()=>uG}))),uP=M(2,(e,t)=>uK(e,t,uU)),uD=e=>uL(e,z),uL=M(2,(e,t)=>uk(e,{onFailure:e=>ul(t(e)),onSuccess:uU})),u$=l5((e,t)=>uU(t.runtimeFlags)),uU=e=>{let t=new l2(e6);return t.effect_instruction_i0=e,t},uq=e=>{let t=new l0(e1);return t.commit=e,t},uB=e=>{let t=new l0(e8);return t.effect_instruction_i0=e,t},uJ=M(e=>3===e.length||2===e.length&&!(ei(e[1])&&"onlyEffect"in e[1]),(e,t)=>ux(e,e=>{let r="function"==typeof t?t(e):t;return l3(r)?l6(r,e):eh(r)?l9(t=>{r.then(r=>t(uU(e)),e=>t(up(new he(e))))}):uU(e)})),uH=e=>l5(t=>{let r=U(t.getFiberRef(cz),tW(()=>t.scope()));return e(cx(cz,tk(r)))}),uK=M(3,(e,t,r)=>uw(e,{onFailure:e=>n7(e).length>0?ud(t0(si(e))):t(),onSuccess:r})),uV=e=>{let t=new l0(e7);return t.effect_instruction_i0=lL(1),t.effect_instruction_i1=()=>e,t},uW=e=>l7(e,function(){let e=new l0(e7);return e.effect_instruction_i0=lL(1),e.effect_instruction_i1=e=>lF(e)?ev(()=>this.effect_instruction_i0(uR)):ev(()=>this.effect_instruction_i0(uV)),e}),uG=uU(void 0),uY=e=>{let t=new l0(e7);return t.effect_instruction_i0=e,t.effect_instruction_i1=void 0,t},uQ=M(2,(e,t)=>ux(t,t=>t?U(e,uN(tk)):uU(tK()))),uZ=e=>{let t=new l0(e9);return t.effect_instruction_i0=e.while,t.effect_instruction_i1=e.body,t.effect_instruction_i2=e.step,t},uX=e=>uq(()=>{let t=new l0(te);return t.effect_instruction_i0=e(),t}),u0=M(2,(e,t)=>{let r=new l0(e7);return r.effect_instruction_i0=t,r.effect_instruction_i1=()=>e,r}),u1=e=>{let t=new l0(tr);return void 0!==e?.priority?cT(t,e.priority):t},u2=M(2,(e,t)=>ux(e,e=>uN(t,t=>[e,t]))),u3=M(2,(e,t)=>ux(e,e=>l6(t,e))),u5=M(2,(e,t)=>ux(e,()=>t)),u4=M(3,(e,t,r)=>ux(e,e=>uN(t,t=>r(e,t)))),u6=(()=>{let e=setInterval(()=>{},0x80000000-1);return uB(()=>clearInterval(e))},e=>ux(ug,t=>U(e,u8(t)))),u8=M(2,(e,t)=>ux(e.interruptAsFork(t),()=>e.await)),u7={_tag:"All",syslog:0,label:"ALL",ordinal:Number.MIN_SAFE_INTEGER,pipe(){return eX(this,arguments)}},u9={_tag:"Fatal",syslog:2,label:"FATAL",ordinal:5e4,pipe(){return eX(this,arguments)}},ce={_tag:"Error",syslog:3,label:"ERROR",ordinal:4e4,pipe(){return eX(this,arguments)}},ct={_tag:"Warning",syslog:4,label:"WARN",ordinal:3e4,pipe(){return eX(this,arguments)}},cr={_tag:"Info",syslog:6,label:"INFO",ordinal:2e4,pipe(){return eX(this,arguments)}},ci={_tag:"Debug",syslog:7,label:"DEBUG",ordinal:1e4,pipe(){return eX(this,arguments)}},cn={_tag:"Trace",syslog:7,label:"TRACE",ordinal:0,pipe(){return eX(this,arguments)}},cs={_tag:"None",syslog:7,label:"OFF",ordinal:Number.MAX_SAFE_INTEGER,pipe(){return eX(this,arguments)}},ca=[u7,cn,ci,cr,ct,ce,u9,cs],co=Symbol.for("effect/FiberRef"),cl={_A:e=>e},cu=e=>l5(t=>hg(t.getFiberRef(e))),cc=M(2,(e,t)=>ux(cu(e),t)),ch=M(2,(e,t)=>cp(e,()=>[void 0,t])),cp=M(2,(e,t)=>l5(r=>{let[i,n]=t(r.getFiberRef(e));return r.setFiberRef(e,n),uU(i)})),cf=M(2,(e,t)=>cp(e,e=>[void 0,t(e)])),cd=Symbol.for("effect/RequestResolver"),cm={_A:e=>e,_R:e=>e};class cg{constructor(e,t){this[cd]=cm,this.runAll=e,this.target=t}[ek](){return eM(this,this.target?eC(this.target):eO(this))}[ez](e){return this.target?cb(e)&&eP(this.target,e.target):this===e}identified(...e){return new cg(this.runAll,ih(e))}pipe(){return eX(this,arguments)}}let cb=e=>en(e,cd),cx=M(3,(e,t,r)=>l4(u3(cu(t),ch(t,r)),()=>e,e=>ch(t,e))),cy=M(3,(e,t,r)=>cc(t,i=>cx(e,t,r(i)))),cv=(e,t)=>ck(e,{differ:lb(),fork:t?.fork??z,join:t?.join}),c_=e=>{let t=lm();return ck(e,{differ:t,fork:t.empty})},cS=e=>{let t=lg(lb());return ck(e,{differ:t,fork:t.empty})},cw=e=>{let t=ld();return ck(e,{differ:t,fork:t.empty})},ck=(e,t)=>({...th,[co]:cl,initial:e,commit(){return cu(this)},diff:(e,r)=>t.differ.diff(e,r),combine:(e,r)=>t.differ.combine(e,r),patch:e=>r=>t.differ.patch(e,r),fork:t.fork,join:t.join??((e,t)=>t)}),cC=H(Symbol.for("effect/FiberRef/currentContext"),()=>cw(sQ())),cO=H(Symbol.for("effect/FiberRef/currentSchedulingPriority"),()=>cv(0)),cE=H(Symbol.for("effect/FiberRef/currentMaxOpsBeforeYield"),()=>cv(2048)),cI=H(Symbol.for("effect/FiberRef/currentLogAnnotation"),()=>cv(ni())),cF=H(Symbol.for("effect/FiberRef/currentLogLevel"),()=>cv(cr)),cR=H(Symbol.for("effect/FiberRef/currentLogSpan"),()=>cv(on())),cT=M(2,(e,t)=>cx(e,cO,t)),cN=H(Symbol.for("effect/FiberRef/currentConcurrency"),()=>cv("unbounded")),cA=H(Symbol.for("effect/FiberRef/currentRequestBatching"),()=>cv(!0)),cj=H(Symbol.for("effect/FiberRef/currentUnhandledErrorLogLevel"),()=>cv(tk(ci))),cM=H(Symbol.for("effect/FiberRef/currentMetricLabels"),()=>cS(rK())),cz=H(Symbol.for("effect/FiberRef/currentForkScopeOverride"),()=>cv(tK(),{fork:()=>tK(),join:(e,t)=>e})),cP=H(Symbol.for("effect/FiberRef/currentInterruptedCause"),()=>cv(nY,{fork:()=>nY,join:(e,t)=>e})),cD=H(Symbol.for("effect/FiberRef/currentTracerEnabled"),()=>cv(!0)),cL=H(Symbol.for("effect/FiberRef/currentTracerTiming"),()=>cv(!0)),c$=H(Symbol.for("effect/FiberRef/currentTracerSpanAnnotations"),()=>cv(ni())),cU=H(Symbol.for("effect/FiberRef/currentTracerSpanLinks"),()=>cv(il())),cq=Symbol.for("effect/Scope"),cB=Symbol.for("effect/CloseableScope"),cJ=(e,t)=>e.addFinalizer(()=>l8(t)),cH=(e,t)=>e.addFinalizer(t),cK=(e,t)=>e.close(t),cV=(e,t)=>e.fork(t),cW=M(2,(e,t)=>{let r=U(e,se,t1(t));switch(r._tag){case"None":return U(n7(e),iA,tV({onNone:()=>{let t=rd(n9(e)).flatMap(e=>rd(aV(e)).map(e=>`#${e}`));return new c0(t?`Interrupted by fibers: ${t.join(", ")}`:void 0)},onSome:z}));case"Some":return r.value}}),cG=function(){class e extends globalThis.Error{commit(){return up(this)}toJSON(){return{...this}}[eU](){return this.toString!==globalThis.Error.prototype.toString?this.stack?`${this.toString()}
${this.stack.split("\n").slice(1).join("\n")}`:this.toString():"Bun"in globalThis?sv(nQ(this),{renderErrorCause:!0}):this}}return Object.assign(e.prototype,tp),e}(),cY=(e,t)=>{class r extends cG{constructor(...e){super(...e),this._tag=t}}return Object.assign(r.prototype,e),r.prototype.name=t,r},cQ=Symbol.for("effect/Cause/errors/RuntimeException"),cZ=cY({[cQ]:cQ},"RuntimeException"),cX=Symbol.for("effect/Cause/errors/InterruptedException"),c0=cY({[cX]:cX},"InterruptedException"),c1=e=>en(e,cX),c2=Symbol.for("effect/Cause/errors/IllegalArgument"),c3=cY({[c2]:c2},"IllegalArgumentException"),c5=Symbol.for("effect/Cause/errors/NoSuchElement"),c4=cY({[c5]:c5},"NoSuchElementException"),c6=Symbol.for("effect/Cause/errors/InvalidPubSubCapacityException"),c8=cY({[c6]:c6},"InvalidPubSubCapacityException"),c7=Symbol.for("effect/Cause/errors/Timeout"),c9=Symbol.for("effect/Cause/errors/UnknownException"),he=function(){class e extends cG{constructor(e,t){super(t??"An unknown error occurred",{cause:e}),this._tag="UnknownException",this.cause=e,this.error=e}}return Object.assign(e.prototype,{[c9]:c9,name:"UnknownException"}),e}(),ht=e=>l3(e)&&"_tag"in e&&("Success"===e._tag||"Failure"===e._tag),hr=e=>"Failure"===e._tag,hi=e=>"Success"===e._tag,hn=M(2,(e,t)=>{switch(e._tag){case e2:return hu(e.effect_instruction_i0);case e6:return hg(t)}}),hs=e=>hn(e,void 0),ha=(e,t)=>h_(e,t?.parallel?n0:n1),ho=e=>hu(nZ(e)),hl=e=>hu(nQ(e)),hu=e=>{let t=new l1(e2);return t.effect_instruction_i0=e,t},hc=M(2,(e,t)=>{switch(e._tag){case e2:return hu(e.effect_instruction_i0);case e6:return t(e.effect_instruction_i0)}}),hh=M(2,(e,t)=>{switch(e._tag){case e2:return uU(hu(e.effect_instruction_i0));case e6:return uh(t(e.effect_instruction_i0))}}),hp=e=>hu(nX(e)),hf=M(2,(e,t)=>{switch(e._tag){case e2:return hu(e.effect_instruction_i0);case e6:return hg(t(e.effect_instruction_i0))}}),hd=M(2,(e,{onFailure:t,onSuccess:r})=>{switch(e._tag){case e2:return t(e.effect_instruction_i0);case e6:return r(e.effect_instruction_i0)}}),hm=M(2,(e,{onFailure:t,onSuccess:r})=>{switch(e._tag){case e2:return t(e.effect_instruction_i0);case e6:return r(e.effect_instruction_i0)}}),hg=e=>{let t=new l2(e6);return t.effect_instruction_i0=e,t},hb=hg(void 0),hx=M(2,(e,t)=>hv(e,t,{onSuccess:(e,t)=>[e,t],onFailure:n1})),hy=M(2,(e,t)=>hv(e,t,{onSuccess:(e,t)=>t,onFailure:n1})),hv=M(3,(e,t,{onFailure:r,onSuccess:i})=>{switch(e._tag){case e2:switch(t._tag){case e6:return hu(e.effect_instruction_i0);case e2:return hu(r(e.effect_instruction_i0,t.effect_instruction_i0))}case e6:switch(t._tag){case e6:return hg(i(e.effect_instruction_i0,t.effect_instruction_i0));case e2:return hu(t.effect_instruction_i0)}}}),h_=(e,t)=>{let r=ih(e);return iN(r)?U(iL(r),r2(U(ij(r),hf(ic)),(e,r)=>U(e,hv(r,{onSuccess:(e,t)=>U(e,i_(t)),onFailure:t}))),hf(im),hf(e=>id(e)),tk):tK()},hS=e=>({...th,[lq]:lB,state:aF(lJ([])),commit(){return hC(this)},blockingOn:e}),hw=()=>ux(ug,e=>hk(e)),hk=e=>uB(()=>hS(e)),hC=e=>ue(t=>{let r=aT(e.state);switch(r._tag){case lU:return t(r.effect);case l$:return r.joiners.push(t),hN(e,t)}},e.blockingOn),hO=M(2,(e,t)=>uB(()=>{let r=aT(e.state);switch(r._tag){case lU:return!1;case l$:aN(e.state,lH(t));for(let e=0,i=r.joiners.length;e<i;e++)r.joiners[e](t);return!0}})),hE=M(2,(e,t)=>hO(e,t)),hI=((e,t)=>hO(e,up(t)),M(2,(e,t)=>hO(e,ud(t)))),hF=M(2,(e,t)=>hO(e,uF(t))),hR=M(2,(e,t)=>hO(e,uU(t))),hT=(e,t)=>{let r=aT(e.state);if(r._tag===l$){aN(e.state,lH(t));for(let e=0,i=r.joiners.length;e<i;e++)r.joiners[e](t)}},hN=(e,t)=>uB(()=>{let r=aT(e.state);if(r._tag===l$){let e=r.joiners.indexOf(t);e>=0&&r.joiners.splice(e,1)}}),hA=l5(e=>hg(e.currentContext)),hj=()=>hA,hM=e=>ux(hj(),e),hz=M(2,(e,t)=>cx(cC,t)(e)),hP=M(2,(e,t)=>cy(cC,e=>sW(e,t))(e)),hD=M(2,(e,t)=>hM(r=>hz(e,t(r)))),hL=e=>{let t=e.currentSpan;return void 0!==t&&"Span"===t._tag?tk(t):tK()},h$={_tag:"Span",spanId:"noop",traceId:"noop",sampled:!1,status:{_tag:"Ended",startTime:BigInt(0),endTime:BigInt(0),exit:hb},attributes:new Map,links:[],kind:"internal",attribute(){},event(){},end(){}},hU=e=>Object.assign(Object.create(h$),e),hq=Symbol.for("effect/Clock"),hB=sG("effect/Clock"),hJ=0x80000000-1,hH={unsafeSchedule(e,t){let r=ad(t);if(r>hJ)return L;let i=!1,n=setTimeout(()=>{i=!0,e()},r);return()=>(clearTimeout(n),!i)}},hK=function(){let e=BigInt(1e6);if("undefined"==typeof performance)return()=>BigInt(Date.now())*e;if("number"==typeof performance.timeOrigin&&0===performance.timeOrigin)return()=>BigInt(Math.round(1e6*performance.now()));let t=BigInt(Date.now())*e-BigInt(Math.round(1e6*performance.now()));return()=>t+BigInt(Math.round(1e6*performance.now()))}(),hV=function(){let e="object"==typeof process&&"hrtime"in process&&"function"==typeof process.hrtime.bigint?process.hrtime:void 0;if(!e)return hK;let t=hK()-e.bigint();return()=>t+e.bigint()}();class hW{unsafeCurrentTimeMillis(){return Date.now()}unsafeCurrentTimeNanos(){return hV()}scheduler(){return uU(hH)}sleep(e){return ut(t=>l8(uB(hH.unsafeSchedule(()=>t(uG),e))))}constructor(){this[hq]=hq,this.currentTimeMillis=uB(()=>this.unsafeCurrentTimeMillis()),this.currentTimeNanos=uB(()=>this.unsafeCurrentTimeNanos())}}let hG=e=>Math.max(Math.pow(2,Math.ceil(Math.log(e)/Math.log(2))),2),hY=e=>{if("NaN"===e)return tk(NaN);if("Infinity"===e)return tk(1/0);if("-Infinity"===e)return tk(-1/0);if(""===e.trim())return tw;let t=Number(e);return Number.isNaN(t)?tw:tk(t)},hQ=e=>e.replace(/[/\\^$*+?.()|[\]{}]/g,"\\$&"),hZ="InvalidData",hX="MissingData",h0="SourceUnavailable",h1="Unsupported",h2=Symbol.for("effect/ConfigError"),h3={_tag:"ConfigError",[h2]:h2},h5=(e,t)=>{let r=Object.create(h3);return r._op="And",r.left=e,r.right=t,Object.defineProperty(r,"toString",{enumerable:!1,value(){return`${this.left} and ${this.right}`}}),r},h4=(e,t)=>{let r=Object.create(h3);return r._op="Or",r.left=e,r.right=t,Object.defineProperty(r,"toString",{enumerable:!1,value(){return`${this.left} or ${this.right}`}}),r},h6=(e,t,r={pathDelim:"."})=>{let i=Object.create(h3);return i._op=hZ,i.path=e,i.message=t,Object.defineProperty(i,"toString",{enumerable:!1,value(){let e=U(this.path,r7(r.pathDelim));return`(Invalid data at ${e}: "${this.message}")`}}),i},h8=(e,t,r={pathDelim:"."})=>{let i=Object.create(h3);return i._op=hX,i.path=e,i.message=t,Object.defineProperty(i,"toString",{enumerable:!1,value(){let e=U(this.path,r7(r.pathDelim));return`(Missing data at ${e}: "${this.message}")`}}),i},h7=(e,t,r,i={pathDelim:"."})=>{let n=Object.create(h3);return n._op=h0,n.path=e,n.message=t,n.cause=r,Object.defineProperty(n,"toString",{enumerable:!1,value(){let e=U(this.path,r7(i.pathDelim));return`(Source unavailable at ${e}: "${this.message}")`}}),n},h9=(e,t,r={pathDelim:"."})=>{let i=Object.create(h3);return i._op=h1,i.path=e,i.message=t,Object.defineProperty(i,"toString",{enumerable:!1,value(){let e=U(this.path,r7(r.pathDelim));return`(Unsupported operation at ${e}: "${this.message}")`}}),i},pe=M(2,(e,t)=>{switch(e._op){case"And":return h5(pe(e.left,t),pe(e.right,t));case"Or":return h4(pe(e.left,t),pe(e.right,t));case hZ:return h6([...t,...e.path],e.message);case hX:return h8([...t,...e.path],e.message);case h0:return h7([...t,...e.path],e.message,e.cause);case h1:return h9([...t,...e.path],e.message)}}),pt={andCase:(e,t,r)=>t&&r,orCase:(e,t,r)=>t&&r,invalidDataCase:L,missingDataCase:D,sourceUnavailableCase:L,unsupportedCase:L},pr=M(3,(e,t,r)=>{let i=[e],n=[];for(;i.length>0;){let e=i.pop();switch(e._op){case"And":i.push(e.right),i.push(e.left),n.push(tN({_op:"AndCase"}));break;case"Or":i.push(e.right),i.push(e.left),n.push(tN({_op:"OrCase"}));break;case hZ:n.push(tA(r.invalidDataCase(t,e.path,e.message)));break;case hX:n.push(tA(r.missingDataCase(t,e.path,e.message)));break;case h0:n.push(tA(r.sourceUnavailableCase(t,e.path,e.message,e.cause)));break;case h1:n.push(tA(r.unsupportedCase(t,e.path,e.message)))}}let s=[];for(;n.length>0;){let e=n.pop();switch(e._op){case"Left":switch(e.left._op){case"AndCase":{let e=s.pop(),i=s.pop(),n=r.andCase(t,e,i);s.push(n);break}case"OrCase":{let e=s.pop(),i=s.pop(),n=r.orCase(t,e,i);s.push(n)}}break;case"Right":s.push(e.right)}}if(0===s.length)throw Error("BUG: ConfigError.reduceWithContext - please report an issue at https://github.com/Effect-TS/effect/issues");return s.pop()}),pi={_tag:"Empty"},pn=M(2,(e,t)=>({_tag:"AndThen",first:e,second:t})),ps=M(2,(e,t)=>pn(e,{_tag:"MapName",f:t})),pa=M(2,(e,t)=>pn(e,{_tag:"Nested",name:t})),po=M(2,(e,t)=>pn(e,{_tag:"Unnested",name:t})),pl=M(2,(e,t)=>{let r=os(t),i=e;for(;or(r);){let e=r.head;switch(e._tag){case"Empty":r=r.tail;break;case"AndThen":r=oi(e.first,oi(e.second,r.tail));break;case"MapName":i=rW(i,e.f),r=r.tail;break;case"Nested":i=rx(i,e.name),r=r.tail;break;case"Unnested":if(!U(rI(i),t8(e.name)))return tN(h8(i,`Expected ${e.name} to be in path in ConfigProvider#unnested`));i=rN(i),r=r.tail}}return tA(i)}),pu="Constant",pc="Fallback",ph="Lazy",pp="MapOrFail",pf="Nested",pd="Primitive",pm="ZipWith",pg=e=>e.toLowerCase(),pb=e=>e.toUpperCase(),px=(e,t,r)=>t instanceof RegExp?e.replace(t,r):t.reduce((e,t)=>e.replace(t,r),e),py=[/([a-z0-9])([A-Z])/g,/([A-Z])([A-Z][a-z])/g],pv=/[^A-Z0-9]+/gi,p_=(e,t={})=>{let{delimiter:r=" ",splitRegexp:i=py,stripRegexp:n=pv,transform:s=pg}=t,a=px(px(e,i,"$1\0$2"),n,"\0"),o=0,l=a.length;for(;"\0"===a.charAt(o);)o++;for(;"\0"===a.charAt(l-1);)l--;return a.slice(o,l).split("\0").map(s).join(r)},pS=(e,t)=>p_(e,{delimiter:"_",transform:pb,...t}),pw=(e,t)=>[...e,...t],pk=Symbol.for("effect/ConfigProvider"),pC=sG("effect/ConfigProvider"),pO=Symbol.for("effect/ConfigProviderFlat"),pE=e=>({[pk]:pk,pipe(){return eX(this,arguments)},...e}),pI=e=>({[pO]:pO,patch:e.patch,load:(t,r,i=!0)=>e.load(t,r,i),enumerateChildren:e.enumerateChildren}),pF=e=>pE({load:t=>ux(pj(e,rK(),t,!1),e=>tV(rI(e),{onNone:()=>up(h8(rK(),`Expected a single value having structure: ${t}`)),onSome:uU})),flattened:e}),pR=e=>{let{pathDelim:t,seqDelim:r}=Object.assign({},{pathDelim:"_",seqDelim:","},e),i=e=>U(e,r7(t)),n=e=>e.split(t),s=()=>"undefined"!=typeof process&&"env"in process&&"object"==typeof process.env?process.env:{};return pF(pI({load:(e,t,n=!0)=>{let a=i(e),o=s();return U(a in o?tk(o[a]):tK(),uj(()=>h8(e,`Expected ${a} to exist in the process context`)),ux(i=>pq(i,e,t,r,n)))},enumerateChildren:e=>uB(()=>nL(Object.keys(s()).map(e=>n(e.toUpperCase())).filter(t=>{for(let r=0;r<e.length;r++){let i=U(e,rE(r)),n=t[r];if(void 0===n||i!==n)return!1}return!0}).flatMap(t=>t.slice(e.length,e.length+1)))),patch:pi}))},pT=(e,t)=>{let{pathDelim:r,seqDelim:i}=Object.assign({seqDelim:",",pathDelim:"."},t),n=e=>U(e,r7(r)),s=e=>e.split(r),a=pW(e,e=>s(e),n);return pF(pI({load:(e,t,r=!0)=>{let s=n(e);return U(a.has(s)?tk(a.get(s)):tK(),uj(()=>h8(e,`Expected ${s} to exist in the provided map`)),ux(n=>pq(n,e,t,i,r)))},enumerateChildren:e=>uB(()=>nL(rd(a.keys()).map(s).filter(t=>{for(let r=0;r<e.length;r++){let i=U(e,rE(r)),n=t[r];if(void 0===n||i!==n)return!1}return!0}).flatMap(t=>t.slice(e.length,e.length+1)))),patch:pi}))},pN=(e,t,r,i)=>{let n=r4(r.length,t=>t>=i.length?tK():tk([e(t),t+1])),s=r4(i.length,e=>e>=r.length?tK():tk([t(e),e+1]));return[pw(r,n),pw(i,s)]},pA=(e,t)=>{let r=t;if("Nested"===r._tag){let t=e.slice();for(;"Nested"===r._tag;)t.push(r.name),r=r.config;return t}return e},pj=(e,t,r,i)=>{switch(r._tag){case pu:return uU(rV(r.value));case"Described":return uq(()=>pj(e,t,r.config,i));case"Fail":return up(h8(t,r.message));case pc:return U(uq(()=>pj(e,t,r.first,i)),ui(n=>r.condition(n)?U(pj(e,t,r.second,i),ui(e=>up(h4(n,e)))):up(n)));case ph:return uq(()=>pj(e,t,r.config(),i));case pp:return uq(()=>U(pj(e,t,r.original,i),ux(uC(e=>U(r.mapOrFail(e),uj(pe(pA(t,r.original))))))));case pf:return uq(()=>pj(e,pw(t,rV(r.name)),r.config,i));case pd:return U(pl(t,e.patch),ux(t=>U(e.load(t,r,i),ux(e=>{if(0===e.length){let e=U(rR(t),tW(()=>"<n/a>"));return up(h8([],`Expected ${r.description} with name ${e}`))}return uU(e)}))));case"Sequence":return U(pl(t,e.patch),ux(i=>U(e.enumerateChildren(i),ux(pJ),ux(i=>0===i.length?uq(()=>uN(pj(e,t,r.config,!0),rV)):U(uC(i,i=>pj(e,ry(t,`[${i}]`),r.config,!0)),uN(e=>{let t=rY(e);return 0===t.length?rV(rK()):rV(t)}))))));case"HashMap":return uq(()=>U(pl(t,e.patch),ux(t=>U(e.enumerateChildren(t),ux(n=>U(n,uC(n=>pj(e,pw(t,rV(n)),r.valueConfig,i)),uN(e=>0===e.length?rV(ni()):U(pB(e),rW(e=>a1(rD(rd(n),e)))))))))));case pm:return uq(()=>U(pj(e,t,r.left,i),uc,ux(n=>U(pj(e,t,r.right,i),uc,ux(e=>{if(tR(n)&&tR(e))return up(h5(n.left,e.left));if(tR(n)&&tT(e))return up(n.left);if(tT(n)&&tR(e))return up(e.left);if(tT(n)&&tT(e)){let i=U(t,r7(".")),s=pM(t,i),[a,o]=pN(s,s,U(n.right,rW(tA)),U(e.right,rW(tA)));return U(a,rD(o),uC(([e,t])=>U(u2(e,t),uN(([e,t])=>r.zip(e,t)))))}throw Error("BUG: ConfigProvider.fromFlatLoop - please report an issue at https://github.com/Effect-TS/effect/issues")})))))}},pM=(e,t)=>r=>tN(h8(e,`The element at index ${r} in a sequence at path "${t}" was missing`)),pz=M(2,(e,t)=>pF(pP(e.flattened,t))),pP=(e,t)=>pI({load:(t,r,i=!0)=>e.load(t,r,i),enumerateChildren:t=>e.enumerateChildren(t),patch:ps(e.patch,t)}),pD=M(2,(e,t)=>pF(pI({load:(t,r)=>e.flattened.load(t,r,!0),enumerateChildren:t=>e.flattened.enumerateChildren(t),patch:pa(e.flattened.patch,t)}))),pL=((e,t)=>pF(pI({load:(t,r)=>e.flattened.load(t,r,!0),enumerateChildren:t=>e.flattened.enumerateChildren(t),patch:po(e.flattened.patch,t)})),M(2,(e,t)=>pF(p$(e.flattened,()=>t().flattened)))),p$=(e,t)=>pI({load:(r,i,n)=>U(pl(r,e.patch),ux(t=>e.load(t,i,n)),ui(e=>U(uB(t),ux(t=>U(pl(r,t.patch),ux(e=>t.load(e,i,n)),ui(t=>up(h4(e,t)))))))),enumerateChildren:r=>U(pl(r,e.patch),ux(t=>e.enumerateChildren(t)),uc,ux(e=>U(uB(t),ux(t=>U(pl(r,t.patch),ux(e=>t.enumerateChildren(e)),uc,ux(t=>{if(tR(e)&&tR(t))return up(h5(e.left,t.left));if(tR(e)&&tT(t))return uU(t.right);if(tT(e)&&tR(t))return uU(e.right);if(tT(e)&&tT(t))return uU(U(e.right,nz(t.right)));throw Error("BUG: ConfigProvider.orElseFlat - please report an issue at https://github.com/Effect-TS/effect/issues")})))))),patch:pi}),pU=(e,t)=>e.split(RegExp(`\\s*${hQ(t)}\\s*`)),pq=(e,t,r,i,n)=>n?U(pU(e,i),uC(e=>r.parse(e.trim())),uj(pe(t))):U(r.parse(e),uA({onFailure:pe(t),onSuccess:rV})),pB=e=>Object.keys(e[0]).map(t=>e.map(e=>e[t])),pJ=e=>U(uC(e,pV),uA({onFailure:()=>rK(),onSuccess:rP(rr)}),uc,uN(tL)),pH=/(^.+)(\[(\d+)\])$/,pK=/^(\[(\d+)\])$/,pV=e=>{let t=e.match(pK);if(null!==t){let e=t[2];return U(void 0!==e&&e.length>0?tk(e):tK(),t2(pY))}return tK()},pW=(e,t,r)=>{let i=new Map;for(let[n,s]of e){let e=U(t(n),rG(e=>tV(pG(e),{onNone:()=>rV(e),onSome:([e,t])=>rh(e,`[${t}]`)})));i.set(r(e),s)}return i},pG=e=>{let t=e.match(pH);if(null!==t){let e=t[1],r=t[3];return t3([void 0!==e&&e.length>0?tk(e):tK(),U(void 0!==r&&r.length>0?tk(r):tK(),t2(pY))])}return tK()},pY=e=>{let t=Number.parseInt(e);return Number.isNaN(t)?tK():tk(t)},pQ=e=>({_tag:"KeyName",name:e}),pZ=e=>({_tag:"KeyIndex",index:e}),pX=e=>{let t=[],r=0;for(;r<e.length;){let i=e[r];if("KeyName"===i._tag){if(r+1<e.length){let n=e[r+1];"KeyIndex"===n._tag?(t.push(`${i.name}[${n.index}]`),r+=2):(t.push(i.name),r+=1)}else t.push(i.name),r+=1}}return t},p0=e=>{let t=(e,t)=>"string"==typeof t?rh([e,t]):"number"==typeof t||"boolean"==typeof t?rh([e,String(t)]):r_(t)?r(e,t):"object"==typeof t&&null!==t?i(e,t):rK(),r=(e,r)=>rg(r,{onEmpty:()=>rh([e,"<nil>"]),onNonEmpty:rG((r,i)=>t(ry(e,pZ(i)),r))}),i=(e,r)=>Object.entries(r).filter(([,e])=>eo(e)).flatMap(([r,i])=>{let n=ry(e,pQ(r)),s=t(n,i);return rS(s)?rh([n,""]):s});return i(rK(),e)},p1=Symbol.for("effect/Console"),p2=sG("effect/Console"),p3={[p1]:p1,assert:(e,...t)=>uB(()=>{console.assert(e,...t)}),clear:uB(()=>{console.clear()}),count:e=>uB(()=>{console.count(e)}),countReset:e=>uB(()=>{console.countReset(e)}),debug:(...e)=>uB(()=>{console.debug(...e)}),dir:(e,t)=>uB(()=>{console.dir(e,t)}),dirxml:(...e)=>uB(()=>{console.dirxml(...e)}),error:(...e)=>uB(()=>{console.error(...e)}),group:e=>e?.collapsed?uB(()=>console.groupCollapsed(e?.label)):uB(()=>console.group(e?.label)),groupEnd:uB(()=>{console.groupEnd()}),info:(...e)=>uB(()=>{console.info(...e)}),log:(...e)=>uB(()=>{console.log(...e)}),table:(e,t)=>uB(()=>{console.table(e,t)}),time:e=>uB(()=>console.time(e)),timeEnd:e=>uB(()=>console.timeEnd(e)),timeLog:(e,...t)=>uB(()=>{console.timeLog(e,...t)}),trace:(...e)=>uB(()=>{console.trace(...e)}),warn:(...e)=>uB(()=>{console.warn(...e)}),unsafe:console},p5=Symbol.for("effect/Random"),p4=sG("effect/Random");class p6{constructor(e){this[p5]=p5,this.seed=e,this.PRNG=new ed(e)}get next(){return uB(()=>this.PRNG.number())}get nextBoolean(){return uN(this.next,e=>e>.5)}get nextInt(){return uB(()=>this.PRNG.integer(Number.MAX_SAFE_INTEGER))}nextRange(e,t){return uN(this.next,r=>(t-e)*r+e)}nextIntBetween(e,t){return uB(()=>this.PRNG.integer(t-e)+e)}shuffle(e){return p8(e,e=>this.nextIntBetween(0,e))}}let p8=(e,t)=>uq(()=>U(uB(()=>Array.from(e)),ux(e=>{let r=[];for(let t=e.length;t>=2;t-=1)r.push(t);return U(r,uO(r=>U(t(r),uN(t=>p7(e,r-1,t)))),l6(ih(e)))}))),p7=(e,t,r)=>{let i=e[t];return e[t]=e[r],e[r]=i,e},p9=Symbol.for("effect/Tracer"),fe=sG("effect/Tracer"),ft=sG("effect/ParentSpan"),fr=function(){let e="abcdef0123456789",t=e.length;return function(r){let i="";for(let n=0;n<r;n++)i+=e.charAt(Math.floor(Math.random()*t));return i}}();class fi{constructor(e,t,r,i,n,s){this._tag="Span",this.traceId="native",this.sampled=!0,this.events=[],this.name=e,this.parent=t,this.context=r,this.links=i,this.startTime=n,this.kind=s,this.status={_tag:"Started",startTime:n},this.attributes=new Map,this.traceId="Some"===t._tag?t.value.traceId:fr(32),this.spanId=fr(16)}end(e,t){this.status={_tag:"Ended",endTime:e,exit:t,startTime:this.status.startTime}}attribute(e,t){this.attributes.set(e,t)}event(e,t,r){this.events.push([e,t,r??{}])}}let fn=e=>{if(e?.captureStackTrace===!1||e?.captureStackTrace!==void 0&&"boolean"!=typeof e.captureStackTrace)return e;let t=Error.stackTraceLimit;Error.stackTraceLimit=3;let r=Error();Error.stackTraceLimit=t;let i=!1;return{...e,captureStackTrace:()=>{if(!1!==i)return i;if(void 0!==r.stack){let e=r.stack.split("\n");if(void 0!==e[3])return i=e[3].trim()}}}},fs=sX()("effect/Tracer/DisablePropagation",{defaultValue:L}),fa=U(sQ(),sq(hB,new hW),sq(p2,p3),sq(p4,new p6(eC(Math.random()))),sq(pC,pR()),sq(fe,{[p9]:p9,span:(e,t,r,i,n,s)=>new fi(e,t,r,i,n,s),context:e=>e()})),fo=H(Symbol.for("effect/DefaultServices/currentServices"),()=>cw(fa)),fl=e=>l5(t=>e(t.currentDefaultServices)),fu=e=>fl(t=>e(t.unsafeMap.get(hB.key))),fc=fu(e=>e.currentTimeMillis),fh=e=>fl(t=>e(t.unsafeMap.get(pC.key))),fp=e=>fh(t=>t.load(e));g=e=>e.next,fl(e=>g(e.unsafeMap.get(p4.key)));let ff=e=>!e,fd=e=>ux(ug,t=>hO(e,uF(t))),fm=e=>uB(()=>aT(e.state)._tag===lU),fg=tf,fb=td;class fx extends fg{}class fy extends fb{}let fv="Sequential",f_="Parallel",fS={_tag:fv},fw=e=>e._tag===fv,fk=e=>e._tag===f_,fC={_tag:f_},fO=e=>({_tag:"ParallelN",parallelism:e});function fE(){return new fF(new Map)}let fI=Symbol.for("effect/FiberRefs");class fF{constructor(e){this[fI]=fI,this.locals=e}pipe(){return eX(this,arguments)}}let fR=(e,t,r,i=!1)=>{let n,s=t,a=r,o=i;for(;void 0===n;)if(rw(s)&&rw(a)){let e=rF(s)[0],t=rN(s),r=rF(a)[0],i=rF(a)[1],l=rN(a);e.startTimeMillis<r.startTimeMillis?(a=l,o=!0):e.startTimeMillis>r.startTimeMillis?s=t:e.id<r.id?(a=l,o=!0):e.id>r.id?s=t:n=[i,o]}else n=[e.initial,!0];return n},fT=M(3,(e,t,r)=>{let i=new Map(e.locals);return r.locals.forEach((e,r)=>{let n=e[0][1];if(!e[0][0][ez](t)){if(!i.has(r)){if(eP(n,r.initial))return;i.set(r,[[t,r.join(r.initial,n)]]);return}let s=i.get(r),[a,o]=fR(r,s,e);if(o){let e=r.diff(a,n),o=s[0][1],l=r.join(o,r.patch(e)(o));if(!eP(o,l)){let e;let n=s[0][0];e=n[ez](t)?[[n,l],...s.slice(1)]:[[t,l],...s],i.set(r,e)}}}}),new fF(i)}),fN=M(2,(e,t)=>{let r=new Map;return fA(e,r,t),new fF(r)}),fA=(e,t,r)=>{e.locals.forEach((e,i)=>{let n=e[0][1],s=i.patch(i.fork)(n);eP(n,s)?t.set(i,e):t.set(i,[[r,s],...e])})},fj=M(2,(e,t)=>{let r=new Map(e.locals);return r.delete(t),new fF(r)}),fM=M(2,(e,t)=>e.locals.has(t)?tk(rF(e.locals.get(t))[1]):tK()),fz=M(2,(e,t)=>U(fM(e,t),tW(()=>t.initial))),fP=M(2,(e,{fiberId:t,fiberRef:r,value:i})=>{if(0===e.locals.size)return new fF(new Map([[r,[[t,i]]]]));let n=new Map(e.locals);return fD(n,t,r,i),new fF(n)}),fD=(e,t,r,i)=>{let n;let s=e.get(r)??[];if(rw(s)){let[e,r]=rF(s);if(e[ez](t)){if(eP(r,i))return;n=[[t,i],...s.slice(1)]}else n=[[t,i],...s]}else n=[[t,i]];e.set(r,n)},fL=M(2,(e,{entries:t,forkAs:r})=>{if(0===e.locals.size)return new fF(new Map(t));let i=new Map(e.locals);return void 0!==r&&fA(e,i,r),t.forEach(([e,t])=>{1===t.length?fD(i,t[0][0],e,t[0][1]):t.forEach(([t,r])=>{fD(i,t,e,r)})}),new fF(i)}),f$="Empty",fU="Remove",fq="Update",fB="AndThen",fJ={_tag:f$},fH=(e,t)=>{let r=new Map(e.locals),i=fJ;for(let[e,n]of t.locals.entries()){let t=rF(n)[1],s=r.get(e);if(void 0!==s){let r=rF(s)[1];eP(r,t)||(i=fK({_tag:fq,fiberRef:e,patch:e.diff(r,t)})(i))}else i=fK({_tag:"Add",fiberRef:e,value:t})(i);r.delete(e)}for(let[e]of r.entries())i=fK({_tag:fU,fiberRef:e})(i);return i},fK=M(2,(e,t)=>({_tag:fB,first:e,second:t})),fV=M(3,(e,t,r)=>{let i=r,n=rV(e);for(;rw(n);){let e=rF(n),r=rN(n);switch(e._tag){case f$:n=r;break;case"Add":i=fP(i,{fiberId:t,fiberRef:e.fiberRef,value:e.value}),n=r;break;case fU:i=fj(i,e.fiberRef),n=r;break;case fq:{let s=fz(i,e.fiberRef);i=fP(i,{fiberId:t,fiberRef:e.fiberRef,value:e.fiberRef.patch(e.patch)(s)}),n=r;break}case fB:n=rx(e.first)(rx(e.second)(r))}}return i}),fW="effect/FiberStatus",fG=Symbol.for(fW),fY="Done",fQ="Running",fZ="Suspended",fX=eT(`${fW}-${fY}`);class f0{[ek](){return fX}[ez](e){return f5(e)&&e._tag===fY}constructor(){this[fG]=fG,this._tag=fY}}class f1{constructor(e){this[fG]=fG,this._tag=fQ,this.runtimeFlags=e}[ek](){return U(eC(fW),eE(eC(this._tag)),eE(eC(this.runtimeFlags)),eM(this))}[ez](e){return f5(e)&&e._tag===fQ&&this.runtimeFlags===e.runtimeFlags}}class f2{constructor(e,t){this[fG]=fG,this._tag=fZ,this.runtimeFlags=e,this.blockingOn=t}[ek](){return U(eC(fW),eE(eC(this._tag)),eE(eC(this.runtimeFlags)),eE(eC(this.blockingOn)),eM(this))}[ez](e){return f5(e)&&e._tag===fZ&&this.runtimeFlags===e.runtimeFlags&&eP(this.blockingOn,e.blockingOn)}}let f3=new f0,f5=e=>en(e,fG),f4=e=>new f1(e),f6=(e,t)=>new f2(e,t),f8=e=>e._tag===fY,f7=(O=U(rr,ri(e=>e.ordinal)),M(2,(e,t)=>1===O(e,t))),f9=e=>{switch(e){case"All":return u7;case"Debug":return ci;case"Error":return ce;case"Fatal":return u9;case"Info":return cr;case"Trace":return cn;case"None":return cs;case"Warning":return ct}},de=Symbol.for("effect/Micro"),dt=Symbol.for("effect/Micro/MicroExit"),dr=Symbol.for("effect/Micro/MicroCause"),di={_E:z};class dn extends globalThis.Error{constructor(e,t,r){let i,n,s;let a=`MicroCause.${e}`;if(t instanceof globalThis.Error){i=`(${a}) ${t.name}`;let e=(n=t.message).split("\n").length;s=t.stack?`(${a}) ${t.stack.split("\n").slice(0,e+3).join("\n")}`:`${i}: ${n}`}else i=a,n=eK(t,0),s=`${i}: ${n}`;r.length>0&&(s+=`
    ${r.join("\n    ")}`),super(n),this._tag=e,this.traces=r,this[dr]=di,this.name=i,this.stack=s}pipe(){return eX(this,arguments)}toString(){return this.stack}[eU](){return this.stack}}class ds extends dn{constructor(e,t=[]){super("Fail",e,t),this.error=e}}let da=(e,t=[])=>new ds(e,t);class dl extends dn{constructor(e,t=[]){super("Die",e,t),this.defect=e}}let du=(e,t=[])=>new dl(e,t);class dc extends dn{constructor(e=[]){super("Interrupt","interrupted",e)}}let dh=(e=[])=>new dc(e),dp=e=>"Fail"===e._tag,df=e=>"Interrupt"===e._tag,dd=M(2,(e,t)=>{let r=[...e.traces,t];switch(e._tag){case"Die":return du(e.defect,r);case"Interrupt":return dh(r);case"Fail":return da(e.error,r)}}),dm=Symbol.for("effect/Micro/MicroFiber"),dg={_A:z,_E:z};class db{constructor(e,t=!0){this._stack=[],this._observers=[],this.currentOpCount=0,this._interrupted=!1,this._yielded=void 0,this.context=e,this.interruptible=t,this[dm]=dg}getRef(e){return sH(this.context,e)}addObserver(e){return this._exit?(e(this._exit),$):(this._observers.push(e),()=>{let t=this._observers.indexOf(e);t>=0&&this._observers.splice(t,1)})}unsafeInterrupt(){!this._exit&&(this._interrupted=!0,this.interruptible&&this.evaluate(d2))}unsafePoll(){return this._exit}evaluate(e){if(this._exit)return;if(void 0!==this._yielded){let e=this._yielded;this._yielded=void 0,e()}let t=this.runLoop(e);if(t===dO)return;let r=dx.interruptChildren&&dx.interruptChildren(this);if(void 0!==r)return this.evaluate(dY(r,()=>t));this._exit=t;for(let e=0;e<this._observers.length;e++)this._observers[e](t);this._observers.length=0}runLoop(e){let t=!1,r=e;this.currentOpCount=0;try{for(;;){if(this.currentOpCount++,!t&&this.getRef(mi).shouldYield(this)){t=!0;let e=r;r=dY(dP,()=>e)}if((r=r[dS](this))===dO){let e=this._yielded;if(dt in e)return this._yielded=void 0,e;return dO}}}catch(e){if(!en(r,dS))return d3(`MicroFiber.runLoop: Not a valid effect: ${String(r)}`);return d3(e)}}getCont(e){for(;;){let t=this._stack.pop();if(!t)return;let r=t[dC]&&t[dC](this);if(r)return{[e]:r};if(t[e])return t}}yieldWith(e){return this._yielded=e,dO}children(){return this._children??=new Set}}let dx=H("effect/Micro/fiberMiddleware",()=>({interruptChildren:void 0})),dy=e=>dz(()=>{for(let t of e)t.unsafeInterrupt();let t=e[Symbol.iterator](),r=dz(()=>{let e=t.next();for(;!e.done;){if(e.value.unsafePoll()){e=t.next();continue}let i=e.value;return dK(e=>{i.addObserver(t=>{e(r)})})}return d4});return r}),dv=Symbol.for("effect/Micro/identifier"),d_=Symbol.for("effect/Micro/args"),dS=Symbol.for("effect/Micro/evaluate"),dw=Symbol.for("effect/Micro/successCont"),dk=Symbol.for("effect/Micro/failureCont"),dC=Symbol.for("effect/Micro/ensureCont"),dO=Symbol.for("effect/Micro/Yield"),dE={...tu,_op:"Micro",[de]:{_A:z,_E:z,_R:z},pipe(){return eX(this,arguments)},[Symbol.iterator](){return new ef(new eb(this))},toJSON(){return{_id:"Micro",op:this[dv],...d_ in this?{args:this[d_]}:void 0}},toString(){return eB(this)},[eU](){return eB(this)}};function dI(e){return d3("Micro.evaluate: Not implemented")}let dF=e=>({...dE,[dv]:e.op,[dS]:e.eval??dI,[dw]:e.contA,[dk]:e.contE,[dC]:e.ensure}),dR=e=>{let t=dF(e);return function(){let r=Object.create(t);return r[d_]=!1===e.single?arguments:arguments[0],r}},dT=e=>{let t={...dF(e),[dt]:dt,_tag:e.op,get[e.prop](){return this[d_]},toJSON(){return{_id:"MicroExit",_tag:e.op,[e.prop]:this[d_]}},[ez](t){return dX(t)&&t._tag===e.op&&eP(this[d_],t[d_])},[ek](){return eM(this,eE(eT(e.op))(eC(this[d_])))}};return function(e){let r=Object.create(t);return r[d_]=e,r[dw]=void 0,r[dk]=void 0,r[dC]=void 0,r}},dN=dT({op:"Success",prop:"value",eval(e){let t=e.getCont(dw);return t?t[dw](this[d_],e):e.yieldWith(this)}}),dA=dT({op:"Failure",prop:"cause",eval(e){let t=e.getCont(dk);for(;df(this[d_])&&t&&e.interruptible;)t=e.getCont(dk);return t?t[dk](this[d_],e):e.yieldWith(this)}}),dj=e=>dA(da(e)),dM=dR({op:"Sync",eval(e){let t=this[d_](),r=e.getCont(dw);return r?r[dw](t,e):e.yieldWith(d0(t))}}),dz=dR({op:"Suspend",eval(e){return this[d_]()}}),dP=dR({op:"Yield",eval(e){let t=!1;return e.getRef(mi).scheduleTask(()=>{t||e.evaluate(d4)},this[d_]??0),e.yieldWith(()=>{t=!0})}})(0),dD=e=>d3(e),dL=e=>"Right"===e._tag?dN(e.right):dj(e.left),d$=dN(void 0),dU=e=>dJ(function(t,r){e(r).then(e=>t(dN(e)),e=>t(dD(e)))},0!==e.length),dq=e=>dJ(function(t,r){try{e.try(r).then(e=>t(dN(e)),r=>t(dj(e.catch(r))))}catch(r){t(dj(e.catch(r)))}},0!==e.try.length),dB=dR({op:"WithMicroFiber",eval(e){return this[d_](e)}}),dJ=dR({op:"Async",single:!1,eval(e){let t=this[d_][0],r=!1,i=!1,n=this[d_][1]?new AbortController:void 0,s=t(t=>{r||(r=!0,i?e.evaluate(t):i=t)},n?.signal);return!1!==i?i:(i=!0,e._yielded=()=>{r=!0},void 0===n&&void 0===s||e._stack.push(dH(()=>(r=!0,n?.abort(),s??d4))),dO)}}),dH=dR({op:"AsyncFinalizer",ensure(e){e.interruptible&&(e.interruptible=!1,e._stack.push(mb(!0)))},contE(e,t){return df(e)?dY(this[d_](),()=>dA(e)):dA(e)}}),dK=e=>dJ(e,e.length>=2),dV=(...e)=>dz(()=>dW(1===e.length?e[0]():e[1].call(e[0]))),dW=dR({op:"Iterator",contA(e,t){let r=this[d_].next(e);return r.done?dN(r.value):(t._stack.push(this),ex(r.value))},eval(e){return this[dw](void 0,e)}}),dG=e=>mp(e,{onFailure:d1,onSuccess:d0}),dY=M(2,(e,t)=>{let r=Object.create(dQ);return r[d_]=e,r[dw]=t,r}),dQ=dF({op:"OnSuccess",eval(e){return e._stack.push(this),this[d_]}}),dZ=M(2,(e,t)=>dY(e,e=>dN(t(e)))),dX=e=>en(e,dt),d0=dN,d1=dA,d2=d1(dh()),d3=e=>d1(du(e)),d5=e=>"Failure"===e._tag,d4=d0(void 0),d6=e=>{for(let t of e)if("Failure"===t._tag)return t;return d4},d8="setImmediate"in globalThis?globalThis.setImmediate:e=>setTimeout(e,0);class d7{scheduleTask(e,t){this.tasks.push(e),this.running||(this.running=!0,d8(this.afterScheduled))}runTasks(){let e=this.tasks;this.tasks=[];for(let t=0,r=e.length;t<r;t++)e[t]()}shouldYield(e){return e.currentOpCount>=e.getRef(mt)}flush(){for(;this.tasks.length>0;)this.runTasks()}constructor(){this.tasks=[],this.running=!1,this.afterScheduled=()=>{this.running=!1,this.runTasks()}}}let d9=M(2,(e,t)=>dB(r=>{let i=r.context;return r.context=t(i),md(e,()=>(r.context=i,d$))})),me=M(2,(e,t)=>d9(e,sW(t)));class mt extends sX()("effect/Micro/currentMaxOpsBeforeYield",{defaultValue:()=>2048}){}class mr extends sX()("effect/Micro/currentConcurrency",{defaultValue:()=>"unbounded"}){}class mi extends sX()("effect/Micro/currentScheduler",{defaultValue:()=>new d7}){}let mn=M(2,(e,t)=>{let r=Object.create(ms);return r[d_]=e,r[dk]=t,r}),ms=dF({op:"OnFailure",eval(e){return e._stack.push(this),this[d_]}}),ma=M(3,(e,t,r)=>mn(e,e=>t(e)?r(e):dA(e))),mo=M(2,(e,t)=>ma(e,dp,e=>t(e.error))),ml=M(2,(e,t)=>mo(e,e=>dM(t))),mu=function(){let e=globalThis.Error.stackTraceLimit;globalThis.Error.stackTraceLimit=2;let t=new globalThis.Error;globalThis.Error.stackTraceLimit=e;let r=e=>r=>mg(r,r=>dA(function(e,r){let i=t.stack;if(!i)return r;let n=i.split("\n")[2]?.trim().replace(/^at /,"");if(!n)return r;let s=n.match(/\((.*)\)$/);return dd(r,`at ${e} (${s?s[1]:n})`)}(e,r)));return 2==arguments.length?r(arguments[1])(arguments[0]):r(arguments[0])},mc=M(2,(e,t)=>{let r=Object.create(mh);return r[d_]=e,r[dw]=t.onSuccess,r[dk]=t.onFailure,r}),mh=dF({op:"OnSuccessAndFailure",eval(e){return e._stack.push(this),this[d_]}}),mp=null;class mf{constructor(){this.state={_tag:"Open",finalizers:new Set},this[null]=null}unsafeAddFinalizer(e){"Open"===this.state._tag&&this.state.finalizers.add(e)}addFinalizer(e){return dz(()=>"Open"===this.state._tag?(this.state.finalizers.add(e),d$):e(this.state.exit))}unsafeRemoveFinalizer(e){"Open"===this.state._tag&&this.state.finalizers.delete(e)}close(e){return dz(()=>{if("Open"===this.state._tag){let t=Array.from(this.state.finalizers).reverse();return this.state={_tag:"Closed",exit:e},dY(m_(t,t=>dG(t(e))),d6)}return d$})}get fork(){return dM(()=>{let e=new mf;if("Closed"===this.state._tag)return e.state=this.state,e;function t(t){return e.close(t)}return this.state.finalizers.add(t),e.unsafeAddFinalizer(e=>dM(()=>this.unsafeRemoveFinalizer(t))),e})}}let md=M(2,(e,t)=>my(r=>mc(r(e),{onFailure:e=>dY(t(d1(e)),()=>dA(e)),onSuccess:e=>dY(t(d0(e)),()=>dN(e))}))),mm=M(3,(e,t,r)=>md(e,e=>t(e)?r(e):d4)),mg=M(2,(e,t)=>mm(e,d5,e=>t(e.cause))),mb=dR({op:"SetInterruptible",ensure(e){if(e.interruptible=this[d_],e._interrupted&&e.interruptible)return()=>d2}}),mx=e=>dB(t=>t.interruptible?e:(t.interruptible=!0,t._stack.push(mb(!1)),t._interrupted)?d2:e),my=e=>dB(t=>t.interruptible?(t.interruptible=!1,t._stack.push(mb(!0)),e(mx)):e(z)),mv=dR({op:"While",contA(e,t){return(this[d_].step(e),this[d_].while())?(t._stack.push(this),this[d_].body()):d4},eval(e){return this[d_].while()?(e._stack.push(this),this[d_].body()):d4}}),m_=(e,t,r)=>dB(i=>{let n=r?.concurrency==="inherit"?i.getRef(mr):r?.concurrency??1,s="unbounded"===n?Number.POSITIVE_INFINITY:Math.max(1,n),a=Arr.fromIterable(e),o=a.length;if(0===o)return r?.discard?d$:dN([]);let l=r?.discard?void 0:Array(o),u=0;return 1===s?(null)(mv({while:()=>u<a.length,body:()=>t(a[u],u),step:l?e=>l[u++]=e:e=>u++}),l):dK(e=>{let r;let n=new Set,c=0,h=0,p=!1,f=!1;return function d(){for(p=!0;c<s&&u<o;){let m=u,g=a[m];u++,c++;try{let a=mS(i,t(g,m),!0,!0);n.add(a),a.addObserver(t=>{n.delete(a),f||("Failure"===t._tag?void 0===r&&(r=t,o=u,n.forEach(e=>e.unsafeInterrupt())):void 0!==l&&(l[m]=t.value),h++,c--,h===o?e(r??dN(l)):!p&&c<s&&d())})}catch(e){r=d3(e),o=u,n.forEach(e=>e.unsafeInterrupt())}}p=!1}(),dz(()=>(f=!0,u=o,dy(n)))})}),mS=(e,t,r=!1,i=!1)=>{let n=new db(e.context,e.interruptible);return i||(e.children().add(n),n.addObserver(()=>e.children().delete(n))),r?n.evaluate(t):e.getRef(mi).scheduleTask(()=>n.evaluate(t),0),n},mw=(e,t)=>{let r=new db(mi.context(t?.scheduler??new d7));if(r.evaluate(e),t?.signal){if(t.signal.aborted)r.unsafeInterrupt();else{let e=()=>r.unsafeInterrupt();t.signal.addEventListener("abort",e,{once:!0}),r.addObserver(()=>t.signal.removeEventListener("abort",e))}}return r},mk=function(){class e extends globalThis.Error{}return Object.assign(e.prototype,dE,tc,{[dv]:"Failure",[dS](){return dj(this)},toString(){return this.message?`${this.name}: ${this.message}`:this.name},toJSON(){return{...this}},[eU](){let e=this.stack;return e?`${this.toString()}
${e.split("\n").slice(1).join("\n")}`:this.toString()}}),e}(),mC=class extends mk{constructor(e){super(),e&&Object.assign(this,e)}},mO=e=>{class t extends mC{constructor(...t){super(...t),this._tag=e}}return t.prototype.name=e,t},mE=Symbol.for("effect/Readable"),mI=Symbol.for("effect/Ref"),mF={_A:e=>e};class mR extends fx{static{i=mE}commit(){return this.get}constructor(e){super(),this[mI]=mF,this[i]=mE,this.ref=e,this.get=uB(()=>aT(this.ref))}modify(e){return uB(()=>{let t=aT(this.ref),[r,i]=e(t);return t!==i&&aN(i)(this.ref),r})}}let mT=e=>new mR(aF(e)),mN=e=>uB(()=>mT(e)),mA=e=>e.get,mj=M(2,(e,t)=>e.modify(()=>[void 0,t])),mM=M(2,(e,t)=>e.modify(e=>[e,t])),mz=M(2,(e,t)=>e.modify(t)),mP=M(2,(e,t)=>e.modify(e=>[void 0,t(e)]));class mD{scheduleTask(e,t){let r;let i=this.buckets.length,n=0;for(;n<i;n++)if(this.buckets[n][0]<=t)r=this.buckets[n];else break;r&&r[0]===t?r[1].push(e):n===i?this.buckets.push([t,[e]]):this.buckets.splice(n,0,[t,[e]])}constructor(){this.buckets=[]}}class mL{constructor(e){this.running=!1,this.tasks=new mD,this.maxNextTickBeforeTimer=e}starveInternal(e){let t=this.tasks.buckets;for(let[e,r]of(this.tasks.buckets=[],t))for(let e=0;e<r.length;e++)r[e]();0===this.tasks.buckets.length?this.running=!1:this.starve(e)}starve(e=0){e>=this.maxNextTickBeforeTimer?setTimeout(()=>this.starveInternal(0),0):Promise.resolve(void 0).then(()=>this.starveInternal(e+1))}shouldYield(e){return e.currentOpCount>e.getFiberRef(cE)&&e.getFiberRef(cO)}scheduleTask(e,t){this.tasks.scheduleTask(e,t),this.running||(this.running=!0,this.starve())}}let m$=H(Symbol.for("effect/Scheduler/defaultScheduler"),()=>new mL(2048));class mU{scheduleTask(e,t){this.deferred?m$.scheduleTask(e,t):this.tasks.scheduleTask(e,t)}shouldYield(e){return e.currentOpCount>e.getFiberRef(cE)&&e.getFiberRef(cO)}flush(){for(;this.tasks.buckets.length>0;){let e=this.tasks.buckets;for(let[t,r]of(this.tasks.buckets=[],e))for(let e=0;e<r.length;e++)r[e]()}this.deferred=!0}constructor(){this.tasks=new mD,this.deferred=!1}}let mq=H(Symbol.for("effect/FiberRef/currentScheduler"),()=>cv(m$)),mB=(e,t)=>({_tag:"Par",left:e,right:t}),mJ=(e,t)=>({_tag:"Seq",left:e,right:t}),mH=e=>{let t=os(e),r=on();for(;;){let[e,i]=ou(t,[mX(),on()],([e,t],r)=>{let[i,n]=mK(r);return[m1(e,i),oa(t,n)]});if(r=mV(r,e),ot(i))return oc(r);t=i}throw Error("BUG: BlockedRequests.flatten - please report an issue at https://github.com/Effect-TS/effect/issues")},mK=e=>{let t=e,r=mX(),i=on(),n=on();for(;;)switch(t._tag){case"Empty":if(ot(i))return[r,n];t=i.head,i=i.tail;break;case"Par":i=oi(t.right,i),t=t.left;break;case"Seq":{let e=t.left,r=t.right;switch(e._tag){case"Empty":t=r;break;case"Par":{let i=e.left,n=e.right;t=mB(mJ(i,r),mJ(n,r));break}case"Seq":t=mJ(e.left,mJ(e.right,r));break;case"Single":t=e,n=oi(r,n)}break}case"Single":if(r=m0(r,t),ot(i))return[r,n];t=i.head,i=i.tail}throw Error("BUG: BlockedRequests.step - please report an issue at https://github.com/Effect-TS/effect/issues")},mV=(e,t)=>{if(ot(e))return os(m5(t));if(m2(t))return e;let r=ge(e.head),i=m3(t);return 1===r.length&&1===i.length&&eP(r[0],i[0])?oi(m9(e.head,m5(t)),e.tail):oi(m5(t),e)},mW=Symbol.for("effect/RequestBlock/Entry"),mG={_R:e=>e},mY=Symbol.for("effect/RequestBlock/RequestBlockParallel"),mQ={_R:e=>e};class mZ{constructor(e){this[mY]=mQ,this.map=e}}let mX=()=>new mZ(ni()),m0=(e,t)=>new mZ(nd(e.map,t.dataSource,e=>tY(t1(e,iv(t.blockedRequest)),()=>ic(t.blockedRequest)))),m1=(e,t)=>new mZ(ny(e.map,t.map,(e,t,r)=>nl(e,r,tV(ns(e,r),{onNone:()=>t,onSome:e=>iC(t,e)})))),m2=e=>a2(e.map),m3=e=>Array.from(nc(e.map)),m5=e=>m7(nb(e.map,e=>ic(e))),m4=Symbol.for("effect/RequestBlock/RequestBlockSequential"),m6={_R:e=>e};class m8{constructor(e){this[m4]=m6,this.map=e}}let m7=e=>new m8(e),m9=(e,t)=>new m8(ny(t.map,e.map,(e,t,r)=>nl(e,r,tV(ns(e,r),{onNone:()=>il(),onSome:e=>iC(e,t)})))),ge=e=>Array.from(nc(e.map)),gt=e=>Array.from(e.map),gr=H(Symbol.for("effect/FiberRef/currentRequestMap"),()=>cv(new Map)),gi=(e,t,r,i)=>{switch(e){case void 0:return t();case"unbounded":return r();case"inherit":return cc(cN,e=>"unbounded"===e?r():e>1?i(e):t());default:return e>1?i(e):t()}},gn=(e,t,r)=>{switch(e){case void 0:return t();case"unbounded":return r();case"inherit":return cc(cN,e=>"unbounded"===e||e>1?r():t());default:return e>1?r():t()}},gs=e=>{let t=s7(e);return fu(e=>e.sleep(t))},ga=(e,t)=>({label:e,startTime:t}),go=e=>t=>{let r=t.label.replace(/[\s="]/g,"_");return`${r}=${e-t.startTime}ms`},gl=e=>({_tag:"ExternalSpan",spanId:e.spanId,traceId:e.traceId,sampled:e.sampled??!0,context:e.context??sQ()}),gu="effect/MetricLabel",gc=Symbol.for(gu);class gh{constructor(e,t){this[gc]=gc,this.key=e,this.value=t,this._hash=eT(gu+this.key+this.value)}[ek](){return this._hash}[ez](e){return gf(e)&&this.key===e.key&&this.value===e.value}pipe(){return eX(this,arguments)}}let gp=(e,t)=>new gh(e,t),gf=e=>en(e,gc),gd=M(e=>l3(e[0]),function(){let e=arguments;return cy(e[0],cI,"string"==typeof e[1]?nl(e[1],e[2]):t=>Object.entries(e[1]).reduce((e,[t,r])=>nl(e,t,r),t))}),gm=e=>uN(e,tk),gg=e=>{let t,r;return"function"==typeof e?t=e:(t=e.try,r=e.catch),uB(()=>{try{return t()}catch(e){throw lG(nQ(r?r(e):new he(e)))}})},gb=M(2,(e,t)=>uw(e,{onFailure:e=>{let r=t(e);switch(r._tag){case"None":return ud(e);case"Some":return r.value}},onSuccess:uU})),gx=M(3,(e,t,r)=>un(e,es(t),r)),gy=M(2,(e,t)=>{let r;return un(e,e=>(r??=Object.keys(t),en(e,"_tag")&&K(e._tag)&&r.includes(e._tag)),e=>t[e._tag](e))}),gv=e=>gB(e,gE,fH),g_=e=>gB(e,u2(gE,u$),([e,t],[r,i])=>[fH(e,r),lM(t,i)]),gS=M(3,(e,t,r)=>ux(e,e=>uN(r(e),r=>Object.assign({},e,{[t]:r})))),gw=M(2,(e,t)=>uN(e,e=>({[t]:e}))),gk=((e,t)=>uq(()=>{let r;let i=e[Symbol.iterator](),n=[],s=uU(!1),a=0;for(;(r=i.next())&&!r.done;){let e=r.value,i=a++;s=ux(s,r=>r?(n.push(e),uU(!0)):t(e,i))}return uN(s,()=>n)}),M(3,(e,t,r)=>ux(e,e=>t(e)?uU(e):r(e)))),gC=M(2,(e,t)=>uk(e,{onFailure:e=>uU(t.onFailure(e)),onSuccess:e=>uU(t.onSuccess(e))})),gO=e=>{let t=ux(ux(e,()=>u1()),()=>t);return t},gE=l5(e=>uU(e.getFiberRefs())),gI=e=>(...t)=>{let r;let i=tQ(e);for(let e=0,i=t.length;e<i;e++){let i=t[e];n2(i)&&(r=void 0!==r?n1(r,i):i,t=[...t.slice(0,e),...t.slice(e+1)],e--)}return void 0===r&&(r=nY),l5(e=>(e.log(t,r,i),uG))},gF=gI(),gR=gI(ci),gT=gI(cr),gN=gI(ct),gA=gI(ce),gj=M(2,(e,t)=>ux(fc,r=>cy(e,cR,oo(ga(t,r))))),gM=M(2,(e,t)=>uw(e,{onFailure:e=>um(()=>t(e)),onSuccess:uU})),gz=e=>uN(e,e=>!e),gP=e=>uN(mN(!0),t=>l8(uQ(e,mM(t,!1)))),gD=e=>gG((t,r)=>U(e,fV(t,r))),gL=M(3,(e,t,r)=>hM(i=>hz(e,sq(i,t,r)))),g$=M(3,(e,t,r)=>hM(i=>ux(r,r=>hz(e,U(i,sq(t,r)))))),gU=M(3,(e,t,r)=>rd(e).reduce((e,t,i)=>ux(e,e=>r(e,t,i)),uU(t))),gq=uU(tK()),gB=M(3,(e,t,r)=>ux(t,i=>ux(e,e=>uN(t,t=>[r(i,t),e])))),gJ=M(2,(e,{onFailure:t,onSuccess:r})=>uw(e,{onFailure:e=>{let r=st(e);switch(r._tag){case"Left":return u5(t(r.left),ud(e));case"Right":return ud(e)}},onSuccess:e=>l6(r(e),e)})),gH=M(2,(e,t)=>uw(e,{onFailure:e=>{let r=st(e);switch(r._tag){case"Left":return u5(t(r.left),ud(e));case"Right":return ud(e)}},onSuccess:uU})),gK=M(2,(e,t)=>uw(e,{onFailure:e=>u5(t(e),ud(e)),onSuccess:uU})),gV=e=>{let t,r;return("function"==typeof e?t=e:(t=e.try,r=e.catch),t.length>=1)?ut((e,i)=>{try{t(i).then(t=>e(hg(t)),t=>e(r?uf(()=>r(t)):up(new he(t))))}catch(t){e(r?uf(()=>r(t)):up(new he(t)))}}):ut(e=>{try{t().then(t=>e(hg(t)),t=>e(r?uf(()=>r(t)):up(new he(t))))}catch(t){e(r?uf(()=>r(t)):up(new he(t)))}})},gW=M(2,(e,t)=>ux(e,e=>gg({try:()=>t.try(e),catch:t.catch}))),gG=e=>l5(t=>(t.setFiberRefs(e(t.id(),t.getFiberRefs())),uG)),gY=M(2,(e,t)=>uq(()=>t()?uN(e,tk):uU(tK()))),gQ=BigInt(0),gZ=t2(e=>sK(e.context,fs)?"Span"===e._tag?gZ(e.parent):tK():tk(e)),gX=(e,t,r)=>{let i;let n=!e.getFiberRef(cD)||r.context&&sK(r.context,fs),s=e.getFiberRef(cC),a=r.parent?tk(r.parent):r.root?tK():gZ(sV(s,ft));if(n)i=hU({name:t,parent:a,context:sq(r.context??sQ(),fs,!0)});else{let n=e.getFiberRef(fo),s=sK(n,fe),o=sK(n,hB),l=e.getFiberRef(cL),u=e.getFiberRefs(),c=fM(u,c$),h=fM(u,cU),p="Some"===h._tag?void 0!==r.links?[...id(h.value),...r.links??[]]:id(h.value):r.links??rK();i=s.span(t,a,r.context??sQ(),p,l?o.unsafeCurrentTimeNanos():gQ,r.kind??"internal"),"Some"===c._tag&&nx(c.value,(e,t)=>i.attribute(t,e)),void 0!==r.attributes&&Object.entries(r.attributes).forEach(([e,t])=>i.attribute(e,t))}return"function"==typeof r.captureStackTrace&&sC.set(i,r.captureStackTrace),i},g0=(e,t,r,i)=>uB(()=>{"Ended"!==e.status._tag&&(hr(t)&&sC.has(e)&&e.attribute("code.stacktrace",sC.get(e)()),e.end(i?r.unsafeCurrentTimeNanos():gQ,t))}),g1=(e,...t)=>{let r=fn(1===t.length?void 0:t[0]),i=t[t.length-1];return l5(t=>{let n=gX(t,e,r),s=t.getFiberRef(cL),a=sK(t.getFiberRef(fo),hB);return uM(i(n),e=>g0(n,e,a,s))})},g2=M(2,(e,t)=>gL(e,ft,t)),g3=e=>U(e,hc(z)),g5="InterruptSignal",g4="Stateful",g6="Resume",g8="YieldNow",g7=e=>({_tag:g5,cause:e}),g9=e=>({_tag:g4,onFiber:e}),be=e=>({_tag:g6,effect:e}),bt=()=>({_tag:g8}),br=Symbol.for("effect/FiberScope");class bi{add(e,t){this.roots.add(t),t.addObserver(()=>{this.roots.delete(t)})}constructor(){this[br]=br,this.fiberId=aQ,this.roots=new Set}}class bn{constructor(e,t){this[br]=br,this.fiberId=e,this.parent=t}add(e,t){this.parent.tell(g9(e=>{e.addChild(t),t.addObserver(()=>{e.removeChild(t)})}))}}let bs=e=>new bn(e.id(),e),ba=H(Symbol.for("effect/FiberScope/Global"),()=>new bi),bo=Symbol.for("effect/Fiber"),bl={_E:e=>e,_A:e=>e},bu={[bo]:bl,pipe(){return eX(this,arguments)}},bc=Symbol.for("effect/Fiber"),bh=e=>e.await,bp=((e,t)=>e.interruptAsFork(t),e=>u3(u_(e.await),e.inheritAll)),bf=((e,t)=>bf(e,e=>uB(()=>t(e))),M(2,(e,t)=>({...th,commit(){return bp(this)},...bu,id:()=>e.id(),await:ux(e.await,hh(t)),children:e.children,inheritAll:e.inheritAll,poll:ux(e.poll,e=>{switch(e._tag){case"None":return uU(tK());case"Some":return U(hh(e.value,t),uN(tk))}}),interruptAsFork:t=>e.interruptAsFork(t)})));(e,t)=>({...th,commit(){return bp(this)},...bu,id:()=>aK(e.id(),t.id()),await:u4(e.await,t.await,(e,t)=>hi(e)?e:t),children:e.children,inheritAll:u5(t.inheritAll,e.inheritAll),poll:u4(e.poll,t.poll,(e,t)=>{switch(e._tag){case"None":return tK();case"Some":return hi(e.value)?e:t}}),interruptAsFork:r=>U(u8(e,r),u5(U(t,u8(r))),l8)});let bd="effect/FiberCurrent",bm=Symbol.for("effect/Logger"),bg={_Message:e=>e,_Output:e=>e},bb=e=>({[bm]:bg,log:e,pipe(){return eX(this,arguments)}}),bx=M(2,(e,t)=>bb(r=>e.log({...r,message:t(r.message)}))),by=M(2,(e,t)=>bb(r=>e.log(t(r)))),bv=M(2,(e,t)=>bb(r=>t(r.logLevel)?tk(e.log(r)):tK())),b_=M(2,(e,t)=>bb(r=>t(e.log(r)))),bS=e=>({[bm]:bg,log:({message:t})=>e(t),pipe(){return eX(this,arguments)}}),bw=M(2,(e,t)=>bb(r=>[e.log(r),t.log(r)])),bk=M(2,(e,t)=>b_(bw(e,t),e=>e[0])),bC=M(2,(e,t)=>b_(bw(e,t),e=>e[1])),bO=bb(({annotations:e,cause:t,date:r,fiberId:i,logLevel:n,message:s,spans:a})=>{let o=r.getTime(),l=`timestamp=${r.toISOString()} level=${n.label} fiber=${aG(i)}`,u=rm(s);for(let e=0;e<u.length;e++){let t=eK(u[e]);t.length>0&&(l+=" message=",l=bF(t,l))}if(null!=t&&"Empty"!==t._tag&&(l+=" cause=",l=bF(sv(t,{renderErrorCause:!0}),l)),or(a)){l+=" ";let e=!0;for(let t of a)e?e=!1:l+=" ",l+=U(t,go(o))}if(nh(e)>0){l+=" ";let t=!0;for(let[r,i]of e)t?t=!1:l+=" ",l+=bj(r),l+="=",l=bF(eK(i),l)}return l}),bE=e=>`"${e.replace(/\\([\s\S])|(")/g,"\\$1$2")}"`,bI=/^[^\s"=]+$/,bF=(e,t)=>t+(e.match(bI)?e:bE(e)),bR=bb(({annotations:e,cause:t,date:r,fiberId:i,logLevel:n,message:s,spans:a})=>{let o=r.getTime(),l=`timestamp=${r.toISOString()} level=${n.label} fiber=${aG(i)}`,u=rm(s);for(let e=0;e<u.length;e++){let t=eK(u[e],0);t.length>0&&(l+=" message=",l=bz(t,l))}if(null!=t&&"Empty"!==t._tag&&(l+=" cause=",l=bz(sv(t,{renderErrorCause:!0}),l)),or(a)){l+=" ";let e=!0;for(let t of a)e?e=!1:l+=" ",l+=U(t,bP(o))}if(nh(e)>0){l+=" ";let t=!0;for(let[r,i]of e)t?t=!1:l+=" ",l+=bj(r),l+="=",l=bz(eK(i,0),l)}return l}),bT=bb(({annotations:e,cause:t,date:r,fiberId:i,logLevel:n,message:s,spans:a})=>{let o=r.getTime(),l={},u={};if(nh(e)>0)for(let[t,r]of e)l[t]=bN(r);if(or(a))for(let e of a)u[e.label]=o-e.startTime;let c=rm(s);return{message:1===c.length?bN(c[0]):c.map(bN),logLevel:n.label,timestamp:r.toISOString(),cause:n5(t)?void 0:sv(t,{renderErrorCause:!0}),annotations:l,spans:u,fiberId:aG(i)}}),bN=e=>{switch(typeof e){case"bigint":case"function":case"symbol":return String(e);default:return eq(e)}},bA=b_(bT,eV),bj=e=>e.replace(/[\s="]/g,"_"),bM=e=>JSON.stringify(e),bz=(e,t)=>t+(e.match(bI)?e:bM(e)),bP=e=>t=>{let r=bj(t.label);return`${r}=${e-t.startTime}ms`},bD=(e,...t)=>{let r="";for(let e=0;e<t.length;e++)r+=`\x1b[${t[e]}m`;return r+e+"\x1b[0m"},bL=(e,...t)=>e,b$={bold:"1",red:"31",green:"32",yellow:"33",blue:"34",cyan:"36",white:"37",gray:"90",black:"30",bgBrightRed:"101"},bU={None:[],All:[],Trace:[b$.gray],Debug:[b$.blue],Info:[b$.green],Warning:[b$.yellow],Error:[b$.red],Fatal:[b$.bgBrightRed,b$.black]},bq={None:"",All:"",Trace:"color:gray",Debug:"color:blue",Info:"color:green",Warning:"color:orange",Error:"color:red",Fatal:"background-color:red;color:white"},bB=e=>`${e.getHours().toString().padStart(2,"0")}:${e.getMinutes().toString().padStart(2,"0")}:${e.getSeconds().toString().padStart(2,"0")}.${e.getMilliseconds().toString().padStart(3,"0")}`,bJ="object"==typeof process&&null!==process&&"object"==typeof process.stdout&&null!==process.stdout,bH=bJ&&!0===process.stdout.isTTY,bK=bJ||"Deno"in globalThis,bV=e=>{let t=e?.mode??"auto",r="browser"===("auto"===t?bK?"tty":"browser":t),i="boolean"==typeof e?.colors?e.colors:bH||r,n=e?.formatDate??bB;return r?bG({colors:i,formatDate:n}):bW({colors:i,formatDate:n,stderr:e?.stderr===!0})},bW=e=>{let t="object"==typeof process&&"isBun"in process&&!0===process.isBun,r=e.colors&&bH?bD:bL;return bb(({annotations:i,cause:n,context:s,date:a,fiberId:o,logLevel:l,message:u,spans:c})=>{let h=sK(fz(s,fo),p2).unsafe,p=!0===e.stderr?h.error:h.log,f=rm(u),d=r(`[${e.formatDate(a)}]`,b$.white)+` ${r(l.label,...bU[l._tag])}`+` (${aG(o)})`;if(or(c)){let e=bP(a.getTime());for(let t of c)d+=" "+e(t)}d+=":";let m=0;if(f.length>0){let e=bN(f[0]);"string"==typeof e&&(d+=" "+r(e,b$.bold,b$.cyan),m++)}if(p(d),t||h.group(),n5(n)||p(sv(n,{renderErrorCause:!0})),m<f.length)for(;m<f.length;m++)p(eZ(f[m]));if(nh(i)>0)for(let[e,t]of i)p(r(`${e}:`,b$.bold,b$.white),eZ(t));t||h.groupEnd()})},bG=e=>{let t=e.colors?"%c":"";return bb(({annotations:r,cause:i,context:n,date:s,fiberId:a,logLevel:o,message:l,spans:u})=>{let c=sK(fz(n,fo),p2).unsafe,h=rm(l),p=`${t}[${e.formatDate(s)}]`,f=[];if(e.colors&&f.push("color:gray"),p+=` ${t}${o.label}${t} (${aG(a)})`,e.colors&&f.push(bq[o._tag],""),or(u)){let e=bP(s.getTime());for(let t of u)p+=" "+e(t)}p+=":";let d=0;if(h.length>0){let r=bN(h[0]);"string"==typeof r&&(p+=` ${t}${r}`,e.colors&&f.push("color:deepskyblue"),d++)}if(c.groupCollapsed(p,...f),n5(i)||c.error(sv(i,{renderErrorCause:!0})),d<h.length)for(;d<h.length;d++)c.log(eZ(h[d]));if(nh(r)>0)for(let[t,i]of r){let r=eZ(i);e.colors?c.log(`%c${t}:`,"color:gray",r):c.log(`${t}:`,r)}c.groupEnd()})},bY=H("effect/Logger/prettyLoggerDefault",()=>bV()),bQ=Symbol.for("effect/MetricKeyType"),bZ="effect/MetricKeyType/Counter",bX=Symbol.for(bZ),b0=Symbol.for("effect/MetricKeyType/Frequency"),b1=Symbol.for("effect/MetricKeyType/Gauge"),b2="effect/MetricKeyType/Histogram",b3=Symbol.for(b2),b5=Symbol.for("effect/MetricKeyType/Summary"),b4={_In:e=>e,_Out:e=>e};class b6{constructor(e,t){this[bQ]=b4,this[bX]=bX,this.incremental=e,this.bigint=t,this._hash=eT(bZ)}[ek](){return this._hash}[ez](e){return b9(e)}pipe(){return eX(this,arguments)}}class b8{constructor(e){this[bQ]=b4,this[b3]=b3,this.boundaries=e,this._hash=U(eT(b2),eE(eC(this.boundaries)))}[ek](){return this._hash}[ez](e){return xr(e)&&eP(this.boundaries,e.boundaries)}pipe(){return eX(this,arguments)}}let b7=e=>new b6(e?.incremental??!1,e?.bigint??!1),b9=e=>en(e,bX),xe=e=>en(e,b0),xt=e=>en(e,b1),xr=e=>en(e,b3),xi=e=>en(e,b5),xn=Symbol.for("effect/MetricKey"),xs={_Type:e=>e},xa=tJ(eP);class xo{constructor(e,t,r,i=[]){this[xn]=xs,this.name=e,this.keyType=t,this.description=r,this.tags=i,this._hash=U(eT(this.name+this.description),eE(eC(this.keyType)),eE(ej(this.tags)))}[ek](){return this._hash}[ez](e){return xl(e)&&this.name===e.name&&eP(this.keyType,e.keyType)&&eP(this.description,e.description)&&xa(this.tags,e.tags)}pipe(){return eX(this,arguments)}}let xl=e=>en(e,xn),xu=(e,t)=>new xo(e,b7(t),tQ(t?.description)),xc=M(2,(e,t)=>0===t.length?e:new xo(e.name,e.keyType,e.description,rH(e.tags,t))),xh=Symbol.for("effect/MutableHashMap"),xp={[xh]:xh,[Symbol.iterator](){return new xf(this)},toString(){return eB(this.toJSON())},toJSON(){return{_id:"MutableHashMap",values:Array.from(this).map(eq)}},[eU](){return this.toJSON()},pipe(){return eX(this,arguments)}};class xf{constructor(e){this.self=e,this.referentialIterator=e.referential[Symbol.iterator]()}next(){if(void 0!==this.bucketIterator)return this.bucketIterator.next();let e=this.referentialIterator.next();return e.done?(this.bucketIterator=new xd(this.self.buckets.values()),this.next()):e}[Symbol.iterator](){return new xf(this.self)}}class xd{constructor(e){this.backing=e}next(){if(void 0===this.currentBucket){let e=this.backing.next();if(e.done)return e;this.currentBucket=e.value[Symbol.iterator]()}let e=this.currentBucket.next();return e.done?(this.currentBucket=void 0,this.next()):e}}let xm=()=>{let e=Object.create(xp);return e.referential=new Map,e.buckets=new Map,e.bucketsSize=0,e},xg=M(2,(e,t)=>{if(!1===eL(t))return e.referential.has(t)?tk(e.referential.get(t)):tK();let r=t[ek](),i=e.buckets.get(r);return void 0===i?tK():xb(e,i,t)}),xb=(e,t,r,i=!1)=>{for(let n=0,s=t.length;n<s;n++)if(r[ez](t[n][0])){let r=t[n][1];return i&&(t.splice(n,1),e.bucketsSize--),tk(r)}return tK()},xx=M(2,(e,t)=>tS(xg(e,t))),xy=M(3,(e,t,r)=>{if(!1===eL(t))return e.referential.set(t,r),e;let i=t[ek](),n=e.buckets.get(i);return void 0===n?e.buckets.set(i,[[t,r]]):(xv(e,n,t),n.push([t,r])),e.bucketsSize++,e}),xv=(e,t,r)=>{for(let i=0,n=t.length;i<n;i++)if(r[ez](t[i][0])){t.splice(i,1),e.bucketsSize--;return}},x_=M(2,(e,t)=>{if(!1===eL(t))return e.referential.delete(t),e;let r=t[ek](),i=e.buckets.get(r);return void 0===i||(xv(e,i,t),0===i.length&&e.buckets.delete(r)),e}),xS=e=>e.referential.size+e.bucketsSize,xw=Symbol.for("effect/MetricState"),xk="effect/MetricState/Counter",xC=Symbol.for(xk),xO="effect/MetricState/Frequency",xE=Symbol.for(xO),xI="effect/MetricState/Gauge",xF=Symbol.for(xI),xR="effect/MetricState/Histogram",xT=Symbol.for(xR),xN="effect/MetricState/Summary",xA=Symbol.for(xN),xj={_A:e=>e};class xM{constructor(e){this[xw]=xj,this[xC]=xC,this.count=e}[ek](){return U(eC(xk),eE(eC(this.count)),eM(this))}[ez](e){return xK(e)&&this.count===e.count}pipe(){return eX(this,arguments)}}let xz=tJ(eP);class xP{constructor(e){this[xw]=xj,this[xE]=xE,this.occurrences=e}[ek](){return U(eT(xO),eE(ej(rd(this.occurrences.entries()))),eM(this))}[ez](e){return xV(e)&&xz(rd(this.occurrences.entries()),rd(e.occurrences.entries()))}pipe(){return eX(this,arguments)}}class xD{constructor(e){this[xw]=xj,this[xF]=xF,this.value=e}[ek](){return U(eC(xI),eE(eC(this.value)),eM(this))}[ez](e){return xW(e)&&this.value===e.value}pipe(){return eX(this,arguments)}}class xL{constructor(e,t,r,i,n){this[xw]=xj,this[xT]=xT,this.buckets=e,this.count=t,this.min=r,this.max=i,this.sum=n}[ek](){return U(eC(xR),eE(eC(this.buckets)),eE(eC(this.count)),eE(eC(this.min)),eE(eC(this.max)),eE(eC(this.sum)),eM(this))}[ez](e){return xG(e)&&eP(this.buckets,e.buckets)&&this.count===e.count&&this.min===e.min&&this.max===e.max&&this.sum===e.sum}pipe(){return eX(this,arguments)}}class x${constructor(e,t,r,i,n,s){this[xw]=xj,this[xA]=xA,this.error=e,this.quantiles=t,this.count=r,this.min=i,this.max=n,this.sum=s}[ek](){return U(eC(xN),eE(eC(this.error)),eE(eC(this.quantiles)),eE(eC(this.count)),eE(eC(this.min)),eE(eC(this.max)),eE(eC(this.sum)),eM(this))}[ez](e){return xY(e)&&this.error===e.error&&eP(this.quantiles,e.quantiles)&&this.count===e.count&&this.min===e.min&&this.max===e.max&&this.sum===e.sum}pipe(){return eX(this,arguments)}}let xU=e=>new xM(e),xq=e=>new xP(e),xB=e=>new xD(e),xJ=e=>new xL(e.buckets,e.count,e.min,e.max,e.sum),xH=e=>new x$(e.error,e.quantiles,e.count,e.min,e.max,e.sum),xK=e=>en(e,xC),xV=e=>en(e,xE),xW=e=>en(e,xF),xG=e=>en(e,xT),xY=e=>en(e,xA),xQ=Symbol.for("effect/MetricHook"),xZ={_In:e=>e,_Out:e=>e},xX=e=>({[xQ]:xZ,pipe(){return eX(this,arguments)},...e}),x0=BigInt(0),x1=e=>{let t=e.keyType.bigint?x0:0,r=e.keyType.incremental?e.keyType.bigint?e=>e>=x0:e=>e>=0:e=>!0,i=e=>{r(e)&&(t+=e)};return xX({get:()=>xU(t),update:i,modify:i})},x2=e=>{let t=new Map;for(let r of e.keyType.preregisteredWords)t.set(r,0);let r=e=>{let r=t.get(e)??0;t.set(e,r+1)};return xX({get:()=>xq(t),update:r,modify:r})},x3=(e,t)=>{let r=t;return xX({get:()=>xB(r),update:e=>{r=e},modify:e=>{r+=e}})},x5=e=>{let t=e.keyType.boundaries.values,r=t.length,i=new Uint32Array(r+1),n=new Float32Array(r),s=0,a=0,o=Number.MAX_VALUE,l=Number.MIN_VALUE;U(t,rP(rr),rW((e,t)=>{n[t]=e}));let u=e=>{let t=0,u=r;for(;t!==u;){let r=Math.floor(t+(u-t)/2);e<=n[r]?u=r:t=r,u===t+1&&(e<=n[t]?u=t:t=u)}i[t]=i[t]+1,s+=1,a+=e,e<o&&(o=e),e>l&&(l=e)},c=()=>{let e=rp(r),t=0;for(let s=0;s<r;s++){let r=n[s];t+=i[s],e[s]=[r,t]}return e};return xX({get:()=>xJ({buckets:c(),count:s,min:o,max:l,sum:a}),update:u,modify:u})},x4=e=>{let{error:t,maxAge:r,maxSize:i,quantiles:n}=e.keyType,s=U(n,rP(rr)),a=rp(i),o=0,l=0,u=0,c=Number.MAX_VALUE,h=Number.MIN_VALUE,p=e=>{let n=[],o=0;for(;o!==i-1;){let t=a[o];if(null!=t){let[i,s]=t,a=al(e-i);aw(a,as)&&a<=r&&n.push(s)}o+=1}return x6(t,s,rP(n,rr))},f=(e,t)=>{i>0&&(a[(o+=1)%i]=[t,e]),l+=1,u+=e,e<c&&(c=e),e>h&&(h=e)};return xX({get:()=>xH({error:t,quantiles:p(Date.now()),count:l,min:c,max:h,sum:u}),update:([e,t])=>f(e,t),modify:([e,t])=>f(e,t)})},x6=(e,t,r)=>{let i=r.length;if(!rw(t))return rK();let n=t[0],s=t.slice(1),a=x8(e,i,tK(),0,n,r),o=rV(a);return s.forEach(t=>{o.push(x8(e,i,a.value,a.consumed,t,a.rest))}),rW(o,e=>[e.quantile,e.value])},x8=(e,t,r,i,n,s)=>{let a=e,o=t,l=r,u=i,c=n,h=s,p=e,f=t,d=r,m=i,g=n,b=s;for(;;){if(!rw(h))return{quantile:c,value:tK(),consumed:u,rest:[]};if(1===c)return{quantile:c,value:tk(rT(h)),consumed:u+h.length,rest:[]};let e=rj(h,e=>e<=h[0]),t=c*o,r=a/2*t,i=u+e[0].length,n=Math.abs(i-t);if(i<t-r){p=a,f=o,d=rI(h),m=i,g=c,b=e[1],a=p,o=f,l=d,u=m,c=g,h=b;continue}if(i>t+r)return{quantile:c,value:l,consumed:u,rest:h};switch(l._tag){case"None":p=a,f=o,d=rI(h),m=i,g=c,b=e[1],a=p,o=f,l=d,u=m,c=g,h=b;continue;case"Some":if(n<Math.abs(t-l.value)){p=a,f=o,d=rI(h),m=i,g=c,b=e[1],a=p,o=f,l=d,u=m,c=g,h=b;continue}return{quantile:c,value:tk(l.value),consumed:u,rest:h}}}throw Error("BUG: MetricHook.resolveQuantiles - please report an issue at https://github.com/Effect-TS/effect/issues")},x7=Symbol.for("effect/MetricPair"),x9={_Type:e=>e},ye=(e,t)=>({[x7]:x9,metricKey:e,metricState:t,pipe(){return eX(this,arguments)}}),yt=Symbol.for("effect/MetricRegistry");class yr{snapshot(){let e=[];for(let[t,r]of this.map)e.push(ye(t,r.get()));return e}get(e){let t=U(this.map,xg(e),tZ);if(null!=t)return t;if(b9(e.keyType))return this.getCounter(e);if(xt(e.keyType))return this.getGauge(e);if(xe(e.keyType))return this.getFrequency(e);if(xr(e.keyType))return this.getHistogram(e);if(xi(e.keyType))return this.getSummary(e);throw Error("BUG: MetricRegistry.get - unknown MetricKeyType - please report an issue at https://github.com/Effect-TS/effect/issues")}getCounter(e){let t=U(this.map,xg(e),tZ);if(null==t){let r=x1(e);U(this.map,xx(e))||U(this.map,xy(e,r)),t=r}return t}getFrequency(e){let t=U(this.map,xg(e),tZ);if(null==t){let r=x2(e);U(this.map,xx(e))||U(this.map,xy(e,r)),t=r}return t}getGauge(e){let t=U(this.map,xg(e),tZ);if(null==t){let r=x3(e,e.keyType.bigint?BigInt(0):0);U(this.map,xx(e))||U(this.map,xy(e,r)),t=r}return t}getHistogram(e){let t=U(this.map,xg(e),tZ);if(null==t){let r=x5(e);U(this.map,xx(e))||U(this.map,xy(e,r)),t=r}return t}getSummary(e){let t=U(this.map,xg(e),tZ);if(null==t){let r=x4(e);U(this.map,xx(e))||U(this.map,xy(e,r)),t=r}return t}constructor(){this[yt]=yt,this.map=xm()}}let yi=()=>new yr,yn=Symbol.for("effect/Metric"),ys={_Type:e=>e,_In:e=>e,_Out:e=>e},ya=H(Symbol.for("effect/Metric/globalMetricRegistry"),()=>yi()),yo=function(e,t,r,i){let n=Object.assign(e=>uJ(e,e=>yp(n,e)),{[yn]:ys,keyType:e,unsafeUpdate:t,unsafeValue:r,unsafeModify:i,register(){return this.unsafeValue([]),this},pipe(){return eX(this,arguments)}});return n},yl=(e,t)=>yu(xu(e,t)),yu=e=>{let t;let r=new WeakMap,i=i=>{if(0===i.length)return void 0!==t?t:t=ya.get(e);let n=r.get(i);return void 0!==n||(n=ya.get(xc(e,i)),r.set(i,n)),n};return yo(e.keyType,(e,t)=>i(t).update(e),e=>i(e).get(),(e,t)=>i(t).modify(e))},yc=M(3,(e,t,r)=>yh(e,[gp(t,r)])),yh=M(2,(e,t)=>yo(e.keyType,(r,i)=>e.unsafeUpdate(r,rH(t,i)),r=>e.unsafeValue(rH(t,r)),(r,i)=>e.unsafeModify(r,rH(t,i)))),yp=M(2,(e,t)=>cc(cM,r=>uB(()=>e.unsafeUpdate(t,r)))),yf="effect/MetricBoundaries",yd=Symbol.for(yf);class ym{constructor(e){this[yd]=yd,this.values=e,this._hash=U(eT(yf),eE(ej(this.values)))}[ek](){return this._hash}[ez](e){return yg(e)&&eP(this.values,e.values)}pipe(){return eX(this,arguments)}}let yg=e=>en(e,yd),yb=e=>new ym(U(e,rv(ic(Number.POSITIVE_INFINITY)),r8)),yx=M(2,(e,t)=>cc(gr,r=>uB(()=>{if(r.has(e)){let i=r.get(e);i.state.completed||(i.state.completed=!0,hT(i.result,t))}})));class yy{addObserver(e){this.observers.add(e)}removeObserver(e){this.observers.delete(e)}increment(){this.count++,this.observers.forEach(e=>e(this.count))}decrement(){this.count--,this.observers.forEach(e=>e(this.count))}constructor(){this.count=0,this.observers=new Set,this.interrupted=!1}}let yv=Symbol.for("effect/Supervisor"),y_={_T:e=>e};class yS{constructor(e,t){this[yv]=y_,this.underlying=e,this.value0=t}get value(){return this.value0}onStart(e,t,r,i){this.underlying.onStart(e,t,r,i)}onEnd(e,t){this.underlying.onEnd(e,t)}onEffect(e,t){this.underlying.onEffect(e,t)}onSuspend(e){this.underlying.onSuspend(e)}onResume(e){this.underlying.onResume(e)}map(e){return new yS(this,U(this.value,uN(e)))}zip(e){return new yw(this,e)}}class yw{constructor(e,t){this._tag="Zip",this[yv]=y_,this.left=e,this.right=t}get value(){return u2(this.left.value,this.right.value)}onStart(e,t,r,i){this.left.onStart(e,t,r,i),this.right.onStart(e,t,r,i)}onEnd(e,t){this.left.onEnd(e,t),this.right.onEnd(e,t)}onEffect(e,t){this.left.onEffect(e,t),this.right.onEffect(e,t)}onSuspend(e){this.left.onSuspend(e),this.right.onSuspend(e)}onResume(e){this.left.onResume(e),this.right.onResume(e)}map(e){return new yS(this,U(this.value,uN(e)))}zip(e){return new yw(this,e)}}let yk=e=>en(e,yv)&&es(e,"Zip");class yC{get value(){return uB(()=>Array.from(this.fibers))}onStart(e,t,r,i){this.fibers.add(i)}onEnd(e,t){this.fibers.delete(t)}onEffect(e,t){}onSuspend(e){}onResume(e){}map(e){return new yS(this,U(this.value,uN(e)))}zip(e){return new yw(this,e)}onRun(e,t){return e()}constructor(){this[yv]=y_,this.fibers=new Set}}class yO{constructor(e){this[yv]=y_,this.effect=e}get value(){return this.effect}onStart(e,t,r,i){}onEnd(e,t){}onEffect(e,t){}onSuspend(e){}onResume(e){}map(e){return new yS(this,U(this.value,uN(e)))}zip(e){return new yw(this,e)}onRun(e,t){return e()}}let yE=uB(()=>new yC),yI=e=>new yO(e),yF=H("effect/Supervisor/none",()=>yI(uG)),yR="Empty",yT="AddSupervisor",yN="RemoveSupervisor",yA="AndThen",yj={_tag:yR},yM=(e,t)=>({_tag:yA,first:e,second:t}),yz=(e,t)=>{let r=e,i=t;for(;iN(i);){let e=ij(i);switch(e._tag){case yR:i=iL(i);break;case yT:r=r.zip(e.supervisor),i=iL(i);break;case yN:r=yP(r,e.supervisor),i=iL(i);break;case yA:i=i_(e.first)(i_(e.second)(iL(i)))}}return r},yP=(e,t)=>eP(e,t)?yF:yk(e)?yP(e.left,t).zip(yP(e.right,t)):e,yD=e=>eP(e,yF)?nO():yk(e)?U(yD(e.left),nz(yD(e.right))):n$(e),yL=lf({empty:yj,patch:(e,t)=>yz(t,ic(e)),combine:yM,diff:(e,t)=>{if(eP(e,t))return yj;let r=yD(e),i=yD(t),n=U(i,nM(r),nD(yj,(e,t)=>yM(e,{_tag:yT,supervisor:t}))),s=U(r,nM(i),nD(yj,(e,t)=>yM(e,{_tag:yN,supervisor:t})));return yM(n,s)}}),y$=yl("effect_fiber_started",{incremental:!0}),yU=yl("effect_fiber_active"),yq=yl("effect_fiber_successes",{incremental:!0}),yB=yl("effect_fiber_failures",{incremental:!0}),yJ=yc(yu(new xo("effect_fiber_lifetimes",new b8((e=>U(rf(e.count-1,t=>e.start*Math.pow(e.factor,t)),ib,yb))({start:.5,factor:2,count:35})),tQ(b))),"time_unit","milliseconds"),yH="Continue",yK="Yield",yV={_E:e=>e,_A:e=>e},yW=e=>{throw Error(`BUG: FiberRuntime - ${eK(e)} - please report an issue at https://github.com/Effect-TS/effect/issues`)},yG=Symbol.for("effect/internal/fiberRuntime/YieldedOp"),yY=H("effect/internal/fiberRuntime/yieldedOpChannel",()=>({currentOp:null})),yQ={[e5]:(e,t,r)=>ev(()=>t.effect_instruction_i1(r)),OnStep:(e,t,r)=>hg(hg(r)),[e4]:(e,t,r)=>ev(()=>t.effect_instruction_i2(r)),[ti]:(e,t,r)=>(e.patchRuntimeFlags(e.currentRuntimeFlags,t.patch),lI(e.currentRuntimeFlags)&&e.isInterrupted())?hu(e.getInterruptedCause()):hg(r),[e9]:(e,t,r)=>(ev(()=>t.effect_instruction_i2(r)),ev(()=>t.effect_instruction_i0()))?(e.pushStack(t),ev(()=>t.effect_instruction_i1())):uG,[te]:(e,t,r)=>{let i=ev(()=>t.effect_instruction_i0.next(r));return i.done?hg(i.value):(e.pushStack(t),ex(i.value))}},yZ={[g5]:(e,t,r,i)=>(e.processNewInterruptSignal(i.cause),lI(t)?hu(i.cause):r),[g6]:(e,t,r,i)=>{throw Error("It is illegal to have multiple concurrent run loops in a single fiber")},[g4]:(e,t,r,i)=>(i.onFiber(e,f4(t)),r),[g8]:(e,t,r,i)=>ux(u1(),()=>r)},yX=e=>uO(mH(e),e=>vu(gt(e),([e,t])=>{let r=new Map,i=[];for(let e of t)for(let t of(i.push(id(e)),e))r.set(t.request,t);let n=i.flat();return cx(vJ(e.runAll(i),n,()=>n.forEach(e=>{e.listeners.interrupted=!0})),gr,r)},!1,!1));class y0 extends fx{static{n=bo,s=bc}constructor(e,t,r){if(super(),this[n]=bl,this[s]=yV,this._queue=[],this._children=null,this._observers=[],this._running=!1,this._stack=[],this._asyncInterruptor=null,this._asyncBlockingOn=null,this._exitValue=null,this._steps=[],this._isYielding=!1,this.currentOpCount=0,this.run=()=>{this.drainQueueOnCurrentThread()},this.currentRuntimeFlags=r,this._fiberId=e,this._fiberRefs=t,lA(r)){let e=this.getFiberRef(cM);y$.unsafeUpdate(1,e),yU.unsafeUpdate(1,e)}this.refreshRefCache()}commit(){return bp(this)}id(){return this._fiberId}resume(e){this.tell(be(e))}get status(){return this.ask((e,t)=>t)}get runtimeFlags(){return this.ask((e,t)=>f8(t)?e.currentRuntimeFlags:t.runtimeFlags)}scope(){return bs(this)}get children(){return this.ask(e=>Array.from(e.getChildren()))}getChildren(){return null===this._children&&(this._children=new Set),this._children}getInterruptedCause(){return this.getFiberRef(cP)}fiberRefs(){return this.ask(e=>e.getFiberRefs())}ask(e){return uq(()=>{let t=hS(this._fiberId);return this.tell(g9((r,i)=>{hT(t,uB(()=>e(r,i)))})),hC(t)})}tell(e){this._queue.push(e),this._running||(this._running=!0,this.drainQueueLaterOnExecutor())}get await(){return ut(e=>{let t=t=>e(uU(t));return this.tell(g9((e,r)=>{null!==e._exitValue?t(this._exitValue):e.addObserver(t)})),uB(()=>this.tell(g9((e,r)=>{e.removeObserver(t)})))},this.id())}get inheritAll(){return l5((e,t)=>{let r=e.id(),i=e.getFiberRefs(),n=t.runtimeFlags,s=fT(i,r,this.getFiberRefs());return e.setFiberRefs(s),uY(U(lM(n,e.getFiberRef(vP)),lw(1),lw(16)))})}get poll(){return uB(()=>tQ(this._exitValue))}unsafePoll(){return this._exitValue}interruptAsFork(e){return uB(()=>this.tell(g7(nX(e))))}unsafeInterruptAsFork(e){this.tell(g7(nX(e)))}addObserver(e){null!==this._exitValue?e(this._exitValue):this._observers.push(e)}removeObserver(e){this._observers=this._observers.filter(t=>t!==e)}getFiberRefs(){return this.setFiberRef(vP,this.currentRuntimeFlags),this._fiberRefs}unsafeDeleteFiberRef(e){this._fiberRefs=fj(this._fiberRefs,e)}getFiberRef(e){return this._fiberRefs.locals.has(e)?this._fiberRefs.locals.get(e)[0][1]:e.initial}setFiberRef(e,t){this._fiberRefs=fP(this._fiberRefs,{fiberId:this._fiberId,fiberRef:e,value:t}),this.refreshRefCache()}refreshRefCache(){this.currentDefaultServices=this.getFiberRef(fo),this.currentTracer=this.currentDefaultServices.unsafeMap.get(fe.key),this.currentSupervisor=this.getFiberRef(vD),this.currentScheduler=this.getFiberRef(mq),this.currentContext=this.getFiberRef(cC),this.currentSpan=this.currentContext.unsafeMap.get(ft.key)}setFiberRefs(e){this._fiberRefs=e,this.refreshRefCache()}addChild(e){this.getChildren().add(e)}removeChild(e){this.getChildren().delete(e)}transferChildren(e){let t=this._children;if(this._children=null,null!==t&&t.size>0)for(let r of t)null===r._exitValue&&e.add(this.currentRuntimeFlags,r)}drainQueueOnCurrentThread(){let e=!0;for(;e;){let t=yH,r=globalThis[bd];globalThis[bd]=this;try{for(;t===yH;)t=0===this._queue.length?"Done":this.evaluateMessageWhileSuspended(this._queue.splice(0,1)[0])}finally{this._running=!1,globalThis[bd]=r}this._queue.length>0&&!this._running?(this._running=!0,t===yK?(this.drainQueueLaterOnExecutor(),e=!1):e=!0):e=!1}}drainQueueLaterOnExecutor(){this.currentScheduler.scheduleTask(this.run,this.getFiberRef(cO))}drainQueueWhileRunning(e,t){let r=t;for(;this._queue.length>0;){let t=this._queue.splice(0,1)[0];r=yZ[t._tag](this,e,r,t)}return r}isInterrupted(){return!n5(this.getFiberRef(cP))}addInterruptedCause(e){let t=this.getFiberRef(cP);this.setFiberRef(cP,n1(t,e))}processNewInterruptSignal(e){this.addInterruptedCause(e),this.sendInterruptSignalToAllChildren()}sendInterruptSignalToAllChildren(){if(null===this._children||0===this._children.size)return!1;let e=!1;for(let t of this._children)t.tell(g7(nX(this.id()))),e=!0;return e}interruptAllChildren(){if(this.sendInterruptSignalToAllChildren()){let e=this._children.values();this._children=null;let t=!1;return uZ({while:()=>!t,body:()=>{let r=e.next();return r.done?uB(()=>{t=!0}):l8(r.value.await)},step:()=>{}})}return null}reportExitValue(e){if(lA(this.currentRuntimeFlags)){let t=this.getFiberRef(cM),r=this.id().startTimeMillis,i=Date.now();switch(yJ.unsafeUpdate(i-r,t),yU.unsafeUpdate(-1,t),e._tag){case e6:yq.unsafeUpdate(1,t);break;case e2:yB.unsafeUpdate(1,t)}}if("Failure"===e._tag){let t=this.getFiberRef(cj);n6(e.cause)||"Some"!==t._tag||this.log("Fiber terminated with an unhandled error",e.cause,t)}}setExitValue(e){this._exitValue=e,this.reportExitValue(e);for(let t=this._observers.length-1;t>=0;t--)this._observers[t](e);this._observers=[]}getLoggers(){return this.getFiberRef(y9)}log(e,t,r){let i=tS(r)?r.value:this.getFiberRef(cF);if(f7(this.getFiberRef(y1),i))return;let n=this.getFiberRef(cR),s=this.getFiberRef(cI),a=this.getLoggers(),o=this.getFiberRefs();if(nU(a)>0){let r=new Date(sK(this.getFiberRef(fo),hB).unsafeCurrentTimeMillis());eQ(o,()=>{for(let l of a)l.log({fiberId:this.id(),logLevel:i,message:e,cause:t,context:o,spans:n,annotations:s,date:r})})}}evaluateMessageWhileSuspended(e){switch(e._tag){case g8:return yK;case g5:return this.processNewInterruptSignal(e.cause),null!==this._asyncInterruptor&&(this._asyncInterruptor(hu(e.cause)),this._asyncInterruptor=null),yH;case g6:return this._asyncInterruptor=null,this._asyncBlockingOn=null,this.evaluateEffect(e.effect),yH;case g4:return e.onFiber(this,null!==this._exitValue?f3:f6(this.currentRuntimeFlags,this._asyncBlockingOn)),yH;default:return yW(e)}}evaluateEffect(e){this.currentSupervisor.onResume(this);try{let t=lI(this.currentRuntimeFlags)&&this.isInterrupted()?hu(this.getInterruptedCause()):e;for(;null!==t;){let e=t,r=this.runLoop(e);if(r===yG){let e=yY.currentOp;yY.currentOp=null,e._op===tr?lO(this.currentRuntimeFlags)?(this.tell(bt()),this.tell(be(hb)),t=null):t=hb:e._op===e0&&(t=null)}else{this.currentRuntimeFlags=U(this.currentRuntimeFlags,lE(16));let e=this.interruptAllChildren();null!==e?t=ux(e,()=>r):(0===this._queue.length?this.setExitValue(r):this.tell(be(r)),t=null)}}}finally{this.currentSupervisor.onSuspend(this)}}start(e){if(this._running)this.tell(be(e));else{this._running=!0;let t=globalThis[bd];globalThis[bd]=this;try{this.evaluateEffect(e)}finally{this._running=!1,globalThis[bd]=t,this._queue.length>0&&this.drainQueueLaterOnExecutor()}}}startFork(e){this.tell(be(e))}patchRuntimeFlags(e,t){let r=lz(e,t);return globalThis[bd]=this,this.currentRuntimeFlags=r,r}initiateAsync(e,t){let r=!1,i=e=>{r||(r=!0,this.tell(be(e)))};lI(e)&&(this._asyncInterruptor=i);try{t(i)}catch(e){i(ud(nZ(e)))}}pushStack(e){this._stack.push(e),"OnStep"===e._op&&this._steps.push({refs:this.getFiberRefs(),flags:this.currentRuntimeFlags})}popStack(){let e=this._stack.pop();if(e)return"OnStep"===e._op&&this._steps.pop(),e}getNextSuccessCont(){let e=this.popStack();for(;e;){if(e._op!==e3)return e;e=this.popStack()}}getNextFailCont(){let e=this.popStack();for(;e;){if(e._op!==e5&&e._op!==e9&&e._op!==te)return e;e=this.popStack()}}Tag(e){return uB(()=>sK(this.currentContext,e))}Left(e){return up(e.left)}None(e){return up(new c4)}Right(e){return hg(e.right)}Some(e){return hg(e.value)}Micro(e){return l9(t=>{let r=t,i=mw(me(e,this.currentContext));return i.addObserver(e=>{if("Success"===e._tag)return r(hg(e.value));switch(e.cause._tag){case"Interrupt":return r(hu(nX(aQ)));case"Fail":return r(up(e.cause.error));case"Die":return r(ul(e.cause.defect))}}),l9(e=>{r=t=>{e(uG)},i.unsafeInterrupt()})})}[e8](e){let t=ev(()=>e.effect_instruction_i0()),r=this.getNextSuccessCont();return void 0!==r?(r._op in yQ||yW(r),yQ[r._op](this,r,t)):(yY.currentOp=hg(t),yG)}[e6](e){let t=this.getNextSuccessCont();return void 0!==t?(t._op in yQ||yW(t),yQ[t._op](this,t,e.effect_instruction_i0)):(yY.currentOp=e,yG)}[e2](e){let t=e.effect_instruction_i0,r=this.getNextFailCont();if(void 0===r)return yY.currentOp=hu(t),yG;switch(r._op){case e3:case e4:if(!(lI(this.currentRuntimeFlags)&&this.isInterrupted()))return ev(()=>r.effect_instruction_i1(t));return hu(sn(t));case"OnStep":if(!(lI(this.currentRuntimeFlags)&&this.isInterrupted()))return hg(hu(t));return hu(sn(t));case ti:if(this.patchRuntimeFlags(this.currentRuntimeFlags,r.patch),lI(this.currentRuntimeFlags)&&this.isInterrupted())return hu(n1(t,this.getInterruptedCause()));return hu(t);default:yW(r)}}[tt](e){return ev(()=>e.effect_instruction_i0(this,f4(this.currentRuntimeFlags)))}Blocked(e){let t=this.getFiberRefs(),r=this.currentRuntimeFlags;if(this._steps.length>0){let i=[],n=this._steps[this._steps.length-1],s=this.popStack();for(;s&&"OnStep"!==s._op;)i.push(s),s=this.popStack();this.setFiberRefs(n.refs),this.currentRuntimeFlags=n.flags;let a=fH(n.refs,t),o=lM(n.flags,r);return hg(lY(e.effect_instruction_i0,l5(t=>{for(;i.length>0;)t.pushStack(i.pop());return t.setFiberRefs(fV(t.id(),t.getFiberRefs())(a)),t.currentRuntimeFlags=lz(o)(t.currentRuntimeFlags),e.effect_instruction_i1})))}return uW(t=>ux(vh(lQ(e.effect_instruction_i0)),()=>t(e.effect_instruction_i1)))}RunBlocked(e){return yX(e.effect_instruction_i0)}[e7](e){let t=e.effect_instruction_i0,r=this.currentRuntimeFlags,i=lz(r,t);if(lI(i)&&this.isInterrupted())return hu(this.getInterruptedCause());if(this.patchRuntimeFlags(this.currentRuntimeFlags,t),!e.effect_instruction_i1)return hb;{let t=lM(i,r);return this.pushStack(new lX(t,e)),ev(()=>e.effect_instruction_i1(r))}}[e5](e){return this.pushStack(e),e.effect_instruction_i0}OnStep(e){return this.pushStack(e),e.effect_instruction_i0}[e3](e){return this.pushStack(e),e.effect_instruction_i0}[e4](e){return this.pushStack(e),e.effect_instruction_i0}[e0](e){return this._asyncBlockingOn=e.effect_instruction_i1,this.initiateAsync(this.currentRuntimeFlags,e.effect_instruction_i0),yY.currentOp=e,yG}[tr](e){return this._isYielding=!1,yY.currentOp=e,yG}[e9](e){let t=e.effect_instruction_i0,r=e.effect_instruction_i1;return t()?(this.pushStack(e),r()):hb}[te](e){return yQ[te](this,e,void 0)}[e1](e){return ev(()=>e.commit())}runLoop(e){let t=e;for(this.currentOpCount=0;;){if((2&this.currentRuntimeFlags)!=0&&this.currentSupervisor.onEffect(this,t),this._queue.length>0&&(t=this.drainQueueWhileRunning(this.currentRuntimeFlags,t)),!this._isYielding){this.currentOpCount+=1;let e=this.currentScheduler.shouldYield(this);if(!1!==e){this._isYielding=!0,this.currentOpCount=0;let r=t;t=ux(u1({priority:e}),()=>r)}}try{if((t=this.currentTracer.context(()=>q()!==t[lZ]._V?uu(`Cannot execute an Effect versioned ${t[lZ]._V} with a Runtime of version ${q()}`):this[t._op](t),this))===yG){let e=yY.currentOp;if(e._op===tr||e._op===e0)return yG;return yY.currentOp=null,e._op===e6||e._op===e2?e:hu(nZ(e))}}catch(e){t=(t===yG||en(t,"_op"))&&t._op in this?lW(e)?hu(e.cause):c1(e)?hu(n1(nZ(e),nX(aQ))):ul(e):uu(`Not a valid effect: ${eK(t)}`)}}}}let y1=H("effect/FiberRef/currentMinimumLogLevel",()=>cv(f9("Info"))),y2=e=>bb(t=>{sK(fz(t.context,fo),p2).unsafe.log(e.log(t))}),y3=H(Symbol.for("effect/Logger/defaultLogger"),()=>y2(bO)),y5=H(Symbol.for("effect/Logger/jsonLogger"),()=>y2(bA)),y4=H(Symbol.for("effect/Logger/logFmtLogger"),()=>y2(bR)),y6=H(Symbol.for("effect/Logger/prettyLogger"),()=>bY),y8=H(Symbol.for("effect/Logger/structuredLogger"),()=>y2(bT)),y7=H(Symbol.for("effect/Logger/tracerLogger"),()=>bb(({annotations:e,cause:t,context:r,fiberId:i,logLevel:n,message:s})=>{let a=sV(fz(r,cC),ft);if("None"===a._tag||"ExternalSpan"===a.value._tag)return;let o=sK(fz(r,fo),hB),l={};for(let[t,r]of e)l[t]=r;l["effect.fiberId"]=aG(i),l["effect.logLevel"]=n.label,null!==t&&"Empty"!==t._tag&&(l["effect.cause"]=sv(t,{renderErrorCause:!0})),a.value.event(eK(Array.isArray(s)?s[0]:s),o.unsafeCurrentTimeNanos(),l)})),y9=H(Symbol.for("effect/FiberRef/currentLoggers"),()=>c_(n$(y3,y7))),ve=M(3,(e,t,r)=>ux(vI,i=>{let n=[],s=uq(()=>{if(0===n.length)return uG;let e=n;return n=[],r(e)});return uW(r=>U(gs(t),u5(s),gO,r,vh,ux(e=>cJ(i,u6(e))),u5(vr(()=>s)),l6(bb(t=>{n.push(e.log(t))}))))})),vt=M(e=>l3(e[0]),(e,t)=>uV(uJ(e,e=>vr(r=>t(e,r))))),vr=e=>l5(t=>{let r=t.getFiberRefs(),i=t.currentRuntimeFlags;return ux(vI,t=>cH(t,t=>l5(n=>{let s=n.getFiberRefs(),a=n.currentRuntimeFlags,o=fH(s,r),l=lM(a,i),u=fH(r,s);return n.setFiberRefs(fV(o,n.id(),r)),vB(u0(e(t),l),uB(()=>{n.setFiberRefs(fV(u,n.id(),n.getFiberRefs()))}))})))}),vi=(e=>eu(e[0])&&!l3(e[0]),e=>{if(Array.isArray(e)||eu(e))return[e,tK()];let t=Object.keys(e),r=t.length;return[t.map(t=>e[t]),tk(e=>{let i={};for(let n=0;n<r;n++)i[t[n]]=e[n];return i})]}),vn=(e,t,r)=>{let i=[];for(let t of e)i.push(uc(t));return ux(vo(i,z,{concurrency:r?.concurrency,batching:r?.batching}),e=>{let i=tK(),n=e.length,s=Array(n),a=Array(n),o=!1;for(let t=0;t<n;t++){let r=e[t];"Left"===r._tag?(s[t]=tk(r.left),o=!0):(a[t]=r.right,s[t]=i)}return o?"Some"===t._tag?up(t.value(s)):up(s):r?.discard?uG:"Some"===t._tag?uU(t.value(a)):uU(a)})},vs=(e,t,r)=>{let i=[];for(let t of e)i.push(uc(t));return r?.discard?vo(i,z,{concurrency:r?.concurrency,batching:r?.batching,discard:!0}):uN(vo(i,z,{concurrency:r?.concurrency,batching:r?.batching}),e=>"Some"===t._tag?t.value(e):e)},va=(e,t)=>{let[r,i]=vi(e);return t?.mode==="validate"?vn(r,i,t):t?.mode==="either"?vs(r,i,t):t?.discard!==!0&&"Some"===i._tag?uN(vo(r,z,t),i.value):vo(r,z,t)},vo=((e,t)=>Array.from({length:t},()=>e),M(e=>eu(e[0]),(e,t,r)=>l5(i=>{let n=r?.batching===!0||r?.batching==="inherit"&&i.getFiberRef(cA);return r?.discard?gi(r.concurrency,()=>vx(fS,r?.concurrentFinalizers)(r=>n?vu(e,(e,i)=>r(t(e,i)),!0,!1,1):uO(e,(e,i)=>r(t(e,i)))),()=>vx(fC,r?.concurrentFinalizers)(r=>vu(e,(e,i)=>r(t(e,i)),n,!1)),i=>vx(fO(i),r?.concurrentFinalizers)(r=>vu(e,(e,i)=>r(t(e,i)),n,!1,i))):gi(r?.concurrency,()=>vx(fS,r?.concurrentFinalizers)(r=>n?vc(e,1,(e,i)=>r(t(e,i)),!0):uC(e,(e,i)=>r(t(e,i)))),()=>vx(fC,r?.concurrentFinalizers)(r=>vl(e,(e,i)=>r(t(e,i)),n)),i=>vx(fO(i),r?.concurrentFinalizers)(r=>vc(e,i,(e,i)=>r(t(e,i)),n)))}))),vl=(e,t,r)=>uq(()=>{let i=rd(e),n=Array(i.length);return u5(vu(i,(e,r)=>ux(t(e,r),e=>uB(()=>n[r]=e)),r,!1),uU(n))}),vu=(e,t,r,i,n)=>uW(s=>uH(a=>l5(o=>{let l=Array.from(e).reverse(),u=l.length;if(0===u)return uG;let c=0,h=!1,p=n?Math.min(l.length,n):l.length,f=new Set,d=[],m=()=>f.forEach(e=>{e.currentScheduler.scheduleTask(()=>{e.unsafeInterruptAsFork(o.id())},0)}),g=[],b=[],x=[],y=()=>{let e=d.filter(({exit:e})=>"Failure"===e._tag).sort((e,t)=>e.index<t.index?-1:e.index===t.index?0:1).map(({exit:e})=>e);return 0===e.length&&e.push(hb),e},v=(e,t=!1)=>{let r=uV(a(e)),i=vf(r,o,o.currentRuntimeFlags,ba);return o.currentScheduler.scheduleTask(()=>{t&&i.unsafeInterruptAsFork(o.id()),i.resume(r)},0),i},_=()=>{i||(u-=l.length,l=[]),h=!0,m()},S=r?uv:uh,w=v(ut(e=>{let i=(e,t)=>{"Blocked"===e._op?x.push(e):(d.push({index:t,exit:e}),"Failure"!==e._op||h||_())},a=()=>{if(l.length>0){let p=l.pop(),m=c++,_=()=>{let e=l.pop();return m=c++,ux(u1(),()=>ux(S(s(t(e,m))),w))},w=e=>l.length>0&&(i(e,m),l.length>0)?_():uU(e),k=v(ux(S(s(t(p,m))),w));g.push(k),f.add(k),h&&k.currentScheduler.scheduleTask(()=>{k.unsafeInterruptAsFork(o.id())},0),k.addObserver(t=>{let s;s="Failure"===t._op?t:t.effect_instruction_i0,b.push(k),f.delete(k),i(s,m),d.length===u?e(uU(tW(ha(y(),{parallel:!0}),()=>hb))):x.length+d.length===u?e(uU(lY(x.map(e=>e.effect_instruction_i0).reduce(mB),vu([tW(ha(y(),{parallel:!0}),()=>hb),...x.map(e=>e.effect_instruction_i1)],e=>e,r,!0,n)))):a()})}};for(let e=0;e<p;e++)a()}));return l8(uM(u_(s(bp(w))),hd({onFailure:()=>{_();let e=x.length+1,t=Math.min("number"==typeof n?n:x.length,x.length),r=Array.from(x);return ut(i=>{let n=[],s=0,a=0,o=(t,a)=>o=>{n[t]=o,++s===e&&i(t0(ha(n,{parallel:!0}))),r.length>0&&a&&l()},l=()=>{v(r.pop(),!0).addObserver(o(a,!0)),a++};w.addObserver(o(a,!1)),a++;for(let e=0;e<t;e++)l()})},onSuccess:()=>uC(b,e=>e.inheritAll)})))}))),vc=(e,t,r,i)=>uq(()=>{let n=rd(e),s=Array(n.length);return u5(vu(n,(e,t)=>uN(r(e,t),e=>s[t]=e),i,!1,t),uU(s))}),vh=e=>vm(e,ba),vp=(e,t,r,i=null)=>{let n=vd(e,t,r,i);return n.resume(e),n},vf=(e,t,r,i=null)=>vd(e,t,r,i),vd=(e,t,r,i=null)=>{let n=a0(),s=fN(t.getFiberRefs(),n),a=new y0(n,s,r),o=fz(s,cC),l=a.currentSupervisor;return l.onStart(o,e,tk(t),a),a.addObserver(e=>l.onEnd(e,a)),(null!==i?i:U(t.getFiberRef(cz),tW(()=>t.scope()))).add(r,a),a},vm=(e,t)=>l5((r,i)=>uU(vp(e,r,i.runtimeFlags,t))),vg=(e=>Q(e[2]),e=>hM(t=>tV(sV(t,vE),{onNone:()=>e,onSome:t=>{switch(t.strategy._tag){case"Parallel":return e;case"Sequential":case"ParallelN":return ux(cV(t,fC),t=>vA(e,t))}}}))),vb=e=>t=>hM(r=>tV(sV(r,vE),{onNone:()=>t,onSome:r=>"ParallelN"===r.strategy._tag&&r.strategy.parallelism===e?t:ux(cV(r,fO(e)),e=>vA(t,e))})),vx=(e,t)=>r=>hM(i=>tV(sV(i,vE),{onNone:()=>r(z),onSome:i=>{if(!0!==t)return r(z);{let t="Parallel"===e._tag?vg:"Sequential"===e._tag?v_:vb(e.parallelism);switch(i.strategy._tag){case"Parallel":return t(r(vg));case"Sequential":return t(r(v_));case"ParallelN":return t(r(vb(i.strategy.parallelism)))}}}})),vy=e=>ux(vE,e),vv=e=>ux(vN(),t=>uM(e(t),e=>t.close(e))),v_=e=>hM(t=>tV(sV(t,vE),{onNone:()=>e,onSome:t=>{switch(t.strategy._tag){case"Sequential":return e;case"Parallel":case"ParallelN":return ux(cV(t,fS),t=>vA(e,t))}}})),vS=(e=>l3(e[1]),e=>vz(fo,sq(pC,e))),vw=M(e=>l3(e[1]),(e,t,r)=>vO(e,t,(e,t)=>[e,t],r)),vk=M(e=>l3(e[1]),(e,t,r)=>r?.concurrent!==!0&&(r?.batching===void 0||!1===r.batching)?u3(e,t):vO(e,t,(e,t)=>e,r)),vC=M(e=>l3(e[1]),(e,t,r)=>r?.concurrent!==!0&&(r?.batching===void 0||!1===r.batching)?u5(e,t):vO(e,t,(e,t)=>t,r)),vO=M(e=>l3(e[1]),(e,t,r,i)=>uN(va([e,t],{concurrency:i?.concurrent?2:1,batching:i?.batching,concurrentFinalizers:i?.concurrentFinalizers}),([e,t])=>r(e,t))),vE=sG("effect/Scope"),vI=vE,vF=(e,t)=>{"Open"===e.state._tag&&e.state.finalizers.add(t)},vR={[cq]:cq,[cB]:cB,pipe(){return eX(this,arguments)},fork(e){return uB(()=>{let t=vT(e);if("Closed"===this.state._tag)return t.state=this.state,t;let r=e=>t.close(e);return this.state.finalizers.add(r),vF(t,e=>uB(()=>{"Open"===this.state._tag&&this.state.finalizers.delete(r)})),t})},close(e){return uq(()=>{if("Closed"===this.state._tag)return uG;let t=Array.from(this.state.finalizers.values()).reverse();return(this.state={_tag:"Closed",exit:e},0===t.length)?uG:fw(this.strategy)?U(uC(t,t=>uh(t(e))),ux(e=>U(ha(e),t1(hs),tW(()=>hb)))):fk(this.strategy)?U(vl(t,t=>uh(t(e)),!1),ux(e=>U(ha(e,{parallel:!0}),t1(hs),tW(()=>hb)))):U(vc(t,this.strategy.parallelism,t=>uh(t(e)),!1),ux(e=>U(ha(e,{parallel:!0}),t1(hs),tW(()=>hb))))})},addFinalizer(e){return uq(()=>"Closed"===this.state._tag?e(this.state.exit):(this.state.finalizers.add(e),uG))}},vT=(e=fS)=>{let t=Object.create(vR);return t.strategy=e,t.state={_tag:"Open",finalizers:new Set},t},vN=(e=fS)=>uB(()=>vT(e)),vA=M(2,(e,t)=>hD(e,sW(sU(vE,t)))),vj=M(2,(e,t)=>U(e,vA(t),uM(e=>t.close(e)))),vM=M(2,(e,t)=>l8(vt(ux(cu(e),r=>l6(ch(e,t),r)),t=>ch(e,t)))),vz=M(2,(e,t)=>cc(e,r=>vM(e,t(r)))),vP=ck(lN,{differ:lP,fork:lP.empty}),vD=ck(yF,{differ:yL,fork:yj}),vL=M(3,(e,t,r)=>vU(e,t,{onSelfWin:(e,t)=>ux(e.await,i=>{switch(i._tag){case e6:return ux(e.inheritAll,()=>r.onSelfDone(i,t));case e2:return r.onSelfDone(i,t)}}),onOtherWin:(e,t)=>ux(e.await,i=>{switch(i._tag){case e6:return ux(e.inheritAll,()=>r.onOtherDone(i,t));case e2:return r.onOtherDone(i,t)}})})),v$=M(2,(e,t)=>ub(r=>vL(e,t,{onSelfDone:(e,t)=>hm(e,{onFailure:e=>U(bp(t),gM(t=>n0(e,t))),onSuccess:e=>U(t,u8(r),l6(e))}),onOtherDone:(e,t)=>hm(e,{onFailure:e=>U(bp(t),gM(t=>n0(t,e))),onSuccess:e=>U(t,u8(r),l6(e))})}))),vU=M(3,(e,t,r)=>l5((i,n)=>{let s=n.runtimeFlags,a=aF(!0),o=vd(e,i,s,r.selfScope),l=vd(t,i,s,r.otherScope);return ut(i=>{o.addObserver(()=>vq(o,l,r.onSelfWin,a,i)),l.addObserver(()=>vq(l,o,r.onOtherWin,a,i)),o.startFork(e),l.startFork(t)},aH(o.id(),l.id()))})),vq=(e,t,r,i,n)=>{aR(!0,!1)(i)&&n(r(e,t))},vB=M(2,(e,t)=>uW(r=>uw(r(e),{onFailure:e=>uw(t,{onFailure:t=>ud(n1(e,t)),onSuccess:()=>ud(e)}),onSuccess:e=>l6(t,e)}))),vJ=(e,t,r)=>ub(i=>ux(ux(vh(uR(e)),e=>ut(i=>{let n=t.map(e=>e.listeners.count),s=()=>{n.every(e=>0===e)&&t.every(e=>"Pending"===e.result.state.current._tag||!!("Done"===e.result.state.current._tag&&ht(e.result.state.current.effect)&&"Failure"===e.result.state.current.effect._tag&&n4(e.result.state.current.effect.cause)))&&(a.forEach(e=>e()),r?.(),i(u6(e)))};e.addObserver(e=>{a.forEach(e=>e()),i(e)});let a=t.map((e,t)=>{let r=e=>{n[t]=e,s()};return e.listeners.addObserver(r),()=>e.listeners.removeObserver(r)});return s(),uB(()=>{a.forEach(e=>e())})})),()=>uq(()=>uO(t.flatMap(e=>e.state.completed?[]:[e]),e=>yx(e.request,hp(i)))))),vH=e=>e._tag===nq,vK=e=>sb(e,{onEmpty:tk(nY),onFail:e=>U(e,t1(nQ)),onDie:e=>tk(nZ(e)),onInterrupt:e=>tk(nX(e)),onSequential:(e,t)=>tS(e)&&tS(t)?tk(n1(e.value,t.value)):t_(e)&&tS(t)?tk(t.value):tS(e)&&t_(t)?tk(e.value):tK(),onParallel:(e,t)=>tS(e)&&tS(t)?tk(n0(e.value,t.value)):t_(e)&&tS(t)?tk(t.value):tS(e)&&t_(t)?tk(e.value):tK()}),vV=e=>cW(z)(e),vW=e=>en(e,c5),vG=e=>en(e,cQ),vY=Symbol.for("effect/DateTime"),vQ=Symbol.for("effect/DateTime/TimeZone"),vZ={[vY]:vY,pipe(){return eX(this,arguments)},[eU](){return this.toString()},toJSON(){return _t(this).toJSON()}},vX={...vZ,_tag:"Utc",[ek](){return eM(this,eR(this.epochMillis))},[ez](e){return v4(e)&&"Utc"===e._tag&&this.epochMillis===e.epochMillis},toString(){return`DateTime.Utc(${_t(this).toJSON()})`}},v0={...vZ,_tag:"Zoned",[ek](){return U(eR(this.epochMillis),eE(eC(this.zone)),eM(this))},[ez](e){return v4(e)&&"Zoned"===e._tag&&this.epochMillis===e.epochMillis&&eP(this.zone,e.zone)},toString(){return`DateTime.Zoned(${_b(this)})`}},v1={[vQ]:vQ,[eU](){return this.toString()}},v2={...v1,_tag:"Named",[ek](){return eM(this,eT(`Named:${this.id}`))},[ez](e){return v6(e)&&"Named"===e._tag&&this.id===e.id},toString(){return`TimeZone.Named(${this.id})`},toJSON(){return{_id:"TimeZone",_tag:"Named",id:this.id}}},v3={...v1,_tag:"Offset",[ek](){return eM(this,eT(`Offset:${this.offset}`))},[ez](e){return v6(e)&&"Offset"===e._tag&&this.offset===e.offset},toString(){return`TimeZone.Offset(${_n(this.offset)})`},toJSON(){return{_id:"TimeZone",_tag:"Offset",offset:this.offset}}},v5=(e,t,r)=>{let i=Object.create(v0);return i.epochMillis=e,i.zone=t,i.partsUtc=r,i},v4=e=>en(e,vY),v6=e=>en(e,vQ),v8=e=>{let t=Object.create(vX);return t.epochMillis=e,t},v7=(e=>v4(e[0]),H("effect/DateTime/validZoneCache",()=>new Map)),v9={day:"numeric",month:"numeric",year:"numeric",hour:"numeric",minute:"numeric",second:"numeric",timeZoneName:"longOffset",fractionalSecondDigits:3,hourCycle:"h23"},_e=e=>{let t=e.resolvedOptions().timeZone;if(v7.has(t))return v7.get(t);let r=Object.create(v2);return r.id=t,r.format=e,v7.set(t,r),r},_t=(e=>{if(v7.has(e))return v7.get(e);try{return _e(new Intl.DateTimeFormat("en-US",{...v9,timeZone:e}))}catch(t){throw new c3(`Invalid time zone: ${e}`)}},e=>new Date(e.epochMillis)),_r=e=>{if("Utc"===e._tag)return new Date(e.epochMillis);if("Offset"===e.zone._tag)return new Date(e.epochMillis+e.zone.offset);if(void 0!==e.adjustedEpochMillis)return new Date(e.adjustedEpochMillis);let t=e.zone.format.formatToParts(e.epochMillis).filter(e=>"literal"!==e.type),r=new Date(0);return r.setUTCFullYear(Number(t[2].value),Number(t[0].value)-1,Number(t[1].value)),r.setUTCHours(Number(t[3].value),Number(t[4].value),Number(t[5].value),Number(t[6].value)),e.adjustedEpochMillis=r.getTime(),r},_i=e=>_r(e).getTime()-_a(e),_n=e=>{let t=Math.abs(e),r=Math.floor(t/36e5),i=Math.round(t%36e5/6e4);return`${e<0?"-":"+"}${String(r).padStart(2,"0")}:${String(i).padStart(2,"0")}`},_s=e=>_n(_i(e)),_a=e=>e.epochMillis,_o=e=>({millis:e.getUTCMilliseconds(),seconds:e.getUTCSeconds(),minutes:e.getUTCMinutes(),hours:e.getUTCHours(),day:e.getUTCDate(),weekDay:e.getUTCDay(),month:e.getUTCMonth()+1,year:e.getUTCFullYear()}),_l=(e,t)=>{let r="Offset"===t._tag?t.offset:_h(e,t);return v5(e-r,t)},_u=/([+-])(\d{2}):(\d{2})$/,_c=e=>{let t=_u.exec(e);if(null===t)return null;let[,r,i,n]=t;return("+"===r?1:-1)*(60*Number(i)+Number(n))*6e4},_h=(e,t)=>{let r=t.format.formatToParts(e).find(e=>"timeZoneName"===e.type)?.value??"";if("GMT"===r)return 0;let i=_c(r);return null===i?_i(v5(e,t)):i},_p=M(2,(e,t)=>{if("Utc"===e._tag){let r=_t(e);return t(r),v8(r.getTime())}let r=new Date(_r(e).getTime());return t(r),_l(r.getTime(),e.zone)}),_f=((e,t)=>_f(e,e=>{let r=new Date(e);return t(r),r.getTime()}),M(2,(e,t)=>{let r=t(_a(e));return"Utc"===e._tag?v8(r):v5(r,e.zone)})),_d=((e,t)=>t(_r(e)),M(2,(e,t)=>t(_t(e)))),_m=(e,t)=>{e.setTime(e.getTime()+t)},_g=((e,t)=>_p(e,e=>{if(t.millis&&_m(e,t.millis),t.seconds&&_m(e,1e3*t.seconds),t.minutes&&_m(e,6e4*t.minutes),t.hours&&_m(e,36e5*t.hours),t.days&&e.setUTCDate(e.getUTCDate()+t.days),t.weeks&&e.setUTCDate(e.getUTCDate()+7*t.weeks),t.months){let r=e.getUTCDate();e.setUTCMonth(e.getUTCMonth()+t.months+1,0),r<e.getUTCDate()&&e.setUTCDate(r)}if(t.years){let r=e.getUTCDate(),i=e.getUTCMonth();e.setUTCFullYear(e.getUTCFullYear()+t.years,i+1,0),r<e.getUTCDate()&&e.setUTCDate(r)}}),e=>{let t=_r(e);return"Utc"===e._tag?t.toISOString():`${t.toISOString().slice(0,-1)}${_s(e)}`}),_b=e=>"Offset"===e.zone._tag?_g(e):`${_g(e)}[${e.zone.id}]`;class _x{constructor(e,t=!1){this.s=e,this.stripped=t,this.index=0,this.length=e.length}next(){if(this.done)return{done:!0,value:void 0};let e=this.index;for(;!this.done&&!_y(this.s[this.index]);)this.index=this.index+1;let t=this.index;if(!this.done){let e=this.s[this.index];this.index=this.index+1,!this.done&&_v(e,this.s[this.index])&&(this.index=this.index+1),this.stripped||(t=this.index)}return{done:!1,value:this.s.substring(e,t)}}[Symbol.iterator](){return new _x(this.s,this.stripped)}get done(){return this.index>=this.length}}let _y=e=>{let t=e.charCodeAt(0);return 13===t||10===t},_v=(e,t)=>13===e.charCodeAt(0)&&10===t.charCodeAt(0),__=((e,t)=>_S(e.seconds,t.seconds)&&_S(e.minutes,t.minutes)&&_S(e.hours,t.hours)&&_S(e.days,t.days)&&_S(e.months,t.months)&&_S(e.weekdays,t.weekdays),tJ((e,t)=>e===t)),_S=(e,t)=>__(rd(e),rd(t)),_w=Symbol.for("effect/ScheduleInterval"),_k={[_w]:_w,startMillis:0,endMillis:0},_C=(e,t)=>e>t?_k:{[_w]:_w,startMillis:e,endMillis:t},_O=M(2,(e,t)=>_E(e,t)===e),_E=M(2,(e,t)=>e.endMillis<=t.startMillis?e:t.endMillis<=e.startMillis?t:e.startMillis<t.startMillis?e:t.startMillis<e.startMillis?t:e.endMillis<=t.endMillis?e:t),_I=M(2,(e,t)=>_C(Math.max(e.startMillis,t.startMillis),Math.min(e.endMillis,t.endMillis))),_F=e=>e.startMillis>=e.endMillis,_R=e=>al(e.endMillis-e.startMillis),_T=e=>_C(e,Number.POSITIVE_INFINITY),_N=Symbol.for("effect/ScheduleIntervals"),_A=e=>({[_N]:_N,intervals:e}),_j=M(2,(e,t)=>iN(t.intervals)?iN(e.intervals)?ij(e.intervals).startMillis<ij(t.intervals).startMillis?_M(iL(e.intervals),t.intervals,ij(e.intervals),il()):_M(e.intervals,iL(t.intervals),ij(t.intervals),il()):t:e),_M=(e,t,r,i)=>{let n=e,s=t,a=r,o=i;for(;iN(n)||iN(s);)if(!iN(n)&&iN(s))a.endMillis<ij(s).startMillis?(o=U(o,i_(a)),a=ij(s)):a=_C(a.startMillis,ij(s).endMillis),s=iL(s),n=il();else if(iN(n)&&iT(s))a.endMillis<ij(n).startMillis?(o=U(o,i_(a)),a=ij(n)):a=_C(a.startMillis,ij(n).endMillis),s=il(),n=iL(n);else if(iN(n)&&iN(s))ij(n).startMillis<ij(s).startMillis?(a.endMillis<ij(n).startMillis?(o=U(o,i_(a)),a=ij(n)):a=_C(a.startMillis,ij(n).endMillis),n=iL(n)):(a.endMillis<ij(s).startMillis?(o=U(o,i_(a)),a=ij(s)):a=_C(a.startMillis,ij(s).endMillis),s=iL(s));else throw Error(ep("Intervals.unionLoop"));return _A(U(o,i_(a),im))},_z=M(2,(e,t)=>_P(e.intervals,t.intervals,il())),_P=(e,t,r)=>{let i=e,n=t,s=r;for(;iN(i)&&iN(n);){let e=U(ij(i),_I(ij(n))),t=_F(e)?s:U(s,i_(e));U(ij(i),_O(ij(n)))?i=iL(i):n=iL(n),s=t}return _A(im(s))},_D=e=>U(e.intervals,iA,tW(()=>_k)).startMillis,_L=M(2,(e,t)=>_D(e)<_D(t)),_$=((e,t)=>_L(e,t)?t:e,e=>U(e.intervals,iA,tW(()=>_k)).endMillis),_U=e=>iN(e.intervals),_q="Continue",_B="Done",_J=e=>({_tag:_q,intervals:e}),_H=e=>({_tag:_q,intervals:_A(ic(e))}),_K={_tag:_B},_V=e=>e._tag===_q,_W=e=>e._tag===_B,_G=Symbol.for("effect/Schedule"),_Y=e=>en(e,_G),_Q=Symbol.for("effect/ScheduleDriver"),_Z={_Out:e=>e,_In:e=>e,_R:e=>e},_X={_Out:e=>e,_In:e=>e,_R:e=>e};class _0{constructor(e,t){this[_G]=_Z,this.initial=e,this.step=t}pipe(){return eX(this,arguments)}}class _1{constructor(e,t){this[_Q]=_X,this.schedule=e,this.ref=t}get state(){return uN(mA(this.ref),e=>e[1])}get last(){return ux(mA(this.ref),([e,t])=>{switch(e._tag){case"None":return uf(()=>new c4);case"Some":return uU(e.value)}})}get reset(){return mj(this.ref,[tK(),this.schedule.initial])}next(e){return U(uN(mA(this.ref),e=>e[1]),ux(t=>U(fc,ux(r=>U(uq(()=>this.schedule.step(r,e,t)),ux(([e,t,i])=>{let n=mj(this.ref,[tk(t),e]);if(_W(i))return u5(n,up(tK()));let s=_D(i.intervals)-r;return s<=0?l6(n,t):U(n,u5(gs(al(s))),l6(t))}))))))}}let _2=(e,t)=>new _0(e,t),_3=((e,t)=>_3(e,e=>uB(()=>t(e))),M(2,(e,t)=>Si(e,(e,r)=>uN(t(e),e=>a_(r,s7(e)))))),_5=((e,t)=>_2([e.initial,t.initial,!0],(r,i,n)=>n[2]?ux(e.step(r,i,n[0]),([e,s,a])=>_W(a)?uN(t.step(r,i,n[1]),([t,r,i])=>[[e,t,!1],tA(r),i]):uU([[e,n[1],!0],tN(s),a])):uN(t.step(r,i,n[1]),([e,t,r])=>[[n[0],e,!1],tA(t),r])),M(2,(e,t)=>_4(e,(e,r)=>uB(()=>t(e,r))))),_4=M(2,(e,t)=>_2(e.initial,(r,i,n)=>ux(e.step(r,i,n),([e,r,n])=>_W(n)?uU([e,r,_K]):uN(t(i,r),t=>t?[e,r,n]:[e,r,_K])))),_6=((e,t)=>_6(e,e=>uB(()=>t(e))),M(2,(e,t)=>_2(e.initial,(r,i,n)=>ux(t(i),t=>e.step(r,t,n))))),_8=((e,t)=>Si(e,(e,r)=>t(r)),e=>U(mN([tK(),e.initial]),uN(t=>new _1(e,t)))),_7=M(2,(e,t)=>_9(e,t,_z)),_9=M(3,(e,t,r)=>_2([e.initial,t.initial],(i,n,s)=>U(u4(e.step(i,n,s[0]),t.step(i,n,s[1]),(e,t)=>[e,t]),ux(([[i,s,a],[o,l,u]])=>_V(a)&&_V(u)?Se(e,t,n,i,s,a.intervals,o,l,u.intervals,r):uU([[i,o],[s,l],_K]))))),Se=(e,t,r,i,n,s,a,o,l,u)=>{let c=u(s,l);return _U(c)?uU([[i,a],[n,o],_J(c)]):U(s,_L(l))?ux(e.step(_$(s),r,i),([i,n,s])=>_W(s)?uU([[i,a],[n,o],_K]):Se(e,t,r,i,n,s.intervals,a,o,l,u)):ux(t.step(_$(l),r,a),([a,o,l])=>_W(l)?uU([[i,a],[n,o],_K]):Se(e,t,r,i,n,s,a,o,l.intervals,u))},St=M(2,(e,t)=>Sr(e,e=>uB(()=>t(e)))),Sr=M(2,(e,t)=>_2(e.initial,(r,i,n)=>ux(e.step(r,i,n),([e,r,i])=>uN(t(r),t=>[e,t,i])))),Si=M(2,(e,t)=>_2(e.initial,(r,i,n)=>ux(e.step(r,i,n),([e,i,n])=>{if(_W(n))return uU([e,i,n]);let s=n.intervals;return uN(t(i,_R(_C(r,_D(s)))),t=>{let n=s7(t),a=_D(s),o=r+ad(n),l=o-a;return[e,i,_H(_C(o,Math.max(0,_$(s)+l)))]})}))),Sn=e=>_2(e.initial,(t,r,i)=>U(e.step(t,r,i),uN(([e,t,i])=>[e,r,i]))),Ss=e=>Su(Sk,t=>t<e),Sa=((e,t,r)=>_2([e.initial,t],(t,i,[n,s])=>ux(e.step(t,i,n),([e,t,i])=>_W(i)?uU([[e,s],s,i]):uN(r(s,t),t=>[[e,t],s,i]))),M(3,(e,t,r)=>_2([e.initial,t.initial],(i,n,s)=>u4(e.step(i,n,s[0]),t.step(i,n,s[1]),([e,t,i],[n,s,a])=>{if(_W(i)&&_W(a))return[[e,n],[t,s],_K];if(_W(i)&&_V(a))return[[e,n],[t,s],_J(a.intervals)];if(_V(i)&&_W(a))return[[e,n],[t,s],_J(i.intervals)];if(_V(i)&&_V(a))return[[e,n],[t,s],_J(r(i.intervals,a.intervals))];throw Error("BUG: Schedule.unionWith - please report an issue at https://github.com/Effect-TS/effect/issues")})))),So=M(2,(e,t)=>_4(e,(e,r)=>gz(t(e)))),Sl=M(2,(e,t)=>_4(e,(e,r)=>t(e))),Su=M(2,(e,t)=>_5(e,(e,r)=>t(r))),Sc=((e,t)=>St(_7(e,t),e=>e[0]),Symbol.for("effect/Schedule/ScheduleDefect"));class Sh{constructor(e){this.error=e,this[Sc]=Sc}}let Sp=e=>en(e,Sc),Sf=e=>ui(e,e=>ul(new Sh(e))),Sd=e=>ur(e,e=>tV(sp(e,e=>n3(e)&&Sp(e.defect)?tk(e.defect):tK()),{onNone:()=>ud(e),onSome:e=>up(e.error)})),Sm=M(2,(e,t)=>Sb(e,t,(e,t)=>up(e))),Sg=M(2,(e,t)=>{if(_Y(t))return Sm(e,t);let r=t.schedule??Sn(Sk),i=t.while?Sl(r,e=>{let r=t.while(e);return"boolean"==typeof r?uU(r):Sf(r)}):r,n=t.until?So(i,e=>{let r=t.until(e);return"boolean"==typeof r?uU(r):Sf(r)}):i;return Sd(Sm(e,t.times?_7(n,Ss(t.times)).pipe(St(e=>e[0])):n))}),Sb=M(3,(e,t,r)=>ux(_8(t),t=>uk(e,{onFailure:e=>r(e,tK()),onSuccess:i=>Sx(e,t,r,i)}))),Sx=(e,t,r,i)=>uk(t.next(i),{onFailure:()=>uD(t.last),onSuccess:i=>uk(e,{onFailure:e=>r(e,tk(i)),onSuccess:i=>Sx(e,t,r,i)})}),Sy=M(2,(e,t)=>Sv(e,t,(e,t)=>up(e))),Sv=((e,t)=>{if(_Y(t))return Sy(e,t);let r=t.schedule??Sk,i=t.while?Sl(r,e=>{let r=t.while(e);return"boolean"==typeof r?uU(r):Sf(r)}):r,n=t.until?So(i,e=>{let r=t.until(e);return"boolean"==typeof r?uU(r):Sf(r)}):i;return Sd(Sy(e,t.times?_7(n,Ss(t.times)):n))},M(3,(e,t,r)=>ux(_8(t),t=>S_(e,t,r)))),S_=(e,t,r)=>ui(e,i=>uk(t.next(i),{onFailure:()=>U(t.last,uD,ux(e=>r(i,e))),onSuccess:()=>S_(e,t,r)})),SS=((e,t)=>SS(e,void 0,t),M(3,(e,t,r)=>ux(_8(r),r=>Sw(e,t,r)))),Sw=(e,t,r)=>uk(r.next(t),{onFailure:()=>uD(r.last),onSuccess:()=>ux(e,t=>Sw(e,t,r))}),Sk=(x=e=>e+1,_2(0,(e,t,r)=>uB(()=>[x(r),r,_H(_T(e))])));class SC{constructor(e){this.waiters=new Set,this.taken=0,this.take=e=>ue(t=>{if(this.free<e){let r=()=>{this.free<e||(this.waiters.delete(r),this.taken+=e,t(uU(e)))};return this.waiters.add(r),uB(()=>{this.waiters.delete(r)})}return this.taken+=e,t(uU(e))}),this.updateTaken=e=>l5(t=>(this.taken=e(this.taken),this.waiters.size>0&&t.getFiberRef(mq).scheduleTask(()=>{let e=this.waiters.values(),t=e.next();for(;!1===t.done&&this.free>0;)t.value(),t=e.next()},t.getFiberRef(cO)),uU(this.free))),this.release=e=>this.updateTaken(t=>t-e),this.releaseAll=this.updateTaken(e=>0),this.withPermits=e=>t=>uW(r=>ux(r(this.take(e)),e=>vB(r(t),this.release(e)))),this.withPermitsIfAvailable=e=>t=>uW(r=>uq(()=>this.free<e?gq:(this.taken+=e,vB(r(gm(t)),this.release(e))))),this.permits=e}get free(){return this.permits-this.taken}}let SO=e=>new SC(e),SE=((e,t)=>{let r=s7(t);return ux(hj(),t=>uN(SL(tK()),i=>[hz(SI(e,r,i),t),SF(i)]))},(e,t,r)=>{let i=ad(s7(t));return U(hw(),uJ(t=>uT(e,t)),uN(e=>tk([r+i,e])))}),SI=(e,t,r)=>uW(i=>U(fu(e=>e.currentTimeMillis),ux(i=>SU(r,r=>{switch(r._tag){case"None":return tk(SE(e,t,i));case"Some":{let[n]=r.value;return n-i<=0?tk(SE(e,t,i)):tK()}}})),ux(e=>t_(e)?uu("BUG: Effect.cachedInvalidate - please report an issue at https://github.com/Effect-TS/effect/issues"):i(hC(e.value[1]))))),SF=e=>mj(e,tK()),SR=((e,t)=>ux(yE,r=>U(SA(e,r),vB(ux(r.value,t)))),M(2,(e,t)=>uW(r=>ux(t.fork(fS),t=>U(r(e),uM(e=>t.close(e)),vh,uJ(e=>t.addFinalizer(()=>ub(t=>eP(t,e.id())?uG:l8(u6(e)))))))))),ST=e=>vy(t=>SR(e,t)),SN=M(2,(e,t)=>U(uh(e),v$(uh(t)),e=>u_(e))),SA=M(2,(e,t)=>cy(vD,e=>e.zip(t))(e)),Sj=((e,{duration:t,onTimeout:r})=>u_(SM(e,{onTimeout:()=>uf(r),onSuccess:uU,duration:t})),M(2,(e,{duration:t,onTimeout:r})=>u_(SM(e,{onTimeout:()=>um(r),onSuccess:uU,duration:t})))),SM=M(2,(e,{duration:t,onSuccess:r,onTimeout:i})=>ub(n=>vU(e,uR(gs(t)),{onSelfWin:(e,t)=>ux(e.await,i=>"Success"===i._tag?ux(e.inheritAll,()=>l6(u8(t,n),r(i.value))):ux(u8(t,n),()=>hu(i.cause))),onOtherWin:(e,t)=>ux(e.await,r=>"Success"===r._tag?ux(e.inheritAll,()=>l6(u8(t,n),i())):ux(u8(t,n),()=>hu(r.cause))),otherScope:ba}))),Sz=Symbol.for("effect/Ref/SynchronizedRef"),SP={_A:e=>e};class SD extends fx{static{a=mI,o=mE}constructor(e,t){super(),this[Sz]=SP,this[a]=mF,this[o]=mE,this.ref=e,this.withLock=t,this.get=mA(this.ref)}commit(){return this.get}modify(e){return this.modifyEffect(t=>uU(e(t)))}modifyEffect(e){return this.withLock(U(ux(mA(this.ref),e),ux(([e,t])=>l6(mj(this.ref,t),e))))}}let SL=e=>uB(()=>S$(e)),S$=e=>new SD(mT(e),SO(1).withPermits(1)),SU=M(2,(e,t)=>e.modifyEffect(e=>{let r=t(e);switch(r._tag){case"None":return uU([e,e]);case"Some":return uN(r.value,e=>[e,e])}})),Sq=((e,t,r)=>({...th,commit(){return bp(this)},[bo]:bl,id:()=>U(e.id(),aK(t.id())),await:U(e.await,u_,vO(u_(t.await),r,{concurrent:!0}),uh),children:e.children,inheritAll:u5(t.inheritAll,e.inheritAll),poll:u4(e.poll,t.poll,(e,t)=>U(e,t2(e=>U(t,t1(t=>hv(e,t,{onSuccess:r,onFailure:n0})))))),interruptAsFork:r=>u5(e.interruptAsFork(r),t.interruptAsFork(r)),pipe(){return eX(this,arguments)}}),Symbol.for("effect/ManagedRuntime")),SB="Fresh",SJ="ProvideMerge",SH=e=>e.inheritAll,SK=e=>e.poll,SV=e=>(t,r)=>{let i=a0(),n=[[cC,[[i,e.context]]]];r?.scheduler&&n.push([mq,[[i,r.scheduler]]]);let s=fL(e.fiberRefs,{entries:n,forkAs:i});r?.updateRefs&&(s=r.updateRefs(s,i));let a=new y0(i,s,e.runtimeFlags),o=t;r?.scope&&(o=ux(cV(r.scope,fS),e=>u5(cJ(e,ub(e=>eP(e,a.id())?uG:u8(a,e))),uM(t,t=>cK(e,t)))));let l=a.currentSupervisor;return l!==yF&&(l.onStart(e.context,o,tK(),a),a.addObserver(e=>l.onEnd(e,a))),ba.add(e.runtimeFlags,a),r?.immediate===!1?a.resume(o):a.start(o),a},SW=e=>(t,r={})=>{let i=SV(e)(t,r);return r.onExit&&i.addObserver(e=>{r.onExit(e)}),(t,r)=>SW(e)(U(i,u8(t??aQ)),{...r,onExit:r?.onExit?e=>r.onExit(g3(e)):void 0})},SG=e=>t=>{let r=S3(e)(t);if("Failure"!==r._tag)return r.effect_instruction_i0;throw S1(r.effect_instruction_i0)};class SY extends Error{constructor(e){super(`Fiber #${e.id().id} cannot be resolved synchronously. This is caused by using runSync on an effect that performs async work`),this._tag="AsyncFiberException",this.fiber=e,this.name=this._tag,this.stack=this.message}}let SQ=e=>{let t=Error.stackTraceLimit;Error.stackTraceLimit=0;let r=new SY(e);return Error.stackTraceLimit=t,r},SZ=Symbol.for("effect/Runtime/FiberFailure"),SX=Symbol.for("effect/Runtime/FiberFailure/Cause");class S0 extends Error{constructor(e){super(),this[SZ]=SZ,this[SX]=e;let t=sI(e);if(t.length>0){let e=t[0];this.name=e.name,this.message=e.message,this.stack=e.stack}this.name=`(FiberFailure) ${this.name}`,(void 0===this.message||0===this.message.length)&&(this.message="An error has occurred")}toJSON(){return{_id:"FiberFailure",cause:this[SX].toJSON()}}toString(){return"(FiberFailure) "+(this.stack??this.message)}[eU](){return this.toString()}}let S1=e=>{let t=Error.stackTraceLimit;Error.stackTraceLimit=0;let r=new S0(e);return Error.stackTraceLimit=t,r},S2=e=>{switch(e._op){case"Failure":case"Success":return e;case"Left":return hl(e.left);case"Right":return hg(e.right);case"Some":return hg(e.value);case"None":return hl(c4())}},S3=e=>t=>{let r=S2(t);if(r)return r;let i=new mU,n=SV(e)(t,{scheduler:i});return i.flush(),n.unsafePoll()||ho(uo(SQ(n),hL(n)))},S5=e=>(t,r)=>S4(e)(t,r).then(e=>{switch(e._tag){case e6:return e.effect_instruction_i0;case e2:throw S1(e.effect_instruction_i0)}}),S4=e=>(t,r)=>new Promise(i=>{let n=S2(t);n&&i(n);let s=SV(e)(t);s.addObserver(e=>{i(e)}),r?.signal!==void 0&&(r.signal.aborted?s.unsafeInterruptAsFork(s.id()):r.signal.addEventListener("abort",()=>{s.unsafeInterruptAsFork(s.id())},{once:!0}))});class S6{constructor(e,t,r){this.context=e,this.runtimeFlags=t,this.fiberRefs=r}pipe(){return eX(this,arguments)}}let S8=e=>new S6(e.context,e.runtimeFlags,e.fiberRefs),S7=()=>l5((e,t)=>uU(new S6(e.getFiberRef(cC),t.runtimeFlags,e.getFiberRefs()))),S9=lT(1,32,4),we=S8({context:sQ(),runtimeFlags:S9,fiberRefs:fE()}),wt=((e,t)=>S8({context:e.context,runtimeFlags:t(e.runtimeFlags),fiberRefs:e.fiberRefs}),SV(we)),wr=S5(we),wi=S4(we),wn=SG(we),ws=S3(we),wa=M(2,(e,t)=>e.modifyEffect(t)),wo=Symbol.for("effect/Layer"),wl={[wo]:{_RIn:e=>e,_E:e=>e,_ROut:e=>e},pipe(){return eX(this,arguments)}},wu=Symbol.for("effect/Layer/MemoMap"),wc=e=>en(e,wo),wh=e=>e._op_layer===SB;class wp{constructor(e){this.ref=e,this[wu]=wu}getOrElseMemoize(e,t){return U(wa(this.ref,r=>{let i=r.get(e);if(void 0!==i){let[e,n]=i;return uU([U(e,ux(([e,t])=>U(gD(e),l6(t))),uM(hd({onFailure:()=>uG,onSuccess:()=>cH(t,n)}))),r])}return U(mN(0),ux(i=>U(hw(),ux(n=>U(mN(()=>uG),uN(s=>{let a=uW(a=>U(vN(),ux(o=>U(a(ux(wb(e,o,!0),e=>gv(e(this)))),uh,ux(a=>{switch(a._tag){case e2:return U(hI(n,a.effect_instruction_i0),u5(cK(o,a)),u5(ud(a.effect_instruction_i0)));case e6:return U(mj(s,e=>U(cK(o,e),uQ(mz(i,e=>[1===e,e-1])),l8)),u5(mP(i,e=>e+1)),u5(cH(t,t=>U(uB(()=>r.delete(e)),u5(mA(s)),ux(e=>e(t))))),u5(hR(n,a.effect_instruction_i0)),l6(a.effect_instruction_i0[1]))}}))))),o=[U(hC(n),uM(hm({onFailure:()=>uG,onSuccess:()=>mP(i,e=>e+1)}))),e=>U(mA(s),ux(t=>t(e)))];return[a,wh(e)?r:r.set(e,o)]}))))))}),u_)}}let wf=uq(()=>uN(SL(new Map),e=>new wp(e))),wd=()=>new wp(S$(new Map)),wm=M(2,(e,t)=>ux(wf,r=>ux(wb(e,t),e=>e(r)))),wg=M(3,(e,t,r)=>ux(wb(e,r),e=>e(t))),wb=(e,t,r=!1)=>{switch(e._op_layer){case"Locally":return uB(()=>r=>e.f(r.getOrElseMemoize(e.self,t)));case"ExtendScope":return uB(()=>t=>vy(r=>t.getOrElseMemoize(e.layer,r)));case"Fold":return uB(()=>r=>U(r.getOrElseMemoize(e.layer,t),uw({onFailure:i=>r.getOrElseMemoize(e.failureK(i),t),onSuccess:i=>r.getOrElseMemoize(e.successK(i),t)})));case"Fresh":return uB(()=>r=>U(e.layer,wm(t)));case"FromEffect":return r?uB(()=>t=>e.effect):uB(()=>r=>r.getOrElseMemoize(e,t));case"Provide":return uB(()=>r=>U(r.getOrElseMemoize(e.first,t),ux(i=>U(r.getOrElseMemoize(e.second,t),hz(i)))));case"Scoped":return r?uB(()=>r=>vA(e.effect,t)):uB(()=>r=>r.getOrElseMemoize(e,t));case"Suspend":return uB(()=>r=>r.getOrElseMemoize(e.evaluate(),t));case"ProvideMerge":return uB(()=>r=>U(r.getOrElseMemoize(e.first,t),u4(r.getOrElseMemoize(e.second,t),e.zipK)));case"ZipWith":return uB(()=>r=>U(r.getOrElseMemoize(e.first,t),vO(r.getOrElseMemoize(e.second,t),e.zipK,{concurrent:!0})))}},wx=((e,t)=>wC(e,{onFailure:t,onSuccess:wN}),()=>ww(hj())),wy=e=>wv(nQ(e)),wv=e=>ww(ud(e)),w_=M(2,(e,t)=>wC(e,{onFailure:wy,onSuccess:t})),wS=M(2,(e,t)=>{let r=sY(e),i=r?e:t;return ww(uN(r?t:e,e=>sU(i,e)))});function ww(e){let t=Object.create(wl);return t._op_layer="FromEffect",t.effect=e,t}(e,t)=>{let r=Object.create(wl);return r._op_layer="Locally",r.self=e,r.f=t,r};let wk=M(2,(e,{onFailure:t,onSuccess:r})=>{let i=Object.create(wl);return i._op_layer="Fold",i.layer=e,i.failureK=t,i.successK=r,i}),wC=M(2,(e,{onFailure:t,onSuccess:r})=>wk(e,{onFailure:e=>{let r=st(e);switch(r._tag){case"Left":return t(r.left);case"Right":return wv(r.right)}},onSuccess:r})),wO=M(2,(e,t)=>wP(e,t,(e,t)=>sW(e,t))),wE=(...e)=>{let t=e[0];for(let r=1;r<e.length;r++)t=wO(t,e[r]);return t},wI=M(2,(e,t)=>{let r=sY(e),i=r?e:t;return wR(uN(r?t:e,e=>sU(i,e)))}),wF=e=>wR(U(e,l6(sQ()))),wR=e=>{let t=Object.create(wl);return t._op_layer="Scoped",t.effect=e,t},wT=M(2,(e,t)=>{let r=sY(e);return ww(uU(sU(r?e:t,r?t:e)))}),wN=e=>ww(uU(e)),wA=e=>{let t=Object.create(wl);return t._op_layer="Suspend",t.evaluate=e,t},wj=M(2,(e,t)=>ux(vy(r=>wg(e,t,r)),e=>U(S7(),hz(e)))),wM=M(2,(e,t)=>wA(()=>{let r=Object.create(wl);return r._op_layer="Provide",r.first=Object.create(wl,{_op_layer:{value:SJ,enumerable:!0},first:{value:wx(),enumerable:!0},second:{value:Array.isArray(t)?wE(...t):t},zipK:{value:(e,t)=>U(e,sW(t))}}),r.second=e,r})),wz=M(2,(e,t)=>{let r=Object.create(wl);return r._op_layer=SJ,r.first=t,r.second=wM(e,t),r.zipK=(e,t)=>U(e,sW(t)),r}),wP=M(3,(e,t,r)=>wA(()=>{let i=Object.create(wl);return i._op_layer="ZipWith",i.first=e,i.second=t,i.zipK=r,i})),wD=e=>{let t=sG("effect/Layer/unwrapEffect/Layer.Layer<R1, E1, A>");return w_(wS(t,e),e=>sK(e,t))},wL=e=>{let t=sG("effect/Layer/unwrapScoped/Layer.Layer<R1, E1, A>");return w_(wI(t,e),e=>sK(e,t))},w$=M(2,(e,t)=>vv(r=>ux(wm(t,r),t=>hP(e,t)))),wU=M(2,(e,t)=>{let r=fH(we.fiberRefs,t.fiberRefs),i=lM(we.runtimeFlags,t.runtimeFlags);return uW(n=>l5(s=>{let a=s.getFiberRef(cC),o=s.getFiberRefs(),l=fV(s.id(),o)(r),u=s.currentRuntimeFlags,c=lz(i)(u),h=fH(l,o),p=lM(c,u);return s.setFiberRefs(l),s.currentRuntimeFlags=c,vB(hP(n(e),sW(a,t.context)),l5(e=>(e.setFiberRefs(fV(e.id(),e.getFiberRefs())(h)),e.currentRuntimeFlags=lz(p)(e.currentRuntimeFlags),uG)))}))}),wq=M(2,(e,t)=>Array.isArray(t)?w$(e,wE(...t)):wc(t)?w$(e,t):sD(t)?hP(e,t):Sq in t?ux(t.runtimeEffect,t=>wU(e,t)):wU(e,t)),wB=Symbol.for("effect/MutableList"),wJ={[wB]:wB,[Symbol.iterator](){let e=!1,t=this.head;return{next(){if(e)return this.return();if(null==t)return e=!0,this.return();let r=t.value;return t=t.next,{done:e,value:r}},return:t=>(e||(e=!0),{done:!0,value:t})}},toString(){return eB(this.toJSON())},toJSON(){return{_id:"MutableList",values:Array.from(this).map(eq)}},[eU](){return this.toJSON()},pipe(){return eX(this,arguments)}},wH=e=>({value:e,removed:!1,prev:void 0,next:void 0}),wK=()=>{let e=Object.create(wJ);return e.head=void 0,e.tail=void 0,e._length=0,e},wV=e=>0===wW(e),wW=e=>e._length,wG=M(2,(e,t)=>{let r=wH(t);return void 0===e.head&&(e.head=r),void 0===e.tail||(e.tail.next=r,r.prev=e.tail),e.tail=r,e._length+=1,e}),wY=e=>{let t=e.head;if(void 0!==t)return wQ(e,t),t.value},wQ=(e,t)=>{!t.removed&&(t.removed=!0,void 0!==t.prev&&void 0!==t.next?(t.prev.next=t.next,t.next.prev=t.prev):void 0!==t.prev?(e.tail=t.prev,t.prev.next=void 0):void 0!==t.next?(e.head=t.next,t.next.prev=void 0):(e.tail=void 0,e.head=void 0),e._length>0&&(e._length-=1))},wZ=Symbol.for("effect/MutableQueue"),wX=Symbol.for("effect/mutable/MutableQueue/Empty"),w0={[wZ]:wZ,[Symbol.iterator](){return Array.from(this.queue)[Symbol.iterator]()},toString(){return eB(this.toJSON())},toJSON(){return{_id:"MutableQueue",values:Array.from(this).map(eq)}},[eU](){return this.toJSON()},pipe(){return eX(this,arguments)}},w1=e=>{let t=Object.create(w0);return t.queue=wK(),t.capacity=e,t},w2=e=>w1(e),w3=()=>w1(void 0),w5=e=>wW(e.queue),w4=e=>wV(e.queue),w6=e=>void 0===e.capacity?1/0:e.capacity,w8=M(2,(e,t)=>{let r=wW(e.queue);return(void 0===e.capacity||r!==e.capacity)&&(wG(t)(e.queue),!0)}),w7=M(2,(e,t)=>{let r;let i=t[Symbol.iterator](),n=il(),s=!0;for(;s&&(r=i.next())&&!r.done;)s=w8(r.value)(e);for(;null!=r&&!r.done;)n=i_(r.value)(n),r=i.next();return im(n)}),w9=M(2,(e,t)=>wV(e.queue)?t:wY(e.queue)),ke=M(2,(e,t)=>{let r=il(),i=0;for(;i<t;){let t=w9(wX)(e);if(t===wX)break;r=i_(t)(r),i+=1}return im(r)}),kt=(e,t,r,i)=>om({_tag:"Complete",key:e,exit:t,entryStats:r,timeToLiveMillis:i}),kr=(e,t)=>om({_tag:"Pending",key:e,deferred:t}),ki=(e,t)=>om({_tag:"Refreshing",deferred:e,complete:t}),kn=Symbol.for("effect/Cache/MapKey");class ks{constructor(e){this[kn]=kn,this.previous=void 0,this.next=void 0,this.current=e}[ek](){return U(eC(this.current),eE(eC(this.previous)),eE(eC(this.next)),eM(this))}[ez](e){return this===e||ko(e)&&eP(this.current,e.current)&&eP(this.previous,e.previous)&&eP(this.next,e.next)}}let ka=e=>new ks(e),ko=e=>en(e,kn);class kl{add(e){if(e!==this.tail){if(void 0===this.tail)this.head=e,this.tail=e;else{let t=e.previous,r=e.next;void 0!==r&&(e.next=void 0,void 0!==t?(t.next=r,r.previous=t):(this.head=r,this.head.previous=void 0)),this.tail.next=e,e.previous=this.tail,this.tail=e}}}remove(){let e=this.head;if(void 0!==e){let t=e.next;void 0!==t?(e.next=void 0,this.head=t,this.head.previous=void 0):(this.head=void 0,this.tail=void 0)}return e}constructor(){this.head=void 0,this.tail=void 0}}let ku=()=>new kl,kc=(e,t,r,i,n,s)=>({map:e,keys:t,accesses:r,updating:i,hits:n,misses:s}),kh=()=>kc(xm(),ku(),w3(),aF(!1),0,0),kp=Symbol.for("effect/Cache"),kf={_Key:e=>e,_Error:e=>e,_Value:e=>e},kd=Symbol.for("effect/ConsumerCache"),km={_Key:e=>e,_Error:e=>e,_Value:e=>e},kg=e=>e,kb=e=>({loadedMillis:e});class kx{constructor(e,t,r,i,n){this[kp]=kf,this[kd]=km,this.capacity=e,this.context=t,this.fiberId=r,this.lookup=i,this.timeToLive=n,this.cacheState=kh()}get(e){return uN(this.getEither(e),tL)}get cacheStats(){return uB(()=>kg({hits:this.cacheState.hits,misses:this.cacheState.misses,size:xS(this.cacheState.map)}))}getOption(e){return uq(()=>tV(xg(this.cacheState.map,e),{onNone:()=>{let t=ka(e);return this.trackAccess(t),this.trackMiss(),uU(tK())},onSome:e=>this.resolveMapValue(e)}))}getOptionComplete(e){return uq(()=>tV(xg(this.cacheState.map,e),{onNone:()=>{let t=ka(e);return this.trackAccess(t),this.trackMiss(),uU(tK())},onSome:e=>this.resolveMapValue(e,!0)}))}contains(e){return uB(()=>xx(this.cacheState.map,e))}entryStats(e){return uB(()=>{let t=xg(this.cacheState.map,e);if(tS(t))switch(t.value._tag){case"Complete":return tk(kb(t.value.entryStats.loadedMillis));case"Pending":break;case"Refreshing":return tk(kb(t.value.complete.entryStats.loadedMillis))}return tK()})}getEither(e){return uq(()=>{let t,r;let i=tZ(xg(this.cacheState.map,e));return(void 0===i&&(r=hS(this.fiberId),t=ka(e),xx(this.cacheState.map,e)?i=tZ(xg(this.cacheState.map,e)):xy(this.cacheState.map,e,kr(t,r))),void 0===i)?(this.trackAccess(t),this.trackMiss(),uN(this.lookupValueOf(e,r),tA)):ux(this.resolveMapValue(i),tV({onNone:()=>this.getEither(e),onSome:e=>uU(tN(e))}))})}invalidate(e){return uB(()=>{x_(this.cacheState.map,e)})}invalidateWhen(e,t){return uB(()=>{let r=xg(this.cacheState.map,e);tS(r)&&"Complete"===r.value._tag&&"Success"===r.value.exit._tag&&t(r.value.exit.value)&&x_(this.cacheState.map,e)})}get invalidateAll(){return uB(()=>{this.cacheState.map=xm()})}refresh(e){return fu(t=>uq(()=>{let r=hS(this.fiberId),i=tZ(xg(this.cacheState.map,e));if(void 0===i&&(xx(this.cacheState.map,e)?i=tZ(xg(this.cacheState.map,e)):xy(this.cacheState.map,e,kr(ka(e),r))),void 0===i)return l8(this.lookupValueOf(e,r));switch(i._tag){case"Complete":if(this.hasExpired(t,i.timeToLiveMillis))return eP(tZ(xg(this.cacheState.map,e)),i)&&x_(this.cacheState.map,e),l8(this.get(e));return U(this.lookupValueOf(e,r),gY(()=>{if(eP(tZ(xg(this.cacheState.map,e)),i)){let t=ki(r,i);return xy(this.cacheState.map,e,t),!0}return!1}),l8);case"Pending":case"Refreshing":return hC(i.deferred)}}))}set(e,t){return fu(r=>uB(()=>{let i=r.unsafeCurrentTimeMillis(),n=hg(t),s=kt(ka(e),n,kb(i),i+ad(s7(this.timeToLive(n))));xy(this.cacheState.map,e,s)}))}get size(){return uB(()=>xS(this.cacheState.map))}get values(){return uB(()=>{let e=[];for(let t of this.cacheState.map)"Complete"===t[1]._tag&&"Success"===t[1].exit._tag&&e.push(t[1].exit.value);return e})}get entries(){return uB(()=>{let e=[];for(let t of this.cacheState.map)"Complete"===t[1]._tag&&"Success"===t[1].exit._tag&&e.push([t[0],t[1].exit.value]);return e})}get keys(){return uB(()=>{let e=[];for(let t of this.cacheState.map)"Complete"===t[1]._tag&&"Success"===t[1].exit._tag&&e.push(t[0]);return e})}resolveMapValue(e,t=!1){return fu(r=>{switch(e._tag){case"Complete":if(this.trackAccess(e.key),this.hasExpired(r,e.timeToLiveMillis))return x_(this.cacheState.map,e.key.current),uU(tK());return this.trackHit(),uN(e.exit,tk);case"Pending":if(this.trackAccess(e.key),this.trackHit(),t)return uU(tK());return uN(hC(e.deferred),tk);case"Refreshing":if(this.trackAccess(e.complete.key),this.trackHit(),this.hasExpired(r,e.complete.timeToLiveMillis)){if(t)return uU(tK());return uN(hC(e.deferred),tk)}return uN(e.complete.exit,tk)}})}trackHit(){this.cacheState.hits=this.cacheState.hits+1}trackMiss(){this.cacheState.misses=this.cacheState.misses+1}trackAccess(e){if(w8(this.cacheState.accesses,e),aR(this.cacheState.updating,!1,!0)){let e=!0;for(;e;){let t=w9(this.cacheState.accesses,wX);t===wX?e=!1:this.cacheState.keys.add(t)}let t=xS(this.cacheState.map);for(e=t>this.capacity;e;){let r=this.cacheState.keys.remove();void 0!==r?xx(this.cacheState.map,r.current)&&(x_(this.cacheState.map,r.current),t-=1,e=t>this.capacity):e=!1}aN(this.cacheState.updating,!1)}}hasExpired(e,t){return e.unsafeCurrentTimeMillis()>t}lookupValueOf(e,t){return fu(r=>uq(()=>U(this.lookup(e),hz(this.context),uh,ux(i=>{let n=r.unsafeCurrentTimeMillis(),s=kb(n),a=kt(ka(e),i,s,n+ad(s7(this.timeToLive(i))));return xy(this.cacheState.map,e,a),u5(hE(t,i),i)}),uz(()=>u5(fd(t),uB(()=>{x_(this.cacheState.map,e)}))))))}}let ky=(e,t,r)=>new kx(e,sQ(),aq,t,e=>s7(r(e))),kv=(()=>cv(ky(65536,()=>uN(hw(),e=>({listeners:new yy,handle:e})),()=>au(60))),e=>U(hw(),ux(t=>U(g_(e),uT(t),gP,uN(e=>u5(e,U(hC(t),ux(([e,t])=>l6(u2(gD(e[0]),uY(e[1])),t))))))))),k_=function(){let e=1==arguments.length?arguments[0]:arguments[1].bind(arguments[0]);return uX(()=>e(U))},kS=e=>e.length>=1?ut((t,r)=>{try{e(r).then(e=>t(hg(e)),e=>t(ho(e)))}catch(e){t(ho(e))}}):ut(t=>{try{e().then(e=>t(hg(e)),e=>t(ho(e)))}catch(e){t(ho(e))}}),kw=e=>gC(e,{onFailure:$,onSuccess:$}),kk=e=>uw(e,{onFailure:e=>gR(e,"An error was silently ignored because it is not anticipated to be useful"),onSuccess:()=>uG}),kC=e=>ux(vN(),t=>vj(e,t)),kO=(e,...t)=>gI(e)(...t),kE=e=>uB(()=>SO(e)),kI=M(2,(e,t)=>vO(e,t,(e,t)=>e(t))),kF=function(){let e="string"!=typeof arguments[0],t=e?arguments[1]:arguments[0],r=fn(e?arguments[2]:arguments[1]);if(e){let e=arguments[0];return g1(t,r,t=>g2(e,t))}return e=>g1(t,r,t=>g2(e,t))},kR=function(e,...t){let r=Error.stackTraceLimit;Error.stackTraceLimit=2;let i=Error();if(Error.stackTraceLimit=r,"string"!=typeof e)return function(...r){let n=Error.stackTraceLimit;Error.stackTraceLimit=2;let s=Error();return Error.stackTraceLimit=n,kT({self:this,body:e,args:r,pipeables:t,spanName:"<anonymous>",spanOptions:{context:fs.context(!0)},errorDef:i,errorCall:s})};let n=t[0];return(t,...r)=>function(...s){let a=Error.stackTraceLimit;Error.stackTraceLimit=2;let o=Error();return Error.stackTraceLimit=a,kT({self:this,body:t,args:s,pipeables:r,spanName:e,spanOptions:n,errorDef:i,errorCall:o})}};function kT(e){let t,r;if(eS(e.body))t=uX(()=>e.body.apply(e.self,e.args));else try{t=e.body.apply(e.self,e.args)}catch(e){r=e,t=ul(e)}if(e.pipeables.length>0)try{for(let r of e.pipeables)t=r(t)}catch(e){t=r?ud(n1(nZ(r),nZ(e))):ul(e)}let i=!1,n=e.spanOptions&&"captureStackTrace"in e.spanOptions?e.spanOptions:{captureStackTrace:()=>{if(!1!==i)return i;if(e.errorCall.stack){let t=e.errorDef.stack.trim().split("\n"),r=e.errorCall.stack.trim().split("\n");return i=`${t.slice(2).join("\n").trim()}
${r.slice(2).join("\n").trim()}`}},...e.spanOptions};return kF(t,e.spanName,n)}let kN=function(){let e=Symbol.for("effect/Data/Error/plainArgs");return class extends cG{constructor(t){super(t?.message,t?.cause?{cause:t.cause}:void 0),t&&(Object.assign(this,t),Object.defineProperty(this,e,{value:t,enumerable:!1}))}toJSON(){return{...this[e],...this}}}}(),kA=e=>{class t extends kN{constructor(...t){super(...t),this._tag=e}}return t.prototype.name=e,t},kj=Symbol.for("@effect/platform/Error/PlatformErrorTypeId"),kM=(y="BadArgument",e=>om({[kj]:kj,_tag:y,...e})),kz=(e,t)=>{class r extends kN{constructor(...e){super(...e),this._tag=t}}return r.prototype[e]=e,r.prototype.name=t,r},kP=(e,t)=>{switch(t._tag){case"StringKeyword":case"TemplateLiteral":return Object.keys(e);case"SymbolKeyword":return Object.getOwnPropertySymbols(e);case"Refinement":return kP(e,t.from)}},kD=e=>Object.keys(e).concat(Object.getOwnPropertySymbols(e)),kL=e=>{let t,r=!1;return()=>(r||(t=e(),r=!0),t)},k$=e=>{try{return e.toISOString()}catch(t){return String(e)}},kU=e=>{if(K(e))return JSON.stringify(e);if(V(e)||null==e||W(e)||Y(e))return String(e);if(el(e))return k$(e);if(G(e))return String(e)+"n";if(!r_(e)&&en(e,"toString")&&Q(e.toString)&&e.toString!==Object.prototype.toString)return e.toString();try{if(JSON.stringify(e),r_(e))return`[${e.map(kU).join(",")}]`;return`{${kD(e).map(t=>`${K(t)?JSON.stringify(t):String(t)}:${kU(e[t])}`).join(",")}}`}catch(t){return String(e)}},kq=e=>"string"==typeof e?JSON.stringify(e):String(e),kB=e=>Array.isArray(e),kJ=e=>!Array.isArray(e),kH=e=>`[${kq(e)}]`,kK=e=>kB(e)?e.map(kH).join(""):kH(e),kV=(e,t,r,i)=>{let n=e;return r&&rw(r)&&(n+=`
at path: ${kK(r)}`),void 0!==t&&(n+=`
details: ${t}`),i&&(n+=`
schema (${i._tag}): ${i}`),n},kW=(e,t,r)=>kV("Unsupported schema or overlapping types",`cannot extend ${e} with ${t}`,r),kG=e=>kV("Unsupported key schema",void 0,void 0,e),kY=e=>kV("Unsupported literal",`literal value: ${kU(e)}`),kQ=e=>kV("Duplicate index signature",`${e} index signature`),kZ=kV("Unsupported index signature parameter","An index signature parameter type must be `string`, `symbol`, a template literal type or a refinement of the previous types"),kX=kV("Invalid element","A required element cannot follow an optional element. ts(1257)"),k0=e=>kV("Duplicate property signature transformation",`Duplicate key ${kU(e)}`),k1=e=>kV("Duplicate property signature",`Duplicate key ${kU(e)}`),k2=Symbol.for("effect/annotation/Brand"),k3=Symbol.for("effect/annotation/SchemaId"),k5=Symbol.for("effect/annotation/Message"),k4=Symbol.for("effect/annotation/MissingMessage"),k6=Symbol.for("effect/annotation/Identifier"),k8=Symbol.for("effect/annotation/Title"),k7=Symbol.for("effect/annotation/AutoTitle"),k9=Symbol.for("effect/annotation/Description"),Ce=Symbol.for("effect/annotation/Examples"),Ct=Symbol.for("effect/annotation/Default"),Cr=Symbol.for("effect/annotation/JSONSchema"),Ci=Symbol.for("effect/annotation/Arbitrary"),Cn=Symbol.for("effect/annotation/Pretty"),Cs=Symbol.for("effect/annotation/Equivalence"),Ca=Symbol.for("effect/annotation/Documentation"),Co=Symbol.for("effect/annotation/Concurrency"),Cl=Symbol.for("effect/annotation/Batching"),Cu=Symbol.for("effect/annotation/ParseIssueTitle"),Cc=Symbol.for("effect/annotation/ParseOptions"),Ch=Symbol.for("effect/annotation/DecodingFallback"),Cp=Symbol.for("effect/annotation/Surrogate"),Cf=Symbol.for("effect/annotation/StableFilter"),Cd=M(2,(e,t)=>Object.prototype.hasOwnProperty.call(e.annotations,t)?tk(e.annotations[t]):tK()),Cm=Cd(k2),Cg=Cd(k5),Cb=Cd(k4),Cx=Cd(k8),Cy=Cd(k7),Cv=Cd(k6),C_=Cd(k9),CS=Cd(Co),Cw=Cd(Cl),Ck=Cd(Cu),CC=Cd(Cc),CO=Cd(Ch),CE=Cd(Cp),CI=Cd(Cf),CF=e=>t7(CI(e),e=>!0===e),CR=Symbol.for("effect/annotation/JSONIdentifier"),CT=Cd(CR),CN=e=>tG(CT(e),()=>Cv(e)),CA=Symbol.for("effect/schema/ParseJson");class Cj{constructor(e,t,r,i={}){this._tag="Declaration",this.typeParameters=e,this.decodeUnknown=t,this.encodeUnknown=r,this.annotations=i}toString(){return tW(OW(this),()=>"<declaration schema>")}toJSON(){return{_tag:this._tag,typeParameters:this.typeParameters.map(e=>e.toJSON()),annotations:OB(this.annotations)}}}let CM=e=>t=>t._tag===e;class Cz{constructor(e,t={}){this._tag="Literal",this.literal=e,this.annotations=t}toString(){return tW(OW(this),()=>kU(this.literal))}toJSON(){return{_tag:this._tag,literal:G(this.literal)?String(this.literal):this.literal,annotations:OB(this.annotations)}}}let CP=CM("Literal"),CD=new Cz(null);class CL{constructor(e,t={}){this._tag="UniqueSymbol",this.symbol=e,this.annotations=t}toString(){return tW(OW(this),()=>kU(this.symbol))}toJSON(){return{_tag:this._tag,symbol:String(this.symbol),annotations:OB(this.annotations)}}}class C${constructor(e={}){this._tag="UndefinedKeyword",this.annotations=e}toString(){return OK(this)}toJSON(){return{_tag:this._tag,annotations:OB(this.annotations)}}}let CU=new C$({[k8]:"undefined"});class Cq{constructor(e={}){this._tag="NeverKeyword",this.annotations=e}toString(){return OK(this)}toJSON(){return{_tag:this._tag,annotations:OB(this.annotations)}}}let CB=new Cq({[k8]:"never"});class CJ{constructor(e={}){this._tag="UnknownKeyword",this.annotations=e}toString(){return OK(this)}toJSON(){return{_tag:this._tag,annotations:OB(this.annotations)}}}let CH=new CJ({[k8]:"unknown"});class CK{constructor(e={}){this._tag="AnyKeyword",this.annotations=e}toString(){return OK(this)}toJSON(){return{_tag:this._tag,annotations:OB(this.annotations)}}}let CV=new CK({[k8]:"any"});class CW{constructor(e={}){this._tag="StringKeyword",this.annotations=e}toString(){return OK(this)}toJSON(){return{_tag:this._tag,annotations:OB(this.annotations)}}}let CG=new CW({[k8]:"string",[k9]:"a string"}),CY=CM("StringKeyword");class CQ{constructor(e={}){this._tag="NumberKeyword",this.annotations=e}toString(){return OK(this)}toJSON(){return{_tag:this._tag,annotations:OB(this.annotations)}}}let CZ=new CQ({[k8]:"number",[k9]:"a number"}),CX=CM("NumberKeyword");class C0{constructor(e={}){this._tag="BooleanKeyword",this.annotations=e}toString(){return OK(this)}toJSON(){return{_tag:this._tag,annotations:OB(this.annotations)}}}let C1=new C0({[k8]:"boolean",[k9]:"a boolean"}),C2=CM("BooleanKeyword");class C3{constructor(e={}){this._tag="BigIntKeyword",this.annotations=e}toString(){return OK(this)}toJSON(){return{_tag:this._tag,annotations:OB(this.annotations)}}}let C5=CM("SymbolKeyword"),C4=e=>{switch(e._tag){case"Literal":case"NumberKeyword":case"StringKeyword":case"TemplateLiteral":return!0;case"Union":return e.types.every(C4)}return!1},C6=e=>{switch(e._tag){case"Literal":return JSON.stringify(String(e.literal));case"StringKeyword":return"string";case"NumberKeyword":return"number";case"TemplateLiteral":return String(e);case"Union":return e.types.map(C6).join(" | ")}};class C8{constructor(e,t={}){this.type=e,this.annotations=t}toJSON(){return{type:this.type.toJSON(),annotations:OB(this.annotations)}}toString(){return String(this.type)}}class C7 extends C8{constructor(e,t,r={}){super(e,r),this.isOptional=t}toJSON(){return{type:this.type.toJSON(),isOptional:this.isOptional,annotations:OB(this.annotations)}}toString(){return String(this.type)+(this.isOptional?"?":"")}}let C9=e=>e.map(e=>e.type);class Oe{constructor(e,t,r,i={}){this._tag="TupleType",this.elements=e,this.rest=t,this.isReadonly=r,this.annotations=i;let n=!1,s=!1;for(let t of e)if(t.isOptional)n=!0;else if(n){s=!0;break}if(s||n&&t.length>1)throw Error(kX)}toString(){return tW(OW(this),()=>Ot(this))}toJSON(){return{_tag:this._tag,elements:this.elements.map(e=>e.toJSON()),rest:this.rest.map(e=>e.toJSON()),isReadonly:this.isReadonly,annotations:OB(this.annotations)}}}let Ot=e=>{let t=e.elements.map(String).join(", ");return rb(e.rest,{onEmpty:()=>`readonly [${t}]`,onNonEmpty:(r,i)=>{let n=String(r),s=n.includes(" | ")?`(${n})`:n;if(i.length>0){let r=i.map(String).join(", ");return e.elements.length>0?`readonly [${t}, ...${s}[], ${r}]`:`readonly [...${s}[], ${r}]`}return e.elements.length>0?`readonly [${t}, ...${s}[]]`:`ReadonlyArray<${n}>`}})};class Or extends C7{constructor(e,t,r,i,n){super(t,r,n),this.name=e,this.isReadonly=i}toString(){return(this.isReadonly?"readonly ":"")+String(this.name)+(this.isOptional?"?":"")+": "+this.type}toJSON(){return{name:String(this.name),type:this.type.toJSON(),isOptional:this.isOptional,isReadonly:this.isReadonly,annotations:OB(this.annotations)}}}let Oi=e=>{switch(e._tag){case"StringKeyword":case"SymbolKeyword":case"TemplateLiteral":return!0;case"Refinement":return Oi(e.from)}return!1};class On{constructor(e,t,r){if(this.type=t,this.isReadonly=r,Oi(e))this.parameter=e;else throw Error(kZ)}toString(){return(this.isReadonly?"readonly ":"")+`[x: ${this.parameter}]: ${this.type}`}toJSON(){return{parameter:this.parameter.toJSON(),type:this.type.toJSON(),isReadonly:this.isReadonly}}}class Os{constructor(e,t,r={}){this._tag="TypeLiteral",this.annotations=r;let i={};for(let t=0;t<e.length;t++){let r=e[t].name;if(Object.prototype.hasOwnProperty.call(i,r))throw Error(k1(r));i[r]=null}let n={string:!1,symbol:!1};for(let e=0;e<t.length;e++){let r=OJ(t[e].parameter);if(CY(r)){if(n.string)throw Error(kQ("string"));n.string=!0}else if(C5(r)){if(n.symbol)throw Error(kQ("symbol"));n.symbol=!0}}this.propertySignatures=e,this.indexSignatures=t}toString(){return tW(OW(this),()=>Oo(this))}toJSON(){return{_tag:this._tag,propertySignatures:this.propertySignatures.map(e=>e.toJSON()),indexSignatures:this.indexSignatures.map(e=>e.toJSON()),annotations:OB(this.annotations)}}}let Oa=e=>e.map(String).join("; "),Oo=e=>{if(e.propertySignatures.length>0){let t=e.propertySignatures.map(String).join("; ");return e.indexSignatures.length>0?`{ ${t}; ${Oa(e.indexSignatures)} }`:`{ ${t} }`}return e.indexSignatures.length>0?`{ ${Oa(e.indexSignatures)} }`:"{}"},Ol=CM("TypeLiteral"),Ou=rP(ri(rr,e=>{switch(e._tag){case"AnyKeyword":return 0;case"UnknownKeyword":return 1;case"ObjectKeyword":return 2;case"StringKeyword":case"NumberKeyword":case"BooleanKeyword":case"BigIntKeyword":case"SymbolKeyword":return 3}return 4})),Oc={string:"StringKeyword",number:"NumberKeyword",boolean:"BooleanKeyword",bigint:"BigIntKeyword"},Oh=e=>rG(e,e=>Og(e)?Oh(e.types):[e]),Op=e=>{let t=Ou(e),r=[],i={},n=[];for(let e of t)switch(e._tag){case"NeverKeyword":break;case"AnyKeyword":return[CV];case"UnknownKeyword":return[CH];case"ObjectKeyword":case"UndefinedKeyword":case"VoidKeyword":case"StringKeyword":case"NumberKeyword":case"BooleanKeyword":case"BigIntKeyword":case"SymbolKeyword":i[e._tag]||(i[e._tag]=e,r.push(e));break;case"Literal":{let t=typeof e.literal;switch(t){case"string":case"number":case"bigint":case"boolean":i[Oc[t]]||n.includes(e.literal)||(n.push(e.literal),r.push(e));break;case"object":n.includes(e.literal)||(n.push(e.literal),r.push(e))}break}case"UniqueSymbol":i.SymbolKeyword||n.includes(e.symbol)||(n.push(e.symbol),r.push(e));break;case"TupleType":i.ObjectKeyword||r.push(e);break;case"TypeLiteral":0===e.propertySignatures.length&&0===e.indexSignatures.length?i["{}"]||(i["{}"]=e,r.push(e)):i.ObjectKeyword||r.push(e);break;default:r.push(e)}return r};class Of{static{this.make=(e,t)=>Om(e)?new Of(e,t):1===e.length?e[0]:CB}static{this.unify=(e,t)=>Of.make(Op(Oh(e)),t)}constructor(e,t={}){this._tag="Union",this.types=e,this.annotations=t}toString(){return tW(OW(this),()=>this.types.map(String).join(" | "))}toJSON(){return{_tag:this._tag,types:this.types.map(e=>e.toJSON()),annotations:OB(this.annotations)}}}let Od=(e,t)=>e.map(t),Om=e=>e.length>1,Og=CM("Union"),Ob=H(Symbol.for("effect/Schema/AST/toJSONMemoMap"),()=>new WeakMap);class Ox{constructor(e,t={}){this._tag="Suspend",this.f=e,this.annotations=t,this.f=kL(e)}toString(){return OW(this).pipe(tG(()=>t2(tX(this.f)(),e=>OW(e))),tW(()=>"<suspended schema>"))}toJSON(){let e=this.f(),t=Ob.get(e);return t||(Ob.set(e,{_tag:this._tag}),t={_tag:this._tag,ast:e.toJSON(),annotations:OB(this.annotations)},Ob.set(e,t)),t}}class Oy{constructor(e,t,r={}){this._tag="Refinement",this.from=e,this.filter=t,this.annotations=r}toString(){return Cv(this).pipe(tW(()=>tV(OV(this),{onNone:()=>`{ ${this.from} | filter }`,onSome:e=>Ov(this.from)?String(this.from)+" & "+e:e})))}toJSON(){return{_tag:this._tag,from:this.from.toJSON(),annotations:OB(this.annotations)}}}let Ov=CM("Refinement"),O_={};class OS{constructor(e,t,r,i={}){this._tag="Transformation",this.from=e,this.to=t,this.transformation=r,this.annotations=i}toString(){return tW(OW(this),()=>`(${String(this.from)} <-> ${String(this.to)})`)}toJSON(){return{_tag:this._tag,from:this.from.toJSON(),to:this.to.toJSON(),annotations:OB(this.annotations)}}}class Ow{constructor(e,t){this._tag="FinalTransformation",this.decode=e,this.encode=t}}class Ok{constructor(){this._tag="ComposeTransformation"}}let OC=new Ok;class OO{constructor(e,t,r,i){this.from=e,this.to=t,this.decode=r,this.encode=i}}class OE{constructor(e){this._tag="TypeLiteralTransformation",this.propertySignatureTransformations=e;let t={},r={};for(let i of e){let e=i.from;if(t[e])throw Error(k0(e));t[e]=!0;let n=i.to;if(r[n])throw Error(k0(n));r[n]=!0}}}let OI=e=>"TypeLiteralTransformation"===e._tag,OF=(e,t)=>{let r=Object.getOwnPropertyDescriptors(e),i={...e.annotations,...t},n=CE(e);return tS(n)&&(i[Cp]=OF(n.value,t)),r.annotations.value=i,Object.create(Object.getPrototypeOf(e),r)},OR=(e,t)=>{switch(e._tag){case"Literal":return hQ(String(e.literal));case"StringKeyword":return".*";case"NumberKeyword":return"[+-]?\\d*\\.?\\d+(?:[Ee][+-]?\\d+)?";case"TemplateLiteral":return ON(e,t,!1);case"Union":return e.types.map(e=>OR(e,t)).join("|")}},OT=(e,t,r,i)=>{if(Og(e)){if(r&&!i)return`(?:${t})`}else if(!r||!i)return t;return`(${t})`},ON=(e,t,r)=>{let i="";if(""!==e.head){let n=hQ(e.head);i+=t&&r?`(${n})`:n}for(let n of e.spans){let e=OR(n.type,t);if(i+=OT(n.type,e,t,r),""!==n.literal){let e=hQ(n.literal);i+=t&&r?`(${e})`:e}}return i},OA=e=>RegExp(`^${ON(e,!1,!0)}$`),Oj=e=>{switch(e._tag){case"TupleType":{let t=!1,r=[];for(let i of e.elements)i.isOptional&&(t=!0),r.push(i.type);return t&&r.push(CU),r=r.concat(C9(e.rest)),Of.make(r)}case"Refinement":return Oj(e.from);case"Union":return Of.make(e.types.map(Oj));case"Suspend":return Oj(e.f())}throw Error(errors_.getASTUnsupportedSchemaErrorMessage(e))},OM=(e,t)=>{let r=[],i=[],n=e=>{switch(e._tag){case"NeverKeyword":break;case"StringKeyword":case"SymbolKeyword":case"TemplateLiteral":case"Refinement":i.push(new On(e,t,!0));break;case"Literal":if(K(e.literal)||V(e.literal))r.push(new Or(e.literal,t,!1,!0));else throw Error(kY(e.literal));break;case"Enums":for(let[i,n]of e.enums)r.push(new Or(n,t,!1,!0));break;case"UniqueSymbol":r.push(new Or(e.symbol,t,!1,!0));break;case"Union":e.types.forEach(n);break;default:throw Error(kG(e))}};return n(e),{propertySignatures:r,indexSignatures:i}},Oz=e=>{switch(e._tag){case"TupleType":return!1===e.isReadonly?e:new Oe(e.elements,e.rest,!1,e.annotations);case"TypeLiteral":{let t=OL(e.propertySignatures,e=>!1===e.isReadonly?e:new Or(e.name,e.type,e.isOptional,!1,e.annotations)),r=OL(e.indexSignatures,e=>!1===e.isReadonly?e:new On(e.parameter,e.type,!1));return t===e.propertySignatures&&r===e.indexSignatures?e:new Os(t,r,e.annotations)}case"Union":{let t=OL(e.types,Oz);return t===e.types?e:Of.make(t,e.annotations)}case"Suspend":return new Ox(()=>Oz(e.f()),e.annotations);case"Refinement":{let t=Oz(e.from);return t===e.from?e:new Oy(t,e.filter,e.annotations)}case"Transformation":{let t=Oz(e.from),r=Oz(e.to);return t===e.from&&r===e.to?e:new OS(t,r,e.transformation,e.annotations)}}return e},OP=e=>{switch(e._tag){case"Declaration":{let t=OL(e.typeParameters,OP);return t===e.typeParameters?e:new Cj(t,e.decodeUnknown,e.encodeUnknown,e.annotations)}case"TupleType":{let t=OL(e.elements,e=>{let t=OP(e.type);return t===e.type?e:new C7(t,e.isOptional)}),r=C9(e.rest),i=OL(r,OP);return t===e.elements&&i===r?e:new Oe(t,i.map(e=>new C8(e)),e.isReadonly,e.annotations)}case"TypeLiteral":{let t=OL(e.propertySignatures,e=>{let t=OP(e.type);return t===e.type?e:new Or(e.name,t,e.isOptional,e.isReadonly)}),r=OL(e.indexSignatures,e=>{let t=OP(e.type);return t===e.type?e:new On(e.parameter,t,e.isReadonly)});return t===e.propertySignatures&&r===e.indexSignatures?e:new Os(t,r,e.annotations)}case"Union":{let t=OL(e.types,OP);return t===e.types?e:Of.make(t,e.annotations)}case"Suspend":return new Ox(()=>OP(e.f()),e.annotations);case"Refinement":{let t=OP(e.from);return t===e.from?e:new Oy(t,e.filter,e.annotations)}case"Transformation":return OP(e.to)}return e},OD=e=>tV(CN(e),{onNone:()=>void 0,onSome:e=>({[CR]:e})});function OL(e,t){let r=!1,i=rp(e.length);for(let n=0;n<e.length;n++){let s=e[n],a=t(s);a!==s&&(r=!0),i[n]=a}return r?i:e}let O$=e=>{switch(e._tag){case"Transformation":return e.from;case"Refinement":return O$(e.from);case"Suspend":return O$(e.f())}},OU=(e,t)=>{switch(e._tag){case"Declaration":{let r=OL(e.typeParameters,e=>OU(e,t));return r===e.typeParameters?e:new Cj(r,e.decodeUnknown,e.encodeUnknown,e.annotations)}case"TupleType":{let r=OL(e.elements,e=>{let r=OU(e.type,t);return r===e.type?e:new C7(r,e.isOptional)}),i=C9(e.rest),n=OL(i,e=>OU(e,t));return r===e.elements&&n===i?e:new Oe(r,n.map(e=>new C8(e)),e.isReadonly,OD(e))}case"TypeLiteral":{let r=OL(e.propertySignatures,e=>{let r=OU(e.type,t);return r===e.type?e:new Or(e.name,r,e.isOptional,e.isReadonly)}),i=OL(e.indexSignatures,e=>{let r=OU(e.type,t);return r===e.type?e:new On(e.parameter,r,e.isReadonly)});return r===e.propertySignatures&&i===e.indexSignatures?e:new Os(r,i,OD(e))}case"Union":{let r=OL(e.types,e=>OU(e,t));return r===e.types?e:Of.make(r,OD(e))}case"Suspend":return new Ox(()=>OU(e.f(),t),OD(e));case"Refinement":{let r=OU(e.from,t);if(t){if(r===e.from)return e;if(void 0===O$(e.from)&&CF(e))return new Oy(r,e.filter,e.annotations)}let i=OD(e);return i?OF(r,i):r}case"Transformation":{let r=OD(e);return OU(r?OF(e.from,r):e.from,t)}}return e},Oq=e=>OU(e,!1),OB=e=>{let t={};for(let r of Object.getOwnPropertySymbols(e))t[String(r)]=e[r];return t},OJ=e=>{switch(e._tag){case"StringKeyword":case"SymbolKeyword":case"TemplateLiteral":return e;case"Refinement":return OJ(e.from)}},OH=(e,t)=>new OS(e,t,OC),OK=e=>tW(OW(e),()=>e._tag),OV=e=>Cx(e).pipe(tG(()=>C_(e)),tG(()=>Cy(e)),t1(t=>t+tV(Cm(e),{onNone:()=>"",onSome:e=>e.map(e=>` & Brand<${kU(e)}>`).join("")}))),OW=e=>tG(Cv(e),()=>OV(e));class OG{constructor(e,t,r){this._tag="Pointer",this.path=e,this.actual=t,this.issue=r}}class OY{constructor(e,t){this._tag="Unexpected",this.actual=e,this.message=t}}class OQ{constructor(e,t){this._tag="Missing",this.actual=void 0,this.ast=e,this.message=t}}class OZ{constructor(e,t,r,i){this._tag="Composite",this.ast=e,this.actual=t,this.issues=r,this.output=i}}class OX{constructor(e,t,r,i){this._tag="Refinement",this.ast=e,this.actual=t,this.kind=r,this.issue=i}}class O0{constructor(e,t,r,i){this._tag="Transformation",this.ast=e,this.actual=t,this.kind=r,this.issue=i}}class O1{constructor(e,t,r){this._tag="Type",this.ast=e,this.actual=t,this.message=r}}class O2{constructor(e,t,r){this._tag="Forbidden",this.ast=e,this.actual=t,this.message=r}}let O3=Symbol.for("effect/Schema/ParseErrorTypeId"),O5=e=>en(e,O3);class O4 extends kA("ParseError"){get message(){return this.toString()}toString(){return EE.formatIssueSync(this.issue)}toJSON(){return{_id:"ParseError",message:this.toString()}}[eU](){return this.toJSON()}constructor(...e){super(...e),this[O3]=O3}}let O6=e=>new O4({issue:e}),O8=M(2,(e,t)=>"Left"===e._tag?e:"Right"===e._tag?t(e.right):ux(e,t)),O7=M(2,(e,t)=>"Left"===e._tag?e:"Right"===e._tag?tA(t(e.right)):uN(e,t)),O9=M(2,(e,t)=>"Left"===e._tag?tN(t(e.left)):"Right"===e._tag?e:uj(e,t)),Ee=e=>{if("Left"===e._tag||"Right"===e._tag)return e},Et=M(2,(e,t)=>"Left"===e._tag?tN(t.onFailure(e.left)):"Right"===e._tag?tA(t.onSuccess(e.right)):uA(e,t)),Er=M(2,(e,t)=>"Left"===e._tag?t(e.left):"Right"===e._tag?e:ui(e,t)),Ei=(e,t)=>void 0===t||V(t)?e:void 0===e?t:{...e,...t},En=(e,t,r)=>{let i=Ed(e,t);return(e,t)=>i(e,Ei(r,t))},Es=(e,t,r)=>{let i=En(e,t,r);return(e,t)=>t$(i(e,t),O6)},Ea=(e,t,r)=>{let i=Ed(e,t);return(e,t)=>i(e,{...Ei(r,t),isEffectAllowed:!0})},Eo=(e,t)=>En(e.ast,!0,t),El=(e,t)=>Ea(e.ast,!0,t),Eu=(e,t)=>Ea(e.ast,!1,t),Ec=(e,t)=>Es(OP(e.ast),!0,t),Eh=(e,t)=>{let r=Ed(OP(e.ast),!0);return(e,i)=>tT(r(e,{exact:!0,...Ei(t,i)}))},Ep=H(Symbol.for("effect/Schema/Parser/decodeMemoMap"),()=>new WeakMap),Ef=H(Symbol.for("effect/Schema/Parser/encodeMemoMap"),()=>new WeakMap),Ed=(e,t)=>{let r=t?Ep:Ef,i=r.get(e);if(i)return i;let n=Eb(e,t),s=CC(e),a=tS(s)?(e,t)=>n(e,Ei(t,s.value)):n,o=CO(e),l=t&&tS(o)?(t,r)=>ES(Er(a(t,r),o.value),e,t,r):a;return r.set(e,l),l},Em=e=>tZ(CS(e)),Eg=e=>tZ(Cw(e)),Eb=(e,t)=>{switch(e._tag){case"Refinement":if(t){let t=Ed(e.from,!0);return(r,i)=>{i=i??O_;let n=i?.errors==="all";return ES(O8(Er(t(r,i),t=>{let s=new OX(e,r,"From",t);return n&&CF(e)&&EM(t)?tV(e.filter(r,i,e),{onNone:()=>tN(s),onSome:t=>tN(new OZ(e,r,[s,new OX(e,r,"Predicate",t)]))}):tN(s)}),t=>tV(e.filter(t,i,e),{onNone:()=>tA(t),onSome:t=>tN(new OX(e,r,"Predicate",t))})),e,r,i)}}{let t=Ed(OP(e),!0),r=Ed(E_(e.from),!1);return(i,n)=>ES(O8(t(i,n),e=>r(e,n)),e,i,n)}case"Transformation":{let r=EC(e.transformation,t),i=t?Ed(e.from,!0):Ed(e.to,!1),n=t?Ed(e.to,!0):Ed(e.from,!1);return(s,a)=>ES(O8(O9(i(s,a),r=>new O0(e,s,t?"Encoded":"Type",r)),i=>O8(O9(r(i,a??O_,e,s),t=>new O0(e,s,"Transformation",t)),r=>O9(n(r,a),r=>new O0(e,s,t?"Type":"Encoded",r)))),e,s,a)}case"Declaration":{let r=t?e.decodeUnknown(...e.typeParameters):e.encodeUnknown(...e.typeParameters);return(t,i)=>ES(r(t,i??O_,e),e,t,i)}case"Literal":return Ex(e,t=>t===e.literal);case"UniqueSymbol":return Ex(e,t=>t===e.symbol);case"UndefinedKeyword":return Ex(e,Z);case"NeverKeyword":return Ex(e,et);case"UnknownKeyword":case"AnyKeyword":case"VoidKeyword":return tA;case"StringKeyword":return Ex(e,K);case"NumberKeyword":return Ex(e,V);case"BooleanKeyword":return Ex(e,W);case"BigIntKeyword":return Ex(e,G);case"SymbolKeyword":return Ex(e,Y);case"ObjectKeyword":return Ex(e,ei);case"Enums":return Ex(e,t=>e.enums.some(([e,r])=>r===t));case"TemplateLiteral":{let t=OA(e);return Ex(e,e=>K(e)&&t.test(e))}case"TupleType":{let r=e.elements.map(e=>Ed(e.type,t)),i=e.rest.map(e=>Ed(e.type,t)),n=e.elements.filter(e=>!e.isOptional);e.rest.length>0&&(n=n.concat(e.rest.slice(1)));let s=n.length,a=e.elements.length>0?e.elements.map((e,t)=>t).join(" | "):"never",o=Em(e),l=Eg(e);return(t,u)=>{let c;if(!r_(t))return tN(new O1(e,t));let h=u?.errors==="all",p=[],f=0,d=[],m=t.length;for(let r=m;r<=s-1;r++){let i=new OG(r,t,new OQ(n[r-m]));if(!h)return tN(new OZ(e,t,i,d));p.push([f++,i])}if(0===e.rest.length)for(let r=e.elements.length;r<=m-1;r++){let i=new OG(r,t,new OY(t[r],`is unexpected, expected: ${a}`));if(!h)return tN(new OZ(e,t,i,d));p.push([f++,i])}let g=0;for(;g<r.length;g++)if(m<g+1){if(e.elements[g].isOptional)continue}else{let i=(0,r[g])(t[g],u),n=Ee(i);if(n){if(tR(n)){let r=new OG(g,t,n.left);if(!h)return tN(new OZ(e,t,r,Ek(d)));p.push([f++,r]);continue}d.push([f++,n.right])}else{let r=f++,n=g;c||(c=[]),c.push(({es:s,output:a})=>ux(uc(i),i=>{if(tR(i)){let o=new OG(n,t,i.left);return h?(s.push([r,o]),uG):tN(new OZ(e,t,o,Ek(a)))}return a.push([r,i.right]),uG}))}}if(rw(i)){let[r,...n]=i;for(;g<m-n.length;g++){let i=r(t[g],u),n=Ee(i);if(n){if(tR(n)){let r=new OG(g,t,n.left);if(!h)return tN(new OZ(e,t,r,Ek(d)));p.push([f++,r]);continue}d.push([f++,n.right])}else{let r=f++,n=g;c||(c=[]),c.push(({es:s,output:a})=>ux(uc(i),i=>{if(!tR(i))return a.push([r,i.right]),uG;{let o=new OG(n,t,i.left);return h?(s.push([r,o]),uG):tN(new OZ(e,t,o,Ek(a)))}}))}}for(let r=0;r<n.length;r++)if(!(m<(g+=r)+1)){let i=n[r](t[g],u),s=Ee(i);if(s){if(tR(s)){let r=new OG(g,t,s.left);if(!h)return tN(new OZ(e,t,r,Ek(d)));p.push([f++,r]);continue}d.push([f++,s.right])}else{let r=f++,n=g;c||(c=[]),c.push(({es:s,output:a})=>ux(uc(i),i=>{if(tR(i)){let o=new OG(n,t,i.left);return h?(s.push([r,o]),uG):tN(new OZ(e,t,o,Ek(a)))}return a.push([r,i.right]),uG}))}}}let b=({es:r,output:i})=>tH(r)?tN(new OZ(e,t,Ek(r),Ek(i))):tA(Ek(i));if(c&&c.length>0){let e=c;return uq(()=>{let t={es:rB(p),output:rB(d)};return ux(vo(e,e=>e(t),{concurrency:o,batching:l,discard:!0}),()=>b(t))})}return b({output:d,es:p})}}case"TypeLiteral":{if(0===e.propertySignatures.length&&0===e.indexSignatures.length)return Ex(e,eo);let r=[],i={},n=[];for(let s of e.propertySignatures)r.push([Ed(s.type,t),s]),i[s.name]=null,n.push(s.name);let s=e.indexSignatures.map(e=>[Ed(e.parameter,t),Ed(e.type,t),e.parameter]),a=Of.make(e.indexSignatures.map(e=>e.parameter).concat(n.map(e=>Y(e)?new CL(e):new Cz(e)))),o=Ed(a,t),l=Em(e),u=Eg(e);return(t,c)=>{let h,p;if(!ec(t))return tN(new O1(e,t));let f=c?.errors==="all",d=[],m=0,g=c?.onExcessProperty==="error",b=c?.onExcessProperty==="preserve",x={};if(g||b){for(let r of h=kD(t))if(tR(Ee(o(r,c)))){if(g){let i=new OG(r,t,new OY(t[r],`is unexpected, expected: ${String(a)}`));if(!f)return tN(new OZ(e,t,i,x));d.push([m++,i]);continue}x[r]=t[r]}}let y=c?.exact===!0;for(let i=0;i<r.length;i++){let n=r[i][1],s=n.name,a=Object.prototype.hasOwnProperty.call(t,s);if(!a){if(n.isOptional)continue;if(y){let r=new OG(s,t,new OQ(n));if(!f)return tN(new OZ(e,t,r,x));d.push([m++,r]);continue}}let o=(0,r[i][0])(t[s],c),l=Ee(o);if(l){if(tR(l)){let r=new OG(s,t,a?l.left:new OQ(n));if(!f)return tN(new OZ(e,t,r,x));d.push([m++,r]);continue}x[s]=l.right}else{let r=m++;p||(p=[]),p.push(({es:i,output:l})=>ux(uc(o),o=>{if(tR(o)){let u=new OG(s,t,a?o.left:new OQ(n));return f?(i.push([r,u]),uG):tN(new OZ(e,t,u,l))}return l[s]=o.right,uG}))}}for(let r=0;r<s.length;r++){let n=s[r],a=n[0],o=n[1];for(let r of kP(t,n[2])){let n=Ee(a(r,c));if(n&&tT(n)){let n=o(t[r],c),s=Ee(n);if(s){if(tR(s)){let i=new OG(r,t,s.left);if(!f)return tN(new OZ(e,t,i,x));d.push([m++,i]);continue}Object.prototype.hasOwnProperty.call(i,r)||(x[r]=s.right)}else{let s=m++,a=r;p||(p=[]),p.push(({es:o,output:l})=>ux(uc(n),n=>{if(!tR(n))return Object.prototype.hasOwnProperty.call(i,r)||(l[r]=n.right),uG;{let r=new OG(a,t,n.left);return f?(o.push([s,r]),uG):tN(new OZ(e,t,r,l))}}))}}}}let v=({es:r,output:i})=>{if(tH(r))return tN(new OZ(e,t,Ek(r),i));if(c?.propertyOrder==="original"){let e=h||kD(t);for(let t of n)-1===e.indexOf(t)&&e.push(t);let r={};for(let t of e)Object.prototype.hasOwnProperty.call(i,t)&&(r[t]=i[t]);return tA(r)}return tA(i)};if(p&&p.length>0){let e=p;return uq(()=>{let t={es:rB(d),output:Object.assign({},x)};return ux(vo(e,e=>e(t),{concurrency:l,batching:u,discard:!0}),()=>v(t))})}return v({es:d,output:x})}}case"Union":{let r=Ev(e.types,t),i=kD(r.keys),n=i.length,s=new Map;for(let r=0;r<e.types.length;r++)s.set(e.types[r],Ed(e.types[r],t));let a=Em(e)??1,o=Eg(e);return(t,l)=>{let u;let c=[],h=0,p=[];if(n>0){if(er(t))for(let e=0;e<n;e++){let n=i[e],s=r.keys[n].buckets;if(Object.prototype.hasOwnProperty.call(t,n)){let e=String(t[n]);if(Object.prototype.hasOwnProperty.call(s,e))p=p.concat(s[e]);else{let e=Of.make(r.keys[n].literals);c.push([h++,new OZ(new Os([new Or(n,e,!1,!0)],[]),t,new OG(n,t,new O1(e,t[n])))])}}else{let e=Of.make(r.keys[n].literals),i=new Or(n,e,!1,!0);c.push([h++,new OZ(new Os([i],[]),t,new OG(n,t,new OQ(i)))])}}else c.push([h++,new O1(e,t)])}r.otherwise.length>0&&(p=p.concat(r.otherwise));for(let e=0;e<p.length;e++){let r=p[e],i=s.get(r)(t,l),n=u&&0!==u.length?void 0:Ee(i);if(n){if(tT(n))return n;c.push([h++,n.left])}else{let e=h++;u||(u=[]),u.push(t=>uq(()=>"finalResult"in t?uG:ux(uc(i),r=>(tT(r)?t.finalResult=r:t.es.push([e,r.left]),uG))))}}let f=r=>tH(r)?1===r.length&&"Type"===r[0][1]._tag?tN(r[0][1]):tN(new OZ(e,t,Ek(r))):tN(new O1(e,t));if(u&&u.length>0){let e=u;return uq(()=>{let t={es:rB(c)};return ux(vo(e,e=>e(t),{concurrency:a,batching:o,discard:!0}),()=>"finalResult"in t?t.finalResult:f(t.es))})}return f(c)}}case"Suspend":{let r=kL(()=>Ed(OF(e.f(),e.annotations),t));return(e,t)=>r()(e,t)}}},Ex=(e,t)=>r=>t(r)?tA(r):tN(new O1(e,r)),Ey=(e,t)=>{switch(e._tag){case"Declaration":{let r=CE(e);if(tS(r))return Ey(r.value,t);break}case"TypeLiteral":{let r=[];for(let i=0;i<e.propertySignatures.length;i++){let n=e.propertySignatures[i],s=t?Oq(n.type):OP(n.type);CP(s)&&!n.isOptional&&r.push([n.name,s])}return r}case"TupleType":{let r=[];for(let i=0;i<e.elements.length;i++){let n=e.elements[i],s=t?Oq(n.type):OP(n.type);CP(s)&&!n.isOptional&&r.push([i,s])}return r}case"Refinement":return Ey(e.from,t);case"Suspend":return Ey(e.f(),t);case"Transformation":return Ey(t?e.from:e.to,t)}return[]},Ev=(e,t)=>{let r={},i=[];for(let n=0;n<e.length;n++){let s=e[n],a=Ey(s,t);if(a.length>0)for(let e=0;e<a.length;e++){let[t,i]=a[e],n=String(i.literal);r[t]=r[t]||{buckets:{},literals:[]};let o=r[t].buckets;if(Object.prototype.hasOwnProperty.call(o,n)){if(e<a.length-1)continue;o[n].push(s),r[t].literals.push(i)}else{o[n]=[s],r[t].literals.push(i);break}}else i.push(s)}return{keys:r,otherwise:i}},E_=e=>Ov(e)?E_(e.from):e,ES=(e,t,r,i)=>{let n=Ee(e);if(n)return n;if(i?.isEffectAllowed===!0)return e;try{return wn(uc(e))}catch(e){return tN(new O2(t,r,"cannot be be resolved synchronously, this is caused by using runSync on an effect that performs async work"))}},Ew=([e],[t])=>e>t?1:e<t?-1:0;function Ek(e){return e.sort(Ew).map(e=>e[1])}let EC=(e,t)=>{switch(e._tag){case"FinalTransformation":return t?e.decode:e.encode;case"ComposeTransformation":return tA;case"TypeLiteralTransformation":return r=>{let i=tA(r);for(let r of e.propertySignatureTransformations){let[e,n]=t?[r.from,r.to]:[r.to,r.from],s=t?r.decode:r.encode;i=O7(i,t=>{let r=s(Object.prototype.hasOwnProperty.call(t,e)?tk(t[e]):tK());return delete t[e],tS(r)&&(t[n]=r.value),t})}return i}}},EO=(e,t=[])=>({value:e,forest:t}),EE={formatIssue:e=>uN(EK(e),EI),formatIssueSync:e=>wn(EE.formatIssue(e)),formatError:e=>EE.formatIssue(e.issue),formatErrorSync:e=>EE.formatIssueSync(e.issue)},EI=e=>e.value+EF("\n",e.forest),EF=(e,t)=>{let r,i="",n=t.length;for(let s=0;s<n;s++){r=t[s];let a=s===n-1;i+=e+(a?"└":"├")+"─ "+r.value,i+=EF(e+(n>1&&!a?"│  ":"   "),r.forest)}return i},ER=e=>{switch(e){case"Encoded":return"Encoded side transformation failure";case"Transformation":return"Transformation process failure";case"Type":return"Type side transformation failure"}},ET=e=>{switch(e){case"From":return"From side refinement failure";case"Predicate":return"Predicate refinement failure"}},EN=e=>"ast"in e?tk(e.ast):tK(),EA=e=>EN(e).pipe(t2(Cg),ux(t=>{let r=t(e);return K(r)?uU({message:r,override:!1}):l3(r)?uN(r,e=>({message:e,override:!1})):K(r.message)?uU({message:r.message,override:r.override}):uN(r.message,e=>({message:e,override:r.override}))})),Ej=e=>t=>t._tag===e,EM=Ej("Composite"),Ez=Ej("Refinement"),EP=Ej("Transformation"),ED=e=>EA(e).pipe(ux(t=>!t.override&&(EM(e)||Ez(e)&&"From"===e.kind||EP(e)&&"Transformation"!==e.kind)?EP(e)||Ez(e)?ED(e.issue):tK():uU(t.message))),EL=e=>EN(e).pipe(t2(Ck),t5(t=>tQ(t(e)))),E$=e=>ED(e).pipe(uP(()=>EL(e)),ui(()=>uU(function(e){var t;if(void 0!==e.message)return e.message;let r=Ov(e.ast)?C_(t=e.ast).pipe(tG(()=>Cx(t)),tG(()=>Cy(t)),tG(()=>Cv(t)),tW(()=>`{ ${t.from} | filter }`)):String(e.ast);return`Expected ${r}, actual ${kU(e.actual)}`}(e)))),EU=e=>tW(EL(e),()=>String(e.ast)),Eq=e=>e.message??"is forbidden",EB=e=>e.message??"is unexpected",EJ=e=>Cb(e.ast).pipe(ux(e=>{let t=e();return K(t)?uU(t):t}),ui(()=>uU(e.message??"is missing"))),EH=(e,t)=>uk(ED(e),{onFailure:t,onSuccess:e=>uU(EO(e))}),EK=e=>{switch(e._tag){case"Type":return uN(E$(e),EO);case"Forbidden":return uU(EO(EU(e),[EO(Eq(e))]));case"Unexpected":return uU(EO(EB(e)));case"Missing":return uN(EJ(e),EO);case"Transformation":return EH(e,()=>uN(EK(e.issue),t=>EO(EU(e),[EO(ER(e.kind),[t])])));case"Refinement":return EH(e,()=>uN(EK(e.issue),t=>EO(EU(e),[EO(ET(e.kind),[t])])));case"Pointer":return uN(EK(e.issue),t=>EO(kK(e.path),[t]));case"Composite":{let t=EU(e);return EH(e,()=>kB(e.issues)?uN(vo(e.issues,EK),e=>EO(t,e)):uN(EK(e.issues),e=>EO(t,[e])))}}},EV=e=>uU([e]),EW=Symbol.for("effect/QueueEnqueue"),EG=Symbol.for("effect/QueueDequeue"),EY=Symbol.for("effect/QueueStrategy"),EQ=Symbol.for("effect/BackingQueue"),EZ={_A:e=>e},EX={_A:e=>e},E0={_In:e=>e},E1={_Out:e=>e};class E2 extends fx{constructor(e,t,r,i,n){super(),this[EW]=E0,this[EG]=E1,this.queue=e,this.takers=t,this.shutdownHook=r,this.shutdownFlag=i,this.strategy=n}pipe(){return eX(this,arguments)}commit(){return this.take}capacity(){return this.queue.capacity()}get size(){return uq(()=>ui(this.unsafeSize(),()=>uI))}unsafeSize(){return aT(this.shutdownFlag)?tK():tk(this.queue.length()-w5(this.takers)+this.strategy.surplusSize())}get isEmpty(){return uN(this.size,e=>e<=0)}get isFull(){return uN(this.size,e=>e>=this.capacity())}get shutdown(){return uV(l5(e=>(U(this.shutdownFlag,aN(!0)),U(vu(Ip(this.takers),t=>hF(t,e.id()),!1,!1),u5(this.strategy.shutdown),uQ(hR(this.shutdownHook,void 0)),l8))))}get isShutdown(){return uB(()=>aT(this.shutdownFlag))}get awaitShutdown(){return hC(this.shutdownHook)}isActive(){return!aT(this.shutdownFlag)}unsafeOffer(e){let t;if(aT(this.shutdownFlag))return!1;if(0===this.queue.length()){let r=U(this.takers,w9(wX));r!==wX?(Ic(r,e),t=!0):t=!1}else t=!1;if(t)return!0;let r=this.queue.offer(e);return Im(this.strategy,this.queue,this.takers),r}offer(e){return uq(()=>{let t;if(aT(this.shutdownFlag))return uI;if(0===this.queue.length()){let r=U(this.takers,w9(wX));r!==wX?(Ic(r,e),t=!0):t=!1}else t=!1;if(t)return uU(!0);let r=this.queue.offer(e);return Im(this.strategy,this.queue,this.takers),r?uU(!0):this.strategy.handleSurplus([e],this.queue,this.takers,this.shutdownFlag)})}offerAll(e){return uq(()=>{if(aT(this.shutdownFlag))return uI;let t=rd(e),r=0===this.queue.length()?rd(If(this.takers,t.length)):rK,[i,n]=U(t,rU(r.length));for(let e=0;e<r.length;e++)Ic(r[e],i[e]);if(0===n.length)return uU(!0);let s=this.queue.offerAll(n);return Im(this.strategy,this.queue,this.takers),iT(s)?uU(!0):this.strategy.handleSurplus(s,this.queue,this.takers,this.shutdownFlag)})}get take(){return l5(e=>{if(aT(this.shutdownFlag))return uI;let t=this.queue.poll(wX);if(t!==wX)return this.strategy.unsafeOnQueueEmptySpace(this.queue,this.takers),uU(t);{let t=hS(e.id());return U(uq(()=>(U(this.takers,w8(t)),Im(this.strategy,this.queue,this.takers),aT(this.shutdownFlag)?uI:hC(t))),uz(()=>uB(()=>Id(this.takers,t))))}})}get takeAll(){return uq(()=>aT(this.shutdownFlag)?uI:uB(()=>{let e=this.queue.pollUpTo(Number.POSITIVE_INFINITY);return this.strategy.unsafeOnQueueEmptySpace(this.queue,this.takers),ih(e)}))}takeUpTo(e){return uq(()=>aT(this.shutdownFlag)?uI:uB(()=>{let t=this.queue.pollUpTo(e);return this.strategy.unsafeOnQueueEmptySpace(this.queue,this.takers),ih(t)}))}takeBetween(e,t){return uq(()=>E3(this,e,t,il()))}}let E3=(e,t,r,i)=>r<t?uU(i):U(It(e,r),ux(n=>{let s=t-n.length;return 1===s?U(Ie(e),uN(e=>U(i,iC(n),iv(e)))):s>1?U(Ie(e),ux(t=>E3(e,s-1,r-n.length-1,U(i,iC(n),iv(t))))):uU(U(i,iC(n)))})),E5=(e,t,r,i,n)=>new E2(e,t,r,i,n),E4=(e,t)=>U(hw(),uN(r=>E5(e,w3(),r,aF(!1),t)));class E6{constructor(e){this[EQ]=EX,this.mutable=e}poll(e){return w9(this.mutable,e)}pollUpTo(e){return ke(this.mutable,e)}offerAll(e){return w7(this.mutable,e)}offer(e){return w8(this.mutable,e)}capacity(){return w6(this.mutable)}length(){return w5(this.mutable)}}let E8=e=>new E6(e),E7=M(2,(e,t)=>e.offer(t)),E9=M(2,(e,t)=>e.offerAll(t)),Ie=e=>e.take,It=M(2,(e,t)=>e.takeUpTo(t)),Ir=M(3,(e,t,r)=>e.takeBetween(t,r)),Ii=M(2,(e,t)=>e.takeBetween(t,t)),In=()=>new Io,Is=()=>new Il,Ia=()=>new Iu;class Io{surplusSize(){return w5(this.putters)}onCompleteTakersWithEmptyQueue(e){for(;!w4(this.putters)&&!w4(e);){let t=w9(e,void 0),r=w9(this.putters,void 0);r[2]&&Ic(r[1],!0),Ic(t,r[0])}}get shutdown(){return U(ug,ux(e=>U(uB(()=>Ip(this.putters)),ux(t=>vu(t,([t,r,i])=>i?U(hF(r,e),l8):uG,!1,!1)))))}handleSurplus(e,t,r,i){return l5(n=>{let s=hS(n.id());return U(uq(()=>(this.unsafeOffer(e,s),this.unsafeOnQueueEmptySpace(t,r),Im(this,t,r),aT(i)?uI:hC(s))),uz(()=>uB(()=>this.unsafeRemove(s))))})}unsafeOnQueueEmptySpace(e,t){let r=!0;for(;r&&(e.capacity()===Number.POSITIVE_INFINITY||e.length()<e.capacity());){let i=U(this.putters,w9(wX));if(i===wX)r=!1;else{let r=e.offer(i[0]);r&&i[2]?Ic(i[1],!0):r||Ih(this.putters,U(Ip(this.putters),i_(i))),Im(this,e,t)}}}unsafeOffer(e,t){let r=rd(e);for(let e=0;e<r.length;e++){let i=r[e];e===r.length-1?U(this.putters,w8([i,t,!0])):U(this.putters,w8([i,t,!1]))}}unsafeRemove(e){Ih(this.putters,U(Ip(this.putters),iE(([,t])=>t!==e)))}constructor(){this[EY]=EZ,this.putters=w3()}}class Il{surplusSize(){return 0}get shutdown(){return uG}onCompleteTakersWithEmptyQueue(){}handleSurplus(e,t,r,i){return uU(!1)}unsafeOnQueueEmptySpace(e,t){}constructor(){this[EY]=EZ}}class Iu{surplusSize(){return 0}get shutdown(){return uG}onCompleteTakersWithEmptyQueue(){}handleSurplus(e,t,r,i){return uB(()=>(this.unsafeOffer(t,e),Im(this,t,r),!0))}unsafeOnQueueEmptySpace(e,t){}unsafeOffer(e,t){let r;let i=t[Symbol.iterator](),n=!0;for(;!(r=i.next()).done&&n;){if(0===e.capacity())return;e.poll(wX),n=e.offer(r.value)}}constructor(){this[EY]=EZ}}let Ic=(e,t)=>hT(e,uU(t)),Ih=(e,t)=>U(e,w7(t)),Ip=e=>U(e,ke(Number.POSITIVE_INFINITY)),If=(e,t)=>U(e,ke(t)),Id=(e,t)=>{Ih(e,U(Ip(e),iE(e=>t!==e)))},Im=(e,t,r)=>{let i=!0;for(;i&&0!==t.length();){let n=U(r,w9(wX));if(n!==wX){let s=t.poll(wX);s!==wX?(Ic(n,s),e.unsafeOnQueueEmptySpace(t,r)):Ih(r,U(Ip(r),i_(n))),i=!0}else i=!1}i&&0===t.length()&&!w4(r)&&e.onCompleteTakersWithEmptyQueue(r)},Ig=e=>U(uB(()=>w2(e)),ux(e=>E4(E8(e),In()))),Ib=e=>U(uB(()=>w2(e)),ux(e=>E4(E8(e),Is()))),Ix=e=>U(uB(()=>w2(e)),ux(e=>E4(E8(e),Ia()))),Iy=()=>U(uB(()=>w3()),ux(e=>E4(E8(e),Is()))),Iv=e=>e.capacity(),I_=e=>e.size,IS=e=>e.isEmpty,Iw=e=>e.isFull,Ik=e=>e.isShutdown,IC=e=>e.awaitShutdown,IO=e=>e.shutdown,IE=e=>uN(e.takeUpTo(1),iA),II=e=>e.takeAll,IF=M(2,(e,t)=>cx(y1,t)(e)),IR=e=>wF(vz(y9,nA(e))),IT=e=>wD(uN(e,IR)),IN=e=>wL(uN(e,IR)),IA=e=>wF(vz(y9,nj(e))),Ij=M(2,(e,t)=>w_(IA(e),()=>IR(t))),IM=M(2,(e,t)=>w_(IA(e),()=>IT(t))),Iz=M(2,(e,t)=>w_(IA(e),()=>IN(t))),IP=e=>ww(uN(e,()=>sQ())),ID=e=>wF(vS(e)),IL=Symbol.for("effect/PubSub/AbsentValue"),I$=(e,t)=>r=>{r.has(e)||r.set(e,new Set),r.get(e).add(t)},IU=(e,t)=>r=>{if(!r.has(e))return;let i=r.get(e);i.delete(t),0===i.size&&r.delete(e)},Iq=e=>{let t="number"==typeof e?{capacity:e}:e;I4(t.capacity);let r=t.replay&&t.replay>0?new Fl(Math.ceil(t.replay)):void 0;return 1===t.capacity?new IY(r):hG(t.capacity)===t.capacity?new IW(t.capacity,r):new IK(t.capacity,r)},IB=e=>new IZ(e?.replay?new Fl(e.replay):void 0),IJ=(e,t,r)=>uN(hw(),i=>IH(e,t,e.subscribe(),w3(),i,aF(!1),r)),IH=(e,t,r,i,n,s,a)=>new I0(e,t,r,i,n,s,a,e.replayWindow());class IK{constructor(e,t){this.publisherIndex=0,this.subscriberCount=0,this.subscribersIndex=0,this.capacity=e,this.replayBuffer=t,this.array=Array.from({length:e}),this.subscribers=Array.from({length:e})}replayWindow(){return this.replayBuffer?new Fu(this.replayBuffer):Fc}isEmpty(){return this.publisherIndex===this.subscribersIndex}isFull(){return this.publisherIndex===this.subscribersIndex+this.capacity}size(){return this.publisherIndex-this.subscribersIndex}publish(e){if(this.isFull())return!1;if(0!==this.subscriberCount){let t=this.publisherIndex%this.capacity;this.array[t]=e,this.subscribers[t]=this.subscriberCount,this.publisherIndex+=1}return this.replayBuffer&&this.replayBuffer.offer(e),!0}publishAll(e){if(0===this.subscriberCount)return this.replayBuffer&&this.replayBuffer.offerAll(e),il();let t=ih(e),r=t.length,i=this.publisherIndex-this.subscribersIndex,n=Math.min(r,this.capacity-i);if(0===n)return t;let s=0,a=this.publisherIndex+n;for(;this.publisherIndex!==a;){let e=iy(t,s++),r=this.publisherIndex%this.capacity;this.array[r]=e,this.subscribers[r]=this.subscriberCount,this.publisherIndex+=1,this.replayBuffer&&this.replayBuffer.offer(e)}return iw(t,s)}slide(){if(this.subscribersIndex!==this.publisherIndex){let e=this.subscribersIndex%this.capacity;this.array[e]=IL,this.subscribers[e]=0,this.subscribersIndex+=1}this.replayBuffer&&this.replayBuffer.slide()}subscribe(){return this.subscriberCount+=1,new IV(this,this.publisherIndex,!1)}}class IV{constructor(e,t,r){this.self=e,this.subscriberIndex=t,this.unsubscribed=r}isEmpty(){return this.unsubscribed||this.self.publisherIndex===this.subscriberIndex||this.self.publisherIndex===this.self.subscribersIndex}size(){return this.unsubscribed?0:this.self.publisherIndex-Math.max(this.subscriberIndex,this.self.subscribersIndex)}poll(e){if(this.unsubscribed)return e;if(this.subscriberIndex=Math.max(this.subscriberIndex,this.self.subscribersIndex),this.subscriberIndex!==this.self.publisherIndex){let e=this.subscriberIndex%this.self.capacity,t=this.self.array[e];return this.self.subscribers[e]-=1,0===this.self.subscribers[e]&&(this.self.array[e]=IL,this.self.subscribersIndex+=1),this.subscriberIndex+=1,t}return e}pollUpTo(e){if(this.unsubscribed)return il();this.subscriberIndex=Math.max(this.subscriberIndex,this.self.subscribersIndex);let t=Math.min(e,this.self.publisherIndex-this.subscriberIndex);if(t<=0)return il();let r=[],i=this.subscriberIndex+t;for(;this.subscriberIndex!==i;){let e=this.subscriberIndex%this.self.capacity,t=this.self.array[e];this.self.subscribers[e]-=1,0===this.self.subscribers[e]&&(this.self.array[e]=IL,this.self.subscribersIndex+=1),r.push(t),this.subscriberIndex+=1}return ih(r)}unsubscribe(){if(!this.unsubscribed)for(this.unsubscribed=!0,this.self.subscriberCount-=1,this.subscriberIndex=Math.max(this.subscriberIndex,this.self.subscribersIndex);this.subscriberIndex!==this.self.publisherIndex;){let e=this.subscriberIndex%this.self.capacity;this.self.subscribers[e]-=1,0===this.self.subscribers[e]&&(this.self.array[e]=IL,this.self.subscribersIndex+=1),this.subscriberIndex+=1}}}class IW{constructor(e,t){this.publisherIndex=0,this.subscriberCount=0,this.subscribersIndex=0,this.capacity=e,this.replayBuffer=t,this.array=Array.from({length:e}),this.mask=e-1,this.subscribers=Array.from({length:e})}replayWindow(){return this.replayBuffer?new Fu(this.replayBuffer):Fc}isEmpty(){return this.publisherIndex===this.subscribersIndex}isFull(){return this.publisherIndex===this.subscribersIndex+this.capacity}size(){return this.publisherIndex-this.subscribersIndex}publish(e){if(this.isFull())return!1;if(0!==this.subscriberCount){let t=this.publisherIndex&this.mask;this.array[t]=e,this.subscribers[t]=this.subscriberCount,this.publisherIndex+=1}return this.replayBuffer&&this.replayBuffer.offer(e),!0}publishAll(e){if(0===this.subscriberCount)return this.replayBuffer&&this.replayBuffer.offerAll(e),il();let t=ih(e),r=t.length,i=this.publisherIndex-this.subscribersIndex,n=Math.min(r,this.capacity-i);if(0===n)return t;let s=0,a=this.publisherIndex+n;for(;this.publisherIndex!==a;){let e=iy(t,s++),r=this.publisherIndex&this.mask;this.array[r]=e,this.subscribers[r]=this.subscriberCount,this.publisherIndex+=1,this.replayBuffer&&this.replayBuffer.offer(e)}return iw(t,s)}slide(){if(this.subscribersIndex!==this.publisherIndex){let e=this.subscribersIndex&this.mask;this.array[e]=IL,this.subscribers[e]=0,this.subscribersIndex+=1}this.replayBuffer&&this.replayBuffer.slide()}subscribe(){return this.subscriberCount+=1,new IG(this,this.publisherIndex,!1)}}class IG{constructor(e,t,r){this.self=e,this.subscriberIndex=t,this.unsubscribed=r}isEmpty(){return this.unsubscribed||this.self.publisherIndex===this.subscriberIndex||this.self.publisherIndex===this.self.subscribersIndex}size(){return this.unsubscribed?0:this.self.publisherIndex-Math.max(this.subscriberIndex,this.self.subscribersIndex)}poll(e){if(this.unsubscribed)return e;if(this.subscriberIndex=Math.max(this.subscriberIndex,this.self.subscribersIndex),this.subscriberIndex!==this.self.publisherIndex){let e=this.subscriberIndex&this.self.mask,t=this.self.array[e];return this.self.subscribers[e]-=1,0===this.self.subscribers[e]&&(this.self.array[e]=IL,this.self.subscribersIndex+=1),this.subscriberIndex+=1,t}return e}pollUpTo(e){if(this.unsubscribed)return il();this.subscriberIndex=Math.max(this.subscriberIndex,this.self.subscribersIndex);let t=Math.min(e,this.self.publisherIndex-this.subscriberIndex);if(t<=0)return il();let r=[],i=this.subscriberIndex+t;for(;this.subscriberIndex!==i;){let e=this.subscriberIndex&this.self.mask,t=this.self.array[e];this.self.subscribers[e]-=1,0===this.self.subscribers[e]&&(this.self.array[e]=IL,this.self.subscribersIndex+=1),r.push(t),this.subscriberIndex+=1}return ih(r)}unsubscribe(){if(!this.unsubscribed)for(this.unsubscribed=!0,this.self.subscriberCount-=1,this.subscriberIndex=Math.max(this.subscriberIndex,this.self.subscribersIndex);this.subscriberIndex!==this.self.publisherIndex;){let e=this.subscriberIndex&this.self.mask;this.self.subscribers[e]-=1,0===this.self.subscribers[e]&&(this.self.array[e]=IL,this.self.subscribersIndex+=1),this.subscriberIndex+=1}}}class IY{constructor(e){this.publisherIndex=0,this.subscriberCount=0,this.subscribers=0,this.value=IL,this.capacity=1,this.replayBuffer=e}replayWindow(){return this.replayBuffer?new Fu(this.replayBuffer):Fc}pipe(){return eX(this,arguments)}isEmpty(){return 0===this.subscribers}isFull(){return!this.isEmpty()}size(){return this.isEmpty()?0:1}publish(e){return!this.isFull()&&(0!==this.subscriberCount&&(this.value=e,this.subscribers=this.subscriberCount,this.publisherIndex+=1),this.replayBuffer&&this.replayBuffer.offer(e),!0)}publishAll(e){if(0===this.subscriberCount)return this.replayBuffer&&this.replayBuffer.offerAll(e),il();let t=ih(e);return iT(t)?t:this.publish(ij(t))?iw(t,1):t}slide(){this.isFull()&&(this.subscribers=0,this.value=IL),this.replayBuffer&&this.replayBuffer.slide()}subscribe(){return this.subscriberCount+=1,new IQ(this,this.publisherIndex,!1)}}class IQ{constructor(e,t,r){this.self=e,this.subscriberIndex=t,this.unsubscribed=r}isEmpty(){return this.unsubscribed||0===this.self.subscribers||this.subscriberIndex===this.self.publisherIndex}size(){return this.isEmpty()?0:1}poll(e){if(this.isEmpty())return e;let t=this.self.value;return this.self.subscribers-=1,0===this.self.subscribers&&(this.self.value=IL),this.subscriberIndex+=1,t}pollUpTo(e){if(this.isEmpty()||e<1)return il();let t=this.self.value;return this.self.subscribers-=1,0===this.self.subscribers&&(this.self.value=IL),this.subscriberIndex+=1,ic(t)}unsubscribe(){this.unsubscribed||(this.unsubscribed=!0,this.self.subscriberCount-=1,this.subscriberIndex===this.self.publisherIndex||(this.self.subscribers-=1,0!==this.self.subscribers||(this.self.value=IL)))}}class IZ{constructor(e){this.publisherHead={value:IL,subscribers:0,next:null},this.publisherTail=this.publisherHead,this.publisherIndex=0,this.subscribersIndex=0,this.capacity=Number.MAX_SAFE_INTEGER,this.replayBuffer=e}replayWindow(){return this.replayBuffer?new Fu(this.replayBuffer):Fc}isEmpty(){return this.publisherHead===this.publisherTail}isFull(){return!1}size(){return this.publisherIndex-this.subscribersIndex}publish(e){let t=this.publisherTail.subscribers;return 0!==t&&(this.publisherTail.next={value:e,subscribers:t,next:null},this.publisherTail=this.publisherTail.next,this.publisherIndex+=1),this.replayBuffer&&this.replayBuffer.offer(e),!0}publishAll(e){if(0!==this.publisherTail.subscribers)for(let t of e)this.publish(t);else this.replayBuffer&&this.replayBuffer.offerAll(e);return il()}slide(){this.publisherHead!==this.publisherTail&&(this.publisherHead=this.publisherHead.next,this.publisherHead.value=IL,this.subscribersIndex+=1),this.replayBuffer&&this.replayBuffer.slide()}subscribe(){return this.publisherTail.subscribers+=1,new IX(this,this.publisherTail,this.publisherIndex,!1)}}class IX{constructor(e,t,r,i){this.self=e,this.subscriberHead=t,this.subscriberIndex=r,this.unsubscribed=i}isEmpty(){if(this.unsubscribed)return!0;let e=!0,t=!0;for(;t;)this.subscriberHead===this.self.publisherTail?t=!1:this.subscriberHead.next.value!==IL?(e=!1,t=!1):(this.subscriberHead=this.subscriberHead.next,this.subscriberIndex+=1);return e}size(){return this.unsubscribed?0:this.self.publisherIndex-Math.max(this.subscriberIndex,this.self.subscribersIndex)}poll(e){if(this.unsubscribed)return e;let t=!0,r=e;for(;t;)if(this.subscriberHead===this.self.publisherTail)t=!1;else{let e=this.subscriberHead.next.value;e!==IL&&(r=e,this.subscriberHead.subscribers-=1,0===this.subscriberHead.subscribers&&(this.self.publisherHead=this.self.publisherHead.next,this.self.publisherHead.value=IL,this.self.subscribersIndex+=1),t=!1),this.subscriberHead=this.subscriberHead.next,this.subscriberIndex+=1}return r}pollUpTo(e){let t=[],r=0;for(;r!==e;){let i=this.poll(IL);i===IL?r=e:(t.push(i),r+=1)}return ih(t)}unsubscribe(){if(!this.unsubscribed)for(this.unsubscribed=!0,this.self.publisherTail.subscribers-=1;this.subscriberHead!==this.self.publisherTail;)this.subscriberHead.next.value!==IL&&(this.subscriberHead.subscribers-=1,0===this.subscriberHead.subscribers&&(this.self.publisherHead=this.self.publisherHead.next,this.self.publisherHead.value=IL,this.self.subscribersIndex+=1)),this.subscriberHead=this.subscriberHead.next}}class I0 extends fx{static{l=EG}constructor(e,t,r,i,n,s,a,o){super(),this[l]=E1,this.pubsub=e,this.subscribers=t,this.subscription=r,this.pollers=i,this.shutdownHook=n,this.shutdownFlag=s,this.strategy=a,this.replayWindow=o}commit(){return this.take}pipe(){return eX(this,arguments)}capacity(){return this.pubsub.capacity}isActive(){return!aT(this.shutdownFlag)}get size(){return uq(()=>aT(this.shutdownFlag)?uI:uU(this.subscription.size()+this.replayWindow.remaining))}unsafeSize(){return aT(this.shutdownFlag)?tK():tk(this.subscription.size()+this.replayWindow.remaining)}get isFull(){return uq(()=>aT(this.shutdownFlag)?uI:uU(this.subscription.size()===this.capacity()))}get isEmpty(){return uN(this.size,e=>0===e)}get shutdown(){return uV(l5(e=>(aN(this.shutdownFlag,!0),U(vl(I7(this.pollers),t=>hF(t,e.id()),!1),u5(uB(()=>{this.subscribers.delete(this.subscription),this.subscription.unsubscribe(),this.strategy.unsafeOnPubSubEmptySpace(this.pubsub,this.subscribers)})),uQ(hR(this.shutdownHook,void 0)),l8))))}get isShutdown(){return uB(()=>aT(this.shutdownFlag))}get awaitShutdown(){return hC(this.shutdownHook)}get take(){return l5(e=>{if(aT(this.shutdownFlag))return uI;if(this.replayWindow.remaining>0)return uU(this.replayWindow.take());let t=w4(this.pollers)?this.subscription.poll(wX):wX;if(t!==wX)return this.strategy.unsafeOnPubSubEmptySpace(this.pubsub,this.subscribers),uU(t);{let t=hS(e.id());return U(uq(()=>(U(this.pollers,w8(t)),U(this.subscribers,I$(this.subscription,this.pollers)),this.strategy.unsafeCompletePollers(this.pubsub,this.subscribers,this.subscription,this.pollers),aT(this.shutdownFlag)?uI:hC(t))),uz(()=>uB(()=>Fr(this.pollers,t))))}})}get takeAll(){return uq(()=>{if(aT(this.shutdownFlag))return uI;let e=w4(this.pollers)?I9(this.subscription):il();return(this.strategy.unsafeOnPubSubEmptySpace(this.pubsub,this.subscribers),this.replayWindow.remaining>0)?uU(iC(this.replayWindow.takeAll(),e)):uU(e)})}takeUpTo(e){return uq(()=>{let t;if(aT(this.shutdownFlag))return uI;if(this.replayWindow.remaining>=e)return uU(this.replayWindow.takeN(e));this.replayWindow.remaining>0&&(t=this.replayWindow.takeAll(),e-=t.length);let r=w4(this.pollers)?Fe(this.subscription,e):il();return this.strategy.unsafeOnPubSubEmptySpace(this.pubsub,this.subscribers),t?uU(iC(t,r)):uU(r)})}takeBetween(e,t){return uq(()=>I1(this,e,t,il()))}}let I1=(e,t,r,i)=>r<t?uU(i):U(e.takeUpTo(r),ux(n=>{let s=t-n.length;return 1===s?U(e.take,uN(e=>U(i,iC(n),iv(e)))):s>1?U(e.take,ux(t=>I1(e,s-1,r-n.length-1,U(i,iC(n),iv(t))))):uU(U(i,iC(n)))}));class I2{static{u=EW,c=EG}constructor(e,t,r,i,n,s){this[u]=E0,this[c]=E1,this.pubsub=e,this.subscribers=t,this.scope=r,this.shutdownHook=i,this.shutdownFlag=n,this.strategy=s}capacity(){return this.pubsub.capacity}get size(){return uq(()=>aT(this.shutdownFlag)?uI:uB(()=>this.pubsub.size()))}unsafeSize(){return aT(this.shutdownFlag)?tK():tk(this.pubsub.size())}get isFull(){return uN(this.size,e=>e===this.capacity())}get isEmpty(){return uN(this.size,e=>0===e)}get awaitShutdown(){return hC(this.shutdownHook)}get isShutdown(){return uB(()=>aT(this.shutdownFlag))}get shutdown(){return uV(l5(e=>(U(this.shutdownFlag,aN(!0)),U(this.scope.close(hp(e.id())),u5(this.strategy.shutdown),uQ(hR(this.shutdownHook,void 0)),l8))))}publish(e){return uq(()=>aT(this.shutdownFlag)?uI:this.pubsub.publish(e)?(this.strategy.unsafeCompleteSubscribers(this.pubsub,this.subscribers),uU(!0)):this.strategy.handleSurplus(this.pubsub,this.subscribers,ic(e),this.shutdownFlag))}isActive(){return!aT(this.shutdownFlag)}unsafeOffer(e){return!aT(this.shutdownFlag)&&!!this.pubsub.publish(e)&&(this.strategy.unsafeCompleteSubscribers(this.pubsub,this.subscribers),!0)}publishAll(e){return uq(()=>{if(aT(this.shutdownFlag))return uI;let t=Ft(this.pubsub,e);return(this.strategy.unsafeCompleteSubscribers(this.pubsub,this.subscribers),iT(t))?uU(!0):this.strategy.handleSurplus(this.pubsub,this.subscribers,t,this.shutdownFlag)})}get subscribe(){return uN(vt(uJ(va([this.scope.fork(fS),IJ(this.pubsub,this.subscribers,this.strategy)]),e=>e[0].addFinalizer(()=>e[1].shutdown)),(e,t)=>e[0].close(t)),e=>e[1])}offer(e){return this.publish(e)}offerAll(e){return this.publishAll(e)}pipe(){return eX(this,arguments)}}let I3=(e,t)=>ux(vN(),r=>uN(hw(),i=>I5(e,new Map,r,i,aF(!1),t))),I5=(e,t,r,i,n,s)=>new I2(e,t,r,i,n,s),I4=e=>{if(e<=0)throw new c8(`Cannot construct PubSub with capacity of ${e}`)},I6=(e,t)=>{hT(e,uU(t))},I8=(e,t)=>U(e,w7(t)),I7=e=>U(e,ke(Number.POSITIVE_INFINITY)),I9=e=>e.pollUpTo(Number.POSITIVE_INFINITY),Fe=(e,t)=>e.pollUpTo(t),Ft=(e,t)=>e.publishAll(t),Fr=(e,t)=>{I8(e,U(I7(e),iE(e=>e!==t)))};class Fi{get shutdown(){return ux(ug,e=>ux(uB(()=>I7(this.publishers)),t=>vu(t,([t,r,i])=>i?U(hF(r,e),l8):uG,!1,!1)))}handleSurplus(e,t,r,i){return l5(n=>{let s=hS(n.id());return U(uq(()=>(this.unsafeOffer(r,s),this.unsafeOnPubSubEmptySpace(e,t),this.unsafeCompleteSubscribers(e,t),aT(i)?uI:hC(s))),uz(()=>uB(()=>this.unsafeRemove(s))))})}unsafeOnPubSubEmptySpace(e,t){let r=!0;for(;r&&!e.isFull();){let i=U(this.publishers,w9(wX));if(i===wX)r=!1;else{let r=e.publish(i[0]);r&&i[2]?I6(i[1],!0):r||I8(this.publishers,U(I7(this.publishers),i_(i))),this.unsafeCompleteSubscribers(e,t)}}}unsafeCompletePollers(e,t,r,i){return Fa(this,e,t,r,i)}unsafeCompleteSubscribers(e,t){return Fo(this,e,t)}unsafeOffer(e,t){let r=e[Symbol.iterator](),i=r.next();if(!i.done)for(;;){let e=i.value;if((i=r.next()).done){U(this.publishers,w8([e,t,!0]));break}U(this.publishers,w8([e,t,!1]))}}unsafeRemove(e){I8(this.publishers,U(I7(this.publishers),iE(([t,r])=>r!==e)))}constructor(){this.publishers=w3()}}class Fn{get shutdown(){return uG}handleSurplus(e,t,r,i){return uU(!1)}unsafeOnPubSubEmptySpace(e,t){}unsafeCompletePollers(e,t,r,i){return Fa(this,e,t,r,i)}unsafeCompleteSubscribers(e,t){return Fo(this,e,t)}}class Fs{get shutdown(){return uG}handleSurplus(e,t,r,i){return uB(()=>(this.unsafeSlidingPublish(e,r),this.unsafeCompleteSubscribers(e,t),!0))}unsafeOnPubSubEmptySpace(e,t){}unsafeCompletePollers(e,t,r,i){return Fa(this,e,t,r,i)}unsafeCompleteSubscribers(e,t){return Fo(this,e,t)}unsafeSlidingPublish(e,t){let r=t[Symbol.iterator](),i=r.next();if(!i.done&&e.capacity>0){let t=i.value,n=!0;for(;n;){e.slide();let s=e.publish(t);s&&(i=r.next())&&!i.done?t=i.value:s&&(n=!1)}}}}let Fa=(e,t,r,i,n)=>{let s=!0;for(;s&&!i.isEmpty();){let a=U(n,w9(wX));if(a===wX)U(r,IU(i,n)),w4(n)?s=!1:U(r,I$(i,n));else{let s=i.poll(wX);s===wX?I8(n,U(I7(n),i_(a))):(I6(a,s),e.unsafeOnPubSubEmptySpace(t,r))}}},Fo=(e,t,r)=>{for(let[i,n]of r)for(let s of n)e.unsafeCompletePollers(t,r,i,s)};class Fl{constructor(e){this.head={value:IL,next:null},this.tail=this.head,this.size=0,this.index=0,this.capacity=e}slide(){this.index++}offer(e){this.tail.value=e,this.tail.next={value:IL,next:null},this.tail=this.tail.next,this.size===this.capacity?this.head=this.head.next:this.size+=1}offerAll(e){for(let t of e)this.offer(t)}}class Fu{constructor(e){this.buffer=e,this.index=e.index,this.remaining=e.size,this.head=e.head}fastForward(){for(;this.index<this.buffer.index;)this.head=this.head.next,this.index++}take(){if(0===this.remaining)return;this.index<this.buffer.index&&this.fastForward(),this.remaining--;let e=this.head.value;return this.head=this.head.next,e}takeN(e){if(0===this.remaining)return il();this.index<this.buffer.index&&this.fastForward();let t=Math.min(e,this.remaining),r=Array(t);for(let e=0;e<t;e++){let t=this.head.value;this.head=this.head.next,r[e]=t}return this.remaining-=t,ib(r)}takeAll(){return this.takeN(this.remaining)}}let Fc={remaining:0,take:()=>void 0,takeN:()=>il(),takeAll:()=>il()},Fh=e=>uq(()=>I3(Iq(e),new Fi)),Fp=e=>uq(()=>I3(Iq(e),new Fn)),Ff=e=>uq(()=>I3(Iq(e),new Fs)),Fd=e=>uq(()=>I3(IB(e),new Fn)),Fm=e=>e.shutdown,Fg=e=>e.subscribe,Fb="Continue",Fx=Symbol.for("effect/ChannelChildExecutorDecision"),Fy={[Fx]:Fx},Fv=e=>{let t=Object.create(Fy);return t._tag=Fb,t},F_="ContinuationK",FS=Symbol.for("effect/ChannelContinuation"),Fw={_Env:e=>e,_InErr:e=>e,_InElem:e=>e,_InDone:e=>e,_OutErr:e=>e,_OutDone:e=>e,_OutErr2:e=>e,_OutElem:e=>e,_OutDone2:e=>e};class Fk{constructor(e,t){this._tag=F_,this[FS]=Fw,this.onSuccess=e,this.onHalt=t}onExit(e){return hr(e)?this.onHalt(e.cause):this.onSuccess(e.value)}}class FC{constructor(e){this._tag="ContinuationFinalizer",this[FS]=Fw,this.finalizer=e}}let FO="PullAfterNext",FE={[Symbol.for("effect/ChannelUpstreamPullStrategy")]:{_A:e=>e}},FI=e=>{let t=Object.create(FE);return t._tag=FO,t.emitSeparator=e,t},FF="BracketOut",FR="Bridge",FT="ConcatAll",FN="Emit",FA="Ensuring",Fj="Fail",FM="Fold",Fz="FromEffect",FP="PipeTo",FD="Provide",FL="Read",F$="Succeed",FU="SucceedNow",Fq="Suspend",FB=Symbol.for("effect/Channel"),FJ={[FB]:{_Env:e=>e,_InErr:e=>e,_InElem:e=>e,_InDone:e=>e,_OutErr:e=>e,_OutElem:e=>e,_OutDone:e=>e},pipe(){return eX(this,arguments)}},FH=e=>en(e,FB)||l3(e),FK=M(2,(e,t)=>{let r=Object.create(FJ);return r._tag=FF,r.acquire=()=>e,r.finalizer=t,r}),FV=M(2,(e,t)=>{let r=Object.create(FJ);return r._tag=FM,r.channel=e,r.k=new Fk(Re,t),r}),FW=e=>Rr(()=>{let t=[];return F3(F6(e,FG(t)),e=>Ri(()=>[ih(t),e]))}),FG=e=>F7({onInput:t=>F3(Ri(()=>{e.push(t)}),()=>FG(e)),onFailure:F0,onDone:Rt}),FY=(e,t,r)=>{let i=Object.create(FJ);return i._tag=FT,i.combineInners=t,i.combineAll=r,i.onPull=()=>FI(tK()),i.onEmit=()=>Fv,i.value=()=>e,i.k=z,i},FQ=M(4,(e,t,r,i)=>{let n=Object.create(FJ);return n._tag=FT,n.combineInners=r,n.combineAll=i,n.onPull=()=>FI(tK()),n.onEmit=()=>Fv,n.value=()=>e,n.k=t,n}),FZ=M(2,(e,t)=>{let r=Object.create(FJ);return r._tag=FR,r.input=t,r.channel=e,r}),FX=M(2,(e,t)=>{let r=Object.create(FJ);return r._tag=FA,r.channel=e,r.finalizer=t,r}),F0=e=>F1(nQ(e)),F1=e=>F2(()=>e),F2=e=>{let t=Object.create(FJ);return t._tag=Fj,t.error=e,t},F3=M(2,(e,t)=>{let r=Object.create(FJ);return r._tag=FM,r.channel=e,r.k=new Fk(t,F1),r}),F5=M(2,(e,t)=>{let r=Object.create(FJ);return r._tag=FM,r.channel=e,r.k=new Fk(t.onSuccess,t.onFailure),r}),F4=e=>{let t=Object.create(FJ);return t._tag=Fz,t.effect=()=>e,t},F6=M(2,(e,t)=>{let r=Object.create(FJ);return r._tag=FP,r.left=()=>e,r.right=()=>t,r}),F8=M(2,(e,t)=>{let r=Object.create(FJ);return r._tag=FD,r.context=()=>t,r.inner=e,r}),F7=e=>F9({onInput:e.onInput,onFailure:t=>tD(st(t),{onLeft:e.onFailure,onRight:F1}),onDone:e.onDone}),F9=e=>{let t=Object.create(FJ);return t._tag=FL,t.more=e.onInput,t.done=new Fk(e.onDone,e.onFailure),t},Re=e=>Ri(()=>e),Rt=e=>{let t=Object.create(FJ);return t._tag=FU,t.terminal=e,t},Rr=e=>{let t=Object.create(FJ);return t._tag=Fq,t.channel=e,t},Ri=e=>{let t=Object.create(FJ);return t._tag=F$,t.evaluate=e,t},Rn=Rt(void 0),Rs=e=>{let t=Object.create(FJ);return t._tag=FN,t.out=e,t},Ra="Done",Ro="Emit",Rl="FromEffect",Ru="Read",Rc={[Symbol.for("effect/ChannelState")]:{_E:e=>e,_R:e=>e}},Rh=()=>{let e=Object.create(Rc);return e._tag=Ra,e},Rp=()=>{let e=Object.create(Rc);return e._tag=Ro,e},Rf=e=>{let t=Object.create(Rc);return t._tag=Rl,t.effect=e,t},Rd=(e,t,r,i)=>{let n=Object.create(Rc);return n._tag=Ru,n.upstream=e,n.onEffect=t,n.onEmit=r,n.onDone=i,n},Rm=e=>e._tag===Rl,Rg=e=>Rm(e)?e.effect:uG,Rb=e=>Rm(e)?kw(e.effect):void 0,Rx="PullFromChild",Ry="PullFromUpstream",Rv="DrainChildExecutors",R_="Emit";class RS{constructor(e,t,r){this._tag=Rx,this.childExecutor=e,this.parentSubexecutor=t,this.onEmit=r}close(e){let t=this.childExecutor.close(e),r=this.parentSubexecutor.close(e);return void 0!==t&&void 0!==r?vO(uh(t),uh(r),(e,t)=>U(e,hy(t))):void 0!==t?t:void 0!==r?r:void 0}enqueuePullFromChild(e){return this}}class Rw{constructor(e,t,r,i,n,s,a,o){this._tag=Ry,this.upstreamExecutor=e,this.createChild=t,this.lastDone=r,this.activeChildExecutors=i,this.combineChildResults=n,this.combineWithChildResult=s,this.onPull=a,this.onEmit=o}close(e){let t=this.upstreamExecutor.close(e);return[...this.activeChildExecutors.map(t=>void 0!==t?t.childExecutor.close(e):void 0),t].reduce((e,t)=>void 0!==e&&void 0!==t?vO(e,uh(t),(e,t)=>hy(e,t)):void 0!==e?e:void 0!==t?uh(t):void 0,void 0)}enqueuePullFromChild(e){return new Rw(this.upstreamExecutor,this.createChild,this.lastDone,[...this.activeChildExecutors,e],this.combineChildResults,this.combineWithChildResult,this.onPull,this.onEmit)}}class Rk{constructor(e,t,r,i,n,s,a){this._tag=Rv,this.upstreamExecutor=e,this.lastDone=t,this.activeChildExecutors=r,this.upstreamDone=i,this.combineChildResults=n,this.combineWithChildResult=s,this.onPull=a}close(e){let t=this.upstreamExecutor.close(e);return[...this.activeChildExecutors.map(t=>void 0!==t?t.childExecutor.close(e):void 0),t].reduce((e,t)=>void 0!==e&&void 0!==t?vO(e,uh(t),(e,t)=>hy(e,t)):void 0!==e?e:void 0!==t?uh(t):void 0,void 0)}enqueuePullFromChild(e){return new Rk(this.upstreamExecutor,this.lastDone,[...this.activeChildExecutors,e],this.upstreamDone,this.combineChildResults,this.combineWithChildResult,this.onPull)}}class RC{constructor(e,t){this._tag=R_,this.value=e,this.next=t}close(e){return this.next.close(e)}enqueuePullFromChild(e){return this}}let RO={[Symbol.for("effect/ChannelUpstreamPullRequest")]:{_A:e=>e}},RE=e=>{let t=Object.create(RO);return t._tag="Pulled",t.value=e,t},RI=e=>{let t=Object.create(RO);return t._tag="NoUpstream",t.activeDownstreamCount=e,t};class RF{constructor(e,t,r){this._activeSubexecutor=void 0,this._cancelled=void 0,this._closeLastSubstream=void 0,this._done=void 0,this._doneStack=[],this._emitted=void 0,this._input=void 0,this._inProgressFinalizer=void 0,this._currentChannel=e,this._executeCloseLastSubstream=r,this._providedEnv=t}run(){let e;for(;void 0===e;)if(void 0!==this._cancelled)e=this.processCancellation();else if(void 0!==this._activeSubexecutor)e=this.runSubexecutor();else try{if(void 0===this._currentChannel)e=Rh();else switch(l3(this._currentChannel)&&(this._currentChannel=F4(this._currentChannel)),this._currentChannel._tag){case FF:e=this.runBracketOut(this._currentChannel);break;case FR:{let t=this._currentChannel.input;if(this._currentChannel=this._currentChannel.channel,void 0!==this._input){let r=this._input;this._input=void 0;let i=()=>ux(t.awaitRead(),()=>uq(()=>{let e=r.run();switch(e._tag){case Ra:return hd(r.getDone(),{onFailure:e=>t.error(e),onSuccess:e=>t.done(e)});case Ro:return ux(t.emit(r.getEmit()),()=>i());case Rl:return uw(e.effect,{onFailure:e=>t.error(e),onSuccess:()=>i()});case Ru:return RN(e,()=>i(),e=>t.error(e))}}));e=Rf(ux(vh(uR(i())),e=>uB(()=>this.addFinalizer(t=>ux(u6(e),()=>uq(()=>{let e=this.restorePipe(t,r);return void 0!==e?e:uG}))))))}break}case FT:{let e=new RF(this._currentChannel.value(),this._providedEnv,e=>uB(()=>{let t=void 0===this._closeLastSubstream?uG:this._closeLastSubstream;this._closeLastSubstream=U(t,vC(e))}));e._input=this._input;let t=this._currentChannel;this._activeSubexecutor=new Rw(e,e=>t.k(e),void 0,[],(e,r)=>t.combineInners(e,r),(e,r)=>t.combineAll(e,r),e=>t.onPull(e),e=>t.onEmit(e)),this._closeLastSubstream=void 0,this._currentChannel=void 0;break}case FN:this._emitted=this._currentChannel.out,this._currentChannel=void 0!==this._activeSubexecutor?void 0:Rn,e=Rp();break;case FA:this.runEnsuring(this._currentChannel);break;case Fj:e=this.doneHalt(this._currentChannel.error());break;case FM:this._doneStack.push(this._currentChannel.k),this._currentChannel=this._currentChannel.channel;break;case Fz:{let t=void 0===this._providedEnv?this._currentChannel.effect():U(this._currentChannel.effect(),wq(this._providedEnv));e=Rf(uw(t,{onFailure:e=>{let t=this.doneHalt(e);return void 0!==t&&Rm(t)?t.effect:uG},onSuccess:e=>{let t=this.doneSucceed(e);return void 0!==t&&Rm(t)?t.effect:uG}}));break}case FP:{let e=this._input,t=new RF(this._currentChannel.left(),this._providedEnv,e=>this._executeCloseLastSubstream(e));t._input=e,this._input=t,this.addFinalizer(t=>{let r=this.restorePipe(t,e);return void 0!==r?r:uG}),this._currentChannel=this._currentChannel.right();break}case FD:{let e=this._providedEnv;this._providedEnv=this._currentChannel.context(),this._currentChannel=this._currentChannel.inner,this.addFinalizer(()=>uB(()=>{this._providedEnv=e}));break}case FL:{let t=this._currentChannel;e=Rd(this._input,z,e=>{try{this._currentChannel=t.more(e)}catch(e){this._currentChannel=t.done.onExit(ho(e))}},e=>{let r=e=>t.done.onExit(e);this._currentChannel=r(e)});break}case F$:e=this.doneSucceed(this._currentChannel.evaluate());break;case FU:e=this.doneSucceed(this._currentChannel.terminal);break;case Fq:this._currentChannel=this._currentChannel.channel();break;default:this._currentChannel._tag}}catch(e){this._currentChannel=F1(nZ(e))}return e}getDone(){return this._done}getEmit(){return this._emitted}cancelWith(e){this._cancelled=e}clearInProgressFinalizer(){this._inProgressFinalizer=void 0}storeInProgressFinalizer(e){this._inProgressFinalizer=e}popAllFinalizers(e){let t=[],r=this._doneStack.pop();for(;r;)"ContinuationFinalizer"===r._tag&&t.push(r.finalizer),r=this._doneStack.pop();let i=0===t.length?uG:RT(t,e);return this.storeInProgressFinalizer(i),i}popNextFinalizers(){let e=[];for(;0!==this._doneStack.length;){let t=this._doneStack[this._doneStack.length-1];if(t._tag===F_)break;e.push(t),this._doneStack.pop()}return e}restorePipe(e,t){let r=this._input;return(this._input=t,void 0!==r)?r.close(e):uG}close(e){let t,r;let i=this._inProgressFinalizer;void 0!==i&&(t=U(i,vB(uB(()=>this.clearInProgressFinalizer()))));let n=this.popAllFinalizers(e);void 0!==n&&(r=U(n,vB(uB(()=>this.clearInProgressFinalizer()))));let s=void 0===this._activeSubexecutor?void 0:this._activeSubexecutor.close(e);if(void 0!==s||void 0!==t||void 0!==r)return U(uh(RR(s)),vw(uh(RR(t))),vw(uh(RR(r))),uN(([[e,t],r])=>U(e,hy(t),hy(r))),uV,ux(e=>uq(()=>e)))}doneSucceed(e){if(0===this._doneStack.length)return this._done=hg(e),this._currentChannel=void 0,Rh();let t=this._doneStack[this._doneStack.length-1];if(t._tag===F_){this._doneStack.pop(),this._currentChannel=t.onSuccess(e);return}let r=this.popNextFinalizers();if(0===this._doneStack.length)return this._doneStack=r.reverse(),this._done=hg(e),this._currentChannel=void 0,Rh();let i=RT(r.map(e=>e.finalizer),hg(e));return this.storeInProgressFinalizer(i),Rf(U(i,vB(uB(()=>this.clearInProgressFinalizer())),uV,ux(()=>uB(()=>this.doneSucceed(e)))))}doneHalt(e){if(0===this._doneStack.length)return this._done=hu(e),this._currentChannel=void 0,Rh();let t=this._doneStack[this._doneStack.length-1];if(t._tag===F_){this._doneStack.pop(),this._currentChannel=t.onHalt(e);return}let r=this.popNextFinalizers();if(0===this._doneStack.length)return this._doneStack=r.reverse(),this._done=hu(e),this._currentChannel=void 0,Rh();let i=RT(r.map(e=>e.finalizer),hu(e));return this.storeInProgressFinalizer(i),Rf(U(i,vB(uB(()=>this.clearInProgressFinalizer())),uV,ux(()=>uB(()=>this.doneHalt(e)))))}processCancellation(){return this._currentChannel=void 0,this._done=this._cancelled,this._cancelled=void 0,Rh()}runBracketOut(e){return Rf(uV(uw(this.provide(e.acquire()),{onFailure:e=>uB(()=>{this._currentChannel=F1(e)}),onSuccess:t=>uB(()=>{this.addFinalizer(r=>this.provide(e.finalizer(t,r))),this._currentChannel=Rs(t)})})))}provide(e){return void 0===this._providedEnv?e:U(e,wq(this._providedEnv))}runEnsuring(e){this.addFinalizer(e.finalizer),this._currentChannel=e.channel}addFinalizer(e){this._doneStack.push(new FC(e))}runSubexecutor(){let e=this._activeSubexecutor;switch(e._tag){case Rx:return this.pullFromChild(e.childExecutor,e.parentSubexecutor,e.onEmit,e);case Ry:return this.pullFromUpstream(e);case Rv:return this.drainChildExecutors(e);case R_:return this._emitted=e.value,this._activeSubexecutor=e.next,Rp()}}replaceSubexecutor(e){this._currentChannel=void 0,this._activeSubexecutor=e}finishWithExit(e){let t=hd(e,{onFailure:e=>this.doneHalt(e),onSuccess:e=>this.doneSucceed(e)});return this._activeSubexecutor=void 0,void 0===t?uG:Rg(t)}finishSubexecutorWithCloseEffect(e,...t){this.addFinalizer(()=>U(t,vo(t=>U(uB(()=>t(e)),ux(e=>void 0!==e?e:uG)),{discard:!0})));let r=U(e,hd({onFailure:e=>this.doneHalt(e),onSuccess:e=>this.doneSucceed(e)}));return this._activeSubexecutor=void 0,r}applyUpstreamPullStrategy(e,t,r){switch(r._tag){case FO:{let i=!e||t.some(e=>void 0!==e);return[r.emitSeparator,i?[void 0,...t]:t]}case"PullAfterAllEnqueued":{let i=!e||t.some(e=>void 0!==e);return[r.emitSeparator,i?[...t,void 0]:t]}}}pullFromChild(e,t,r,i){return Rd(e,z,n=>{let s=r(n);switch(s._tag){case Fb:break;case"Close":this.finishWithDoneValue(e,t,s.value);break;case"Yield":{let e=t.enqueuePullFromChild(i);this.replaceSubexecutor(e)}}this._activeSubexecutor=new RC(n,this._activeSubexecutor)},hd({onFailure:r=>{let i=this.handleSubexecutorFailure(e,t,r);return void 0===i?void 0:Rb(i)},onSuccess:r=>{this.finishWithDoneValue(e,t,r)}}))}finishWithDoneValue(e,t,r){switch(t._tag){case Ry:{let i=new Rw(t.upstreamExecutor,t.createChild,void 0!==t.lastDone?t.combineChildResults(t.lastDone,r):r,t.activeChildExecutors,t.combineChildResults,t.combineWithChildResult,t.onPull,t.onEmit);this._closeLastSubstream=e.close(hg(r)),this.replaceSubexecutor(i);break}case Rv:{let i=new Rk(t.upstreamExecutor,void 0!==t.lastDone?t.combineChildResults(t.lastDone,r):r,t.activeChildExecutors,t.upstreamDone,t.combineChildResults,t.combineWithChildResult,t.onPull);this._closeLastSubstream=e.close(hg(r)),this.replaceSubexecutor(i)}}}handleSubexecutorFailure(e,t,r){return this.finishSubexecutorWithCloseEffect(hu(r),e=>t.close(e),t=>e.close(t))}pullFromUpstream(e){if(0===e.activeChildExecutors.length)return this.performPullFromUpstream(e);let t=e.activeChildExecutors[0],r=new Rw(e.upstreamExecutor,e.createChild,e.lastDone,e.activeChildExecutors.slice(1),e.combineChildResults,e.combineWithChildResult,e.onPull,e.onEmit);if(void 0===t)return this.performPullFromUpstream(r);this.replaceSubexecutor(new RS(t.childExecutor,r,t.onEmit))}performPullFromUpstream(e){return Rd(e.upstreamExecutor,e=>{let t=void 0===this._closeLastSubstream?uG:this._closeLastSubstream;return this._closeLastSubstream=void 0,U(this._executeCloseLastSubstream(t),vC(e))},t=>{if(void 0!==this._closeLastSubstream){let r=this._closeLastSubstream;return this._closeLastSubstream=void 0,U(this._executeCloseLastSubstream(r),uN(()=>{let r=new RF(e.createChild(t),this._providedEnv,this._executeCloseLastSubstream);r._input=this._input;let[i,n]=this.applyUpstreamPullStrategy(!1,e.activeChildExecutors,e.onPull(RE(t)));this._activeSubexecutor=new RS(r,new Rw(e.upstreamExecutor,e.createChild,e.lastDone,n,e.combineChildResults,e.combineWithChildResult,e.onPull,e.onEmit),e.onEmit),tS(i)&&(this._activeSubexecutor=new RC(i.value,this._activeSubexecutor))}))}let r=new RF(e.createChild(t),this._providedEnv,this._executeCloseLastSubstream);r._input=this._input;let[i,n]=this.applyUpstreamPullStrategy(!1,e.activeChildExecutors,e.onPull(RE(t)));this._activeSubexecutor=new RS(r,new Rw(e.upstreamExecutor,e.createChild,e.lastDone,n,e.combineChildResults,e.combineWithChildResult,e.onPull,e.onEmit),e.onEmit),tS(i)&&(this._activeSubexecutor=new RC(i.value,this._activeSubexecutor))},t=>{if(e.activeChildExecutors.some(e=>void 0!==e)){let t=new Rk(e.upstreamExecutor,e.lastDone,[void 0,...e.activeChildExecutors],e.upstreamExecutor.getDone(),e.combineChildResults,e.combineWithChildResult,e.onPull);if(void 0!==this._closeLastSubstream){let e=this._closeLastSubstream;return this._closeLastSubstream=void 0,U(this._executeCloseLastSubstream(e),uN(()=>this.replaceSubexecutor(t)))}return void this.replaceSubexecutor(t)}let r=this._closeLastSubstream,i=this.finishSubexecutorWithCloseEffect(U(t,hf(t=>e.combineWithChildResult(e.lastDone,t))),()=>r,t=>e.upstreamExecutor.close(t));return void 0===i?void 0:Rb(i)})}drainChildExecutors(e){if(0===e.activeChildExecutors.length){let t=this._closeLastSubstream;return void 0!==t&&this.addFinalizer(()=>uU(t)),this.finishSubexecutorWithCloseEffect(e.upstreamDone,()=>t,t=>e.upstreamExecutor.close(t))}let t=e.activeChildExecutors[0],r=e.activeChildExecutors.slice(1);if(void 0===t){let[t,i]=this.applyUpstreamPullStrategy(!0,r,e.onPull(RI(r.reduce((e,t)=>void 0!==t?e+1:e,0))));return(this.replaceSubexecutor(new Rk(e.upstreamExecutor,e.lastDone,i,e.upstreamDone,e.combineChildResults,e.combineWithChildResult,e.onPull)),tS(t))?(this._emitted=t.value,Rp()):void 0}let i=new Rk(e.upstreamExecutor,e.lastDone,r,e.upstreamDone,e.combineChildResults,e.combineWithChildResult,e.onPull);this.replaceSubexecutor(new RS(t.childExecutor,i,t.onEmit))}}let RR=e=>void 0!==e?e:uG,RT=(e,t)=>U(vo(e,e=>uh(e(t))),uN(e=>U(ha(e),tW(()=>hb))),ux(e=>uq(()=>e))),RN=(e,t,r)=>{let i=[e],n=()=>{let e=i.pop();if(void 0===e||void 0===e.upstream)return uu("Unexpected end of input for channel execution");let s=e.upstream.run();switch(s._tag){case Ro:{let s=e.onEmit(e.upstream.getEmit());if(0===i.length){if(void 0===s)return uq(t);return U(s,uw({onFailure:r,onSuccess:t}))}if(void 0===s)return uq(()=>n());return U(s,uw({onFailure:r,onSuccess:()=>n()}))}case Ra:{let s=e.onDone(e.upstream.getDone());if(0===i.length){if(void 0===s)return uq(t);return U(s,uw({onFailure:r,onSuccess:t}))}if(void 0===s)return uq(()=>n());return U(s,uw({onFailure:r,onSuccess:()=>n()}))}case Rl:return i.push(e),U(e.onEffect(s.effect),ur(t=>uq(()=>{let r=e.onDone(hu(t));return void 0===r?uG:r})),uw({onFailure:r,onSuccess:()=>n()}));case Ru:return i.push(e),i.push(s),uq(()=>n())}};return n()},RA=M(2,(e,t)=>{let r=(t,r,i)=>l4(uB(()=>new RF(e,void 0,z)),e=>uq(()=>Rj(e.run(),e).pipe(uT(t),vC(hC(t)),vk(hC(r)))),(e,t)=>{let r=e.close(t);return void 0===r?uG:gK(r,e=>cJ(i,ud(e)))});return uW(e=>va([cV(t,fS),hw(),hw()]).pipe(ux(([i,n,s])=>e(r(n,s,i)).pipe(SR(t),ux(r=>t.addFinalizer(()=>fm(n).pipe(ux(e=>e?hR(s,void 0).pipe(vC(bh(r)),vC(SH(r))):hR(s,void 0).pipe(vC(u6(r)),vC(SH(r)))))).pipe(vC(e(hC(n)))))))))}),Rj=(e,t)=>{switch(e._tag){case Rl:return U(e.effect,ux(()=>Rj(t.run(),t)));case Ro:return Rj(t.run(),t);case Ra:return uq(()=>t.getDone());case Ru:return RN(e,()=>Rj(t.run(),t),ud)}},RM="Done",Rz={[Symbol.for("effect/ChannelMergeDecision")]:{_R:e=>e,_E0:e=>e,_Z0:e=>e,_E:e=>e,_Z:e=>e}},RP=e=>{let t=Object.create(Rz);return t._tag=RM,t.effect=e,t},RD=e=>{let t=Object.create(Rz);return t._tag="Await",t.f=e,t},RL="BothRunning",R$="LeftDone",RU="RightDone",Rq=Symbol.for("effect/ChannelMergeState"),RB={[Rq]:Rq},RJ=(e,t)=>{let r=Object.create(RB);return r._tag=RL,r.left=e,r.right=t,r},RH=e=>{let t=Object.create(RB);return t._tag=R$,t.f=e,t},RK=e=>{let t=Object.create(RB);return t._tag=RU,t.f=e,t},RV="BackPressure",RW="BufferSliding",RG=Symbol.for("effect/ChannelMergeStrategy"),RY={[RG]:RG},RQ=e=>{let t=Object.create(RY);return t._tag=RV,t},RZ=e=>{let t=Object.create(RY);return t._tag=RW,t},RX=M(2,(e,{onBackPressure:t,onBufferSliding:r})=>{switch(e._tag){case RV:return t();case RW:return r()}}),R0="Empty",R1="Emit",R2="Error",R3="Done",R5=e=>({_tag:R0,notifyProducer:e}),R4=e=>({_tag:R1,notifyConsumers:e}),R6=e=>({_tag:R2,cause:e}),R8=e=>({_tag:R3,done:e});class R7{constructor(e){this.ref=e}awaitRead(){return u_(mz(this.ref,e=>e._tag===R0?[hC(e.notifyProducer),e]:[uG,e]))}get close(){return ub(e=>this.error(nX(e)))}done(e){return u_(mz(this.ref,t=>{switch(t._tag){case R0:return[hC(t.notifyProducer),t];case R1:return[vo(t.notifyConsumers,t=>hR(t,tN(e)),{discard:!0}),R8(e)];case R2:case R3:return[uI,t]}}))}emit(e){return ux(hw(),t=>u_(mz(this.ref,r=>{switch(r._tag){case R0:return[hC(r.notifyProducer),r];case R1:{let i=r.notifyConsumers[0],n=r.notifyConsumers.slice(1);if(void 0!==i)return[hR(i,tA(e)),0===n.length?R5(t):R4(n)];throw Error("Bug: Channel.SingleProducerAsyncInput.emit - Queue was empty! please report an issue at https://github.com/Effect-TS/effect/issues")}case R2:case R3:return[uI,r]}})))}error(e){return u_(mz(this.ref,t=>{switch(t._tag){case R0:return[hC(t.notifyProducer),t];case R1:return[vo(t.notifyConsumers,t=>hI(t,e),{discard:!0}),R6(e)];case R2:case R3:return[uI,t]}}))}get take(){return this.takeWith(e=>hu(so(e,tN)),e=>hg(e),e=>hl(tA(e)))}takeWith(e,t,r){return ux(hw(),i=>u_(mz(this.ref,n=>{switch(n._tag){case R0:return[vC(hR(n.notifyProducer,void 0),uS(hC(i),{onFailure:e,onSuccess:tD({onLeft:r,onRight:t})})),R4([i])];case R1:return[uS(hC(i),{onFailure:e,onSuccess:tD({onLeft:r,onRight:t})}),R4([...n.notifyConsumers,i])];case R2:return[uU(e(n.cause)),n];case R3:return[uU(r(n.done)),n]}})))}}let R9=()=>U(hw(),ux(e=>mN(R5(e))),uN(e=>new R7(e))),Te=M(2,(e,t)=>Tg(e,()=>t)),Tt=M(2,(e,t)=>FV(e,e=>tD(st(e),{onLeft:t,onRight:F1}))),Tr=M(2,(e,t)=>FQ(e,t,()=>void 0,()=>void 0)),Ti=e=>F7({onInput:t=>F3(Ri(()=>{e.push(t)}),()=>Ti(e)),onFailure:F0,onDone:Re}),Tn=e=>{let t=F9({onInput:()=>t,onFailure:F1,onDone:Re});return F6(e,t)},Ts=M(2,(e,t)=>FX(e,()=>t)),Ta=()=>F4(hj()),To=e=>F3(Ta(),e),Tl=e=>F3(e,z),Tu=M(2,(e,t)=>F5(e,{onFailure:e=>{let r=st(e);switch(r._tag){case"Left":return t.onFailure(r.left);case"Right":return F1(r.right)}},onSuccess:t.onSuccess})),Tc=e=>T$(e.takeWith(F1,t=>F3(Rs(t),()=>Tc(e)),Re)),Th=e=>Rr(()=>Tp(e)),Tp=e=>U(F4(Ie(e)),F3(tD({onLeft:hd({onFailure:F1,onSuccess:Rt}),onRight:t=>F3(Rs(t),()=>Tp(e))}))),Tf=()=>F7({onInput:e=>F3(Rs(e),()=>Tf()),onFailure:F0,onDone:Rt}),Td=M(2,(e,t)=>TO(e,{other:F4(t),onSelfDone:e=>RP(uq(()=>e)),onOtherDone:e=>RP(uq(()=>e))})),Tm=M(2,(e,t)=>Td(e,hC(t))),Tg=M(2,(e,t)=>F3(e,e=>Ri(()=>t(e)))),Tb=M(2,(e,t)=>F3(e,e=>F4(t(e)))),Tx=M(2,(e,t)=>Ty(e,so(t))),Ty=M(2,(e,t)=>FV(e,e=>F1(t(e)))),Tv=M(2,(e,t)=>{let r=F7({onInput:e=>F3(Rs(t(e)),()=>r),onFailure:F0,onDone:Rt});return F6(e,r)}),T_=M(2,(e,t)=>{let r=F9({onInput:e=>U(F4(t(e)),F3(Rs),F3(()=>r)),onFailure:F1,onDone:Rt});return F6(e,r)}),TS=M(3,(e,t,r)=>Tq(i=>k_(function*(){let n=yield*R9(),s=Tc(n),a=yield*Ig(r);yield*cJ(i,IO(a));let o=yield*hw(),l=r===Number.POSITIVE_INFINITY?e=>z:(yield*kE(r)).withPermits,u=yield*s.pipe(F6(e),Tz(i));yield*u.pipe(uw({onFailure:e=>E7(a,ud(e)),onSuccess:tD({onLeft:e=>vC(uR(l(r)(uG)),l8(E7(a,uU(tN(e))))),onRight:e=>k_(function*(){let r=yield*hw(),n=yield*hw();yield*E7(a,uN(hC(r),tA)),yield*hR(n,void 0).pipe(vC(uW(r=>uh(r(hC(o))).pipe(SN(uh(r(t(e)))),ux(z))).pipe(gK(e=>hI(o,e)),uT(r))),l(1),SR(i)),yield*hC(n)})})}),gO,uR,SR(i));let c=T$(uS(u_(Ie(a)),{onFailure:F1,onSuccess:tD({onLeft:Rt,onRight:e=>F3(Rs(e),()=>c)})}));return FZ(c,n)}))),Tw=e=>t=>Tk(e)(t,$),Tk=({bufferSize:e=16,concurrency:t,mergeStrategy:r=RQ()})=>(i,n)=>Tq(s=>k_(function*(){let a="unbounded"===t?Number.MAX_SAFE_INTEGER:t,o=yield*R9(),l=Tc(o),u=yield*Ig(e);yield*cJ(s,IO(u));let c=yield*Iy();yield*cJ(s,IO(c));let h=yield*mN(tK()),p=yield*hw(),f=(yield*kE(a)).withPermits,d=yield*Tz(F6(l,i),s);function m(e){return e.pipe(ux(tD({onLeft:e=>uU(tk(e)),onRight:e=>l6(E7(u,uU(tA(e))),tK())})),Sg({until:e=>tS(e)}),ux(e=>mP(h,tV({onNone:()=>tk(e.value),onSome:t=>tk(n(t,e.value))}))),ur(e=>n4(e)?ud(e):E7(u,ud(e)).pipe(vC(hR(p,void 0)),l8)))}yield*d.pipe(uw({onFailure:e=>E7(u,ud(e)).pipe(vC(uU(!1))),onSuccess:tD({onLeft:e=>vL(uR(hC(p)),uR(f(a)(uG)),{onSelfDone:(e,t)=>l6(u6(t),!1),onOtherDone:(t,r)=>vC(u6(r),mA(h).pipe(ux(tV({onNone:()=>E7(u,uU(tN(e))),onSome:t=>E7(u,uU(tN(n(t,e))))})),l6(!1)))}),onRight:e=>RX(r,{onBackPressure:()=>k_(function*(){let t=yield*hw(),r=vv(t=>Tz(F6(l,e),t).pipe(ux(e=>v$(uh(m(e)),uh(uR(hC(p))))),ux(z)));return yield*hR(t,void 0).pipe(vC(r),f(1),SR(s)),yield*hC(t),!(yield*fm(p))}),onBufferSliding:()=>k_(function*(){let t=yield*hw(),r=yield*hw(),i=yield*I_(c);yield*Ie(c).pipe(ux(e=>hR(e,void 0)),gY(()=>i>=a)),yield*E7(c,t);let n=vv(r=>Tz(F6(l,e),r).pipe(ux(e=>uh(m(e)).pipe(v$(uh(uR(hC(p)))),v$(uh(uR(hC(t)))))),ux(z)));return yield*hR(r,void 0).pipe(vC(n),f(1),SR(s)),yield*hC(r),!(yield*fm(p))})})})}),Sg({while:e=>e}),SR(s));let g=U(Ie(u),u_,uS({onFailure:F1,onSuccess:tD({onLeft:Rt,onRight:e=>F3(Rs(e),()=>g)})}),T$);return FZ(g,o)})),TC=M(3,(e,t,r)=>Tw(r)(Tv(e,t))),TO=M(2,(e,t)=>Tq(function(r){return k_(function*(){let i=yield*R9(),n=Tc(i),s=yield*Tz(F6(n,e),r),a=yield*Tz(F6(n,t.other),r);function o(e,t,i){return(n,s,a)=>{function o(e){return e._tag===RM?uU(F4(vC(u6(t),e.effect))):uN(bh(t),hd({onFailure:t=>F4(e.f(hu(t))),onSuccess:tD({onLeft:t=>F4(e.f(hg(t))),onRight:t=>TW(Rs(t),l(a(e.f)))})}))}return hd(e,{onFailure:e=>o(n(hu(e))),onSuccess:tD({onLeft:e=>o(n(hg(e))),onRight:e=>uU(F3(Rs(e),()=>F3(F4(SR(uR(i),r)),e=>l(s(e,t)))))})})}}function l(e){switch(e._tag){case RL:return T$(vL(uR(bp(e.left)),uR(bp(e.right)),{onSelfDone:(r,i)=>vC(u6(i),o(r,e.right,s)(t.onSelfDone,RJ,e=>RH(e))),onOtherDone:(r,i)=>vC(u6(i),o(r,e.left,a)(t.onOtherDone,(e,t)=>RJ(t,e),e=>RK(e)))}));case R$:return T$(uN(uh(a),hd({onFailure:t=>F4(e.f(hu(t))),onSuccess:tD({onLeft:t=>F4(e.f(hg(t))),onRight:t=>F3(Rs(t),()=>l(RH(e.f)))})})));case RU:return T$(uN(uh(s),hd({onFailure:t=>F4(e.f(hu(t))),onSuccess:tD({onLeft:t=>F4(e.f(hg(t))),onRight:t=>F3(Rs(t),()=>l(RK(e.f)))})})))}}return F4(l5(e=>{let t=l5(t=>(t.transferChildren(e.scope()),uG));return vO(uR(s).pipe(vB(t),SR(r)),uR(a).pipe(vB(t),SR(r)),(e,t)=>RJ(e,t))})).pipe(F3(l),FZ(i))})})),TE=((e,t)=>Tt(e,e=>{throw t(e)}),M(2,(e,t)=>Tt(e,t))),TI=M(2,(e,t)=>Rr(()=>{let r;let i=F7({onInput:e=>F3(Rs(e),()=>i),onFailure:e=>F1(nZ(r=TY(e))),onDone:Rt}),n=F9({onInput:e=>U(Rs(e),F3(()=>n)),onFailure:e=>n3(e)&&TQ(e.defect)&&eP(e.defect,r)?F0(e.defect.error):F1(e),onDone:Rt});return F6(F6(F6(e,i),t),n)})),TF=e=>vv(t=>RA(e,t)),TR=e=>TF(Tn(e)),TT=e=>vy(t=>RA(e,t)),TN=e=>T$(uW(t=>uN(vN(),r=>FK(gK(t(vA(e,r)),e=>cK(r,hu(e))),(e,t)=>cK(r,t))))),TA=e=>TU(uN(vI,t=>F3(F4(e(t)),Rs))),Tj=e=>TD(e),TM=e=>ux(vI,t=>Tz(e,t)),Tz=M(2,(e,t)=>vw(uB(()=>new RF(e,void 0,z)),S7()).pipe(uJ(([e,r])=>cH(t,t=>{let i=e.close(t);return void 0!==i?wq(i,r):uG})),uV,uN(([e])=>uq(()=>TP(e.run(),e))))),TP=(e,t)=>{switch(e._tag){case Ra:return hd(t.getDone(),{onFailure:ud,onSuccess:e=>uU(tN(e))});case Ro:return uU(tA(t.getEmit()));case Rl:return U(e.effect,ux(()=>TP(t.run(),t)));case Ru:return RN(e,()=>TP(t.run(),t),e=>ud(e))}},TD=e=>Rr(()=>TL(e)),TL=e=>F9({onInput:t=>F3(F4(E7(e,tA(t))),()=>TL(e)),onFailure:t=>F4(U(E7(e,tN(hu(t))))),onDone:t=>F4(U(E7(e,tN(hg(t)))))}),T$=e=>Tl(F4(e)),TU=e=>FY(TN(e),(e,t)=>e,(e,t)=>e),Tq=e=>FY(TA(e),(e,t)=>e,(e,t)=>e),TB=(...e)=>TJ(ih(e)),TJ=e=>TH(0,e.length,e),TH=(e,t,r)=>e===t?Rn:U(Rs(U(r,iy(e))),F3(()=>TH(e+1,t,r))),TK=M(e=>FH(e[1]),(e,t,r)=>r?.concurrent?TO(e,{other:t,onSelfDone:e=>RD(t=>uq(()=>hx(e,t))),onOtherDone:e=>RD(t=>uq(()=>hx(t,e)))}):F3(e,e=>Tg(t,t=>[e,t]))),TV=M(e=>FH(e[1]),(e,t,r)=>r?.concurrent?Tg(TK(e,t,{concurrent:!0}),e=>e[0]):F3(e,e=>Te(t,e))),TW=M(e=>FH(e[1]),(e,t,r)=>r?.concurrent?Tg(TK(e,t,{concurrent:!0}),e=>e[1]):F3(e,()=>t)),TG=Symbol.for("effect/Channel/ChannelException"),TY=e=>({_tag:"ChannelException",[TG]:TG,error:e}),TQ=e=>en(e,TG),TZ=Symbol.for("effect/RcRef"),TX={_tag:"Empty"},T0={_A:z,_E:z};class T1 extends fx{static{h=mE}constructor(e,t,r,i){super(),this[TZ]=T0,this[h]=mE,this.state=TX,this.semaphore=SO(1),this.acquire=e,this.context=t,this.scope=r,this.idleTimeToLive=i,this.get=T2(this)}commit(){return this.get}}let T2=e=>uW(t=>uq(()=>{switch(e.state._tag){case"Closed":return uI;case"Acquired":return e.state.refCount++,e.state.fiber?l6(u6(e.state.fiber),e.state):uU(e.state);case"Empty":return vN().pipe(gw("scope"),gS("value",({scope:r})=>t(cx(e.acquire,cC,sq(e.context,vE,r)))),uN(({scope:t,value:r})=>{let i={_tag:"Acquired",value:r,scope:t,fiber:void 0,refCount:1};return e.state=i,i}))}})).pipe(e.semaphore.withPermits(1),gw("state"),gS("scope",()=>vE),uJ(({scope:t,state:r})=>t.addFinalizer(()=>uq(()=>(r.refCount--,r.refCount>0)?uG:void 0===e.idleTimeToLive?(e.state=TX,cK(r.scope,hb)):gs(e.idleTimeToLive).pipe(uR,u5(uq(()=>"Acquired"===e.state._tag&&0===e.state.refCount?(e.state=TX,cK(r.scope,hb)):uG)),vB(uB(()=>{r.fiber=void 0})),SR(e.scope),uJ(e=>{r.fiber=e}),e.semaphore.withPermits(1))))),uN(({state:e})=>e.value)),T3={_tag:"Left"},T5={_tag:"Right"},T4={_tag:"Both"},T6={_tag:"Either"},T8=e=>{switch(e){case"left":return T3;case"right":return T5;case"both":return T4;case"either":return T6;default:return e}},T7=Symbol.for("effect/Sink"),T9={_A:e=>e,_In:e=>e,_L:e=>e,_E:e=>e,_R:e=>e};class Ne{constructor(e){this[T7]=T9,this.channel=e}pipe(){return eX(this,arguments)}}let Nt=e=>en(e,T7),Nr=e=>new Ne(Rr(()=>Nw(e()))),Ni=((e,t)=>U(e,Ni(iz(t))),M(2,(e,t)=>{let r=F7({onInput:e=>U(Rs(t(e)),F3(()=>r)),onFailure:F0,onDone:Re});return new Ne(U(r,F6(Nw(e))))})),Nn=M(2,(e,t)=>{let r=F7({onInput:e=>U(F4(t(e)),F3(Rs),F3(()=>r)),onFailure:F0,onDone:Re});return new Ne(U(r,TI(Nw(e))))}),Ns=new Ne(Tn(Tf())),Na=e=>new Ne(F0(e)),No=(e,t,r)=>Nr(()=>new Ne(Nl(e,t,r))),Nl=(e,t,r)=>t(e)?F7({onInput:i=>{let[n,s]=Nu(e,i,t,r,0,i.length);return iN(s)?U(Rs(s),Te(n)):Nl(n,t,r)},onFailure:F0,onDone:()=>Rt(e)}):Rt(e),Nu=(e,t,r,i,n,s)=>{if(n===s)return[e,il()];let a=i(e,U(t,iy(n)));return r(a)?Nu(a,t,r,i,n+1,s):[a,U(t,iw(n+1))]},Nc=M(2,(e,t)=>new Ne(U(Nw(e),FW,Tu({onFailure:e=>Nw(t.onFailure(e)),onSuccess:([e,r])=>Rr(()=>{let i={ref:U(e,iE(iN))},n=U(Ri(()=>{let e=i.ref;return i.ref=il(),e}),F3(e=>TJ(e)));return F3(FW(U(n,TW(Tf()),F6(Nw(t.onSuccess(r))))),([e,t])=>U(Re(i.ref),F3(TJ),TW(TJ(e)),Te(t)))})})))),Nh=(e,t,r)=>t(e)?F7({onInput:i=>Nh(r(e,i),t,r),onFailure:F0,onDone:()=>Rt(e)}):Rt(e),Np=(e,t,r)=>Nr(()=>new Ne(Nf(e,t,r))),Nf=(e,t,r)=>t(e)?F7({onInput:i=>U(F4(Nd(e,i,t,r)),F3(([e,i])=>U(i,tV({onNone:()=>Nf(e,t,r),onSome:t=>U(Rs(t),Te(e))})))),onFailure:F0,onDone:()=>Rt(e)}):Rt(e),Nd=(e,t,r,i)=>Nm(e,t,0,t.length,r,i),Nm=(e,t,r,i,n,s)=>r===i?uU([e,tK()]):U(s(e,U(t,iy(r))),ux(e=>n(e)?Nm(e,t,r+1,i,n,s):uU([e,tk(U(t,iw(r+1)))]))),Ng=M(2,(e,t)=>Nc(e,{onFailure:Na,onSuccess:t})),Nb=e=>{let t=F9({onInput:r=>U(F4(vo(r,t=>e(t),{discard:!0})),F3(()=>t)),onFailure:F1,onDone:()=>Rn});return new Ne(t)},Nx=e=>{let t=F9({onInput:r=>U(F4(e(r)),F3(()=>t)),onFailure:F1,onDone:()=>Rn});return new Ne(t)},Ny=e=>new Ne(F4(e)),Nv=(e,t)=>t?.shutdown?Nk(uN(vt(uU(e),IO),Nv)):Nx(t=>U(E9(e,t))),N_=M(2,(e,t)=>new Ne(U(Nw(e),Tg(t)))),NS=((e,t)=>new Ne(U(Nw(e),Tb(t))),M(2,(e,t)=>NC(function(r){return k_(function*(){let i=yield*Fh(t?.capacity??16),n=yield*vA(Fg(i),r),s=yield*vA(Fg(i),r),a=Tj(i),o=Th(n).pipe(F6(Nw(e)),TV(F4(IO(n))),TO({other:Th(s).pipe(F6(Nw(t.other)),TV(F4(IO(s)))),onSelfDone:t.onSelfDone,onOtherDone:t.onOtherDone}));return new Ne(TO(a,{other:o,onSelfDone:()=>RD(z),onOtherDone:e=>RP(e)}))})}))),Nw=((e,t,r)=>new Ne(U(F4(t),F3(i=>U(e,Nw,F3(e=>U(F4(t),Tg(t=>[e,r(i,t)]))))))),e=>l3(e)?Nw(Ny(e)):e.channel),Nk=e=>new Ne(TU(e.pipe(uN(e=>Nw(e))))),NC=e=>new Ne(Tq(t=>e(t).pipe(uN(e=>Nw(e))))),NO=(e=>Nt(e[1]),M(e=>Nt(e[1]),(e,t,r,i)=>i?.concurrent?NS(e,{other:t,onSelfDone:hd({onFailure:e=>RP(ud(e)),onSuccess:e=>RD(hd({onFailure:ud,onSuccess:t=>uU(r(e,t))}))}),onOtherDone:hd({onFailure:e=>RP(ud(e)),onSuccess:e=>RD(hd({onFailure:ud,onSuccess:t=>uU(r(t,e))}))})}):Ng(e,e=>N_(t,t=>r(e,t))))),NE="WithSTMRuntime",NI="OnFailure",NF="OnRetry",NR="OnSuccess",NT="Sync",NN="Succeed",NA="Retry",Nj="Fail",NM="Interrupt",Nz="Fail",NP="Interrupt",ND="Succeed",NL="Retry",N$="Done",NU="Suspend";class Nq{constructor(e){this.value=e}}let NB=(e,t)=>({ref:e,isNew:t,isChanged:!1,expected:e.versioned,newValue:e.versioned.value}),NJ=e=>e.newValue,NH=(e,t)=>{e.isChanged=!0,e.newValue=t},NK=e=>{e.ref.versioned=new Nq(e.newValue)},NV=e=>e.ref.versioned!==e.expected,NW=e=>e.isChanged,NG="Invalid",NY="ReadWrite",NQ=e=>{for(let t of e)NK(t[1])},NZ=e=>{let t="ReadOnly";for(let[,r]of e)if((t=NV(r)?NG:NW(r)?NY:t)===NG)break;return t},NX=e=>{let t=new Map;for(let[,r]of e){for(let e of r.ref.todos)t.set(e[0],e[1]);r.ref.todos=new Map}return t},N0=e=>{for(let[t,r]of Array.from(e.entries()).sort((e,t)=>e[0]-t[0]))r()},N1=(e,t,r)=>{let i=!1;for(let[,n]of t)n.ref.todos.has(e)||(n.ref.todos.set(e,r),i=!0);return i},N2="Done",N3="Interrupted",N5="Running",N4="effect/STM/State",N6=Symbol.for(N4),N8=e=>en(e,N6),N7=e=>e._tag===N5,N9=e=>e._tag===N2,Ae=e=>({[N6]:N6,_tag:N2,exit:e,[ek](){return U(eC(N4),eE(eC(N2)),eE(eC(e)),eM(this))},[ez]:t=>N8(t)&&t._tag===N2&&eP(e,t.exit)}),At=U(eC(N4),eE(eC(N3)),eE(eC("interrupted"))),Ar={[N6]:N6,_tag:N3,[ek]:()=>At,[ez]:e=>N8(e)&&e._tag===N3},Ai=U(eC(N4),eE(eC(N5)),eE(eC("running"))),An={[N6]:N6,_tag:N5,[ek]:()=>Ai,[ez]:e=>N8(e)&&e._tag===N5},As=e=>{switch(e._tag){case Nz:return Ae(hl(e.error));case"Die":return Ae(ho(e.defect));case NP:return Ae(hp(e.fiberId));case ND:return Ae(hg(e.value));case NL:throw Error("BUG: STM.STMState.fromTExit - please report an issue at https://github.com/Effect-TS/effect/issues")}},Aa="effect/TExit",Ao=Symbol.for(Aa),Al={_A:e=>e,_E:e=>e},Au=e=>en(e,Ao),Ac=e=>e._tag===ND,Ah=e=>e._tag===NL,Ap=e=>({[Ao]:Al,_tag:Nz,error:e,[ek](){return U(eC(Aa),eE(eC(Nz)),eE(eC(e)),eM(this))},[ez]:t=>Au(t)&&t._tag===Nz&&eP(e,t.error)}),Af=e=>({[Ao]:Al,_tag:"Die",defect:e,[ek](){return U(eC(Aa),eE(eC("Die")),eE(eC(e)),eM(this))},[ez]:t=>Au(t)&&"Die"===t._tag&&eP(e,t.defect)}),Ad=e=>({[Ao]:Al,_tag:NP,fiberId:e,[ek](){return U(eC(Aa),eE(eC(NP)),eE(eC(e)),eM(this))},[ez]:t=>Au(t)&&t._tag===NP&&eP(e,t.fiberId)}),Am=e=>({[Ao]:Al,_tag:ND,value:e,[ek](){return U(eC(Aa),eE(eC(ND)),eE(eC(e)),eM(this))},[ez]:t=>Au(t)&&t._tag===ND&&eP(e,t.value)}),Ag=U(eC(Aa),eE(eC(NL)),eE(eC("retry"))),Ab={[Ao]:Al,_tag:NL,[ek]:()=>Ag,[ez]:e=>Au(e)&&Ah(e)},Ax=e=>({_tag:N$,exit:e}),Ay=e=>({_tag:NU,journal:e}),Av={ref:0},A_=()=>{let e=Av.ref+1;return Av.ref=e,e},AS=Symbol.for("effect/STM"),Aw={_R:e=>e,_E:e=>e,_A:e=>e};class Ak{get[AS](){return Aw}constructor(e){this._op=e1,this.effect_instruction_i1=void 0,this.effect_instruction_i2=void 0,this.effect_instruction_i0=e,this[lZ]=tl,this[ts]=Aw,this[T7]=Aw,this[FB]=Aw}[ez](e){return this===e}[ek](){return eM(this,eO(this))}[Symbol.iterator](){return new lK(new eb(this))}commit(){return AC(this,$,$)}pipe(){return eX(this,arguments)}}let AC=(e,t,r)=>l5(i=>{let n=i.id(),s=i.getFiberRef(cC),a=i.getFiberRef(mq),o=i.getFiberRef(cO),l=AE(n,e,s,a,o);switch(l._tag){case N$:return t(l.exit),l.exit;case NU:{let i=A_(),l={value:An},u=ut(t=>AI(n,e,i,l,s,a,o,t));return uW(e=>U(e(u),ur(e=>{let i=l.value;return(N7(i)&&(l.value=Ar),N9(i=l.value))?(t(i.exit),i.exit):(r(),ud(e))})))}}}),AO=(e,t,r,i,n,s)=>{let a=new Map,o=new AT(t,a,e,i).run(),l=NZ(a);if(l===NY)NQ(a);else if(l===NG)throw Error("BUG: STM.TryCommit.tryCommit - please report an issue at https://github.com/Effect-TS/effect/issues");switch(o._tag){case ND:return r.value=As(o),AF(hg(o.value),a,n,s);case Nz:return r.value=As(o),AF(hu(nQ(o.error)),a,n,s);case"Die":return r.value=As(o),AF(hu(nZ(o.defect)),a,n,s);case NP:return r.value=As(o),AF(hu(nX(e)),a,n,s);case NL:return Ay(a)}},AE=(e,t,r,i,n)=>{let s=new Map,a=new AT(t,s,e,r).run(),o=NZ(s);if(o===NY&&Ac(a))NQ(s);else if(o===NG)throw Error("BUG: STM.TryCommit.tryCommitSync - please report an issue at https://github.com/Effect-TS/effect/issues");switch(a._tag){case ND:return AF(hg(a.value),s,i,n);case Nz:return AF(hu(nQ(a.error)),s,i,n);case"Die":return AF(hu(nZ(a.defect)),s,i,n);case NP:return AF(hu(nX(e)),s,i,n);case NL:return Ay(s)}},AI=(e,t,r,i,n,s,a,o)=>{if(N7(i.value)){let l=AO(e,t,i,n,s,a);switch(l._tag){case N$:AR(l.exit,o);break;case NU:N1(r,l.journal,()=>AI(e,t,r,i,n,s,a,o))}}},AF=(e,t,r,i)=>{let n=NX(t);return n.size>0&&r.scheduleTask(()=>N0(n),i),Ax(e)},AR=(e,t)=>{t(e)};class AT{constructor(e,t,r,i){this.contStack=[],this.self=e,this.journal=t,this.fiberId=r,this.env=i}getEnv(){return this.env}pushStack(e){this.contStack.push(e)}popStack(){return this.contStack.pop()}nextSuccess(){let e=this.popStack();for(;void 0!==e&&e.effect_instruction_i0!==NR;)e=this.popStack();return e}nextFailure(){let e=this.popStack();for(;void 0!==e&&e.effect_instruction_i0!==NI;)e=this.popStack();return e}nextRetry(){let e=this.popStack();for(;void 0!==e&&e.effect_instruction_i0!==NF;)e=this.popStack();return e}run(){let e,t=this.self;for(;void 0===e&&void 0!==t;)try{let r=t;if(r)switch(r._op){case"Tag":t=AM((e,t,i)=>sK(i,r));break;case"Left":t=AP(r.left);break;case"None":t=AP(new c4);break;case"Right":t=AH(r.right);break;case"Some":t=AH(r.value);break;case"Commit":switch(r.effect_instruction_i0){case"Die":e=Af(ev(()=>r.effect_instruction_i1()));break;case Nj:{let i=this.nextFailure();void 0===i?e=Ap(ev(()=>r.effect_instruction_i1())):t=ev(()=>i.effect_instruction_i2(ev(()=>r.effect_instruction_i1())));break}case NA:{let r=this.nextRetry();void 0===r?e=Ab:t=ev(()=>r.effect_instruction_i2());break}case NM:e=Ad(this.fiberId);break;case NE:t=ev(()=>r.effect_instruction_i1(this));break;case NR:case NI:case NF:this.pushStack(r),t=r.effect_instruction_i1;break;case"Provide":{let e=this.env;this.env=ev(()=>r.effect_instruction_i2(e)),t=U(r.effect_instruction_i1,Az(AK(()=>this.env=e)));break}case NN:{let i=r.effect_instruction_i1,n=this.nextSuccess();void 0===n?e=Am(i):t=ev(()=>n.effect_instruction_i2(i));break}case NT:{let i=ev(()=>r.effect_instruction_i1()),n=this.nextSuccess();void 0===n?e=Am(i):t=ev(()=>n.effect_instruction_i2(i))}}}}catch(e){t=AA(e)}return e}}let AN=M(2,(e,t)=>{let r=new Ak(NI);return r.effect_instruction_i1=e,r.effect_instruction_i2=t,r}),AA=e=>Aj(()=>e),Aj=e=>{let t=new Ak("Die");return t.effect_instruction_i1=e,t},AM=e=>AU(t=>AH(e(t.journal,t.fiberId,t.getEnv()))),Az=M(2,(e,t)=>A$(e,{onFailure:e=>AV(t,AP(e)),onSuccess:e=>AV(t,AH(e))})),AP=e=>AD(()=>e),AD=e=>{let t=new Ak(Nj);return t.effect_instruction_i1=e,t},AL=M(2,(e,t)=>{let r=new Ak(NR);return r.effect_instruction_i1=e,r.effect_instruction_i2=t,r}),A$=M(2,(e,{onFailure:t,onSuccess:r})=>U(e,AB(tA),AN(e=>U(t(e),AB(tN))),AL(e=>{switch(e._tag){case"Left":return AH(e.left);case"Right":return r(e.right)}}))),AU=e=>{let t=new Ak(NE);return t.effect_instruction_i1=e,t},Aq=e=>{let t=new Ak(NM);return t.effect_instruction_i1=e,t},AB=M(2,(e,t)=>U(e,AL(e=>AK(()=>t(e))))),AJ=new Ak(NA),AH=e=>{let t=new Ak(NN);return t.effect_instruction_i1=e,t},AK=e=>{let t=new Ak(NT);return t.effect_instruction_i1=e,t},AV=M(2,(e,t)=>U(e,AL(()=>t))),AW=M(3,(e,t,r)=>U(e,AL(e=>U(t,AB(t=>r(e,t)))))),AG=((e,t)=>U(e,AB(()=>t)),e=>AL(e,z)),AY=M(e=>eu(e[0]),(e,t,r)=>r?.discard?U(AK(()=>e[Symbol.iterator]()),AL(e=>{let r=AQ(()=>{let i=e.next();return i.done?AZ:U(t(i.value),AL(()=>r))});return r})):AQ(()=>rd(e).reduce((e,r)=>AW(e,t(r),(e,t)=>(e.push(t),e)),AH([])))),AQ=e=>AG(AK(e)),AZ=AH(void 0),AX=Symbol.for("effect/TRef"),A0={_A:e=>e};class A1{constructor(e){this[AX]=A0,this.versioned=new Nq(e),this.todos=new Map}modify(e){return AM(t=>{let r=A2(this,t),[i,n]=e(NJ(r));return NH(r,n),i})}pipe(){return eX(this,arguments)}}let A2=(e,t)=>{if(t.has(e))return t.get(e);let r=NB(e,!1);return t.set(e,r),r},A3=M(2,(e,t)=>NJ(A2(e,t))),A5=M(3,(e,t,r)=>{NH(A2(e,r),t)}),A4=Symbol.for("effect/TQueue/TEnqueue"),A6=Symbol.for("effect/TQueue/TDequeue"),A8={_Out:e=>e},A7={_In:e=>e},A9=((e,t,r)=>AQ(()=>{let i=(t,r,n)=>r<t?AH(n):U(e.takeUpTo(r),AL(s=>{let a=t-s.length;return 1===a?U(e.take,AB(e=>U(n,iC(ib(s)),iv(e)))):a>1?U(e.take,AL(e=>i(a-1,r-s.length-1,U(n,iC(ib(s)),iv(e))))):AH(U(n,iC(ib(s))))}));return AB(i(t,r,il()),e=>Array.from(e))}),Symbol.for("effect/TPubSub")),je=Symbol.for("effect/TPubSub/AbsentValue"),jt=(e,t,r)=>({head:e,subscribers:t,tail:r});class jr{static{p=A4}constructor(e,t,r,i,n,s,a){this[A9]={_A:e=>e},this[p]=A7,this.isShutdown=AM(e=>void 0===A3(this.publisherTail,e)),this.awaitShutdown=AL(this.isShutdown,e=>e?AZ:AJ),this.size=AU(e=>void 0===A3(this.publisherTail,e.journal)?Aq(e.fiberId):AH(A3(this.pubsubSize,e.journal))),this.isEmpty=AB(this.size,e=>0===e),this.isFull=AB(this.size,e=>e===this.capacity()),this.shutdown=AM(e=>{void 0!==A3(this.publisherTail,e)&&(A5(this.publisherTail,void 0,e),nP(A3(this.subscribers,e),t=>{A5(t,void 0,e)}),A5(this.subscribers,nO(),e))}),this.pubsubSize=e,this.publisherHead=t,this.publisherTail=r,this.requestedCapacity=i,this.strategy=n,this.subscriberCount=s,this.subscribers=a}capacity(){return this.requestedCapacity}offer(e){return AU(t=>{let r=A3(this.publisherTail,t.journal);if(void 0===r)return Aq(t.fiberId);let i=A3(this.subscriberCount,t.journal);if(0===i)return AH(!0);let n=A3(this.pubsubSize,t.journal);if(n<this.requestedCapacity){let s=new A1(void 0);return A5(r,jt(e,i,s),t.journal),A5(this.publisherTail,s,t.journal),A5(this.pubsubSize,n+1,t.journal),AH(!0)}switch(this.strategy._tag){case"BackPressure":return AJ;case"Dropping":return AH(!1);case"Sliding":{if(this.requestedCapacity>0){let e=A3(this.publisherHead,t.journal),r=!0;for(;r;){let i=A3(e,t.journal);if(void 0===i)return AJ;let n=i.head,s=i.tail;n!==je?(A5(e,jt(je,i.subscribers,i.tail),t.journal),A5(this.publisherHead,s,t.journal),r=!1):e=s}}let n=new A1(void 0);return A5(r,jt(e,i,n),t.journal),A5(this.publisherTail,n,t.journal),AH(!0)}}})}offerAll(e){return AB(AY(e,e=>this.offer(e)),r5(z))}}class ji{static{f=A6}constructor(e,t,r,i,n,s){this[A9]=A9,this[f]=A8,this.isShutdown=AM(e=>void 0===A3(this.subscriberHead,e)),this.awaitShutdown=AL(this.isShutdown,e=>e?AZ:AJ),this.size=AU(e=>{let t=A3(this.subscriberHead,e.journal);if(void 0===t)return Aq(e.fiberId);let r=!0,i=0;for(;r;){let n=A3(t,e.journal);void 0===n?r=!1:(n.head!==je&&(i+=1)>=Number.MAX_SAFE_INTEGER&&(r=!1),t=n.tail)}return AH(i)}),this.isEmpty=AB(this.size,e=>0===e),this.isFull=AB(this.size,e=>e===this.capacity()),this.peek=AU(e=>{let t=A3(this.subscriberHead,e.journal);if(void 0===t)return Aq(e.fiberId);let r=je,i=!0;for(;i;){let n=A3(t,e.journal);if(void 0===n)return AJ;let s=n.head,a=n.tail;s!==je?(r=s,i=!1):t=a}return AH(r)}),this.peekOption=AU(e=>{let t=A3(this.subscriberHead,e.journal);if(void 0===t)return Aq(e.fiberId);let r=tK(),i=!0;for(;i;){let n=A3(t,e.journal);if(void 0===n)r=tK(),i=!1;else{let e=n.head,s=n.tail;e!==je?(r=tk(e),i=!1):t=s}}return AH(r)}),this.shutdown=AM(e=>{let t=A3(this.subscriberHead,e);if(void 0!==t){A5(this.subscriberHead,void 0,e);let r=!0;for(;r;){let i=A3(t,e);if(void 0===i)r=!1;else{let r=i.head,n=i.tail;if(r!==je){let s=i.subscribers;if(1===s){let r=A3(this.pubsubSize,e);A5(t,jt(je,0,n),e),A5(this.publisherHead,n,e),A5(this.pubsubSize,r-1,e)}else A5(t,jt(r,s-1,n),e)}t=n}}let i=A3(this.subscriberCount,e);A5(this.subscriberCount,i-1,e),A5(this.subscribers,nj(A3(this.subscribers,e),this.subscriberHead),e)}}),this.take=AU(e=>{let t=A3(this.subscriberHead,e.journal);if(void 0===t)return Aq(e.fiberId);let r=je,i=!0;for(;i;){let n=A3(t,e.journal);if(void 0===n)return AJ;let s=n.head,a=n.tail;if(s!==je){let o=n.subscribers;if(1===o){let r=A3(this.pubsubSize,e.journal);A5(t,jt(je,0,a),e.journal),A5(this.publisherHead,a,e.journal),A5(this.pubsubSize,r-1,e.journal)}else A5(t,jt(s,o-1,a),e.journal);A5(this.subscriberHead,a,e.journal),r=s,i=!1}else t=a}return AH(r)}),this.takeAll=this.takeUpTo(Number.POSITIVE_INFINITY),this.pubsubSize=e,this.publisherHead=t,this.requestedCapacity=r,this.subscriberHead=i,this.subscriberCount=n,this.subscribers=s}capacity(){return this.requestedCapacity}takeUpTo(e){return AU(t=>{let r=A3(this.subscriberHead,t.journal);if(void 0===r)return Aq(t.fiberId);let i=[],n=0;for(;n!==e;){let s=A3(r,t.journal);if(void 0===s)n=e;else{let e=s.head,a=s.tail;if(e!==je){let o=s.subscribers;if(1===o){let e=A3(this.pubsubSize,t.journal);A5(r,jt(je,0,a),t.journal),A5(this.publisherHead,a,t.journal),A5(this.pubsubSize,e-1,t.journal)}else A5(r,jt(e,o-1,a),t.journal);i.push(e),n+=1}r=a}}return A5(this.subscriberHead,r,t.journal),AH(i)})}}class jn{constructor(e){this.size=0,this.current=0,this.capacity=e,this.array=Array.from({length:e},$)}head(){return tQ(this.array[this.current])}lastOrNull(){if(0===this.size)return;let e=0===this.current?this.array.length-1:this.current-1;return this.array[e]??void 0}put(e){this.array[this.current]=e,this.increment()}dropLast(){this.size>0&&(this.decrement(),this.array[this.current]=void 0)}toChunk(){let e=this.current-this.size;return ih(e<0?[...this.array.slice(this.capacity+e,this.capacity),...this.array.slice(0,this.current)]:this.array.slice(e,this.current))}increment(){this.size<this.capacity&&(this.size+=1),this.current=(this.current+1)%this.capacity}decrement(){this.size-=1,this.current>0?this.current-=1:this.current=this.capacity-1}}let js=Symbol.for("effect/Stream/Handoff"),ja="Empty",jo="Full",jl=e=>({_tag:ja,notifyConsumer:e}),ju=(e,t)=>({_tag:jo,value:e,notifyProducer:t}),jc=(e,t)=>r=>{switch(r._tag){case ja:return e(r.notifyConsumer);case jo:return t(r.value,r.notifyProducer)}},jh={_A:e=>e},jp=()=>U(hw(),ux(e=>mN(jl(e))),uN(e=>({[js]:jh,ref:e}))),jf=M(2,(e,t)=>ux(hw(),r=>u_(mz(e.ref,i=>U(i,jc(e=>[vC(hR(e,void 0),hC(r)),ju(t,r)],(r,n)=>[ux(hC(n),()=>U(e,jf(t))),i])))))),jd=e=>ux(hw(),t=>u_(mz(e.ref,r=>U(r,jc(t=>[ux(hC(t),()=>jd(e)),r],(e,r)=>[l6(hR(r,void 0),e),jl(t)]))))),jm="Emit",jg="Halt",jb=e=>({_tag:jm,elements:e}),jx=e=>({_tag:jg,cause:e}),jy=e=>({_tag:"End",reason:e}),jv=()=>up(tK()),j_=e=>uj(ud(e),tk),jS="ScheduleEnd",jw="UpstreamEnd",jk={_tag:jS},jC={_tag:jw},jO="DrainLeft",jE="DrainRight",jI="PullBoth",jF="PullLeft",jR="PullRight",jT={_tag:jO},jN={_tag:jE},jA={_tag:jI},jj=e=>({_tag:jF,rightChunk:e}),jM=e=>({_tag:jR,leftChunk:e}),jz="PullBoth",jP="PullLet",jD="PullRight",jL={_tag:jz},j$=e=>({_tag:jP,rightChunk:e}),jU=e=>({_tag:jD,leftChunk:e}),jq=Symbol.for("effect/Take"),jB={_A:e=>e,_E:e=>e};class jJ{constructor(e){this[jq]=jB,this.exit=e}pipe(){return eX(this,arguments)}}let jH=e=>new jJ(hg(e)),jK=e=>uq(()=>e.exit),jV=new jJ(hl(tK())),jW=e=>new jJ(hu(U(e,so(tk)))),jG=M(2,(e,{onEnd:t,onFailure:r,onSuccess:i})=>hd(e.exit,{onFailure:e=>tV(vK(e),{onNone:t,onSome:r}),onSuccess:i})),jY=e=>new jJ(hg(ic(e))),jQ=Symbol.for("effect/Stream"),jZ={_R:e=>e,_E:e=>e,_A:e=>e};class jX{constructor(e){this[jQ]=jZ,this.channel=e}pipe(){return eX(this,arguments)}}let j0=e=>en(e,jQ)||l3(e),j1=4096,j2=((e,t,r)=>Mh(j2(e,t,r),e=>tD(e,{onLeft:tK,onRight:tk})),M(3,(e,t,r)=>MS(va([jp(),mN(jk),mN(il()),_8(r),mN(!1),mN(!1)])).pipe(Mp(([r,i,n,s,a,o])=>{let l=F9({onInput:e=>F3(F4(U(r,jf(jb(e)),gY(()=>iN(e)))),()=>l),onFailure:e=>F4(jf(r,jx(e))),onDone:()=>F4(jf(r,jy(jC)))}),u=U(mM(n,il()),ux(e=>iN(e)?U(mj(a,!0),vC(uU(U(Rs(e),F3(()=>u))))):U(jd(r),uN(e=>{switch(e._tag){case jm:return U(F4(mj(a,!0)),TW(Rs(e.elements)),TW(F4(mA(o))),F3(e=>e?Rn:u));case jg:return F1(e.cause);case"End":if(e.reason._tag===jS)return U(mA(a),uN(e=>e?F4(U(mj(i,jk),vC(mj(o,!0)))):U(F4(U(mj(i,jk),vC(mj(o,!0)))),F3(()=>u))),T$);return U(mj(i,e.reason),vC(mj(o,!0)),F4)}}))),T$),c=e=>s.next(e),h=(e,s,l)=>{let p=U(mj(a,!1),vC(mj(o,!1)),vC(U(u,TI(Nw(t)),FW,TF,SR(l)))),f=(e,t,r)=>U(mj(n,iR(e)),vC(uN(mA(i),e=>{switch(e._tag){case jS:return U(va([mA(a),p,U(c(tk(t)),SR(l))]),uN(([e,i,n])=>{let s=U(r,tV({onNone:()=>ic(tA(t)),onSome:e=>iu(tA(t),tN(e))}));return e?U(Rs(s),F3(()=>h(i,n,l))):h(i,n,l)}),T$);case jw:return U(mA(a),uN(e=>e?Rs(ic(tA(t))):Rn),T$)}})),T$);return T$(vL(bp(e),bp(s),{onSelfDone:(e,t)=>U(u6(s),vC(U(uq(()=>e),uN(([e,t])=>f(e,t,tK()))))),onOtherDone:(t,i)=>uw(uq(()=>t),{onFailure:t=>tD(st(t),{onLeft:()=>U(r,jf(jy(jk)),vh,vC(U(bp(e),uN(([e,t])=>f(e,t,tK()))))),onRight:t=>U(r,jf(jx(t)),vh,vC(U(bp(e),uN(([e,t])=>f(e,t,tK())))))}),onSuccess:t=>U(r,jf(jy(jk)),vh,vC(U(bp(e),uN(([e,r])=>f(e,r,tk(t))))))})}))};return zi(r=>F6(Mv(e),l).pipe(TF,SR(r),vC(TI(u,Nw(t)).pipe(FW,TF,SR(r),ux(e=>c(tK()).pipe(SR(r),uN(t=>new jX(h(e,t,r)))))))))})))),j3=M(2,(e,t)=>j5(e,e=>tD(st(e),{onLeft:t,onRight:Mc}))),j5=M(2,(e,t)=>new jX(U(Mv(e),FV(e=>Mv(t(e)))))),j4=M(2,(e,t)=>U(e,j5(e=>U(t(e),tW(()=>Mc(e)))))),j6=e=>ui(gm(e),e=>"None"===e._tag?gq:up(e.value)),j8=M(4,(e,t,r,i)=>{let n=(e,t)=>TW(F4(jd(t)),F9({onInput:r=>F3(F4(U(e,jf(jH(r)))),()=>n(e,t)),onFailure:t=>F4(jf(e,jW(t))),onDone:()=>F4(jf(e,jV))}));return new jX(Tq(s=>va([jp(),jp(),jp(),jp()]).pipe(uJ(([t,r,i])=>F6(Mv(e),n(t,i)).pipe(RA(s),SR(s))),uJ(([e,r,i,a])=>F6(Mv(t),n(r,a)).pipe(RA(s),SR(s))),uN(([e,t,n,s])=>{let a=jf(n,void 0).pipe(vC(jd(e).pipe(ux(jK)))),o=jf(s,void 0).pipe(vC(jd(t).pipe(ux(jK))));return Mv(ze(r,e=>ux(i(e,a,o),j6)))}))))}),j7=M(2,(e,t)=>new jX(U(Mv(e),TW(Mv(t))))),j9=((e,t)=>Mp(e,()=>t),e=>MS(ul(e))),Me=M(2,(e,t)=>U(hw(),ux(r=>U(e,Mi({maximumLag:t.maximumLag,decide:e=>ux(hC(r),t=>t(e))}),ux(e=>U(va(iz(iJ(0,t.size-1),t=>uN(e,([e,r])=>[[e,t],r]))),uN(ib),ux(e=>{let[i,n]=r3(e,[new Map,il()],([e,t],[r,i])=>[e.set(r[0],r[1]),U(t,i_(i))]);return U(hR(r,e=>uN(t.decide(e),e=>t=>U(e(i.get(t))))),l6(Array.from(n)))}))))))),Mt={ref:0},Mr=()=>{let e=Mt.ref;return Mt.ref=e+1,e},Mi=M(2,(e,t)=>Mn(e,t.maximumLag,t.decide,()=>uG)),Mn=M(4,(e,t,r,i)=>U(vt(mN(new Map),(e,t)=>U(mA(e),ux(e=>U(e.values(),vo(IO))))),ux(n=>k_(function*(s){let a=yield*s(kE(1)),o=yield*s(mN(U(Ig(t),ux(e=>{let t=Mr();return U(mP(n,r=>r.set(t,e)),l6([t,e]))})))),l=e=>a.withPermits(1)(U(mj(o,U(Ig(1),uJ(t=>E7(t,e)),ux(e=>{let t=Mr();return U(mP(n,r=>r.set(t,e)),l6(rc(t,e)))}))),vC(U(mA(n),ux(t=>U(ih(t.values()),vo(t=>U(E7(t,e),gb(e=>n4(e)?tk(uG):tK()))))))),vC(i(e)),l8));return yield*s(e,MG(e=>U(r(e),ux(t=>U(mA(n),ux(r=>U(r.entries(),gU(il(),(r,[i,n])=>t(i)?U(E7(n,hg(e)),uw({onFailure:e=>n4(e)?uU(U(r,i_(i))):ud(e),onSuccess:()=>uU(r)})):uU(r)),ux(e=>iN(e)?U(mP(n,t=>{for(let r of e)t.delete(r);return t})):uG))))),l8)),uw({onFailure:e=>l(hu(U(e,so(tk)))),onSuccess:()=>l(hl(tK()))}),ST),a.withPermits(1)(u_(mA(o)))})))),Ms=((e,t)=>{let r=e=>F7({onInput:t=>{let i=U(t,iw(e)),n=Math.max(0,e-t.length);return iT(t)||n>0?r(n):U(Rs(i),TW(Tf()))},onFailure:F0,onDone:()=>Rn});return new jX(U(Mv(e),TI(r(t))))},new jX(Rn)),Ma=M(2,(e,t)=>new jX(U(Mv(e),Ts(t)))),Mo=()=>MS(hj()),Ml=e=>U(Mo(),Mp(e)),Mu=e=>Mw(up(tk(e))),Mc=e=>MS(ud(e)),Mh=M(2,(e,t)=>MT(e,iO(t))),Mp=M(e=>j0(e[0]),(e,t,r)=>{let i=r?.bufferSize??16;return r?.switch?Mf(r?.concurrency,()=>Md(e,1,i,t),r=>Md(e,r,i,t)):Mf(r?.concurrency,()=>new jX(Tr(Mv(e),e=>U(e,iz(e=>Mv(t(e))),r2(Rn,(e,t)=>U(e,TW(t)))))),i=>new jX(U(Mv(e),Tr(TJ),TC(e=>Mv(t(e)),r))))}),Mf=(e,t,r)=>{switch(e){case void 0:return t();case"unbounded":return r(Number.MAX_SAFE_INTEGER);default:return e>1?r(e):t()}},Md=M(4,(e,t,r,i)=>new jX(U(Mv(e),Tr(TJ),TC(e=>Mv(i(e)),{concurrency:t,mergeStrategy:RZ(),bufferSize:r})))),Mm=M(e=>j0(e[0]),(e,t)=>Mp(e,z,t)),Mg=e=>{let t=F9({onInput:e=>F3(TJ(e),()=>t),onFailure:F1,onDone:()=>Rn});return new jX(U(Mv(e),F6(t)))},Mb=e=>{let t=(e,t)=>{let[r,i]=U(e,iD(e=>!hi(e))),n=U(iA(i),tV({onNone:()=>t,onSome:hd({onFailure:e=>tV(vK(e),{onNone:()=>Rn,onSome:F1}),onSuccess:()=>Rn})}));return U(Rs(U(r,iO(e=>hi(e)?tk(e.value):tK()))),F3(()=>n))},r=F9({onInput:e=>t(e,r),onFailure:e=>F1(e),onDone:()=>Rn});return new jX(U(Mv(e),F6(r)))},Mx=e=>Mg(Mb(U(e,MF(e=>e.exit)))),My=e=>new jX(e),Mv=e=>{if("channel"in e)return e.channel;if(l3(e))return Mv(MS(e));throw TypeError("Expected a Stream.")},M_=e=>new jX(iT(e)?Rn:Rs(e)),MS=e=>U(e,uj(tk),Mw),Mw=e=>new jX(T$(gC(e,{onFailure:tV({onNone:()=>Rn,onSome:F0}),onSuccess:e=>Rs(ic(e))}))),Mk=(e,t)=>{let r=t?.maxChunkSize??j1;if(t?.scoped){let i=uN(Fg(e),e=>MI(e,{maxChunkSize:r,shutdown:!0}));return t.shutdown?uN(i,Ma(Fm(e))):i}let i=Mp(M0(Fg(e)),e=>MI(e,{maxChunkSize:r}));return t?.shutdown?Ma(i,Fm(e)):i},MC=e=>M2(()=>ia(e)?M_(e):MO(e[Symbol.iterator]())),MO=(e,t=j1)=>U(uB(()=>{let r=[],i=e=>U(uB(()=>{let n=e.next();if(1===t)return n.done?Rn:U(Rs(ic(n.value)),F3(()=>i(e)));r=[];let s=0;for(;!1===n.done&&(r.push(n.value),!((s+=1)>=t));)n=e.next();return s>0?U(Rs(ib(r)),F3(()=>i(e))):Rn}),T$);return new jX(i(e))}),zt),ME=e=>U(e,uN(MJ),zr),MI=(e,t)=>U(Ir(e,1,t?.maxChunkSize??j1),ur(t=>U(Ik(e),ux(e=>e&&n4(t)?jv():j_(t)))),MJ,t?.shutdown?Ma(IO(e)):z),MF=((e,t)=>{let r=e=>U(SK(e),uN(tV({onNone:()=>F7({onInput:t=>F3(Rs(t),()=>r(e)),onFailure:F0,onDone:()=>Rn}),onSome:hd({onFailure:F1,onSuccess:()=>Rn})})),T$);return new jX(Tq(i=>t.pipe(SR(i),uN(t=>Mv(e).pipe(F6(r(t)))))))},M(2,(e,t)=>new jX(U(Mv(e),Tv(iz(t)))))),MR=M(3,(e,t,r)=>M2(()=>{let i=e=>F7({onInput:t=>U(uq(()=>{let n=[],s=e=>uB(()=>{n.push(e)});return U(t,gU(e,(e,t)=>U(r(e,t),ux(([e,t])=>U(s(t),l6(e))))),gC({onFailure:e=>0!==n.length?TW(Rs(ib(n)),F0(e)):F0(e),onSuccess:e=>F3(Rs(ib(n)),()=>i(e))}))}),T$),onFailure:F0,onDone:()=>Rn});return new jX(U(Mv(e),TI(i(t))))})),MT=M(2,(e,t)=>new jX(U(Mv(e),Tv(t)))),MN=((e,t)=>U(e,MT(iI(t))),M(2,(e,t)=>{let r=e=>{let i=e.next();return i.done?F9({onInput:e=>r(e[Symbol.iterator]()),onFailure:F1,onDone:Re}):T$(uN(t(i.value),t=>F3(Rs(ic(t)),()=>r(e))))};return new jX(U(Mv(e),F6(Rr(()=>r(il()[Symbol.iterator]())))))})),MA=M(3,(e,t,r)=>new jX(U(Mv(e),Tr(TJ),TS(r,t),Tv(ic)))),Mj=M(2,(e,t)=>new jX(U(Mv(e),Tx(t)))),MM=(e=>j0(e[1]),M(2,(e,t)=>Mz(e,t,{onSelf:tN,onOther:tA}))),Mz=M(3,(e,t,r)=>{let i=r.haltStrategy?T8(r.haltStrategy):T4,n=e=>t=>e||!hi(t)?RP(uq(()=>t)):RD(e=>uq(()=>e));return new jX(TO(Mv(MF(e,r.onSelf)),{other:Mv(MF(t,r.onOther)),onSelfDone:n("Either"===i._tag||"Left"===i._tag),onOtherDone:n("Either"===i._tag||"Right"===i._tag)}))}),MP=((e,t)=>new jX(U(Mv(e),TE(()=>Mv(t())))),M(2,(e,t)=>{let r=F7({onInput:e=>iT(e)?Rr(()=>r):U(Rs(e),TW(Tf())),onFailure:F0,onDone:()=>Rr(()=>Mv(t()))});return new jX(U(Mv(e),F6(r)))})),MD=(e=>"function"==typeof e[1],M(2,(e,t)=>new jX(F6(Mv(e),t)))),ML=M(2,(e,t)=>new jX(U(Mv(e),F8(t)))),M$=((e,t)=>new jX(Tq(r=>wm(t,r).pipe(uN(t=>U(Mv(e),F8(t)))))),M(3,(e,t,r)=>Ml(i=>Mp(r,r=>U(e,ML(sq(i,t,r))))))),MU=((e,t)=>Ml(r=>U(e,ML(t(r)))),M(2,(e,t)=>M2(()=>{let r=Math.max(t,1),i=Mq(new MB(r),r);return new jX(U(Mv(e),F6(i)))}))),Mq=(e,t)=>F9({onInput:r=>{if(r.length===t&&e.isEmpty())return F3(Rs(r),()=>Mq(e,t));if(r.length>0){let i;let n=[],s=0;for(;s<r.length;){for(;s<r.length&&void 0===i;)i=e.write(U(r,iy(s))),s+=1;void 0!==i&&(n.push(i),i=void 0)}return F3(TB(...n),()=>Mq(e,t))}return Rr(()=>Mq(e,t))},onFailure:t=>TW(e.emitIfNotEmpty(),F1(t)),onDone:()=>e.emitIfNotEmpty()});class MB{constructor(e){this.builder=[],this.pos=0,this.n=e}isEmpty(){return 0===this.pos}write(e){if(this.builder.push(e),this.pos+=1,this.pos===this.n){let e=ib(this.builder);return this.builder=[],this.pos=0,e}}emitIfNotEmpty(){return 0!==this.pos?Rs(ib(this.builder)):Rn}}let MJ=e=>ze(e,e=>U(uN(e,t=>tk([t,e])),ui(tV({onNone:()=>uU(tK()),onSome:up})))),MH=e=>MJ(U(e,uN(ic))),MK=((e,t)=>MK(e,t,{onElement:e=>tA(e),onSchedule:tN}),M(3,(e,t,r)=>U(_8(t),uN(t=>{let i=U(t.last,uD,uN(r.onSchedule)),n=U(e,MF(r.onElement),Mv),s=T$(gC(t.next(void 0),{onFailure:()=>Rn,onSuccess:()=>U(n,TW(U(i,uN(e=>U(Rs(ic(e)),F3(()=>s))),T$)))}));return new jX(U(n,TW(s)))}),zt))),MV=M(2,(e,t)=>Mv(e).pipe(TI(Nw(t)),TR)),MW=((e,t,r,i)=>MV(e,No(t,r,i)),M(2,(e,t)=>MV(e,Nb(t)))),MG=M(2,(e,t)=>U(e,MX(Nb(t)))),MY=M(2,(e,t)=>U(e,MZ(t))),MQ=((e,t)=>U(e,MZ(t),kC),M(2,(e,t)=>{let r=F9({onInput:e=>F3(F4(E9(t,iz(e,hg))),()=>r),onFailure:e=>F4(E7(t,hu(so(e,tk)))),onDone:()=>F4(E7(t,hl(tK())))});return U(F6(Mv(e),r),Tn,TT,l8)})),MZ=M(2,(e,t)=>{let r=F9({onInput:e=>F3(Rs(jH(e)),()=>r),onFailure:e=>Rs(jW(e)),onDone:()=>Rs(jV)});return U(F6(Mv(e),r),T_(e=>E7(t,e)),Tn,TT,l8)}),MX=M(2,(e,t)=>U(Mv(e),TI(Nw(t)),Tn,TT)),M0=((e,t)=>U(e,MR(tK(),(e,r)=>{switch(e._tag){case"None":return uU([tk(r),r]);case"Some":return U(t(e.value,r),uN(e=>[tk(e),e]))}})),e=>new jX(Ts(TN(U(e,uN(ic))),uG))),M1=e=>new jX(TA(t=>e(t).pipe(uN(ic)))),M2=((e,t,r)=>t<=0||r<=0?j9(new c3("Invalid bounds - `chunkSize` and `stepSize` must be greater than zero")):new jX(Rr(()=>{let i=new jn(t),n=(e,n)=>{if(e<t){let e=i.toChunk();return U(Rs(iT(e)?il():ic(e)),F3(()=>n))}let s=e-(e-t)%r;if(s===e)return n;let a=U(i.toChunk(),i$(e-(s-t+r)));return U(Rs(iT(a)?il():ic(a)),F3(()=>n))},s=e=>F9({onInput:n=>F3(Rs(iO(n,(n,s)=>{i.put(n);let a=e+s+1;return a<t||(a-t)%r>0?tK():tk(i.toChunk())})),()=>s(e+n.length)),onFailure:t=>n(e,F1(t)),onDone:()=>n(e,Rn)});return U(Mv(e),F6(s(0)))})),e=>new jX(Rr(()=>Mv(e())))),M3=((e,t)=>{let r=F7({onInput:e=>{let i=U(e,iU(t));return i.length===e.length?U(Rs(i),F3(()=>r)):Rs(i)},onFailure:F0,onDone:Re});return new jX(U(Mv(e),TI(r)))},(e,t,r,i,n)=>{let s=(e,a)=>F9({onInput:o=>U(t(o),vw(fc),uN(([t,l])=>{let u=e+(l-a)/ad(i)*r,c=r+n<0?Number.POSITIVE_INFINITY:r+n,h=(u<0?c:Math.min(u,c))-t,p=al(Math.max(0,(h>=0?0:-h/r)*ad(i)));return aS(p,as)?U(F4(gs(p)),TW(Rs(o)),F3(()=>s(h,l))):F3(Rs(o),()=>s(h,l))}),T$),onFailure:F1,onDone:()=>Rn}),a=U(fc,uN(e=>s(r,e)),T$);return new jX(U(Mv(e),TI(a)))}),M5=M(3,(e,t,r)=>U(M8(e),uN(Sj({onTimeout:()=>so(t(),tk),duration:r})),ME)),M4=((e,t,r)=>{let i=new cZ("Stream Timeout");return U(e,M5(()=>nZ(i),t),j4(e=>n3(e)&&vG(e.defect)&&void 0!==e.defect.message&&"Stream Timeout"===e.defect.message?tk(r):tK()))},e=>{if("number"==typeof e)return Fh(e);if("unbounded"===e.capacity)return Fd({replay:e.replay});switch(e.strategy){case"dropping":return Fp(e);case"sliding":return Ff(e);default:return Fh(e)}}),M6=M(2,(e,t)=>U(vt(M4(t),e=>Fm(e)),uJ(t=>U(e,MY(t),ST)))),M8=e=>uN(TM(Mv(e)),e=>U(e,uj(tk),ux(tD({onLeft:()=>up(tK()),onRight:uU})))),M7=(e=>j0(e[0]),M(e=>j0(e[0]),(e,t)=>uN(S7(),r=>M9(e,r,t)))),M9=M(e=>j0(e[0]),(e,t,r)=>{let i,n;let s=SG(t),a=SV(t);return new ReadableStream({start(t){n=s(vN());let r=U(M8(e),vA(n),s,ux(e=>iT(e)?r:uU(e)));i=U(r,uJ(e=>uB(()=>{iz(e,e=>{t.enqueue(e)})})),gK(()=>cK(n,hb)),gy({None:()=>uB(()=>{t.close()}),Some:e=>uB(()=>{t.error(e.value)})}),l8)},pull:()=>new Promise(e=>{a(i,{scope:n}).addObserver(t=>e())}),cancel:()=>new Promise(e=>{a(cK(n,hb)).addObserver(t=>e())})},r?.strategy)}),ze=(e,t)=>M2(()=>{let r=e=>T$(uN(t(e),tV({onNone:()=>Rn,onSome:([e,t])=>F3(Rs(e),()=>r(t))})));return new jX(r(e))}),zt=e=>Mm(MS(e)),zr=e=>Mm(M0(e)),zi=e=>Mm(M1(t=>e(t))),zn=((e,t)=>U(MS(t),Mp(t=>t?e:Ms)),M(3,(e,t,r)=>{let i=(e,t,r)=>{switch(e._tag){case jz:return U(j6(t),vw(j6(r),{concurrent:!0}),uk({onFailure:e=>uU(hl(tk(e))),onSuccess:([e,s])=>tS(e)&&tS(s)?iT(e.value)&&iT(s.value)?i(jL,t,r):iT(e.value)?i(j$(s.value),t,r):iT(s.value)?i(jU(e.value),t,r):uU(hg(n(e.value,s.value))):uU(hl(tK()))}));case jP:return uk(t,{onFailure:e=>uU(hl(e)),onSuccess:s=>iT(s)?i(j$(e.rightChunk),t,r):iT(e.rightChunk)?i(jU(s),t,r):uU(hg(n(s,e.rightChunk)))});case jD:return uk(r,{onFailure:e=>uU(hl(e)),onSuccess:s=>iT(s)?i(jU(e.leftChunk),t,r):iT(e.leftChunk)?i(j$(s),t,r):uU(hg(n(e.leftChunk,s)))})}},n=(e,t)=>{let[i,n]=r(e,t);switch(n._tag){case"Left":if(iT(n.left))return[i,jL];return[i,jU(n.left)];case"Right":if(iT(n.right))return[i,jL];return[i,j$(n.right)]}};return U(e,j8(t,jL,i))})),zs=(e,t,r)=>e.length>t.length?[U(e,iS(t.length),iq(t,r)),tN(U(e,iw(t.length)))]:[U(e,iq(U(t,iS(e.length)),r)),tA(U(t,iw(e.length)))],za=M(e=>j0(e[0]),(e,t="utf-8")=>M2(()=>{let r=new TextDecoder(t);return MF(e,e=>r.decode(e))})),zo=Symbol.for("effect/GroupBy"),zl={_R:e=>e,_E:e=>e,_K:e=>e,_V:e=>e},zu=e=>en(e,zo),zc=M(e=>zu(e[0]),(e,t,r)=>Mp(e.grouped,([e,r])=>t(e,Mx(MI(r,{shutdown:!0}))),{concurrency:"unbounded",bufferSize:r?.bufferSize??16})),zh=e=>({[zo]:zl,pipe(){return eX(this,arguments)},grouped:e}),zp=M(e=>"function"!=typeof e[0],(e,t,r)=>r?.key?zc(zd(e,r.key,{bufferSize:r.bufferSize}),(e,r)=>MN(r,t)):Mf(r?.concurrency,()=>MN(e,t),i=>r?.unordered?Mp(e,e=>MS(t(e)),{concurrency:i}):MA(e,i,t)));class zf extends fx{static{d=EG}constructor(e,t){super(),this[d]={_Out:e=>e},this.dequeue=e,this.f=t}capacity(){return Iv(this.dequeue)}get size(){return I_(this.dequeue)}unsafeSize(){return this.dequeue.unsafeSize()}get awaitShutdown(){return IC(this.dequeue)}isActive(){return this.dequeue.isActive()}get isShutdown(){return Ik(this.dequeue)}get shutdown(){return IO(this.dequeue)}get isFull(){return Iw(this.dequeue)}get isEmpty(){return IS(this.dequeue)}get take(){return U(Ie(this.dequeue),uN(e=>this.f(e)))}get takeAll(){return U(II(this.dequeue),uN(iz(e=>this.f(e))))}takeUpTo(e){return U(It(this.dequeue,e),uN(iz(e=>this.f(e))))}takeBetween(e,t){return U(Ir(this.dequeue,e,t),uN(iz(e=>this.f(e))))}takeN(e){return U(Ii(this.dequeue,e),uN(iz(e=>this.f(e))))}poll(){return U(IE(this.dequeue),uN(t1(e=>this.f(e))))}pipe(){return eX(this,arguments)}commit(){return this.take}}let zd=M(e=>"function"!=typeof e[0],(e,t,r)=>{let i=(e,n)=>F9({onInput:s=>F3(F4(vo(zm(s,t),([t,i])=>{let s=e.get(t);return void 0===s?U(Ig(r?.bufferSize??16),ux(r=>U(uB(()=>{e.set(t,r)}),vC(E7(n,jY([t,r]))),vC(U(E7(r,jH(i)),gb(e=>n6(e)?tk(uG):tK())))))):gb(E7(s,jH(i)),e=>n6(e)?tk(uG):tK())},{discard:!0})),()=>i(e,n)),onFailure:e=>F4(E7(n,jW(e))),onDone:()=>U(F4(U(vo(e.entries(),([e,t])=>U(E7(t,jV),gb(e=>n6(e)?tk(uG):tK())),{discard:!0}),vC(E7(n,jV)))))});return zh(zi(t=>k_(function*(){let r=new Map,n=yield*Iy();return yield*cJ(t,IO(n)),yield*Mv(e).pipe(F6(i(r,n)),Tn,RA(t),SR(t),l6(Mx(MI(n,{shutdown:!0}))))})))}),zm=M(2,(e,t)=>{let r;let i=[],n=e[Symbol.iterator](),s=new Map;for(;(r=n.next())&&!r.done;){let e=r.value,n=t(e);if(s.has(n))s.get(n).push(e);else{let t=[e];i.push([n,t]),s.set(n,t)}}return ib(i.map(e=>[e[0],ib(e[1])]))}),zg=(...e)=>{let t=1===e.length?e[0].evaluate:e[0],r=1===e.length?e[0].onError:e[1],i=1===e.length&&!0===e[0].releaseLockOnEnd;return zr(uN(vt(uB(()=>t().getReader()),e=>i?uB(()=>e.releaseLock()):kS(()=>e.cancel())),e=>MH(ux(gV({try:()=>e.read(),catch:e=>tk(r(e))}),({done:e,value:t})=>e?up(tK()):uU(t)))))},zb=e=>MV(e,Ns),zx=Symbol.for("@effect/platform/Cookies"),zy=e=>en(e,zx),zv=Symbol.for("@effect/platform/Cookies/Cookie"),z_=Symbol.for("@effect/platform/Cookies/CookieError");class zS extends kz(z_,"CookieError"){get message(){return this.reason}}let zw={[zx]:zx,...eJ,toJSON(){return{_id:"@effect/platform/Cookies",cookies:ro(this.cookies,e=>e.toJSON())}},pipe(){return eX(this,arguments)}},zk=e=>{let t=Object.create(zw);return t.cookies=e,t},zC=e=>{let t={};for(let r of e)t[r.name]=r;return zk(t)},zO=e=>{let t=[];for(let r of"string"==typeof e?[e]:e){let e=function(e){let t=e.split(";").map(e=>e.trim()).filter(e=>""!==e);if(0===t.length)return tK();let r=t[0].indexOf("=");if(-1===r)return tK();let i=t[0].slice(0,r);if(!zF.test(i))return tK();let n=t[0].slice(r+1),s=zz(n);if(1===t.length)return tk(Object.assign(Object.create(zR),{name:i,value:s,valueEncoded:n}));let a={};for(let e=1;e<t.length;e++){let r=t[e],i=r.indexOf("="),n=-1===i?r:r.slice(0,i).trim(),s=-1===i?void 0:r.slice(i+1).trim();switch(n.toLowerCase()){case"domain":{if(void 0===s)break;let e=s.trim().replace(/^\./,"");e&&(a.domain=e);break}case"expires":{if(void 0===s)break;let e=new Date(s);isNaN(e.getTime())||(a.expires=e);break}case"max-age":{if(void 0===s)break;let e=parseInt(s,10);isNaN(e)||(a.maxAge=au(e));break}case"path":if(void 0===s)break;"/"===s[0]&&(a.path=s);break;case"priority":if(void 0===s)break;switch(s.toLowerCase()){case"low":a.priority="low";break;case"medium":a.priority="medium";break;case"high":a.priority="high"}break;case"httponly":a.httpOnly=!0;break;case"secure":a.secure=!0;break;case"partitioned":a.partitioned=!0;break;case"samesite":if(void 0===s)break;switch(s.toLowerCase()){case"lax":a.sameSite="lax";break;case"strict":a.sameSite="strict";break;case"none":a.sameSite="none"}}}return tk(Object.assign(Object.create(zR),{name:i,value:s,valueEncoded:n,options:Object.keys(a).length>0?a:void 0}))}(r.trim());tS(e)&&t.push(e.value)}return zC(t)},zE=zC([]),zI=e=>rn(e.cookies),zF=/^[\u0009\u0020-\u007e\u0080-\u00ff]+$/,zR={[zv]:zv,...eJ,toJSON(){return{_id:"@effect/platform/Cookies/Cookie",name:this.name,value:this.value,options:this.options}}};function zT(e,t,r){if(!zF.test(e))return tN(new zS({reason:"InvalidName"}));let i=encodeURIComponent(t);if(i&&!zF.test(i))return tN(new zS({reason:"InvalidValue"}));if(void 0!==r){if(void 0!==r.domain&&!zF.test(r.domain))return tN(new zS({reason:"InvalidDomain"}));if(void 0!==r.path&&!zF.test(r.path))return tN(new zS({reason:"InvalidPath"}));if(void 0!==r.maxAge&&!an(s7(r.maxAge)))return tN(new zS({reason:"InfinityMaxAge"}))}return tA(Object.assign(Object.create(zR),{name:e,value:t,valueEncoded:i,options:r}))}let zN=(e,t,r)=>tU(zT(e,t,r)),zA=((e,t)=>zk({...e.cookies,...t.cookies}),M(2,(e,t)=>{let r={...e.cookies};for(let[e,i,n]of t){let t=zT(e,i,n);if(tR(t))return t;r[e]=t.right}return tA(zk(r))}));function zj(e){let t=e.name+"="+e.valueEncoded;if(void 0===e.options)return t;let r=e.options;if(void 0!==r.maxAge&&(t+="; Max-Age="+Math.trunc(am(r.maxAge))),void 0!==r.domain&&(t+="; Domain="+r.domain),void 0!==r.path&&(t+="; Path="+r.path),void 0!==r.priority)switch(r.priority){case"low":t+="; Priority=Low";break;case"medium":t+="; Priority=Medium";break;case"high":t+="; Priority=High"}if(void 0!==r.expires&&(t+="; Expires="+r.expires.toUTCString()),r.httpOnly&&(t+="; HttpOnly"),r.secure&&(t+="; Secure"),r.partitioned&&(t+="; Partitioned"),void 0!==r.sameSite)switch(r.sameSite){case"lax":t+="; SameSite=Lax";break;case"strict":t+="; SameSite=Strict";break;case"none":t+="; SameSite=None"}return t}let zM=e=>Object.values(e.cookies).map(zj),zz=e=>{try{return decodeURIComponent(e)}catch(t){return e}},zP="effect/Redacted",zD=H("effect/Redacted/redactedRegistry",()=>new WeakMap),zL=Symbol.for(zP),z$={[zL]:{_A:e=>e},pipe(){return eX(this,arguments)},toString:()=>"<redacted>",toJSON:()=>"<redacted>",[eU]:()=>"<redacted>",[ek](){return U(eC(zP),eE(eC(zD.get(this))),eM(this))},[ez](e){return zU(e)&&eP(zD.get(this),zD.get(e))}},zU=e=>en(e,zL),zq=e=>{let t=Object.create(z$);return zD.set(t,e),t},zB=e=>{if(zD.has(e))return zD.get(e);throw Error("Unable to get redacted value")},zJ=e=>tq((t,r)=>e(zB(t),zB(r))),zH=Symbol.for("effect/BigDecimal"),zK={[zH]:zH,[ek](){let e=zX(this);return U(eC(e.value),eE(eR(e.scale)),eM(this))},[ez](e){return zV(e)&&z3(this,e)},toString(){return`BigDecimal(${z5(this)})`},toJSON(){return{_id:"BigDecimal",value:String(this.value),scale:this.scale}},[eU](){return this.toJSON()},pipe(){return eX(this,arguments)}},zV=e=>en(e,zH),zW=(e,t)=>{let r=Object.create(zK);return r.value=e,r.scale=t,r},zG=(e,t)=>{if(e!==zY&&e%zQ===zY)throw RangeError("Value must be normalized");let r=zW(e,t);return r.normalized=r,r},zY=BigInt(0),zQ=BigInt(10),zZ=zG(zY,0),zX=e=>{if(void 0===e.normalized){if(e.value===zY)e.normalized=zZ;else{let t=`${e.value}`,r=0;for(let e=t.length-1;e>=0;e--)if("0"===t[e])r++;else break;0===r&&(e.normalized=e);let i=BigInt(t.substring(0,t.length-r)),n=e.scale-r;e.normalized=zG(i,n)}}return e.normalized},z0=M(2,(e,t)=>t>e.scale?zW(e.value*zQ**BigInt(t-e.scale),t):t<e.scale?zW(e.value/zQ**BigInt(e.scale-t),t):e),z1=e=>e.value<zY?zW(-e.value,e.scale):e,z2=tq((e,t)=>e.scale>t.scale?z0(t,e.scale).value===e.value:e.scale<t.scale?z0(e,t.scale).value===t.value:e.value===t.value),z3=M(2,(e,t)=>z2(e,t)),z5=e=>{let t,r;let i=zX(e);if(Math.abs(i.scale)>=16)return z4(i);let n=i.value<zY,s=n?`${i.value}`.substring(1):`${i.value}`;if(i.scale>=s.length)t="0",r="0".repeat(i.scale-s.length)+s;else{let e=s.length-i.scale;if(e>s.length){let i=e-s.length;t=`${s}${"0".repeat(i)}`,r=""}else r=s.slice(e),t=s.slice(0,e)}let a=""===r?t:`${t}.${r}`;return n?`-${a}`:a},z4=e=>{if(z6(e))return"0e+0";let t=zX(e),r=`${z1(t).value}`,i=r.slice(0,1),n=r.slice(1),s=`${z8(t)?"-":""}${i}`;""!==n&&(s+=`.${n}`);let a=n.length-t.scale;return`${s}e${a>=0?"+":""}${a}`},z6=e=>e.value===zY,z8=e=>e.value<zY,z7=e=>pr(e,void 0,pt),z9=Symbol.for("effect/Config"),Pe={...th,[z9]:{_A:e=>e},commit(){return fp(this)}},Pt=M(2,(e,t)=>Pi(e,e=>tA(t(e)))),Pr=M(2,(e,t)=>Pi(e,e=>{try{return tA(t(e))}catch(e){return tN(h6([],e instanceof Error?e.message:`${e}`))}})),Pi=M(2,(e,t)=>{let r=Object.create(Pe);return r._tag=pp,r.original=e,r.mapOrFail=t,r}),Pn=M(2,(e,t)=>{let r=Object.create(Pe);return r._tag=pf,r.name=t,r.config=e,r}),Ps=M(2,(e,t)=>{let r=Object.create(Pe);return r._tag=pc,r.first=e,r.second=Pc(t),r.condition=D,r}),Pa=M(2,(e,t)=>{let r=Object.create(Pe);return r._tag=pc,r.first=e,r.second=Pc(t.orElse),r.condition=t.if,r}),Po=(e,t)=>{let r=Object.create(Pe);return r._tag=pd,r.description=e,r.parse=t,r},Pl=e=>{let t=Po("a text property",tA);return void 0===e?t:Pn(t,e)},Pu=e=>{let t=Object.create(Pe);return t._tag=pu,t.value=e,t.parse=()=>tA(e),t},Pc=e=>{let t=Object.create(Pe);return t._tag=ph,t.config=e,t},Ph=M(2,(e,t)=>Pa(e,{orElse:()=>Pu(t),if:z7})),Pp=((e,t,r)=>{let i=Object.create(Pe);return i._tag=pm,i.left=e,i.right=t,i.zip=r,i},Symbol.for("effect/Encoding/errors/Decode")),Pf=(e,t)=>{let r={_tag:"DecodeException",[Pp]:Pp,input:e};return K(t)&&(r.message=t),r},Pd=new TextEncoder,Pm=e=>{let t;let r=e.length,i="";for(t=2;t<r;t+=3)i+=Py[e[t-2]>>2],i+=Py[(3&e[t-2])<<4|e[t-1]>>4],i+=Py[(15&e[t-1])<<2|e[t]>>6],i+=Py[63&e[t]];return t===r+1&&(i+=Py[e[t-2]>>2],i+=Py[(3&e[t-2])<<4],i+="=="),t===r&&(i+=Py[e[t-2]>>2],i+=Py[(3&e[t-2])<<4|e[t-1]>>4],i+=Py[(15&e[t-1])<<2],i+="="),i},Pg=e=>{let t=Pb(e),r=t.length;if(r%4!=0)return tN(Pf(t,`Length must be a multiple of 4, but is ${r}`));let i=t.indexOf("=");if(-1!==i&&(i<r-2||i===r-2&&"="!==t[r-1]))return tN(Pf(t,"Found a '=' character, but it is not at the end"));try{let e=t.endsWith("==")?2:t.endsWith("=")?1:0,i=new Uint8Array(r/4*3-e);for(let e=0,n=0;e<r;e+=4,n+=3){let r=Px(t.charCodeAt(e))<<18|Px(t.charCodeAt(e+1))<<12|Px(t.charCodeAt(e+2))<<6|Px(t.charCodeAt(e+3));i[n]=r>>16,i[n+1]=r>>8&255,i[n+2]=255&r}return tA(i)}catch(e){return tN(Pf(t,e instanceof Error?e.message:"Invalid input"))}},Pb=e=>e.replace(/[\n\r]/g,"");function Px(e){if(e>=Pv.length)throw TypeError(`Invalid character ${String.fromCharCode(e)}`);let t=Pv[e];if(255===t)throw TypeError(`Invalid character ${String.fromCharCode(e)}`);return t}let Py=["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","0","1","2","3","4","5","6","7","8","9","+","/"],Pv=[255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,62,255,255,255,63,52,53,54,55,56,57,58,59,60,61,255,255,255,0,255,255,255,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,255,255,255,255,255,255,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51],P_=e=>{let t="";for(let r=0;r<e.length;++r)t+=Pw[e[r]];return t},PS=e=>{let t=new TextEncoder().encode(e);if(t.length%2!=0)return tN(Pf(e,`Length must be a multiple of 2, but is ${t.length}`));try{let e=t.length/2,r=new Uint8Array(e);for(let i=0;i<e;i++){let e=Pk(t[2*i]),n=Pk(t[2*i+1]);r[i]=e<<4|n}return tA(r)}catch(t){return tN(Pf(e,t instanceof Error?t.message:"Invalid input"))}},Pw=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"],Pk=e=>{if(48<=e&&e<=57)return e-48;if(97<=e&&e<=102)return e-97+10;if(65<=e&&e<=70)return e-65+10;throw TypeError("Invalid input")},PC=e=>"string"==typeof e?P_(Pd.encode(e)):P_(e),PO=e=>PS(e),PE=Symbol.for("effect/SchemaId/GreaterThanOrEqualTo"),PI=Symbol.for("effect/SchemaId/Int"),PF=Symbol.for("effect/SchemaId/MinLength"),PR=M(e=>ei(e[0]),(e,...t)=>{let r={};for(let i of t)i in e&&(r[i]=e[i]);return r}),PT=M(e=>ei(e[0]),(e,...t)=>{let r={...e};for(let e of t)delete r[e];return r}),PN=Symbol.for("effect/Schema"),PA=e=>class{static{this[PN]=Pj}static{this.ast=e}static annotations(e){return PA(PP(this.ast,e))}static pipe(){return eX(this,arguments)}static toString(){return String(e)}constructor(){this[PN]=Pj}},Pj={_A:e=>e,_I:e=>e,_R:e=>e},PM={schemaId:k3,message:k5,missingMessage:k4,identifier:k6,title:k8,description:k9,examples:Ce,default:Ct,documentation:Ca,jsonSchema:Cr,arbitrary:Ci,pretty:Cn,equivalence:Cs,concurrency:Co,batching:Cl,parseIssueTitle:Cu,parseOptions:Cc,decodingFallback:Ch},Pz=e=>{if(!e)return{};let t={...e};for(let r in PM)r in e&&(t[PM[r]]=e[r],delete t[r]);return t},PP=(e,t)=>OF(e,Pz(t)),PD=e=>String(e.ast),PL=e=>PA(Oq(e.ast)),P$=e=>PA(OP(e.ast)),PU=(e,t)=>{let r=El(e,t);return(e,t)=>O9(r(e,t),O6)},Pq=(e,t)=>{let r=PU(e,t);return(e,t)=>wr(r(e,t))},PB=e=>en(e,PN)&&ei(e[PN]),PJ=e=>Om(e)?Of.make(Od(e,e=>new Cz(e))):new Cz(e[0]),PH=(e,t=PJ(e))=>class extends PA(t){static annotations(e){return PH(this.literals,PP(this.ast,e))}static{this.literals=[...e]}};function PK(...e){return rw(e)?PH(e):PZ}let PV=(e,t,r)=>PA(new Cj(e.map(e=>e.ast),(...e)=>t.decode(...e.map(PA)),(...e)=>t.encode(...e.map(PA)),Pz(r))),PW=(e,t)=>{let r=()=>(t,r,i)=>e(t)?tA(t):tN(new O1(i,t));return PA(new Cj([],r,r,Pz(t)))},PG=function(){if(Array.isArray(arguments[0])){let e=arguments[0],t=arguments[1],r=arguments[2];return PV(e,t,r)}let e=arguments[0],t=arguments[1];return PW(e,t)};class PY extends PA(CU){}class PQ extends PA(CD){}class PZ extends PA(CB){}class PX extends PA(CH){}class P0 extends PA(CG){}class P1 extends PA(CZ){}class P2 extends PA(C1){}let P3=e=>Of.make(e.map(e=>e.ast)),P5=(e,t=P3(e))=>class extends PA(t){static annotations(e){return P5(this.members,PP(this.ast,e))}static{this.members=[...e]}};function P4(...e){return Om(e)?P5(e):rw(e)?e[0]:PZ}let P6=e=>P4(e,PQ),P8=e=>P4(e,PY),P7=e=>P4(e,PQ,PY);class P9{constructor(e,t){this.ast=e,this.from=t}annotations(e){return new P9(new C7(this.ast.type,this.ast.isOptional,{...this.ast.annotations,...Pz(e)}),this.from)}toString(){return`${this.ast.type}${this.ast.isOptional?"?":""}`}}let De=(e,t)=>new Oe(e.map(e=>PB(e)?new C7(e.ast,!1):e.ast),t.map(e=>PB(e)?new C8(e.ast):e.ast),!0),Dt=(e,t,r=De(e,t))=>class extends PA(r){static annotations(e){return Dt(this.elements,this.rest,PP(this.ast,e))}static{this.elements=[...e]}static{this.rest=[...t]}},Dr=(e,t)=>class extends Dt([],[e],t){static annotations(e){return Dr(this.value,PP(this.ast,e))}static{this.value=e}},Di=e=>Dr(e),Dn=(e,t)=>class extends Dt([e],[e],t){static annotations(e){return Dn(this.value,PP(this.ast,e))}static{this.value=e}},Ds=e=>e?'"?:"':'":"';class Da extends C7{constructor(e,t,r,i,n){super(e,t,i),this._tag="PropertySignatureDeclaration",this.isReadonly=r,this.defaultValue=n}toString(){let e=Ds(this.isOptional),t=String(this.type);return`PropertySignature<${e}, ${t}, never, ${e}, ${t}>`}}class Do extends C7{constructor(e,t,r,i,n){super(e,t,i),this.isReadonly=r,this.fromKey=n}}class Dl extends C7{constructor(e,t,r,i,n){super(e,t,i),this.isReadonly=r,this.defaultValue=n}}let Du=e=>void 0===e?"never":K(e)?JSON.stringify(e):String(e);class Dc{constructor(e,t,r,i){this._tag="PropertySignatureTransformation",this.from=e,this.to=t,this.decode=r,this.encode=i}toString(){return`PropertySignature<${Ds(this.to.isOptional)}, ${this.to.type}, ${Du(this.from.fromKey)}, ${Ds(this.from.isOptional)}, ${this.from.type}>`}}let Dh=(e,t)=>{switch(e._tag){case"PropertySignatureDeclaration":return new Da(e.type,e.isOptional,e.isReadonly,{...e.annotations,...t},e.defaultValue);case"PropertySignatureTransformation":return new Dc(new Do(e.from.type,e.from.isOptional,e.from.isReadonly,e.from.annotations),new Dl(e.to.type,e.to.isOptional,e.to.isReadonly,{...e.to.annotations,...t},e.to.defaultValue),e.decode,e.encode)}},Dp=Symbol.for("effect/PropertySignature"),Df=e=>en(e,Dp);class Dd{constructor(e){this[Dp]=null,this.ast=e}pipe(){return eX(this,arguments)}annotations(e){return new Dd(Dh(this.ast,Pz(e)))}toString(){return String(this.ast)}}let Dm=e=>new Dd(e);class Dg extends Dd{constructor(e,t){super(e),this.from=t}annotations(e){return new Dg(Dh(this.ast,Pz(e)),this.from)}}let Db=M(2,(e,t)=>{let r=e.ast;switch(r._tag){case"PropertySignatureDeclaration":return Dm(new Da(r.type,r.isOptional,r.isReadonly,r.annotations,t));case"PropertySignatureTransformation":return Dm(new Dc(r.from,new Dl(r.to.type,r.to.isOptional,r.to.isReadonly,r.to.annotations,t),r.decode,r.encode))}}),Dx=e=>AST.pruneUndefined(e,Dx,e=>{let t=Dx(e.to);if(t)return new AST.Transformation(e.from,t,e.transformation)}),Dy=(e,t,r)=>Dm(new Dc(new Do(e.ast,!0,!0,{},void 0),new Dl(t.ast,!1,!0,{},void 0),e=>tk(r.decode(e)),t2(r.encode))),Dv=(e,t,r)=>Dm(new Dc(new Do(e.ast,!0,!0,{},void 0),new Dl(t.ast,!0,!0,{},void 0),r.decode,r.encode)),D_=(e,t)=>{let r=t?.exact,i=t?.default,n=t?.nullable,s=t?.as=="Option",a=t?.onNoneEncoding?tG(t.onNoneEncoding):z;return r?i?n?Db(Dy(P6(e),P$(e),{decode:tV({onNone:i,onSome:e=>null===e?i():e}),encode:tk}),i).ast:Db(Dy(e,P$(e),{decode:tV({onNone:i,onSome:z}),encode:tk}),i).ast:s?n?Dy(P6(e),Lr(P$(e)),{decode:t4(ee),encode:a}).ast:Dy(e,Lr(P$(e)),{decode:z,encode:z}).ast:n?Dv(P6(e),P$(e),{decode:t4(ee),encode:z}).ast:new Da(e.ast,!0,!0,{},void 0):i?n?Db(Dy(P7(e),P$(e),{decode:tV({onNone:i,onSome:e=>null==e?i():e}),encode:tk}),i).ast:Db(Dy(P8(e),P$(e),{decode:tV({onNone:i,onSome:e=>void 0===e?i():e}),encode:tk}),i).ast:s?n?Dy(P7(e),Lr(P$(e)),{decode:t4(e=>null!=e),encode:a}).ast:Dy(P8(e),Lr(P$(e)),{decode:t4(X),encode:a}).ast:n?Dv(P7(e),P8(P$(e)),{decode:t4(ee),encode:z}).ast:new Da(P8(e).ast,!0,!0,{},void 0)},DS=e=>new Dg(new Da(e.ast===CU||e.ast===CB?CU:P8(e).ast,!0,!0,{},void 0),e),Dw=M(e=>PB(e[0]),(e,t)=>new Dg(D_(e,t),e)),Dk=(v=[k4],e=>{let t;for(let r of v)Object.prototype.hasOwnProperty.call(e.annotations,r)&&(void 0===t&&(t={}),t[r]=e.annotations[r]);return t}),DC=(e,t)=>{let r=kD(e),i=[];if(r.length>0){let n=[],s=[],a=[];for(let t=0;t<r.length;t++){let o=r[t],l=e[o];if(Df(l)){let e=l.ast;switch(e._tag){case"PropertySignatureDeclaration":{let t=e.type,r=e.isOptional,a=e.annotations;n.push(new Or(o,t,r,!0,Dk(e))),s.push(new Or(o,OP(t),r,!0,a)),i.push(new Or(o,t,r,!0,a));break}case"PropertySignatureTransformation":{let t=e.from.fromKey??o;n.push(new Or(t,e.from.type,e.from.isOptional,!0,e.from.annotations)),s.push(new Or(o,e.to.type,e.to.isOptional,!0,e.to.annotations)),a.push(new OO(t,o,e.decode,e.encode))}}}else n.push(new Or(o,l.ast,!1,!0)),s.push(new Or(o,OP(l.ast),!1,!0)),i.push(new Or(o,l.ast,!1,!0))}if(rw(a)){let e=[],r=[];for(let i of t){let{indexSignatures:t,propertySignatures:a}=OM(i.key.ast,i.value.ast);a.forEach(e=>{n.push(e),s.push(new Or(e.name,OP(e.type),e.isOptional,e.isReadonly,e.annotations))}),t.forEach(t=>{e.push(t),r.push(new On(t.parameter,OP(t.type),t.isReadonly))})}return new OS(new Os(n,e,{[k7]:"Struct (Encoded side)"}),new Os(s,r,{[k7]:"Struct (Type side)"}),new OE(a))}}let n=[];for(let e of t){let{indexSignatures:t,propertySignatures:r}=OM(e.key.ast,e.value.ast);r.forEach(e=>i.push(e)),t.forEach(e=>n.push(e))}return new Os(i,n)},DO=(e,t)=>{for(let r of kD(e)){let i=e[r];if(void 0===t[r]&&Df(i)){let e=i.ast,n="PropertySignatureDeclaration"===e._tag?e.defaultValue:e.to.defaultValue;void 0!==n&&(t[r]=n())}}return t},DE=(e,t,r=DC(e,t))=>class extends PA(r){static annotations(e){return DE(this.fields,this.records,PP(this.ast,e))}static{this.fields={...e}}static{this.records=[...t]}static{this.make=(t,r)=>{let i=DO(e,{...t});return Lc(r)?i:Ec(this)(i)}}static pick(...t){return DI(PR(e,...t))}static omit(...t){return DI(PT(e,...t))}};function DI(e,...t){return DE(e,t)}let DF=(e,t,r)=>class extends DE({},[{key:e,value:t}],r){static annotations(r){return DF(e,t,PP(this.ast,r))}static{this.key=e}static{this.value=t}},DR=e=>DF(e.key,e.value),DT=(e,t,r)=>{if(Ol(e)&&Ol(t)){let i=[...e.propertySignatures];for(let e of t.propertySignatures){let t=e.name,n=i.findIndex(e=>e.name===t);if(-1===n)i.push(e);else{let{isOptional:s,type:a}=i[n];i[n]=new Or(t,Dj(a,e.type,r.concat(t)),s,!0)}}return new Os(i,e.indexSignatures.concat(t.indexSignatures))}throw Error(kW(e,t,r))},DN=(_=[k6],e=>{let t={...e.annotations};for(let e of _)delete t[e];return t}),DA=(e,t)=>t.map(t=>new Oy(t,e.filter,DN(e))),Dj=(e,t,r)=>Of.make(Dz([e],[t],r)),DM=e=>Og(e)?e.types:[e],Dz=(e,t,r)=>rG(e,e=>rG(t,t=>{switch(t._tag){case"Literal":if(K(t.literal)&&CY(e)||V(t.literal)&&CX(e)||W(t.literal)&&C2(e))return[t];break;case"StringKeyword":if(t===CG){if(CY(e)||CP(e)&&K(e.literal))return[e];if(Ov(e))return DA(e,Dz(DM(e.from),[t],r))}else if(e===CG)return[t];break;case"NumberKeyword":if(t===CZ){if(CX(e)||CP(e)&&V(e.literal))return[e];if(Ov(e))return DA(e,Dz(DM(e.from),[t],r))}else if(e===CZ)return[t];break;case"BooleanKeyword":if(t===C1){if(C2(e)||CP(e)&&W(e.literal))return[e];if(Ov(e))return DA(e,Dz(DM(e.from),[t],r))}else if(e===C1)return[t];break;case"Union":return Dz(DM(e),t.types,r);case"Suspend":return[new Ox(()=>Dj(e,t.f(),r))];case"Refinement":return DA(t,Dz(DM(e),DM(t.from),r));case"TypeLiteral":switch(e._tag){case"Union":return Dz(e.types,[t],r);case"Suspend":return[new Ox(()=>Dj(e.f(),t,r))];case"Refinement":return DA(e,Dz(DM(e.from),[t],r));case"TypeLiteral":return[DT(e,t,r)];case"Transformation":if(OI(e.transformation))return[new OS(DT(e.from,t,r),DT(e.to,OP(t),r),new OE(e.transformation.propertySignatureTransformations))]}break;case"Transformation":if(OI(t.transformation))switch(e._tag){case"Union":return Dz(e.types,[t],r);case"Suspend":return[new Ox(()=>Dj(e.f(),t,r))];case"Refinement":return DA(e,Dz(DM(e.from),[t],r));case"TypeLiteral":return[new OS(DT(e,t.from,r),DT(OP(e),t.to,r),new OE(t.transformation.propertySignatureTransformations))];case"Transformation":if(OI(e.transformation))return[new OS(DT(e.from,t.from,r),DT(e.to,t.to,r),new OE(t.transformation.propertySignatureTransformations.concat(e.transformation.propertySignatureTransformations)))]}}throw Error(kW(e,t,r))})),DP=M(2,(e,t)=>PA(Dj(e.ast,t.ast,[]))),DD=M(e=>PB(e[1]),(e,t)=>PA(OH(e.ast,t.ast))),DL=e=>PA(new Ox(()=>e().ast)),D$=Symbol.for("effect/SchemaId/Refine"),DU=(e,t,r)=>class extends PA(r){static annotations(e){return DU(this.from,this.filter,PP(this.ast,e))}static{this[D$]=e}static{this.from=e}static{this.filter=t}static{this.make=(e,t)=>Lc(t)?e:Ec(this)(e)}},Dq=(e,t,r)=>{if(W(e))return e?tK():tk(new O1(t,r));if(K(e))return tk(new O1(t,r,e));if(void 0!==e){if("_tag"in e)return tk(e);let i=new O1(t,r,e.message);return tk(rw(e.path)?new OG(e.path,r,i):i)}return tK()},DB=(e,t,r)=>{if(kJ(e))return Dq(e,t,r);if(rw(e)){let i=rQ(e,e=>Dq(e,t,r));if(rw(i))return tk(1===i.length?i[0]:new OZ(t,r,i))}return tK()};function DJ(e,t){return r=>{function i(t,r,i){return DB(e(t,r,i),i,t)}let n=new Oy(r.ast,i,Pz(t));return DU(r,i,n)}}let DH=(e,t,r)=>class extends PA(r){static annotations(e){return DH(this.from,this.to,PP(this.ast,e))}static{this.from=e}static{this.to=t}},DK=M(e=>PB(e[0])&&PB(e[1]),(e,t,r)=>DH(e,t,new OS(e.ast,t.ast,new Ow(r.decode,r.encode)))),DV=M(e=>PB(e[0])&&PB(e[1]),(e,t,r)=>DK(e,t,{strict:!0,decode:(e,t,i,n)=>tA(r.decode(e,n)),encode:(e,t,i,n)=>tA(r.encode(e,n))})),DW=Symbol.for("effect/SchemaId/Trimmed"),DG=Symbol.for("effect/SchemaId/StartsWith"),DY=P0.annotations({[k6]:"JsonString",[k8]:"JsonString",[k9]:"a string that will be parsed as JSON"}),DQ=e=>DK(DY,PX,{strict:!0,decode:(t,r,i)=>tM({try:()=>JSON.parse(t,e?.reviver),catch:e=>new O1(i,t,e.message)}),encode:(t,r,i)=>tM({try:()=>JSON.stringify(t,e?.replacer,e?.space),catch:e=>new O1(i,t,e.message)})}).annotations({schemaId:CA}),DZ=(e,t)=>PB(e)?DD(DZ(t),e):DQ(e),DX=(e,t)=>r=>r.pipe(DJ(t=>t>=e,{schemaId:PE,title:`greaterThanOrEqualTo(${e})`,description:0===e?"a non-negative number":`a number greater than or equal to ${e}`,jsonSchema:{minimum:e},...t})),D0=e=>t=>t.pipe(DJ(e=>Number.isSafeInteger(e),{schemaId:PI,title:"int",description:"an integer",jsonSchema:{type:"integer"},...e}));class D1 extends P1.pipe(D0({identifier:"Int"})){}let D2=e=>t=>e(t).map(zq),D3=(e,t,r,i)=>Et(e,{onFailure:e=>new OZ(r,i,e),onSuccess:t}),D5=e=>(t,r,i)=>zU(t)?D3(e(zB(t),r),zq,i,t):tN(new O1(i,t)),D4=e=>PG([e],{decode:e=>D5(El(e)),encode:e=>D5(Eu(e))},{description:"Redacted(<redacted>)",pretty:()=>()=>"Redacted(<redacted>)",arbitrary:D2,equivalence:zJ}),D6=PG(e=>e instanceof Uint8Array,{identifier:"Uint8ArrayFromSelf",pretty:()=>e=>`new Uint8Array(${JSON.stringify(Array.from(e))})`,arbitrary:()=>e=>e.uint8Array(),equivalence:()=>tJ(eP)}),D8=(S="Uint8ArrayFromBase64",w=e=>Pg(e),k=e=>"string"==typeof e?Pm(Pd.encode(e)):Pm(e),DK(P0.annotations({description:"a string that will be parsed into a Uint8Array"}),D6,{strict:!0,decode:(e,t,r)=>tz(w(e),t=>new O1(r,e,t.message)),encode:e=>tA(k(e))}).annotations({identifier:S})),D7=e=>"None"===e._tag?tK():tk(e.value),D9=(e,t)=>r=>r.oneof(t,r.record({_tag:r.constant("None")}),r.record({_tag:r.constant("Some"),value:e(r)})).map(D7),Le=e=>tV({onNone:()=>"none()",onSome:t=>`some(${e(t)})`}),Lt=e=>(t,r,i)=>tv(t)?t_(t)?tA(tK()):D3(e(t.value,r),tk,i,t):tN(new O1(i,t)),Lr=e=>PG([e],{decode:e=>Lt(El(e)),encode:e=>Lt(Eu(e))},{description:`Option<${PD(e)}>`,pretty:Le,arbitrary:D9,equivalence:t6}),Li=e=>PB(e)||Df(e),Ln=e=>kD(e).every(t=>Li(e[t])),Ls=e=>"fields"in e?e.fields:Ls(e[D$]),La=e=>Ln(e)?DI(e):PB(e)?e:DI(Ls(e)),Lo=e=>Ln(e)?e:Ls(e),Ll=e=>(t,r)=>Lf({kind:"Class",identifier:e,schema:La(t),fields:Lo(t),Base:od,annotations:r}),Lu=(e,t)=>{let r={...e};for(let i of kD(t)){if(i in e)throw Error(k1(i));r[i]=t[i]}return r},Lc=e=>W(e)?e:e?.disableValidation??!1,Lh=H("effect/Schema/astCache",()=>new WeakMap),Lp=e=>void 0===e?[]:Array.isArray(e)?e:[e],Lf=({Base:e,annotations:t,disableToString:r,fields:i,identifier:n,kind:s,schema:a})=>{let o=Symbol.for(`effect/Schema/${s}/${n}`),[l,u,c]=Lp(t),h=P$(a),p=h.annotations({identifier:n,...l}),f=h.annotations({[k7]:`${n} (Type side)`,...l}),d=a.annotations({[k7]:`${n} (Constructor)`,...l}),m=a.annotations({[k7]:`${n} (Encoded side)`,...c}),g=a.annotations({[CR]:n,...c,...l,...u}),b=e=>en(e,o)&&Eh(f)(e),x=class extends e{constructor(e={},t=!1){e={...e},"Class"!==s&&delete e._tag,e=DO(i,e),Lc(t)||(e=Ec(d)(e)),super(e,!0)}static{this[PN]=Pj}static get ast(){let e=Lh.get(this);return e||(e=DV(m,PG([f],{decode:()=>(e,t,r)=>e instanceof this||b(e)?tA(e):tN(new O1(r,e)),encode:()=>(e,t)=>e instanceof this?tA(e):O7(Eu(f)(e,t),e=>new this(e,!0))},{identifier:n,pretty:e=>t=>`${n}(${e(t)})`,arbitrary:e=>t=>e(t).map(e=>new this(e)),equivalence:z,[Cp]:p.ast,...l}),{strict:!0,decode:e=>new this(e,!0),encode:z}).annotations({[Cp]:g.ast,...u}).ast,Lh.set(this,e)),e}static pipe(){return eX(this,arguments)}static annotations(e){return PA(this.ast).annotations(e)}static toString(){return`(${String(m)} <-> ${n})`}static make(...e){return new this(...e)}static{this.fields={...i}}static{this.identifier=n}static extend(e){return(t,r)=>{let n=Lo(t),o=La(t),l=Lu(i,n);return Lf({kind:s,identifier:e,schema:DP(a,o),fields:l,Base:this,annotations:r})}}static transformOrFail(e){return(t,r,n)=>{let o=Lu(i,t);return Lf({kind:s,identifier:e,schema:DK(a,P$(DI(o)),r),fields:o,Base:this,annotations:n})}}static transformOrFailFrom(e){return(t,r,n)=>{let o=Lu(i,t);return Lf({kind:s,identifier:e,schema:DK(PL(a),DI(o),r),fields:o,Base:this,annotations:n})}}get[o](){return o}};return!0!==r&&Object.defineProperty(x.prototype,"toString",{value(){return`${n}({ ${kD(i).map(e=>`${kq(e)}: ${kU(this[e])}`).join(", ")} })`},configurable:!0}),x},Ld=P4(DI({_tag:PK("None")}).annotations({identifier:"FiberIdNoneEncoded"}),DI({_tag:PK("Runtime"),id:D1,startTimeMillis:D1}).annotations({identifier:"FiberIdRuntimeEncoded"}),DI({_tag:PK("Composite"),left:DL(()=>Ld),right:DL(()=>Ld)}).annotations({identifier:"FiberIdCompositeEncoded"})).annotations({identifier:"FiberIdEncoded"}),Lm=e=>e.letrec(t=>({None:e.record({_tag:e.constant("None")}),Runtime:e.record({_tag:e.constant("Runtime"),id:e.integer(),startTimeMillis:e.integer()}),Composite:e.record({_tag:e.constant("Composite"),left:t("FiberId"),right:t("FiberId")}),FiberId:e.oneof(t("None"),t("Runtime"),t("Composite"))})).FiberId.map(Lb),Lg=e=>{switch(e._tag){case"None":return"FiberId.none";case"Runtime":return`FiberId.runtime(${e.id}, ${e.startTimeMillis})`;case"Composite":return`FiberId.composite(${Lg(e.right)}, ${Lg(e.left)})`}},Lb=e=>{switch(e._tag){case"None":return aQ;case"Runtime":return aZ(e.id,e.startTimeMillis);case"Composite":return aX(Lb(e.left),Lb(e.right))}},Lx=e=>DI({_tag:PK("Die"),defect:e}),Ly=DI({_tag:PK("Empty")}),Lv=e=>DI({_tag:PK("Fail"),error:e}),L_=DI({_tag:PK("Interrupt"),fiberId:Ld}),LS=e=>DI({_tag:PK("Parallel"),left:e,right:e}),Lw=e=>DI({_tag:PK("Sequential"),left:e,right:e}),Lk=(e,t)=>{let r=DL(()=>i),i=P4(Ly,Lv(e),Lx(t),L_,Lw(r),LS(r)).annotations({title:`CauseEncoded<${PD(e)}>`});return i},LC=(e,t)=>r=>r.letrec(i=>({Empty:r.record({_tag:r.constant("Empty")}),Fail:r.record({_tag:r.constant("Fail"),error:e(r)}),Die:r.record({_tag:r.constant("Die"),defect:t(r)}),Interrupt:r.record({_tag:r.constant("Interrupt"),fiberId:Lm(r)}),Sequential:r.record({_tag:r.constant("Sequential"),left:i("Cause"),right:i("Cause")}),Parallel:r.record({_tag:r.constant("Parallel"),left:i("Cause"),right:i("Cause")}),Cause:r.oneof(i("Empty"),i("Fail"),i("Die"),i("Interrupt"),i("Sequential"),i("Parallel"))})).Cause.map(LF),LO=e=>t=>{let r=t=>{switch(t._tag){case"Empty":return"Cause.empty";case"Fail":return`Cause.fail(${e(t.error)})`;case"Die":return`Cause.die(${cause_.pretty(t)})`;case"Interrupt":return`Cause.interrupt(${Lg(t.fiberId)})`;case"Sequential":return`Cause.sequential(${r(t.left)}, ${r(t.right)})`;case"Parallel":return`Cause.parallel(${r(t.left)}, ${r(t.right)})`}};return r(t)},LE=e=>(t,r,i)=>cause_.isCause(t)?D3(e(function e(t){switch(t._tag){case"Empty":return{_tag:"Empty"};case"Fail":return{_tag:"Fail",error:t.error};case"Die":return{_tag:"Die",defect:t.defect};case"Interrupt":return{_tag:"Interrupt",fiberId:t.fiberId};case"Sequential":return{_tag:"Sequential",left:e(t.left),right:e(t.right)};case"Parallel":return{_tag:"Parallel",left:e(t.left),right:e(t.right)}}}(t),r),LF,i,t):ParseResult.fail(new ParseResult.Type(i,t)),LI=({defect:e,error:t})=>PG([t,e],{decode:(e,t)=>LE(ParseResult.decodeUnknown(Lk(e,t))),encode:(e,t)=>LE(ParseResult.encodeUnknown(Lk(e,t)))},{title:`Cause<${t.ast}>`,pretty:LO,arbitrary:LC});function LF(e){switch(e._tag){case"Empty":return cause_.empty;case"Fail":return cause_.fail(e.error);case"Die":return cause_.die(e.defect);case"Interrupt":return cause_.interrupt(Lb(e.fiberId));case"Sequential":return cause_.sequential(LF(e.left),LF(e.right));case"Parallel":return cause_.parallel(LF(e.left),LF(e.right))}}let LR=(e,t)=>DI({_tag:PK("Failure"),cause:Lk(e,t)}),LT=e=>DI({_tag:PK("Success"),value:e}),LN=e=>{switch(e._tag){case"Failure":return exit_.failCause(LF(e.cause));case"Success":return exit_.succeed(e.value)}},LA=(e,t,r)=>i=>i.oneof(i.record({_tag:i.constant("Failure"),cause:LC(t,r)(i)}),i.record({_tag:i.constant("Success"),value:e(i)})).map(LN),Lj=(e,t)=>r=>"Failure"===r._tag?`Exit.failCause(${LO(t)(r.cause)})`:`Exit.succeed(${e(r.value)})`,LM=(e,t)=>(r,i,n)=>exit_.isExit(r)?exit_.match(r,{onFailure:e=>D3(t(e,i),exit_.failCause,n,r),onSuccess:t=>D3(e(t,i),exit_.succeed,n,r)}):ParseResult.fail(new ParseResult.Type(n,r)),Lz=Symbol.for("@effect/platform/Headers"),LP=Object.assign(Object.create(null),{[Lz]:Lz,[eW](e){return LH(this,fz(e,LK))}}),LD=e=>Object.assign(Object.create(LP),e),LL=Object.create(LP),L$=e=>{if(void 0===e)return LL;if(Symbol.iterator in e){let t=Object.create(LP);for(let[r,i]of e)t[r.toLowerCase()]=i;return t}let t=Object.create(LP);for(let[r,i]of Object.entries(e))Array.isArray(i)?t[r.toLowerCase()]=i.join(", "):void 0!==i&&(t[r.toLowerCase()]=i);return t},LU=e=>Object.setPrototypeOf(e,LP),Lq=M(3,(e,t,r)=>{let i=LD(e);return i[t.toLowerCase()]=r,i}),LB=M(2,(e,t)=>LD({...e,...L$(t)})),LJ=M(2,(e,t)=>{let r=LD(e);return delete r[t.toLowerCase()],r}),LH=M(2,(e,t)=>{let r={...e},i=t=>{if("string"==typeof t){let i=t.toLowerCase();i in e&&(r[i]=zq(e[i]))}else for(let i in e)t.test(i)&&(r[i]=zq(e[i]))};if(Array.isArray(t))for(let e=0;e<t.length;e++)i(t[e]);else i(t);return r}),LK=H("@effect/platform/Headers/currentRedactedNames",()=>cv(["authorization","cookie","set-cookie","x-api-key"]));function LV(e){if(Array.isArray(e))return e.map(LV).join("");switch(typeof e){case"string":return e;case"number":case"bigint":return e.toString();case"boolean":return e?"true":"false";default:return""}}let LW=e=>{let t=Symbol.iterator in e?rd(e):Object.entries(e),r=[];for(let[e,i]of t)if(Array.isArray(i))for(let t=0;t<i.length;t++)void 0!==i[t]&&r.push([e,String(i[t])]);else void 0!==i&&r.push([e,String(i)]);return r},LG=((e,t,r)=>ry(r1(e,([e])=>e!==t),[t,String(r)]),M(2,(e,t)=>{let r=LW(t),i=r.map(([e])=>e);return rv(r1(e,([e])=>i.includes(e)),r)})),LY=M(3,(e,t,r)=>ry(e,[t,String(r)])),LQ=((e,t)=>rv(e,LW(t)),(e,t,r)=>{try{let i=new URL(e,LZ());for(let e=0;e<t.length;e++){let[r,n]=t[e];void 0!==n&&i.searchParams.append(r,n)}return"Some"===r._tag&&(i.hash=r.value),tA(i)}catch(e){return tN(e)}}),LZ=()=>{if("location"in globalThis&&void 0!==globalThis.location&&void 0!==globalThis.location.origin&&void 0!==globalThis.location.pathname)return location.origin+location.pathname},LX=(e,t,r)=>F3(F4(mN(()=>uG)),i=>U(F4(uV(uJ(e,e=>mj(i,t=>r(e,t))))),F3(t),FX(e=>ux(mA(i),t=>t(e))))),L0=sG("@effect/platform/FileSystem"),L1=e=>"bigint"==typeof e?e:BigInt(e),L2=Symbol.for("@effect/platform/HttpBody"),L3=Symbol.for("@effect/platform/HttpBody/HttpBodyError"),L5=e=>{let t=void 0===e?Object.create(tc):om(e);return t._tag="HttpBodyError",t},L4=e=>L5({[L3]:L3,reason:e});class L6{constructor(){this[L2]=L2}[eU](){return this.toJSON()}toString(){return eB(this)}}class L8 extends L6{toJSON(){return{_id:"@effect/platform/HttpBody",_tag:"Empty"}}constructor(...e){super(...e),this._tag="Empty"}}let L7=new L8;class L9 extends L6{constructor(e,t){super(),this._tag="Uint8Array",this.body=e,this.contentType=t}get contentLength(){return this.body.length}toJSON(){return{_id:"@effect/platform/HttpBody",_tag:"Uint8Array",body:this.contentType.startsWith("text/")||this.contentType.endsWith("json")?new TextDecoder().decode(this.body):`Uint8Array(${this.body.length})`,contentType:this.contentType,contentLength:this.contentLength}}}let $e=(e,t)=>new L9(e,t??"application/octet-stream"),$t=new TextEncoder,$r=(e,t)=>$e($t.encode(e),t??"text/plain"),$i=e=>$r(JSON.stringify(e),"application/json"),$n=e=>gg({try:()=>$i(e),catch:e=>L4({_tag:"JsonError",error:e})});class $s extends L6{constructor(e,t,r){super(),this._tag="Stream",this.stream=e,this.contentType=t,this.contentLength=r}toJSON(){return{_id:"@effect/platform/HttpBody",_tag:"Stream",contentType:this.contentType,contentLength:this.contentLength}}}let $a=Symbol.for("@effect/platform/HttpServerResponse"),$o=Symbol.for("@effect/platform/HttpServerRespondable");class $l extends fy{constructor(e,t,r,i,n){if(super(),this.status=e,this.statusText=t,this.cookies=i,this.body=n,this[$a]=$a,n.contentType||n.contentLength){let e={...r};n.contentType&&(e["content-type"]=n.contentType),n.contentLength&&(e["content-length"]=n.contentLength.toString()),this.headers=e}else this.headers=r}commit(){return uU(this)}[$o](){return uU(this)}[eU](){return this.toJSON()}toString(){return eB(this)}toJSON(){return{_id:"@effect/platform/HttpServerResponse",status:this.status,statusText:this.statusText,headers:eZ(this.headers),cookies:this.cookies.toJSON(),body:this.body.toJSON()}}}let $u=e=>"object"==typeof e&&null!==e&&$a in e,$c=e=>new $l(e?.status??204,e?.statusText,e?.headers?L$(e.headers):LL,e?.cookies??zE,L7),$h=M(3,(e,t,r)=>new $l(e.status,e.statusText,Lq(e.headers,t,r),e.cookies,e.body)),$p=(e,t)=>uN($n(e),e=>new $l(t?.status??200,t?.statusText,t?.headers?L$(t.headers):LL,t?.cookies??zE,e)),$f=(e,t)=>{let r=new globalThis.Headers(e.headers);if(!zI(e.cookies))for(let t of zM(e.cookies))r.append("set-cookie",t);if(t?.withoutBody)return new Response(void 0,{status:e.status,statusText:e.statusText,headers:r});let i=e.body;switch(i._tag){case"Empty":return new Response(void 0,{status:e.status,statusText:e.statusText,headers:r});case"Uint8Array":case"Raw":return new Response(i.body,{status:e.status,statusText:e.statusText,headers:r});case"FormData":return new Response(i.formData,{status:e.status,statusText:e.statusText,headers:r});case"Stream":return new Response(M9(i.stream,t?.runtime??we),{status:e.status,statusText:e.statusText,headers:r})}},$d=Symbol.for("@effect/platform/HttpServerRespondable"),$m=e=>en(e,$d),$g=$c({status:400}),$b=$c({status:404}),$x=e=>$u(e)?uU(e):uD(e[$d]()),$y=(e,t)=>$u(e)?uU(e):$m(e)?ur(e[$d](),()=>uU(t)):O5(e)?uU($g):vW(e)?uU($b):uU(t),$v=Symbol.for("@effect/platform/HttpServerError"),$_=H("@effect/platform/HttpServerError/clientAbortFiberId",()=>aZ(-499,0)),$S=e=>{let t;let r=sa(e,e=>$u(e)?(t=e,tk(nY)):tK());return[t??$w,r]},$w=$c({status:500}),$k=$c({status:499}),$C=$c({status:503}),$O=$v;class $E extends kz($O,"RequestError"){[$d](){return $c({status:400})}get methodAndUrl(){return`${this.request.method} ${this.request.url}`}get message(){return this.description?`${this.reason}: ${this.description} (${this.methodAndUrl})`:`${this.reason} error (${this.methodAndUrl})`}}class $I extends kz($O,"RouteNotFound"){constructor(e){super(e),this.stack=`${this.name}: ${this.message}`}[$d](){return $c({status:404})}get message(){return`${this.request.method} ${this.request.url} not found`}}let $F=e=>{let[t,r]=sx(e,[uU($w),nY],(e,t)=>{switch(t._tag){case"Empty":return tk(e);case"Fail":return tk([$y(t.error,$w),t]);case"Die":return tk([$y(t.defect,$w),t]);case"Interrupt":if("Empty"!==e[1]._tag)return tK();return tk([uU(t.fiberId===$_?$k:$C),t]);default:return tK()}});return uN(t,e=>vH(r)?[e,nZ(e)]:[e,n1(r,nZ(e))])},$R=e=>"Success"===e._tag?e.value:$S(e.cause)[0],$T=Symbol.for("@effect/platform/HttpIncomingMessage"),$N=(e,t)=>{let r=PU(e,t);return e=>ux(e.json,r)},$A=(e,t)=>{let r=PU(e,t);return e=>r(e.headers)},$j=H("@effect/platform/HttpIncomingMessage/maxBodySize",()=>cv(tK())),$M=(e,t)=>{let r;let i=e.headers["content-type"]??"";if(i.includes("application/json"))try{r=wn(e.json)}catch(e){}else if(i.includes("text/")||i.includes("urlencoded"))try{r=wn(e.text)}catch(e){}let n={...t,headers:eZ(e.headers),remoteAddress:e.remoteAddress.toJSON()};return void 0!==r&&(n.body=r),n},$z=Symbol.for("effect/Mailbox"),$P=Symbol.for("effect/Mailbox/ReadonlyMailbox"),$D=il(),$L=hg($D),$$=hg(!1),$U=hg(!0),$q=[$D,!0];class $B extends fx{constructor(e,t,r){super(),this[$z]=$z,this[$P]=$P,this.state={_tag:"Open",takers:new Set,offers:new Set,awaiters:new Set},this.messages=[],this.messagesChunk=il(),this.shutdown=uB(()=>{if("Done"===this.state._tag)return!0;this.messages=[],this.messagesChunk=$D;let e=this.state.offers;if(this.finalize("Open"===this.state._tag?hb:this.state.exit),e.size>0){for(let t of e)"Single"===t._tag?t.resume($$):t.resume(hg(ib(t.remaining.slice(t.offset))));e.clear()}return!0}),this.end=this.done(hb),this.clear=uq(()=>{if("Done"===this.state._tag)return hn(this.state.exit,$D);let e=this.unsafeTakeAll();return this.releaseCapacity(),uU(e)}),this.takeAll=uq(()=>{if("Done"===this.state._tag)return hn(this.state.exit,$q);let e=this.unsafeTakeAll();return 0===e.length?u5(this.awaitTake,this.takeAll):uU([e,this.releaseCapacity()])}),this.take=uq(()=>this.unsafeTake()??u5(this.awaitTake,this.take)),this.await=ue(e=>"Done"===this.state._tag?e(this.state.exit):(this.state.awaiters.add(e),uB(()=>{"Done"!==this.state._tag&&this.state.awaiters.delete(e)}))),this.size=uB(()=>this.unsafeSize()),this.awaitTake=ue(e=>"Done"===this.state._tag?e(this.state.exit):(this.state.takers.add(e),uB(()=>{"Done"!==this.state._tag&&this.state.takers.delete(e)}))),this.scheduleRunning=!1,this.releaseTaker=()=>{if(this.scheduleRunning=!1,"Done"===this.state._tag||0===this.state.takers.size)return;let e=t9(this.state.takers);this.state.takers.delete(e),e(hb)},this.scheduler=e,this.capacity=t,this.strategy=r}offer(e){return uq(()=>{if("Open"!==this.state._tag)return $$;if(this.messages.length+this.messagesChunk.length>=this.capacity)switch(this.strategy){case"dropping":return $$;case"suspend":if(this.capacity<=0&&this.state.takers.size>0)return this.messages.push(e),this.releaseTaker(),$U;return this.offerRemainingSingle(e);case"sliding":return this.unsafeTake(),this.messages.push(e),$U}return this.messages.push(e),this.scheduleReleaseTaker(),$U})}unsafeOffer(e){return"Open"===this.state._tag&&(this.messages.length+this.messagesChunk.length>=this.capacity?"sliding"===this.strategy?(this.unsafeTake(),this.messages.push(e),!0):this.capacity<=0&&this.state.takers.size>0&&(this.messages.push(e),this.releaseTaker(),!0):(this.messages.push(e),this.scheduleReleaseTaker(),!0))}offerAll(e){return uq(()=>{if("Open"!==this.state._tag)return uU(ih(e));let t=this.unsafeOfferAllArray(e);return 0===t.length?$L:"dropping"===this.strategy?uU(ib(t)):this.offerRemainingArray(t)})}unsafeOfferAll(e){return ib(this.unsafeOfferAllArray(e))}unsafeOfferAllArray(e){if("Open"!==this.state._tag)return rd(e);if(this.capacity===Number.POSITIVE_INFINITY||"sliding"===this.strategy)return this.messages.length>0&&(this.messagesChunk=iC(this.messagesChunk,ib(this.messages))),"sliding"===this.strategy?this.messagesChunk=this.messagesChunk.pipe(iC(ih(e)),i$(this.capacity)):ia(e)?this.messagesChunk=iC(this.messagesChunk,e):this.messages=rd(e),this.scheduleReleaseTaker(),[];let t=this.capacity<=0?this.state.takers.size:this.capacity-this.messages.length-this.messagesChunk.length;if(0===t)return rd(e);let r=[],i=0;for(let n of e)i<t?this.messages.push(n):r.push(n),i++;return this.scheduleReleaseTaker(),r}fail(e){return this.done(hl(e))}failCause(e){return this.done(hu(e))}unsafeDone(e){return"Open"===this.state._tag&&(0===this.state.offers.size&&0===this.messages.length&&0===this.messagesChunk.length?this.finalize(e):this.state={...this.state,_tag:"Closing",exit:e},!0)}done(e){return uB(()=>this.unsafeDone(e))}takeN(e){return uq(()=>{let t;if("Done"===this.state._tag)return hn(this.state.exit,$q);if(e<=0)return uU([$D,!1]);if((e=Math.min(e,this.capacity))<=this.messagesChunk.length)t=iS(this.messagesChunk,e),this.messagesChunk=iw(this.messagesChunk,e);else{if(!(e<=this.messages.length+this.messagesChunk.length))return u5(this.awaitTake,this.takeN(e));this.messagesChunk=iC(this.messagesChunk,ib(this.messages)),this.messages=[],t=iS(this.messagesChunk,e),this.messagesChunk=iw(this.messagesChunk,e)}return uU([t,this.releaseCapacity()])})}unsafeTake(){let e;if("Done"===this.state._tag)return hy(this.state.exit,hl(new c4));if(this.messagesChunk.length>0)e=ij(this.messagesChunk),this.messagesChunk=iw(this.messagesChunk,1);else if(this.messages.length>0)e=this.messages[0],this.messagesChunk=iw(ib(this.messages),1),this.messages=[];else if(this.capacity<=0&&this.state.offers.size>0)return this.capacity=1,this.releaseCapacity(),this.capacity=0,this.messages.length>0?hg(this.messages.pop()):void 0;else return;return this.releaseCapacity(),hg(e)}unsafeSize(){let e=this.messages.length+this.messagesChunk.length;return"Done"===this.state._tag?tK():tk(e)}commit(){return this.takeAll}pipe(){return eX(this,arguments)}toJSON(){return{_id:"effect/Mailbox",state:this.state._tag,size:this.unsafeSize().toJSON()}}toString(){return eB(this)}[eU](){return eB(this)}offerRemainingSingle(e){return ue(t=>{if("Open"!==this.state._tag)return t($$);let r={_tag:"Single",message:e,resume:t};return this.state.offers.add(r),uB(()=>{"Open"===this.state._tag&&this.state.offers.delete(r)})})}offerRemainingArray(e){return ue(t=>{if("Open"!==this.state._tag)return t(hg(ib(e)));let r={_tag:"Array",remaining:e,offset:0,resume:t};return this.state.offers.add(r),uB(()=>{"Open"===this.state._tag&&this.state.offers.delete(r)})})}releaseCapacity(){if("Done"===this.state._tag)return"Success"===this.state.exit._tag;if(0===this.state.offers.size)return"Closing"===this.state._tag&&0===this.messages.length&&0===this.messagesChunk.length&&(this.finalize(this.state.exit),"Success"===this.state.exit._tag);let e=this.capacity-this.messages.length-this.messagesChunk.length;for(let t of this.state.offers){if(0===e)break;if("Single"===t._tag)this.messages.push(t.message),e--,t.resume($U),this.state.offers.delete(t);else{for(;t.offset<t.remaining.length;t.offset++){if(0===e)return!1;this.messages.push(t.remaining[t.offset]),e--}t.resume($L),this.state.offers.delete(t)}}return!1}scheduleReleaseTaker(){this.scheduleRunning||(this.scheduleRunning=!0,this.scheduler.scheduleTask(this.releaseTaker,0))}unsafeTakeAll(){if(this.messagesChunk.length>0){let e=this.messages.length>0?iC(this.messagesChunk,ib(this.messages)):this.messagesChunk;return this.messagesChunk=$D,this.messages=[],e}if(this.messages.length>0){let e=ib(this.messages);return this.messages=[],e}return"Done"!==this.state._tag&&this.state.offers.size>0?(this.capacity=1,this.releaseCapacity(),this.capacity=0,ic(this.messages.pop())):$D}finalize(e){if("Done"===this.state._tag)return;let t=this.state;for(let r of(this.state={_tag:"Done",exit:e},t.takers))r(e);for(let r of(t.takers.clear(),t.awaiters))r(e);t.awaiters.clear()}}let $J=e=>l5(t=>uU(new $B(t.currentScheduler,"number"==typeof e?e:e?.capacity??Number.POSITIVE_INFINITY,"number"==typeof e?"suspend":e?.strategy??"suspend"))),$H=((e,t)=>uW(r=>uw(r(e),{onFailure:e=>t.failCause(e),onSuccess:e=>t.end})),/; *([!#$%&'*+.^\w`|~-]+)=("(?:[\v\u0020\u0021\u0023-\u005b\u005d-\u007e\u0080-\u00ff]|\\[\v\u0020-\u00ff])*"|[!#$%&'*+.^\w`|~-]+) */gu),$K=/\\([\v\u0020-\u00ff])/gu,$V=/^[!#$%&'*+.^\w|~-]+\/[!#$%&'*+.^\w|~-]+$/u,$W=/^[!#$%&'*+.^\w|~-]+$/u,$G={value:"",parameters:Object.create(null)};function $Y(e,t=!1){let r,i,n;if("string"!=typeof e)return $G;let s=e.indexOf(";"),a=-1!==s?e.slice(0,s).trim():e.trim();if(!1===(t?$W:$V).test(a))return $G;let o={value:a.toLowerCase(),parameters:Object.create(null)};if(-1===s)return o;for($H.lastIndex=s;i=$H.exec(e);){if(i.index!==s)return $G;s+=i[0].length,r=i[1].toLowerCase(),'"'===(n=i[2])[0]&&(n=n.slice(1,n.length-1),!t&&$K.test(n)&&(n=n.replace($K,"$1"))),o.parameters[r]=n}return s!==e.length?$G:o}!function(e){e[e.key=0]="key",e[e.whitespace=1]="whitespace",e[e.value=2]="value"}(I||(I={}));let $Q={_tag:"Continue"},$Z=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,1,1,1,1,1,0,0,1,1,0,1,1,0,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,0,1],$X=[0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1];!function(e){e[e.headers=0]="headers",e[e.body=1]="body"}(F||(F={}));let $0={_tag:"InvalidDisposition"},$1={_tag:"EndNotReached"},$2={_tag:"ReachedLimit",limit:"MaxParts"},$3={_tag:"ReachedLimit",limit:"MaxTotalSize"},$5={_tag:"ReachedLimit",limit:"MaxPartSize"},$4={_tag:"ReachedLimit",limit:"MaxFieldSize"},$6=new TextEncoder().encode("\r\n");function $8(e){return void 0!==e.filename||"application/octet-stream"===e.contentType}function $7(e){}let $9=new TextDecoder("utf-8"),Ue=function({headers:e,onFile:t,onField:r,onError:i,onDone:n,isFile:s=$8,maxParts:a=1/0,maxTotalSize:o=1/0,maxPartSize:l=1/0,maxFieldSize:u=1048576}){let c=$Y(e["content-type"]).parameters.boundary;if(void 0===c)return i({_tag:"InvalidBoundary"}),{write:$7,end(){}};let h={state:F.headers,index:0,parts:0,onChunk:$7,info:void 0,headerSkip:0,partSize:0,totalSize:0,isFile:!1,fieldChunks:[],fieldSize:0};function p(){h.state=F.body,h.isFile=!0,h.onChunk=$7}let f=function(){let e=new TextDecoder,t={state:I.key,headers:Object.create(null),key:"",value:void 0,crlf:0,previousChunk:void 0,pairs:0,size:0};function r(e){return t.state=I.key,t.headers=Object.create(null),t.key="",t.value=void 0,t.crlf=0,t.previousChunk=void 0,t.pairs=0,t.size=0,e}function i(e,t){let r=new Uint8Array(e.length+t.length);return r.set(e),r.set(t,e.length),r}function n(e){return r({_tag:"Failure",reason:e,headers:t.headers})}return function(s,a){let o,l=0;if(void 0!==t.previousChunk){o=l=t.previousChunk.length;let e=new Uint8Array(s.length+l);e.set(t.previousChunk),e.set(s,l),t.previousChunk=void 0,s=e}let u=s.length;e:for(;a<u;){if(t.state===I.key){let r=a;for(;r<u;r++){if(t.size++>16384)return n("HeaderTooLarge");if(58===s[r]){if(t.key+=e.decode(s.subarray(a,r)).toLowerCase(),0===t.key.length)return n("InvalidHeaderName");32===s[r+1]&&32!==s[r+2]&&9!==s[r+2]?(a=r+2,t.state=I.value,t.size++):32!==s[r+1]&&9!==s[r+1]?(a=r+1,t.state=I.value):(a=r+1,t.state=I.whitespace);break}if(1!==$Z[s[r]])return n("InvalidHeaderName")}if(r===u)return t.key+=e.decode(s.subarray(a,u)).toLowerCase(),$Q}if(t.state===I.whitespace){for(;a<u;a++){if(t.size++>16384)return n("HeaderTooLarge");if(32!==s[a]&&9!==s[a]){t.state=I.value;break}}if(a===u)return $Q}if(t.state===I.value){let c=a;for(void 0!==o&&(c=o,o=void 0);c<u;c++){if(t.size++>16384)return n("HeaderTooLarge");if(13===s[c]||t.crlf>0){let o=s[c];if(13===o&&0===t.crlf&&(t.crlf=1,c++,t.size++,o=s[c]),10===o&&1===t.crlf&&(t.crlf=2,c++,t.size++,o=s[c]),13===o&&2===t.crlf&&(t.crlf=3,c++,t.size++,o=s[c]),10===o&&3===t.crlf&&(t.crlf=4,c++,t.size++),t.crlf<4&&c>=u)return t.previousChunk=s.subarray(a),$Q;if(t.crlf>=2){t.value=void 0===t.value?s.subarray(a,c-t.crlf):i(t.value,s.subarray(a,c-t.crlf));let o=e.decode(t.value);if(void 0===t.headers[t.key]?t.headers[t.key]=o:"string"==typeof t.headers[t.key]?t.headers[t.key]=[t.headers[t.key],o]:t.headers[t.key].push(o),a=c,t.size--,4!==t.crlf&&100===t.pairs)return n("TooManyHeaders");if(3===t.crlf)return n("InvalidHeaderValue");if(4===t.crlf)return r({_tag:"Headers",headers:t.headers,endPosition:a-l});t.pairs++,t.key="",t.value=void 0,t.crlf=0,t.state=I.key;continue e}}else if(1!==$X[s[c]])return n("InvalidHeaderValue")}if(c===u)return t.value=void 0===t.value?s.subarray(a,u):i(t.value,s.subarray(a,u)),$Q}}return a>u&&(t.size+=u-a),$Q}}(),d=function(e,t,r){let i=function(e){let t=new TextEncoder().encode(e),r=t.length,i={};for(let e=0;e<r;e++){let r=t[e];void 0===i[r]&&(i[r]=[]),i[r].push(e)}return{needle:t,needleLength:r,indexes:i,firstByte:t[0],previousChunk:void 0,previousChunkLength:0,matchIndex:0}}(e);void 0!==r&&(i.previousChunk=r,i.previousChunkLength=r.length);let n=function(){if("Buffer"in globalThis&&!("Bun"in globalThis||"Deno"in globalThis))return function(e,t,r){return Buffer.prototype.indexOf.call(e,t,r)};let e=new Uint8Array(256).fill(i.needle.length);for(let t=0,r=i.needle.length-1;t<r;++t)e[i.needle[t]]=r-t;return function(t,r,n){let s=t.length,a=n+i.needleLength-1;for(;a<s;){for(let e=i.needleLength-1,n=a;e>=0&&t[n]===r[e];e--,n--)if(0===e)return n;a+=e[t[a]]}return -1}}();return{write:function(e){let r=e.length;if(void 0!==i.previousChunk){let t=new Uint8Array(i.previousChunkLength+r);t.set(i.previousChunk),t.set(e,i.previousChunkLength),e=t,r=i.previousChunkLength+r,i.previousChunk=void 0}if(r<i.needleLength){i.previousChunk=e,i.previousChunkLength=r;return}let s=0;for(;s<r;){let a=n(e,i.needle,s);if(a>-1){a>s&&t(i.matchIndex,e.subarray(s,a)),i.matchIndex+=1,s=a+i.needleLength;continue}if(e[r-1]in i.indexes){let n=i.indexes[e[r-1]],a=-1;for(let t=0,s=n.length;t<s;t++){let s=n[t];e[r-1-s]===i.firstByte&&t>a&&(a=s)}-1===a?0===s?t(i.matchIndex,e):t(i.matchIndex,e.subarray(s)):(r-1-a>s&&t(i.matchIndex,e.subarray(s,r-1-a)),i.previousChunk=e.subarray(r-1-a),i.previousChunkLength=a+1)}else 0===s?t(i.matchIndex,e):t(i.matchIndex,e.subarray(s));break}},end:function(){void 0!==i.previousChunk&&i.previousChunk!==r&&t(i.matchIndex,i.previousChunk),i.previousChunk=r,i.previousChunkLength=r?.length??0,i.matchIndex=0}}}(`\r
--${c}`,function(e,o){if(0===e){p();return}if(e!==h.index){if(h.index>0){if(h.isFile)h.onChunk(null),h.partSize=0;else{if(1===h.fieldChunks.length)r(h.info,h.fieldChunks[0]);else{let e=new Uint8Array(h.fieldSize),t=0;for(let r=0;r<h.fieldChunks.length;r++){let i=h.fieldChunks[r];e.set(i,t),t+=i.length}r(h.info,e)}h.fieldSize=0,h.fieldChunks=[]}}if(h.state=F.headers,h.index=e,h.headerSkip=2,45===o[0]&&45===o[1])return n();h.parts++,h.parts>a&&i($2)}if((h.partSize+=o.length)>l&&i($5),h.state===F.headers){let e;let r=f(o,h.headerSkip);if(h.headerSkip=0,"Continue"===r._tag)return;if("Failure"===r._tag)return p(),i({_tag:"BadHeaders",error:r});let n=$Y(r.headers["content-type"]),a=$Y(r.headers["content-disposition"],!0);if("form-data"===a.value&&!("name"in a.parameters))return p(),i($0);if("filename*"in a.parameters){let t=a.parameters["filename*"].split("''");2===t.length&&(e=decodeURIComponent(t[1]))}if(h.info={name:a.parameters.name??"",filename:e??a.parameters.filename,contentType:""===n.value?void 0!==a.parameters.filename?"application/octet-stream":"text/plain":n.value,contentTypeParameters:n.parameters,contentDisposition:a.value,contentDispositionParameters:a.parameters,headers:r.headers},h.state=F.body,h.isFile=s(h.info),h.isFile&&(h.onChunk=t(h.info)),r.endPosition<o.length){if(h.isFile)h.onChunk(o.subarray(r.endPosition));else{let e=o.subarray(r.endPosition);(h.fieldSize+=e.length)>u&&i($4),h.fieldChunks.push(e)}}}else h.isFile?h.onChunk(o):((h.fieldSize+=o.length)>u&&i($4),h.fieldChunks.push(o))},$6);return{write:e=>(h.totalSize+=e.length)>o?i($3):d.write(e),end(){d.end(),h.state===F.body&&i($1),h.state=F.headers,h.index=0,h.parts=0,h.onChunk=$7,h.info=void 0,h.totalSize=0,h.partSize=0,h.fieldChunks=[],h.fieldSize=0}}},Ut=Symbol.for("@effect/platform/Path"),Ur=sG("@effect/platform/Path");function Ui(e,t){let r,i="",n=0,s=-1,a=0;for(let o=0;o<=e.length;++o){if(o<e.length)r=e.charCodeAt(o);else if(47===r)break;else r=47;if(47===r){if(s===o-1||1===a);else if(s!==o-1&&2===a){if(i.length<2||2!==n||46!==i.charCodeAt(i.length-1)||46!==i.charCodeAt(i.length-2)){if(i.length>2){let e=i.lastIndexOf("/");if(e!==i.length-1){-1===e?(i="",n=0):n=(i=i.slice(0,e)).length-1-i.lastIndexOf("/"),s=o,a=0;continue}}else if(2===i.length||1===i.length){i="",n=0,s=o,a=0;continue}}t&&(i.length>0?i+="/..":i="..",n=2)}else i.length>0?i+="/"+e.slice(s+1,o):i=e.slice(s+1,o),n=o-s-1;s=o,a=0}else 46===r&&-1!==a?++a:a=-1}return i}let Un=function(){let e,t="",r=!1;for(let i=arguments.length-1;i>=-1&&!r;i--){let n;if(i>=0)n=arguments[i];else{let t=globalThis.process;void 0===e&&"process"in globalThis&&"object"==typeof t&&null!==t&&"function"==typeof t.cwd&&(e=t.cwd()),n=e}0!==n.length&&(t=n+"/"+t,r=47===n.charCodeAt(0))}return(t=Ui(t,!r),r)?t.length>0?"/"+t:"/":t.length>0?t:"."},Us=/%/g,Ua=/\\/g,Uo=/\n/g,Ul=/\r/g,Uu=/\t/g,Uc=Ur.of({[Ut]:Ut,resolve:Un,normalize(e){if(0===e.length)return".";let t=47===e.charCodeAt(0),r=47===e.charCodeAt(e.length-1);return(0!==(e=Ui(e,!t)).length||t||(e="."),e.length>0&&r&&(e+="/"),t)?"/"+e:e},isAbsolute:e=>e.length>0&&47===e.charCodeAt(0),join(){let e;if(0==arguments.length)return".";for(let t=0;t<arguments.length;++t){let r=arguments[t];r.length>0&&(void 0===e?e=r:e+="/"+r)}return void 0===e?".":Uc.normalize(e)},relative(e,t){if(e===t||(e=Uc.resolve(e),t=Uc.resolve(t),e===t))return"";let r=1;for(;r<e.length&&47===e.charCodeAt(r);++r);let i=e.length,n=i-r,s=1;for(;s<t.length&&47===t.charCodeAt(s);++s);let a=t.length-s,o=n<a?n:a,l=-1,u=0;for(;u<=o;++u){if(u===o){if(a>o){if(47===t.charCodeAt(s+u))return t.slice(s+u+1);if(0===u)return t.slice(s+u)}else n>o&&(47===e.charCodeAt(r+u)?l=u:0===u&&(l=0));break}let i=e.charCodeAt(r+u);if(i!==t.charCodeAt(s+u))break;47===i&&(l=u)}let c="";for(u=r+l+1;u<=i;++u)(u===i||47===e.charCodeAt(u))&&(0===c.length?c+="..":c+="/..");return c.length>0?c+t.slice(s+l):(s+=l,47===t.charCodeAt(s)&&++s,t.slice(s))},dirname(e){if(0===e.length)return".";let t=e.charCodeAt(0),r=47===t,i=-1,n=!0;for(let r=e.length-1;r>=1;--r)if(47===(t=e.charCodeAt(r))){if(!n){i=r;break}}else n=!1;return -1===i?r?"/":".":r&&1===i?"//":e.slice(0,i)},basename(e,t){let r,i=0,n=-1,s=!0;if(void 0!==t&&t.length>0&&t.length<=e.length){if(t.length===e.length&&t===e)return"";let a=t.length-1,o=-1;for(r=e.length-1;r>=0;--r){let l=e.charCodeAt(r);if(47===l){if(!s){i=r+1;break}}else -1===o&&(s=!1,o=r+1),a>=0&&(l===t.charCodeAt(a)?-1==--a&&(n=r):(a=-1,n=o))}return i===n?n=o:-1===n&&(n=e.length),e.slice(i,n)}for(r=e.length-1;r>=0;--r)if(47===e.charCodeAt(r)){if(!s){i=r+1;break}}else -1===n&&(s=!1,n=r+1);return -1===n?"":e.slice(i,n)},extname(e){let t=-1,r=0,i=-1,n=!0,s=0;for(let a=e.length-1;a>=0;--a){let o=e.charCodeAt(a);if(47===o){if(!n){r=a+1;break}continue}-1===i&&(n=!1,i=a+1),46===o?-1===t?t=a:1!==s&&(s=1):-1!==t&&(s=-1)}return -1===t||-1===i||0===s||1===s&&t===i-1&&t===r+1?"":e.slice(t,i)},format:function(e){if(null===e||"object"!=typeof e)throw TypeError('The "pathObject" argument must be of type Object. Received type '+typeof e);return function(e,t){let r=t.dir||t.root,i=t.base||(t.name||"")+(t.ext||"");return r?r===t.root?r+i:r+"/"+i:i}(0,e)},parse(e){let t;let r={root:"",dir:"",base:"",ext:"",name:""};if(0===e.length)return r;let i=e.charCodeAt(0),n=47===i;n?(r.root="/",t=1):t=0;let s=-1,a=0,o=-1,l=!0,u=e.length-1,c=0;for(;u>=t;--u){if(47===(i=e.charCodeAt(u))){if(!l){a=u+1;break}continue}-1===o&&(l=!1,o=u+1),46===i?-1===s?s=u:1!==c&&(c=1):-1!==s&&(c=-1)}return -1===s||-1===o||0===c||1===c&&s===o-1&&s===a+1?-1!==o&&(0===a&&n?r.base=r.name=e.slice(1,o):r.base=r.name=e.slice(a,o)):(0===a&&n?(r.name=e.slice(1,s),r.base=e.slice(1,o)):(r.name=e.slice(a,s),r.base=e.slice(a,o)),r.ext=e.slice(s,o)),a>0?r.dir=e.slice(0,a-1):n&&(r.dir="/"),r},sep:"/",fromFileUrl:function(e){if("file:"!==e.protocol)return up(kM({module:"Path",method:"fromFileUrl",message:"URL must be of scheme file"}));if(""!==e.hostname)return up(kM({module:"Path",method:"fromFileUrl",message:"Invalid file URL host"}));let t=e.pathname;for(let e=0;e<t.length;e++)if("%"===t[e]){let r=32|t.codePointAt(e+2);if("2"===t[e+1]&&102===r)return up(kM({module:"Path",method:"fromFileUrl",message:"must not include encoded / characters"}))}return uU(decodeURIComponent(t))},toFileUrl:function(e){var t;let r=new URL("file://"),i=Un(e);return 47===e.charCodeAt(e.length-1)&&"/"!==i[i.length-1]&&(i+="/"),r.pathname=((t=i).includes("%")&&(t=t.replace(Us,"%25")),t.includes("\\")&&(t=t.replace(Ua,"%5C")),t.includes("\n")&&(t=t.replace(Uo,"%0A")),t.includes("\r")&&(t=t.replace(Ul,"%0D")),t.includes("	")&&(t=t.replace(Uu,"%09")),t),uU(r)},toNamespacedPath:z}),Uh=Symbol.for("@effect/platform/Multipart"),Up=Symbol.for("@effect/platform/Multipart/MultipartError");class Uf extends kz(Up,"MultipartError"){get message(){return this.reason}}let Ud=H("@effect/platform/Multipart/maxParts",()=>cv(tK())),Um=H("@effect/platform/Multipart/maxFieldSize",()=>cv(L1(0xa00000))),Ug=H("@effect/platform/Multipart/maxFileSize",()=>cv(tK())),Ub=H("@effect/platform/Multipart/fieldMimeTypes",()=>cv(iu("application/json"))),Ux=e=>l5(t=>{let r=t.getFiberRef(Ub);return uU({headers:e,maxParts:tZ(t.getFiberRef(Ud)),maxFieldSize:Number(t.getFiberRef(Um)),maxPartSize:t.getFiberRef(Ug).pipe(t1(Number),tZ),maxTotalSize:t.getFiberRef($j).pipe(t1(Number),tZ),isFile:0===r.length?void 0:e=>!iH(r,t=>e.contentType.includes(t))&&$8(e)})}),Uy=e=>"Success"===e._tag?Rn:F1(e.cause);class Uv extends eH{constructor(){super(),this[Uh]=Uh}}class U_ extends Uv{constructor(e,t,r){super(),this._tag="Field",this.key=e,this.contentType=t,this.value=r}toJSON(){return{_id:"@effect/platform/Multipart/Part",_tag:"Field",key:this.key,contentType:this.contentType,value:this.value}}}class US extends Uv{constructor(e,t){super(),this._tag="File",this.key=e.name,this.name=e.filename??e.name,this.contentType=e.contentType,this.content=My(t)}toJSON(){return{_id:"@effect/platform/Multipart/Part",_tag:"File",key:this.key,name:this.name,contentType:this.contentType}}}let Uw=(e,t)=>ux(L0,r=>uj(MV(t.content,r.sink(e)),e=>new Uf({reason:"InternalError",cause:e})));class Uk extends Uv{constructor(e,t,r,i){super(),this._tag="PersistedFile",this.key=e,this.name=t,this.contentType=r,this.path=i}toJSON(){return{_id:"@effect/platform/Multipart/Part",_tag:"PersistedFile",key:this.key,name:this.name,contentType:this.contentType,path:this.path}}}let UC=(e,t=16)=>LX(va([Ux(e),$J(t)]),([e,t])=>{let r=[],i=tK(),n=Ue({...e,onField(e,t){r.push(new U_(e.name,e.contentType,(function(e){if("utf-8"===e||"utf8"===e||""===e)return $9;try{return new TextDecoder(e)}catch(e){return $9}})(e.contentTypeParameters.charset??"utf-8").decode(t)))},onFile(e){let t=[],i=!1,n=Rr(()=>{if(0===t.length)return i?Rn:TW(s,n);let e=ib(t);return t=[],i?Rs(e):TW(Rs(e),TW(s,n))});return r.push(new US(e,n)),function(e){null===e?i=!0:t.push(e)}},onError(e){i=tk(hl(function(e){if("ReachedLimit"===e._tag)switch(e.limit){case"MaxParts":return new Uf({reason:"TooManyParts",cause:e});case"MaxFieldSize":return new Uf({reason:"FieldTooLarge",cause:e});case"MaxPartSize":return new Uf({reason:"FileTooLarge",cause:e});case"MaxTotalSize":return new Uf({reason:"BodyTooLarge",cause:e})}return new Uf({reason:"Parse",cause:e})}(e)))},onDone(){i=tk(hb)}}),s=F3(t.takeAll,([e,t])=>Ri(()=>{iF(e,iF(n.write)),t&&n.end()})),a=F3(s,()=>{if(0===r.length)return"None"===i._tag?a:Uy(i.value);let e=ib(r);return r=[],TW(Rs(e),"None"===i._tag?a:Uy(i.value))});return FZ(a,{awaitRead:()=>uG,emit:e=>t.offer(e),error:e=>(i=tk(hu(e)),t.end),done:e=>t.end})},([,e])=>e.shutdown),UO=(e,t=Uw)=>k_(function*(){let r=yield*L0,i=yield*Ur,n=yield*r.makeTempDirectoryScoped(),s=Object.create(null);return yield*MW(e,e=>{if("Field"===e._tag)return e.key in s?"string"==typeof s[e.key]?s[e.key]=[s[e.key],e.value]:s[e.key].push(e.value):s[e.key]=e.value,uG;if(""===e.name)return uG;let r=i.join(n,i.basename(e.name).slice(-128)),a=new Uk(e.key,e.name,e.contentType,r);return Array.isArray(s[e.key])?s[e.key].push(a):s[e.key]=[a],t(r,e)}),s}).pipe(gy({SystemError:e=>up(new Uf({reason:"InternalError",cause:e})),BadArgument:e=>up(new Uf({reason:"InternalError",cause:e}))})),UE=Symbol.for("@effect/platform/HttpServerRequest"),UI=sG("@effect/platform/HttpServerRequest"),UF=sG("@effect/platform/HttpServerRequest/ParsedSearchParams"),UR=e=>{if("/"===e[0])return e;let t=e.indexOf("/",e.indexOf("//")+2);return -1===t?"/":e.slice(t)};class UT extends eH{constructor(e,t,r,i){super(),this.source=e,this.url=t,this.headersOverride=r,this.remoteAddressOverride=i,this[UE]=UE,this[$T]=$T}toJSON(){return $M(this,{_id:"@effect/platform/HttpServerRequest",method:this.method,url:this.originalUrl})}modify(e){return new UT(this.source,e.url??this.url,e.headers??this.headersOverride,e.remoteAddress??this.remoteAddressOverride)}get method(){return this.source.method.toUpperCase()}get originalUrl(){return this.source.url}get remoteAddress(){return this.remoteAddressOverride?tk(this.remoteAddressOverride):tK()}get headers(){return this.headersOverride??=L$(this.source.headers),this.headersOverride}get cookies(){return this.cachedCookies?this.cachedCookies:this.cachedCookies=function(e){let t={},r=e.length,i=0,n=0;for(;n!==r;){-1===(n=e.indexOf(";",i))&&(n=r);let s=e.indexOf("=",i);if(-1===s)break;if(s>n){i=n+1;continue}let a=e.substring(i,s++).trim();if(void 0===t[a]){let r=34===e.charCodeAt(s)?e.substring(s+1,n-1).trim():e.substring(s,n).trim();t[a]=-1!==r.indexOf("%")?zz(r):r}i=n+1}return t}(this.headers.cookie??"")}get stream(){return this.source.body?zg(()=>this.source.body,e=>new $E({request:this,reason:"Decode",cause:e})):Mu(new $E({request:this,reason:"Decode",description:"can not create stream from empty body"}))}get text(){return this.textEffect||(this.textEffect=wn(kv(gV({try:()=>this.source.text(),catch:e=>new $E({request:this,reason:"Decode",cause:e})})))),this.textEffect}get json(){return gW(this.text,{try:e=>JSON.parse(e),catch:e=>new $E({request:this,reason:"Decode",cause:e})})}get urlParamsBody(){return ux(this.text,e=>gg({try:()=>LW(new URLSearchParams(e)),catch:e=>new $E({request:this,reason:"Decode",cause:e})}))}get multipart(){return this.multipartEffect||(this.multipartEffect=wn(kv(UO(this.multipartStream)))),this.multipartEffect}get multipartStream(){return MD(Mj(this.stream,e=>new Uf({reason:"InternalError",cause:e})),UC(this.headers))}get arrayBuffer(){return this.arrayBuffer?this.arrayBuffer:(this.arrayBufferEffect=wn(kv(gV({try:()=>this.source.arrayBuffer(),catch:e=>new $E({request:this,reason:"Decode",cause:e})}))),this.arrayBufferEffect)}get upgrade(){return up(new $E({request:this,reason:"Decode",description:"Not an upgradeable ServerRequest"}))}}let UN=(e,t)=>ux(UI,$A(e,t)),UA=(e,t)=>ux(UI,$N(e,t)),Uj=e=>new UT(e,UR(e.url)),UM=e=>{let t=e.headers.host??"localhost",r="https"===e.headers["x-forwarded-proto"]?"https":"http";try{return tk(new URL(e.url,`${r}://${t}`))}catch(e){return tK()}},Uz=H(Symbol.for("@effect/platform/HttpApp/preResponseHandlers"),()=>cv(tK())),UP=e=>LU({b3:`${e.traceId}-${e.spanId}-${e.sampled?"1":"0"}${"Some"===e.parent._tag?`-${e.parent.value.spanId}`:""}`,traceparent:`00-${e.traceId}-${e.spanId}-${e.sampled?"01":"00"}`}),UD=e=>{let t=UB(e);return"Some"===t._tag||"Some"===(t=UL(e))._tag?t:U$(e)},UL=e=>{if(!("b3"in e))return tK();let t=e.b3.split("-");return t.length<2?tK():tk(gl({traceId:t[0],spanId:t[1],sampled:!t[2]||"1"===t[2]}))},U$=e=>e["x-b3-traceid"]&&e["x-b3-spanid"]?tk(gl({traceId:e["x-b3-traceid"],spanId:e["x-b3-spanid"],sampled:!e["x-b3-sampled"]||"1"===e["x-b3-sampled"]})):tK(),UU=/^[0-9a-f]{32}$/gi,Uq=/^[0-9a-f]{16}$/gi,UB=e=>{if(!e.traceparent)return tK();let t=e.traceparent.split("-");if(4!==t.length)return tK();let[r,i,n,s]=t;return"00"===r?!1===UU.test(i)||!1===Uq.test(n)?tK():tk(gl({traceId:i,spanId:n,sampled:(1&parseInt(s,16))==1})):tK()},UJ=H(Symbol.for("@effect/platform/HttpMiddleware/tracerDisabledWhen"),()=>cv(L)),UH=e=>l5(t=>{let r=sK(t.currentContext,UI);if(t.getFiberRef(UJ)(r))return e;let i=tZ(UM(r));void 0!==i&&(""!==i.username||""!==i.password)&&(i.username="REDACTED",i.password="REDACTED");let n=t.getFiberRef(LK),s=LH(r.headers,n);return g1(`http.server ${r.method}`,{parent:tZ(UD(r.headers)),kind:"server",captureStackTrace:!1},t=>{for(let e in t.attribute("http.request.method",r.method),void 0!==i&&(t.attribute("url.full",i.toString()),t.attribute("url.path",i.pathname),""!==i.search.slice(1)&&t.attribute("url.query",i.search.slice(1)),t.attribute("url.scheme",i.protocol.slice(0,-1))),void 0!==r.headers["user-agent"]&&t.attribute("user_agent.original",r.headers["user-agent"]),s)t.attribute(`http.request.header.${e}`,String(s[e]));return"Some"===r.remoteAddress._tag&&t.attribute("client.address",r.remoteAddress.value),ux(uh(g2(e,t)),e=>{let r=$R(e);t.attribute("http.response.status_code",r.status);let i=LH(r.headers,n);for(let e in i)t.attribute(`http.response.header.${e}`,String(i[e]));return e})})}),UK=Symbol.for("@effect/platform/HttpApp/handled"),UV=(e,t,r)=>{let i=ur(l5(r=>ux(e,e=>{let i=sK(r.currentContext,UI),n=r.getFiberRef(UW);return"None"===n._tag?(i[UK]=!0,l6(t(i,e),e)):uJ(n.value(i,e),e=>(i[UK]=!0,t(i,e)))})),e=>l5(r=>ux($F(e),([e,i])=>{let n=sK(r.currentContext,UI),s=r.getFiberRef(UW);return"None"===s._tag?(n[UK]=!0,vC(t(n,e),ud(i))):vC(uJ(s.value(n,e),e=>(n[UK]=!0,t(n,e))),ud(i))})));return uV(kC(z(void 0===r?UH(i):uw(r(UH(i)),{onFailure:e=>l5(r=>{let i=sK(r.currentContext,UI);return UK in i?uG:uw($F(e),{onFailure:e=>t(i,$c({status:500})),onSuccess:([e])=>t(i,e)})}),onSuccess:e=>l5(r=>{let i=sK(r.currentContext,UI);return UK in i?uG:t(i,e)})}))))},UW=Uz,UG=e=>{let t=SV(e);return(r,i)=>{let n=Symbol.for("@effect/platform/HttpApp/resolve"),s=UV(r,(t,r)=>(t[n]($f(r,{withoutBody:"HEAD"===t.method,runtime:e})),uG),i);return(r,i)=>new Promise(a=>{let o=new Map(i?[...e.context.unsafeMap,...i.unsafeMap]:e.context.unsafeMap),l=Uj(r);o.set(UI.key,l),l[n]=a;let u=t(cx(s,cC,sz(o)));r.signal?.addEventListener("abort",()=>{u.unsafeInterruptAsFork($_)},{once:!0})})}},UY=/\+/g,UQ=function(){};UQ.prototype=Object.create(null);let UZ=Array.from({length:256},(e,t)=>"%"+((t<16?"0":"")+t.toString(16)).toUpperCase()),UX=new Int8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,1,1,1,1,0,0,1,1,0,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,1,0]),U0=/^https?:\/\/.*?\//,U1=/(\/:[^/()]*?)\?(\/?)/;class U2{constructor(e={}){this.options={ignoreTrailingSlash:!0,ignoreDuplicateSlashes:!0,caseSensitive:!1,maxParamLength:100,...e}}options;routes=[];trees={};on(e,t,r){let i=t.match(U1);if(i&&void 0!==i.index){U9(t.length===i.index+i[0].length,"Optional Parameter needs to be the last parameter of the path");let n=t.replace(U1,"$1$2"),s=t.replace(U1,"$2");this.on(e,n,r),this.on(e,s,r);return}for(let i of(this.options.ignoreDuplicateSlashes&&(t=qe(t)),this.options.ignoreTrailingSlash&&(t=qt(t)),"string"==typeof e?[e]:e))this._on(i,t,r)}all(e,t){this.on(qn,e,t)}_on(e,t,r){void 0===this.trees[e]&&(this.trees[e]=new U6("/"));let i=t;if("*"===i&&0!==this.trees[e].prefix.length){let t=this.trees[e];this.trees[e]=new U6(""),this.trees[e].staticChildren["/"]=t}let n=this.trees[e].prefix.length,s=this.trees[e],a=[];for(let e=0;e<=i.length;e++){if(58===i.charCodeAt(e)&&58===i.charCodeAt(e+1)){e++;continue}let t=58===i.charCodeAt(e)&&58!==i.charCodeAt(e+1),r=42===i.charCodeAt(e);if(t||r||e===i.length&&e!==n){let t=i.slice(n,e);this.options.caseSensitive||(t=t.toLowerCase()),t=(t=t.split("::").join(":")).split("%").join("%25"),s=s.createStaticChild(t)}if(t){let t=!1,r=[],l=e+1;for(let u=l;;u++){let c=i.charCodeAt(u),h=40===c,p=45===c||46===c,f=47===c||u===i.length;if(h||p||f){let c=i.slice(l,u);if(a.push(c),t=t||h||p,h){var o;let e=function(e,t){let r=1;for(;t<e.length;){if("\\"===e[++t]){t++;continue}if(")"===e[t]?r--:"("===e[t]&&r++,!r)return t}throw TypeError('Invalid regexp expression in "'+e+'"')}(i,u),t=i.slice(u,e+1);r.push((94===(o=t).charCodeAt(1)&&(o=o.slice(0,1)+o.slice(2)),36===o.charCodeAt(o.length-2)&&(o=o.slice(0,o.length-2)+o.slice(o.length-1)),o)),u=e+1}else r.push("(.*?)");let d=u;for(;u<i.length;u++){let e=i.charCodeAt(u);if(47===e)break;if(58===e){if(58===i.charCodeAt(u+1))u++;else break}}let m=i.slice(d,u);if(m&&(m=(m=m.split("::").join(":")).split("%").join("%25"),r.push(m.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"))),l=u+1,f||47===i.charCodeAt(u)||u===i.length){let a=t?"()"+m:m,o=i.slice(e,u);i=i.slice(0,e+1)+a+i.slice(u),e+=a.length;let l=t?RegExp("^"+r.join("")+"$"):void 0;s=s.createParametricChild(l,m,o),n=e+1;break}}}}else if(r&&(a.push("*"),s=s.createWildcardChild(),n=e+1,e!==i.length-1))throw Error("Wildcard must be the last character in the route")}for(let t of(this.options.caseSensitive||(i=i.toLowerCase()),"*"===i&&(i="/*"),this.routes))if(t.method===e&&t.pattern===i)throw Error(`Method '${e}' already declared for route '${i}'`);let l={method:e,path:t,pattern:i,params:a,handler:r};this.routes.push(l),s.addRoute(l)}has(e,t){let r=this.trees[e];if(void 0===r)return!1;let i=r.getStaticChild(t);return void 0!==i&&i.isLeafNode}find(e,t){let r,i,n,s=this.trees[e];if(void 0===s)return;47!==t.charCodeAt(0)&&(t=t.replace(U0,"/")),this.options.ignoreDuplicateSlashes&&(t=qe(t));try{t=(r=function(e){let t=!1,r=!1,i="";for(let n=1;n<e.length;n++){let s=e.charCodeAt(n);if(37===s){let i=e.charCodeAt(n+1),s=e.charCodeAt(n+2);void 0===qr(i,s)?t=!0:(r=!0,50===i&&53===s&&(t=!0,e=e.slice(0,n+1)+"25"+e.slice(n+1),n+=2),n+=2)}else if(63===s||59===s||35===s){i=e.slice(n+1),e=e.slice(0,n);break}}return{path:t?decodeURI(e):e,querystring:i,shouldDecodeParam:r}}(t)).path,i=r.querystring,n=r.shouldDecodeParam}catch(e){return}this.options.ignoreTrailingSlash&&(t=qt(t));let a=t;!1===this.options.caseSensitive&&(t=t.toLowerCase());let o=this.options.maxParamLength,l=s.prefix.length,u=[],c=t.length,h=[];for(;;){if(l===c&&s.isLeafNode){let e=s.handlerStorage?.find();if(void 0!==e)return{handler:e.handler,params:e.createParams(u),searchParams:function(e){let t=new UQ;if("string"!=typeof e)return t;let r=e.length,i="",n="",s=-1,a=-1,o=!1,l=!1,u=!1,c=!1,h=!1,p=0;for(let f=0;f<r+1;f++)if(38===(p=f!==r?e.charCodeAt(f):38)){if((h=a>s)||(a=f),i=e.slice(s+1,a),h||i.length>0){u&&(i=i.replace(UY," ")),o&&(i=decodeURIComponent(i)||i),h&&(n=e.slice(a+1,f),c&&(n=n.replace(UY," ")),l&&(n=decodeURIComponent(n)||n));let r=t[i];void 0===r?t[i]=n:r.pop?r.push(n):t[i]=[r,n]}n="",s=f,a=f,o=!1,l=!1,u=!1,c=!1}else 61===p?a<=s?a=f:l=!0:43===p?a>s?c=!0:u=!0:37===p&&(a>s?l=!0:o=!0);return t}(i)}}let e=s.getNextNode(t,l,h,u.length);if(void 0===e){if(0===h.length)return;let t=h.pop();l=t.brotherPathIndex,u.splice(t.paramsCount),e=t.brotherNode}if("StaticNode"===(s=e)._tag){l+=s.prefix.length;continue}if("WildcardNode"===s._tag){let e=a.slice(l);n&&(e=qi(e)),u.push(e),l=c;continue}if("ParametricNode"===s._tag){let e=a.indexOf("/",l);-1===e&&(e=c);let t=a.slice(l,e);if(n&&(t=qi(t)),void 0!==s.regex){let e=s.regex.exec(t);if(null===e)continue;for(let t=1;t<e.length;t++){let r=e[t];if(r.length>o)return;u.push(r)}}else{if(t.length>o)return;u.push(t)}l=e}}}}class U3{handlers=[];unconstrainedHandler;find(){return this.unconstrainedHandler}add(e){let t={params:e.params,handler:e.handler,createParams:function(e){let t=e.length;return function(r){let i={};for(let n=0;n<t;n++)i[e[n]]=r[n];return i}}(e.params)};this.handlers.push(t),this.unconstrainedHandler=this.handlers[0]}}class U5{isLeafNode=!1;routes;handlerStorage;addRoute(e){void 0===this.routes?this.routes=[e]:this.routes.push(e),void 0===this.handlerStorage&&(this.handlerStorage=new U3),this.isLeafNode=!0,this.handlerStorage.add(e)}}class U4 extends U5{staticChildren={};findStaticMatchingChild(e,t){let r=this.staticChildren[e.charAt(t)];if(void 0!==r&&r.matchPrefix(e,t))return r}getStaticChild(e,t=0){if(e.length===t)return this;let r=this.findStaticMatchingChild(e,t);if(void 0!==r)return r.getStaticChild(e,t+r.prefix.length)}createStaticChild(e){if(0===e.length)return this;let t=this.staticChildren[e.charAt(0)];if(t){let r=1;for(;r<t.prefix.length;r++)if(e.charCodeAt(r)!==t.prefix.charCodeAt(r)){t=t.split(this,r);break}return t.createStaticChild(e.slice(r))}let r=e.charAt(0);return this.staticChildren[r]=new U6(e),this.staticChildren[r]}}class U6 extends U4{_tag="StaticNode";constructor(e){super(),this.setPrefix(e)}prefix;matchPrefix;parametricChildren=[];wildcardChild;setPrefix(e){if(this.prefix=e,1===e.length)this.matchPrefix=(e,t)=>!0;else{let t=e.length;this.matchPrefix=function(e,r){for(let i=1;i<t;i++)if(e.charCodeAt(r+i)!==this.prefix.charCodeAt(i))return!1;return!0}}}getParametricChild(e){if(void 0===e)return this.parametricChildren.find(e=>!1===e.isRegex);let t=e.source;return this.parametricChildren.find(e=>void 0!==e.regex&&e.regex.source===t)}createParametricChild(e,t,r){let i=this.getParametricChild(e);return void 0!==i?i.nodePaths.add(r):(i=new U8(e,t,r),this.parametricChildren.push(i),this.parametricChildren.sort((e,t)=>e.isRegex?t.isRegex?void 0===e.staticSuffix?1:void 0===t.staticSuffix?-1:t.staticSuffix.endsWith(e.staticSuffix)?1:e.staticSuffix.endsWith(t.staticSuffix)?-1:0:-1:1)),i}createWildcardChild(){return void 0===this.wildcardChild&&(this.wildcardChild=new U7),this.wildcardChild}split(e,t){let r=this.prefix.slice(0,t),i=this.prefix.slice(t);this.setPrefix(i);let n=new U6(r);return n.staticChildren[i.charAt(0)]=this,e.staticChildren[r.charAt(0)]=n,n}getNextNode(e,t,r,i){let n=this.findStaticMatchingChild(e,t),s=0;if(void 0===n){if(0===this.parametricChildren.length)return this.wildcardChild;n=this.parametricChildren[0],s=1}void 0!==this.wildcardChild&&r.push({paramsCount:i,brotherPathIndex:t,brotherNode:this.wildcardChild});for(let e=this.parametricChildren.length-1;e>=s;e--)r.push({paramsCount:i,brotherPathIndex:t,brotherNode:this.parametricChildren[e]});return n}}class U8 extends U4{regex;staticSuffix;_tag="ParametricNode";constructor(e,t,r){super(),this.regex=e,this.staticSuffix=t,this.isRegex=!!e,this.nodePaths=new Set([r])}isRegex;nodePaths;getNextNode(e,t){return this.findStaticMatchingChild(e,t)}}class U7 extends U5{_tag="WildcardNode";getNextNode(e,t,r,i){}}let U9=(e,t)=>{if(!e)throw Error(t)};function qe(e){return e.replace(/\/\/+/g,"/")}function qt(e){return e.length>1&&47===e.charCodeAt(e.length-1)?e.slice(0,-1):e}function qr(e,t){return 50===e?53===t?"%":51===t?"#":52===t?"$":54===t?"&":66===t||98===t?"+":67===t||99===t?",":70===t||102===t?"/":void 0:51===e?65===t||97===t?":":66===t||98===t?";":68===t||100===t?"=":70===t||102===t?"?":void 0:52===e&&48===t?"@":void 0}function qi(e){let t=e.indexOf("%");if(-1===t)return e;let r="",i=t;for(let n=t;n<e.length;n++)if(37===e.charCodeAt(n)){let t=qr(e.charCodeAt(n+1),e.charCodeAt(n+2));r+=e.slice(i,n)+t,i=n+3}return e.slice(0,t)+r+e.slice(i)}let qn=["ACL","BIND","CHECKOUT","CONNECT","COPY","DELETE","GET","HEAD","LINK","LOCK","M-SEARCH","MERGE","MKACTIVITY","MKCALENDAR","MKCOL","MOVE","NOTIFY","OPTIONS","PATCH","POST","PROPFIND","PROPPATCH","PURGE","PUT","REBIND","REPORT","SEARCH","SOURCE","SUBSCRIBE","TRACE","UNBIND","UNLINK","UNLOCK","UNSUBSCRIBE"],qs=(e={})=>new U2(e),qa=Symbol.for("@effect/platform/HttpRouter"),qo=Symbol.for("@effect/platform/HttpRouter/Route"),ql=Symbol.for("@effect/platform/HttpRouter/RouteContext"),qu=sG("@effect/platform/HttpRouter/RouteContext"),qc=e=>en(e,qa),qh=H("@effect/platform/HttpRouter/currentRouterConfig",()=>cv({}));class qp extends fy{constructor(e,t){super(),this.routes=e,this.mounts=t,this[qa]=qa,this.httpApp=cu(qh).pipe(ux(e=>this.httpApp=qf(this,e)))}commit(){return this.httpApp}toJSON(){return{_id:"Router",routes:this.routes.toJSON(),mounts:this.mounts.toJSON()}}toString(){return eB(this)}[eU](){return this.toJSON()}}let qf=(e,t)=>{let r=qs(t),i=id(e.mounts).map(([e,t,r])=>[e,new qg(new qm("*",r?.includePrefix?`${e}/*`:"/*",t,r?.includePrefix?tK():tk(e),!1),{}),r]),n=i.length;return iF(e.routes,e=>{"*"===e.method?r.all(e.path,e):r.on(e.method,e.path,e)}),l5(e=>{let t=sz(new Map(e.getFiberRef(cC).unsafeMap)),s=sK(t,UI);if(n>0)for(let e=0;e<n;e++){let[r,n,a]=i[e];if(s.url.startsWith(r))return t.unsafeMap.set(qu.key,n),a?.includePrefix!==!0&&t.unsafeMap.set(UI.key,qd(s,r)),cx(ux(n.route.handler,$x),cC,t)}let a=r.find(s.method,s.url);if(void 0===a&&"HEAD"===s.method&&(a=r.find("GET",s.url)),void 0===a)return up(new $I({request:s}));let o=a.handler;"Some"===o.prefix._tag&&t.unsafeMap.set(UI.key,qd(s,o.prefix.value)),t.unsafeMap.set(UF.key,a.searchParams),t.unsafeMap.set(qu.key,new qg(o,a.params));let l=sV(t,ft);"Some"===l._tag&&"Span"===l.value._tag&&l.value.attribute("http.route",o.path);let u=ux(o.handler,$x);return cx(o.uninterruptible?u:uR(u),cC,t)})};function qd(e,t){let r=t.length;return e.modify({url:e.url.length<=r?"/":e.url.slice(r)})}class qm extends eH{constructor(e,t,r,i=tK(),n=!1){super(),this.method=e,this.path=t,this.handler=r,this.prefix=i,this.uninterruptible=n,this[qo]=qo}toJSON(){return{_id:"@effect/platform/HttpRouter/Route",method:this.method,path:this.path,prefix:this.prefix.toJSON()}}}class qg{constructor(e,t){this.route=e,this.params=t,this[ql]=ql}}let qb=new qp(il(),il()),qx=e=>e.endsWith("/")?e.slice(0,-1):e,qy=((e,t)=>(t=qx(t),new qp(iz(e.routes,e=>new qm(e.method,"/"===e.path?t:t+e.path,e.handler,tG(t1(e.prefix,e=>t+e),()=>tk(t)),e.uninterruptible)),iz(e.mounts,([e,r])=>["/"===e?t:t+e,r]))),e=>M(e=>qc(e[0]),(t,r,i,n)=>new qp(iv(t.routes,new qm(e,r,i,tK(),n?.uninterruptible??!1)),t.mounts))),qv=qy("GET"),q_=qy("POST"),qS=M(2,(e,t)=>new qp(iz(e.routes,e=>new qm(e.method,e.path,t(ux(e.handler,$x)),e.prefix,e.uninterruptible)),iz(e.mounts,([e,r])=>[e,t(r)]))),qw=((e,t)=>new qp(iz(e.routes,e=>new qm(e.method,e.path,t(e.handler),e.prefix,e.uninterruptible)),iz(e.mounts,([e,r])=>[e,ux(t(r),$x)])),(e,t)=>{let r=PU(e,t);return ux(hj(),e=>{let t=sK(e,UF),i=sK(e,qu);return r({...t,...i.params})})}),qk=Symbol.for("@effect/platform/HttpClientError"),qC=e=>en(e,qk);class qO extends kz(qk,"RequestError"){get methodAndUrl(){return`${this.request.method} ${this.request.url}`}get message(){return this.description?`${this.reason}: ${this.description} (${this.methodAndUrl})`:`${this.reason} error (${this.methodAndUrl})`}}class qE extends kz(qk,"ResponseError"){get methodAndUrl(){return`${this.request.method} ${this.request.url}`}get message(){let e=`${this.response.status} ${this.methodAndUrl}`;return this.description?`${this.reason}: ${this.description} (${e})`:`${this.reason} error (${e})`}}let qI=Symbol.for("@effect/platform/HttpClientRequest"),qF={[qI]:qI,...eJ,toJSON(){return{_id:"@effect/platform/HttpClientRequest",method:this.method,url:this.url,urlParams:this.urlParams,hash:this.hash,headers:eZ(this.headers),body:this.body.toJSON()}},pipe(){return eX(this,arguments)}};function qR(e,t,r,i,n,s){let a=Object.create(qF);return a.method=e,a.url=t,a.urlParams=r,a.hash=i,a.headers=n,a.body=s,a}let qT=qR("GET","",[],tK(),LL,L7),qN=e=>(t,r)=>q$(qT,{method:e,url:t,...r??void 0}),qA=qN("GET"),qj=qN("POST"),qM=qN("PUT"),qz=qN("PATCH"),qP=qN("DELETE"),qD=qN("HEAD"),qL=qN("OPTIONS"),q$=M(2,(e,t)=>{let r=e;return t.method&&(r=qH(r,t.method)),t.url&&(r=qK(r,t.url)),t.headers&&(r=qq(r,t.headers)),t.urlParams&&(r=qG(r,t.urlParams)),t.hash&&(r=qY(r,t.hash)),t.body&&(r=qQ(r,t.body)),t.accept&&(r=qB(r,t.accept)),t.acceptJson&&(r=qJ(r)),r}),qU=M(3,(e,t,r)=>qR(e.method,e.url,e.urlParams,e.hash,Lq(e.headers,t,r),e.body)),qq=M(2,(e,t)=>qR(e.method,e.url,e.urlParams,e.hash,LB(e.headers,t),e.body)),qB=M(2,(e,t)=>qU(e,"Accept",t)),qJ=qB("application/json"),qH=M(2,(e,t)=>qR(t,e.url,e.urlParams,e.hash,e.headers,e.body)),qK=M(2,(e,t)=>{if("string"==typeof t)return qR(e.method,t,e.urlParams,e.hash,e.headers,e.body);let r=new URL(t.toString()),i=LW(r.searchParams),n=r.hash?tk(r.hash.slice(1)):tK();return r.search="",r.hash="",qR(e.method,r.toString(),i,n,e.headers,e.body)}),qV=M(2,(e,t)=>qR(e.method,t.endsWith("/")&&e.url.startsWith("/")?t+e.url.slice(1):t+e.url,e.urlParams,e.hash,e.headers,e.body)),qW=M(3,(e,t,r)=>qR(e.method,e.url,LY(e.urlParams,t,r),e.hash,e.headers,e.body)),qG=M(2,(e,t)=>qR(e.method,e.url,LG(e.urlParams,t),e.hash,e.headers,e.body)),qY=M(2,(e,t)=>qR(e.method,e.url,e.urlParams,tk(t),e.headers,e.body)),qQ=M(2,(e,t)=>{let r=e.headers;if("Empty"===t._tag)r=LJ(LJ(r,"Content-Type"),"Content-length");else{let e=t.contentType;e&&(r=Lq(r,"content-type",e));let i=t.contentLength;i&&(r=Lq(r,"content-length",i.toString()))}return qR(e.method,e.url,e.urlParams,e.hash,r,t)}),qZ=M(2,(e,t)=>uN($n(t),t=>qQ(e,t))),qX=Symbol.for("@effect/platform/HttpClientResponse"),q0=(e,t)=>new q1(e,t);class q1 extends eH{constructor(e,t){super(),this.request=e,this.source=t,this[$T]=$T,this[qX]=qX}toJSON(){return $M(this,{_id:"@effect/platform/HttpClientResponse",request:this.request.toJSON(),status:this.status})}get status(){return this.source.status}get headers(){return L$(this.source.headers)}get cookies(){return this.cachedCookies?this.cachedCookies:this.cachedCookies=zO(this.source.headers.getSetCookie())}get remoteAddress(){return tK()}get stream(){return this.source.body?zg(()=>this.source.body,e=>new qE({request:this.request,response:this,reason:"Decode",cause:e})):Mu(new qE({request:this.request,response:this,reason:"EmptyBody",description:"can not create stream from empty body"}))}get json(){return gW(this.text,{try:e=>""===e?null:JSON.parse(e),catch:e=>new qE({request:this.request,response:this,reason:"Decode",cause:e})})}get text(){return this.textBody??=gV({try:()=>this.source.text(),catch:e=>new qE({request:this.request,response:this,reason:"Decode",cause:e})}).pipe(kv,wn)}get urlParamsBody(){return ux(this.text,e=>gg({try:()=>LW(new URLSearchParams(e)),catch:e=>new qE({request:this.request,response:this,reason:"Decode",cause:e})}))}get formData(){return this.formDataBody??=gV({try:()=>this.source.formData(),catch:e=>new qE({request:this.request,response:this,reason:"Decode",cause:e})}).pipe(kv,wn)}get arrayBuffer(){return this.arrayBufferBody??=gV({try:()=>this.source.arrayBuffer(),catch:e=>new qE({request:this.request,response:this,reason:"Decode",cause:e})}).pipe(kv,wn)}}let q2=e=>e.status>=200&&e.status<300?uU(e):up(new qE({response:e,request:e.request,reason:"StatusCode",description:"non 2xx status code"})),q3=Symbol.for("@effect/platform/HttpClient"),q5=sG("@effect/platform/HttpClient"),q4=H(Symbol.for("@effect/platform/HttpClient/tracerDisabledWhen"),()=>cv(L)),q6=H(Symbol.for("@effect/platform/HttpClient/currentTracerPropagation"),()=>cv(!0)),q8={[q3]:q3,pipe(){return eX(this,arguments)},...eJ,toJSON:()=>({_id:"@effect/platform/HttpClient"}),get(e,t){return this.execute(qA(e,t))},head(e,t){return this.execute(qD(e,t))},post(e,t){return this.execute(qj(e,t))},put(e,t){return this.execute(qM(e,t))},patch(e,t){return this.execute(qz(e,t))},del(e,t){return this.execute(qP(e,t))},options(e,t){return this.execute(qL(e,t))}},q7=(e,t)=>{let r=Object.create(q8);return r.preprocess=t,r.postprocess=e,r.execute=function(r){return e(t(r))},r},{del:q9,execute:Be,get:Bt,head:Br,options:Bi,patch:Bn,post:Bs,put:Ba}=new Proxy({},{get:(e,t,r)=>(...e)=>ux(q5,r=>r[t](...e))}),Bo=M(2,(e,t)=>q7(r=>t(e.postprocess(r)),e.preprocess)),Bl=e=>Bo(e,ux(q2)),Bu=e=>zr(uN(e,e=>e.stream)),Bc={[Symbol.for("@effect/matcher/Matcher")]:{_input:z,_filters:z,_result:z,_return:z},_tag:"ValueMatcher",add(e){return"Right"===this.value._tag?this:"When"===e._tag&&!0===e.guard(this.provided)?Bh(this.provided,tA(e.evaluate(this.provided))):"Not"===e._tag&&!1===e.guard(this.provided)?Bh(this.provided,tA(e.evaluate(this.provided))):this},pipe(){return eX(this,arguments)}};function Bh(e,t){let r=Object.create(Bc);return r.provided=e,r.value=t,r}let Bp=(e,t)=>({_tag:"When",guard:e,evaluate:t}),Bf=e=>{if("function"==typeof e)return e;if(Array.isArray(e)){let t=e.map(Bf),r=t.length;return e=>{if(!Array.isArray(e))return!1;for(let i=0;i<r;i++)if(!1===t[i](e[i]))return!1;return!0}}if(null!==e&&"object"==typeof e){let t=Object.entries(e).map(([e,t])=>[e,Bf(t)]),r=t.length;return e=>{if("object"!=typeof e||null===e)return!1;for(let i=0;i<r;i++){let[r,n]=t[i];if(!(r in e)||!1===n(e[r]))return!1}return!0}}return t=>t===e},Bd=e=>{if("ValueMatcher"===e._tag)return e.value;let t=e.cases.length;if(1===t){let t=e.cases[0];return e=>"When"===t._tag&&!0===t.guard(e)?tA(t.evaluate(e)):"Not"===t._tag&&!1===t.guard(e)?tA(t.evaluate(e)):tN(e)}return r=>{for(let i=0;i<t;i++){let t=e.cases[i];if("When"===t._tag&&!0===t.guard(r)||"Not"===t._tag&&!1===t.guard(r))return tA(t.evaluate(r))}return tN(r)}},Bm=e=>Bh(e,tN(e)),Bg=(e,t)=>r=>r.add(Bp(Bf(e),t)),Bb=e=>t=>{let r=Bd(t);return tF(r)?"Right"===r._tag?r.right:e(r.left):t=>{let i=r(t);return"Right"===i._tag?i.right:e(i.left)}},Bx={"application/andrew-inset":{source:"iana",extensions:["ez"]},"application/applixware":{source:"apache",extensions:["aw"]},"application/atom+xml":{source:"iana",extensions:["atom"]},"application/atomcat+xml":{source:"iana",extensions:["atomcat"]},"application/atomdeleted+xml":{source:"iana",extensions:["atomdeleted"]},"application/atomsvc+xml":{source:"iana",extensions:["atomsvc"]},"application/atsc-dwd+xml":{source:"iana",extensions:["dwd"]},"application/atsc-held+xml":{source:"iana",extensions:["held"]},"application/atsc-rsat+xml":{source:"iana",extensions:["rsat"]},"application/calendar+xml":{source:"iana",extensions:["xcs"]},"application/ccxml+xml":{source:"iana",extensions:["ccxml"]},"application/cdfx+xml":{source:"iana",extensions:["cdfx"]},"application/cdmi-capability":{source:"iana",extensions:["cdmia"]},"application/cdmi-container":{source:"iana",extensions:["cdmic"]},"application/cdmi-domain":{source:"iana",extensions:["cdmid"]},"application/cdmi-object":{source:"iana",extensions:["cdmio"]},"application/cdmi-queue":{source:"iana",extensions:["cdmiq"]},"application/cpl+xml":{source:"iana",extensions:["cpl"]},"application/cu-seeme":{source:"apache",extensions:["cu"]},"application/dash+xml":{source:"iana",extensions:["mpd"]},"application/dash-patch+xml":{source:"iana",extensions:["mpp"]},"application/davmount+xml":{source:"iana",extensions:["davmount"]},"application/dicom":{source:"iana",extensions:["dcm"]},"application/docbook+xml":{source:"apache",extensions:["dbk"]},"application/dssc+der":{source:"iana",extensions:["dssc"]},"application/dssc+xml":{source:"iana",extensions:["xdssc"]},"application/ecmascript":{source:"iana",extensions:["es","ecma"]},"application/emma+xml":{source:"iana",extensions:["emma"]},"application/emotionml+xml":{source:"iana",extensions:["emotionml"]},"application/epub+zip":{source:"iana",extensions:["epub"]},"application/exi":{source:"iana",extensions:["exi"]},"application/express":{source:"iana",extensions:["exp"]},"application/fdt+xml":{source:"iana",extensions:["fdt"]},"application/font-tdpfr":{source:"iana",extensions:["pfr"]},"application/geo+json":{source:"iana",extensions:["geojson"]},"application/gml+xml":{source:"iana",extensions:["gml"]},"application/gpx+xml":{source:"apache",extensions:["gpx"]},"application/gxf":{source:"apache",extensions:["gxf"]},"application/gzip":{source:"iana",extensions:["gz"]},"application/hyperstudio":{source:"iana",extensions:["stk"]},"application/inkml+xml":{source:"iana",extensions:["ink","inkml"]},"application/ipfix":{source:"iana",extensions:["ipfix"]},"application/its+xml":{source:"iana",extensions:["its"]},"application/java-archive":{source:"apache",extensions:["jar","war","ear"]},"application/java-serialized-object":{source:"apache",extensions:["ser"]},"application/java-vm":{source:"apache",extensions:["class"]},"application/javascript":{source:"iana",charset:"UTF-8",extensions:["js","mjs"]},"application/json":{source:"iana",charset:"UTF-8",extensions:["json","map"]},"application/jsonml+json":{source:"apache",extensions:["jsonml"]},"application/ld+json":{source:"iana",extensions:["jsonld"]},"application/lgr+xml":{source:"iana",extensions:["lgr"]},"application/lost+xml":{source:"iana",extensions:["lostxml"]},"application/mac-binhex40":{source:"iana",extensions:["hqx"]},"application/mac-compactpro":{source:"apache",extensions:["cpt"]},"application/mads+xml":{source:"iana",extensions:["mads"]},"application/manifest+json":{source:"iana",charset:"UTF-8",extensions:["webmanifest"]},"application/marc":{source:"iana",extensions:["mrc"]},"application/marcxml+xml":{source:"iana",extensions:["mrcx"]},"application/mathematica":{source:"iana",extensions:["ma","nb","mb"]},"application/mathml+xml":{source:"iana",extensions:["mathml"]},"application/mbox":{source:"iana",extensions:["mbox"]},"application/media-policy-dataset+xml":{source:"iana",extensions:["mpf"]},"application/mediaservercontrol+xml":{source:"iana",extensions:["mscml"]},"application/metalink+xml":{source:"apache",extensions:["metalink"]},"application/metalink4+xml":{source:"iana",extensions:["meta4"]},"application/mets+xml":{source:"iana",extensions:["mets"]},"application/mmt-aei+xml":{source:"iana",extensions:["maei"]},"application/mmt-usd+xml":{source:"iana",extensions:["musd"]},"application/mods+xml":{source:"iana",extensions:["mods"]},"application/mp21":{source:"iana",extensions:["m21","mp21"]},"application/mp4":{source:"iana",extensions:["mp4s","m4p"]},"application/msword":{source:"iana",extensions:["doc","dot"]},"application/mxf":{source:"iana",extensions:["mxf"]},"application/n-quads":{source:"iana",extensions:["nq"]},"application/n-triples":{source:"iana",extensions:["nt"]},"application/node":{source:"iana",extensions:["cjs"]},"application/octet-stream":{source:"iana",extensions:["bin","dms","lrf","mar","so","dist","distz","pkg","bpk","dump","elc","deploy","exe","dll","deb","dmg","iso","img","msi","msp","msm","buffer"]},"application/oda":{source:"iana",extensions:["oda"]},"application/oebps-package+xml":{source:"iana",extensions:["opf"]},"application/ogg":{source:"iana",extensions:["ogx"]},"application/omdoc+xml":{source:"apache",extensions:["omdoc"]},"application/onenote":{source:"apache",extensions:["onetoc","onetoc2","onetmp","onepkg"]},"application/oxps":{source:"iana",extensions:["oxps"]},"application/p2p-overlay+xml":{source:"iana",extensions:["relo"]},"application/patch-ops-error+xml":{source:"iana",extensions:["xer"]},"application/pdf":{source:"iana",extensions:["pdf"]},"application/pgp-encrypted":{source:"iana",extensions:["pgp"]},"application/pgp-keys":{source:"iana",extensions:["asc"]},"application/pgp-signature":{source:"iana",extensions:["asc","sig"]},"application/pics-rules":{source:"apache",extensions:["prf"]},"application/pkcs10":{source:"iana",extensions:["p10"]},"application/pkcs7-mime":{source:"iana",extensions:["p7m","p7c"]},"application/pkcs7-signature":{source:"iana",extensions:["p7s"]},"application/pkcs8":{source:"iana",extensions:["p8"]},"application/pkix-attr-cert":{source:"iana",extensions:["ac"]},"application/pkix-cert":{source:"iana",extensions:["cer"]},"application/pkix-crl":{source:"iana",extensions:["crl"]},"application/pkix-pkipath":{source:"iana",extensions:["pkipath"]},"application/pkixcmp":{source:"iana",extensions:["pki"]},"application/pls+xml":{source:"iana",extensions:["pls"]},"application/postscript":{source:"iana",extensions:["ai","eps","ps"]},"application/provenance+xml":{source:"iana",extensions:["provx"]},"application/prs.cww":{source:"iana",extensions:["cww"]},"application/pskc+xml":{source:"iana",extensions:["pskcxml"]},"application/rdf+xml":{source:"iana",extensions:["rdf","owl"]},"application/reginfo+xml":{source:"iana",extensions:["rif"]},"application/relax-ng-compact-syntax":{source:"iana",extensions:["rnc"]},"application/resource-lists+xml":{source:"iana",extensions:["rl"]},"application/resource-lists-diff+xml":{source:"iana",extensions:["rld"]},"application/rls-services+xml":{source:"iana",extensions:["rs"]},"application/route-apd+xml":{source:"iana",extensions:["rapd"]},"application/route-s-tsid+xml":{source:"iana",extensions:["sls"]},"application/route-usd+xml":{source:"iana",extensions:["rusd"]},"application/rpki-ghostbusters":{source:"iana",extensions:["gbr"]},"application/rpki-manifest":{source:"iana",extensions:["mft"]},"application/rpki-roa":{source:"iana",extensions:["roa"]},"application/rsd+xml":{source:"apache",extensions:["rsd"]},"application/rss+xml":{source:"apache",extensions:["rss"]},"application/rtf":{source:"iana",extensions:["rtf"]},"application/sbml+xml":{source:"iana",extensions:["sbml"]},"application/scvp-cv-request":{source:"iana",extensions:["scq"]},"application/scvp-cv-response":{source:"iana",extensions:["scs"]},"application/scvp-vp-request":{source:"iana",extensions:["spq"]},"application/scvp-vp-response":{source:"iana",extensions:["spp"]},"application/sdp":{source:"iana",extensions:["sdp"]},"application/senml+xml":{source:"iana",extensions:["senmlx"]},"application/sensml+xml":{source:"iana",extensions:["sensmlx"]},"application/set-payment-initiation":{source:"iana",extensions:["setpay"]},"application/set-registration-initiation":{source:"iana",extensions:["setreg"]},"application/shf+xml":{source:"iana",extensions:["shf"]},"application/sieve":{source:"iana",extensions:["siv","sieve"]},"application/smil+xml":{source:"iana",extensions:["smi","smil"]},"application/sparql-query":{source:"iana",extensions:["rq"]},"application/sparql-results+xml":{source:"iana",extensions:["srx"]},"application/srgs":{source:"iana",extensions:["gram"]},"application/srgs+xml":{source:"iana",extensions:["grxml"]},"application/sru+xml":{source:"iana",extensions:["sru"]},"application/ssdl+xml":{source:"apache",extensions:["ssdl"]},"application/ssml+xml":{source:"iana",extensions:["ssml"]},"application/swid+xml":{source:"iana",extensions:["swidtag"]},"application/tei+xml":{source:"iana",extensions:["tei","teicorpus"]},"application/thraud+xml":{source:"iana",extensions:["tfi"]},"application/timestamped-data":{source:"iana",extensions:["tsd"]},"application/trig":{source:"iana",extensions:["trig"]},"application/ttml+xml":{source:"iana",extensions:["ttml"]},"application/urc-ressheet+xml":{source:"iana",extensions:["rsheet"]},"application/urc-targetdesc+xml":{source:"iana",extensions:["td"]},"application/vnd.1000minds.decision-model+xml":{source:"iana",extensions:["1km"]},"application/vnd.3gpp.pic-bw-large":{source:"iana",extensions:["plb"]},"application/vnd.3gpp.pic-bw-small":{source:"iana",extensions:["psb"]},"application/vnd.3gpp.pic-bw-var":{source:"iana",extensions:["pvb"]},"application/vnd.3gpp2.tcap":{source:"iana",extensions:["tcap"]},"application/vnd.3m.post-it-notes":{source:"iana",extensions:["pwn"]},"application/vnd.accpac.simply.aso":{source:"iana",extensions:["aso"]},"application/vnd.accpac.simply.imp":{source:"iana",extensions:["imp"]},"application/vnd.acucobol":{source:"iana",extensions:["acu"]},"application/vnd.acucorp":{source:"iana",extensions:["atc","acutc"]},"application/vnd.adobe.air-application-installer-package+zip":{source:"apache",extensions:["air"]},"application/vnd.adobe.formscentral.fcdt":{source:"iana",extensions:["fcdt"]},"application/vnd.adobe.fxp":{source:"iana",extensions:["fxp","fxpl"]},"application/vnd.adobe.xdp+xml":{source:"iana",extensions:["xdp"]},"application/vnd.adobe.xfdf":{source:"iana",extensions:["xfdf"]},"application/vnd.age":{source:"iana",extensions:["age"]},"application/vnd.ahead.space":{source:"iana",extensions:["ahead"]},"application/vnd.airzip.filesecure.azf":{source:"iana",extensions:["azf"]},"application/vnd.airzip.filesecure.azs":{source:"iana",extensions:["azs"]},"application/vnd.amazon.ebook":{source:"apache",extensions:["azw"]},"application/vnd.americandynamics.acc":{source:"iana",extensions:["acc"]},"application/vnd.amiga.ami":{source:"iana",extensions:["ami"]},"application/vnd.android.package-archive":{source:"apache",extensions:["apk"]},"application/vnd.anser-web-certificate-issue-initiation":{source:"iana",extensions:["cii"]},"application/vnd.anser-web-funds-transfer-initiation":{source:"apache",extensions:["fti"]},"application/vnd.antix.game-component":{source:"iana",extensions:["atx"]},"application/vnd.apple.installer+xml":{source:"iana",extensions:["mpkg"]},"application/vnd.apple.keynote":{source:"iana",extensions:["key"]},"application/vnd.apple.mpegurl":{source:"iana",extensions:["m3u8"]},"application/vnd.apple.numbers":{source:"iana",extensions:["numbers"]},"application/vnd.apple.pages":{source:"iana",extensions:["pages"]},"application/vnd.aristanetworks.swi":{source:"iana",extensions:["swi"]},"application/vnd.astraea-software.iota":{source:"iana",extensions:["iota"]},"application/vnd.audiograph":{source:"iana",extensions:["aep"]},"application/vnd.balsamiq.bmml+xml":{source:"iana",extensions:["bmml"]},"application/vnd.blueice.multipass":{source:"iana",extensions:["mpm"]},"application/vnd.bmi":{source:"iana",extensions:["bmi"]},"application/vnd.businessobjects":{source:"iana",extensions:["rep"]},"application/vnd.chemdraw+xml":{source:"iana",extensions:["cdxml"]},"application/vnd.chipnuts.karaoke-mmd":{source:"iana",extensions:["mmd"]},"application/vnd.cinderella":{source:"iana",extensions:["cdy"]},"application/vnd.citationstyles.style+xml":{source:"iana",extensions:["csl"]},"application/vnd.claymore":{source:"iana",extensions:["cla"]},"application/vnd.cloanto.rp9":{source:"iana",extensions:["rp9"]},"application/vnd.clonk.c4group":{source:"iana",extensions:["c4g","c4d","c4f","c4p","c4u"]},"application/vnd.cluetrust.cartomobile-config":{source:"iana",extensions:["c11amc"]},"application/vnd.cluetrust.cartomobile-config-pkg":{source:"iana",extensions:["c11amz"]},"application/vnd.commonspace":{source:"iana",extensions:["csp"]},"application/vnd.contact.cmsg":{source:"iana",extensions:["cdbcmsg"]},"application/vnd.cosmocaller":{source:"iana",extensions:["cmc"]},"application/vnd.crick.clicker":{source:"iana",extensions:["clkx"]},"application/vnd.crick.clicker.keyboard":{source:"iana",extensions:["clkk"]},"application/vnd.crick.clicker.palette":{source:"iana",extensions:["clkp"]},"application/vnd.crick.clicker.template":{source:"iana",extensions:["clkt"]},"application/vnd.crick.clicker.wordbank":{source:"iana",extensions:["clkw"]},"application/vnd.criticaltools.wbs+xml":{source:"iana",extensions:["wbs"]},"application/vnd.ctc-posml":{source:"iana",extensions:["pml"]},"application/vnd.cups-ppd":{source:"iana",extensions:["ppd"]},"application/vnd.curl.car":{source:"apache",extensions:["car"]},"application/vnd.curl.pcurl":{source:"apache",extensions:["pcurl"]},"application/vnd.dart":{source:"iana",extensions:["dart"]},"application/vnd.data-vision.rdz":{source:"iana",extensions:["rdz"]},"application/vnd.dbf":{source:"iana",extensions:["dbf"]},"application/vnd.dece.data":{source:"iana",extensions:["uvf","uvvf","uvd","uvvd"]},"application/vnd.dece.ttml+xml":{source:"iana",extensions:["uvt","uvvt"]},"application/vnd.dece.unspecified":{source:"iana",extensions:["uvx","uvvx"]},"application/vnd.dece.zip":{source:"iana",extensions:["uvz","uvvz"]},"application/vnd.denovo.fcselayout-link":{source:"iana",extensions:["fe_launch"]},"application/vnd.dna":{source:"iana",extensions:["dna"]},"application/vnd.dolby.mlp":{source:"apache",extensions:["mlp"]},"application/vnd.dpgraph":{source:"iana",extensions:["dpg"]},"application/vnd.dreamfactory":{source:"iana",extensions:["dfac"]},"application/vnd.ds-keypoint":{source:"apache",extensions:["kpxx"]},"application/vnd.dvb.ait":{source:"iana",extensions:["ait"]},"application/vnd.dvb.service":{source:"iana",extensions:["svc"]},"application/vnd.dynageo":{source:"iana",extensions:["geo"]},"application/vnd.ecowin.chart":{source:"iana",extensions:["mag"]},"application/vnd.enliven":{source:"iana",extensions:["nml"]},"application/vnd.epson.esf":{source:"iana",extensions:["esf"]},"application/vnd.epson.msf":{source:"iana",extensions:["msf"]},"application/vnd.epson.quickanime":{source:"iana",extensions:["qam"]},"application/vnd.epson.salt":{source:"iana",extensions:["slt"]},"application/vnd.epson.ssf":{source:"iana",extensions:["ssf"]},"application/vnd.eszigno3+xml":{source:"iana",extensions:["es3","et3"]},"application/vnd.ezpix-album":{source:"iana",extensions:["ez2"]},"application/vnd.ezpix-package":{source:"iana",extensions:["ez3"]},"application/vnd.fdf":{source:"iana",extensions:["fdf"]},"application/vnd.fdsn.mseed":{source:"iana",extensions:["mseed"]},"application/vnd.fdsn.seed":{source:"iana",extensions:["seed","dataless"]},"application/vnd.flographit":{source:"iana",extensions:["gph"]},"application/vnd.fluxtime.clip":{source:"iana",extensions:["ftc"]},"application/vnd.framemaker":{source:"iana",extensions:["fm","frame","maker","book"]},"application/vnd.frogans.fnc":{source:"iana",extensions:["fnc"]},"application/vnd.frogans.ltf":{source:"iana",extensions:["ltf"]},"application/vnd.fsc.weblaunch":{source:"iana",extensions:["fsc"]},"application/vnd.fujitsu.oasys":{source:"iana",extensions:["oas"]},"application/vnd.fujitsu.oasys2":{source:"iana",extensions:["oa2"]},"application/vnd.fujitsu.oasys3":{source:"iana",extensions:["oa3"]},"application/vnd.fujitsu.oasysgp":{source:"iana",extensions:["fg5"]},"application/vnd.fujitsu.oasysprs":{source:"iana",extensions:["bh2"]},"application/vnd.fujixerox.ddd":{source:"iana",extensions:["ddd"]},"application/vnd.fujixerox.docuworks":{source:"iana",extensions:["xdw"]},"application/vnd.fujixerox.docuworks.binder":{source:"iana",extensions:["xbd"]},"application/vnd.fuzzysheet":{source:"iana",extensions:["fzs"]},"application/vnd.genomatix.tuxedo":{source:"iana",extensions:["txd"]},"application/vnd.geogebra.file":{source:"iana",extensions:["ggb"]},"application/vnd.geogebra.tool":{source:"iana",extensions:["ggt"]},"application/vnd.geometry-explorer":{source:"iana",extensions:["gex","gre"]},"application/vnd.geonext":{source:"iana",extensions:["gxt"]},"application/vnd.geoplan":{source:"iana",extensions:["g2w"]},"application/vnd.geospace":{source:"iana",extensions:["g3w"]},"application/vnd.gmx":{source:"iana",extensions:["gmx"]},"application/vnd.google-earth.kml+xml":{source:"iana",extensions:["kml"]},"application/vnd.google-earth.kmz":{source:"iana",extensions:["kmz"]},"application/vnd.grafeq":{source:"iana",extensions:["gqf","gqs"]},"application/vnd.groove-account":{source:"iana",extensions:["gac"]},"application/vnd.groove-help":{source:"iana",extensions:["ghf"]},"application/vnd.groove-identity-message":{source:"iana",extensions:["gim"]},"application/vnd.groove-injector":{source:"iana",extensions:["grv"]},"application/vnd.groove-tool-message":{source:"iana",extensions:["gtm"]},"application/vnd.groove-tool-template":{source:"iana",extensions:["tpl"]},"application/vnd.groove-vcard":{source:"iana",extensions:["vcg"]},"application/vnd.hal+xml":{source:"iana",extensions:["hal"]},"application/vnd.handheld-entertainment+xml":{source:"iana",extensions:["zmm"]},"application/vnd.hbci":{source:"iana",extensions:["hbci"]},"application/vnd.hhe.lesson-player":{source:"iana",extensions:["les"]},"application/vnd.hp-hpgl":{source:"iana",extensions:["hpgl"]},"application/vnd.hp-hpid":{source:"iana",extensions:["hpid"]},"application/vnd.hp-hps":{source:"iana",extensions:["hps"]},"application/vnd.hp-jlyt":{source:"iana",extensions:["jlt"]},"application/vnd.hp-pcl":{source:"iana",extensions:["pcl"]},"application/vnd.hp-pclxl":{source:"iana",extensions:["pclxl"]},"application/vnd.hydrostatix.sof-data":{source:"iana",extensions:["sfd-hdstx"]},"application/vnd.ibm.minipay":{source:"iana",extensions:["mpy"]},"application/vnd.ibm.modcap":{source:"iana",extensions:["afp","listafp","list3820"]},"application/vnd.ibm.rights-management":{source:"iana",extensions:["irm"]},"application/vnd.ibm.secure-container":{source:"iana",extensions:["sc"]},"application/vnd.iccprofile":{source:"iana",extensions:["icc","icm"]},"application/vnd.igloader":{source:"iana",extensions:["igl"]},"application/vnd.immervision-ivp":{source:"iana",extensions:["ivp"]},"application/vnd.immervision-ivu":{source:"iana",extensions:["ivu"]},"application/vnd.insors.igm":{source:"iana",extensions:["igm"]},"application/vnd.intercon.formnet":{source:"iana",extensions:["xpw","xpx"]},"application/vnd.intergeo":{source:"iana",extensions:["i2g"]},"application/vnd.intu.qbo":{source:"iana",extensions:["qbo"]},"application/vnd.intu.qfx":{source:"iana",extensions:["qfx"]},"application/vnd.ipunplugged.rcprofile":{source:"iana",extensions:["rcprofile"]},"application/vnd.irepository.package+xml":{source:"iana",extensions:["irp"]},"application/vnd.is-xpr":{source:"iana",extensions:["xpr"]},"application/vnd.isac.fcs":{source:"iana",extensions:["fcs"]},"application/vnd.jam":{source:"iana",extensions:["jam"]},"application/vnd.jcp.javame.midlet-rms":{source:"iana",extensions:["rms"]},"application/vnd.jisp":{source:"iana",extensions:["jisp"]},"application/vnd.joost.joda-archive":{source:"iana",extensions:["joda"]},"application/vnd.kahootz":{source:"iana",extensions:["ktz","ktr"]},"application/vnd.kde.karbon":{source:"iana",extensions:["karbon"]},"application/vnd.kde.kchart":{source:"iana",extensions:["chrt"]},"application/vnd.kde.kformula":{source:"iana",extensions:["kfo"]},"application/vnd.kde.kivio":{source:"iana",extensions:["flw"]},"application/vnd.kde.kontour":{source:"iana",extensions:["kon"]},"application/vnd.kde.kpresenter":{source:"iana",extensions:["kpr","kpt"]},"application/vnd.kde.kspread":{source:"iana",extensions:["ksp"]},"application/vnd.kde.kword":{source:"iana",extensions:["kwd","kwt"]},"application/vnd.kenameaapp":{source:"iana",extensions:["htke"]},"application/vnd.kidspiration":{source:"iana",extensions:["kia"]},"application/vnd.kinar":{source:"iana",extensions:["kne","knp"]},"application/vnd.koan":{source:"iana",extensions:["skp","skd","skt","skm"]},"application/vnd.kodak-descriptor":{source:"iana",extensions:["sse"]},"application/vnd.las.las+xml":{source:"iana",extensions:["lasxml"]},"application/vnd.llamagraphics.life-balance.desktop":{source:"iana",extensions:["lbd"]},"application/vnd.llamagraphics.life-balance.exchange+xml":{source:"iana",extensions:["lbe"]},"application/vnd.lotus-1-2-3":{source:"iana",extensions:["123"]},"application/vnd.lotus-approach":{source:"iana",extensions:["apr"]},"application/vnd.lotus-freelance":{source:"iana",extensions:["pre"]},"application/vnd.lotus-notes":{source:"iana",extensions:["nsf"]},"application/vnd.lotus-organizer":{source:"iana",extensions:["org"]},"application/vnd.lotus-screencam":{source:"iana",extensions:["scm"]},"application/vnd.lotus-wordpro":{source:"iana",extensions:["lwp"]},"application/vnd.macports.portpkg":{source:"iana",extensions:["portpkg"]},"application/vnd.mapbox-vector-tile":{source:"iana",extensions:["mvt"]},"application/vnd.mcd":{source:"iana",extensions:["mcd"]},"application/vnd.medcalcdata":{source:"iana",extensions:["mc1"]},"application/vnd.mediastation.cdkey":{source:"iana",extensions:["cdkey"]},"application/vnd.mfer":{source:"iana",extensions:["mwf"]},"application/vnd.mfmp":{source:"iana",extensions:["mfm"]},"application/vnd.micrografx.flo":{source:"iana",extensions:["flo"]},"application/vnd.micrografx.igx":{source:"iana",extensions:["igx"]},"application/vnd.mif":{source:"iana",extensions:["mif"]},"application/vnd.mobius.daf":{source:"iana",extensions:["daf"]},"application/vnd.mobius.dis":{source:"iana",extensions:["dis"]},"application/vnd.mobius.mbk":{source:"iana",extensions:["mbk"]},"application/vnd.mobius.mqy":{source:"iana",extensions:["mqy"]},"application/vnd.mobius.msl":{source:"iana",extensions:["msl"]},"application/vnd.mobius.plc":{source:"iana",extensions:["plc"]},"application/vnd.mobius.txf":{source:"iana",extensions:["txf"]},"application/vnd.mophun.application":{source:"iana",extensions:["mpn"]},"application/vnd.mophun.certificate":{source:"iana",extensions:["mpc"]},"application/vnd.mozilla.xul+xml":{source:"iana",extensions:["xul"]},"application/vnd.ms-artgalry":{source:"iana",extensions:["cil"]},"application/vnd.ms-cab-compressed":{source:"iana",extensions:["cab"]},"application/vnd.ms-excel":{source:"iana",extensions:["xls","xlm","xla","xlc","xlt","xlw"]},"application/vnd.ms-excel.addin.macroenabled.12":{source:"iana",extensions:["xlam"]},"application/vnd.ms-excel.sheet.binary.macroenabled.12":{source:"iana",extensions:["xlsb"]},"application/vnd.ms-excel.sheet.macroenabled.12":{source:"iana",extensions:["xlsm"]},"application/vnd.ms-excel.template.macroenabled.12":{source:"iana",extensions:["xltm"]},"application/vnd.ms-fontobject":{source:"iana",extensions:["eot"]},"application/vnd.ms-htmlhelp":{source:"iana",extensions:["chm"]},"application/vnd.ms-ims":{source:"iana",extensions:["ims"]},"application/vnd.ms-lrm":{source:"iana",extensions:["lrm"]},"application/vnd.ms-officetheme":{source:"iana",extensions:["thmx"]},"application/vnd.ms-pki.seccat":{source:"apache",extensions:["cat"]},"application/vnd.ms-pki.stl":{source:"apache",extensions:["stl"]},"application/vnd.ms-powerpoint":{source:"iana",extensions:["ppt","pps","pot"]},"application/vnd.ms-powerpoint.addin.macroenabled.12":{source:"iana",extensions:["ppam"]},"application/vnd.ms-powerpoint.presentation.macroenabled.12":{source:"iana",extensions:["pptm"]},"application/vnd.ms-powerpoint.slide.macroenabled.12":{source:"iana",extensions:["sldm"]},"application/vnd.ms-powerpoint.slideshow.macroenabled.12":{source:"iana",extensions:["ppsm"]},"application/vnd.ms-powerpoint.template.macroenabled.12":{source:"iana",extensions:["potm"]},"application/vnd.ms-project":{source:"iana",extensions:["mpp","mpt"]},"application/vnd.ms-word.document.macroenabled.12":{source:"iana",extensions:["docm"]},"application/vnd.ms-word.template.macroenabled.12":{source:"iana",extensions:["dotm"]},"application/vnd.ms-works":{source:"iana",extensions:["wps","wks","wcm","wdb"]},"application/vnd.ms-wpl":{source:"iana",extensions:["wpl"]},"application/vnd.ms-xpsdocument":{source:"iana",extensions:["xps"]},"application/vnd.mseq":{source:"iana",extensions:["mseq"]},"application/vnd.musician":{source:"iana",extensions:["mus"]},"application/vnd.muvee.style":{source:"iana",extensions:["msty"]},"application/vnd.mynfc":{source:"iana",extensions:["taglet"]},"application/vnd.neurolanguage.nlu":{source:"iana",extensions:["nlu"]},"application/vnd.nitf":{source:"iana",extensions:["ntf","nitf"]},"application/vnd.noblenet-directory":{source:"iana",extensions:["nnd"]},"application/vnd.noblenet-sealer":{source:"iana",extensions:["nns"]},"application/vnd.noblenet-web":{source:"iana",extensions:["nnw"]},"application/vnd.nokia.n-gage.ac+xml":{source:"iana",extensions:["ac"]},"application/vnd.nokia.n-gage.data":{source:"iana",extensions:["ngdat"]},"application/vnd.nokia.n-gage.symbian.install":{source:"iana",extensions:["n-gage"]},"application/vnd.nokia.radio-preset":{source:"iana",extensions:["rpst"]},"application/vnd.nokia.radio-presets":{source:"iana",extensions:["rpss"]},"application/vnd.novadigm.edm":{source:"iana",extensions:["edm"]},"application/vnd.novadigm.edx":{source:"iana",extensions:["edx"]},"application/vnd.novadigm.ext":{source:"iana",extensions:["ext"]},"application/vnd.oasis.opendocument.chart":{source:"iana",extensions:["odc"]},"application/vnd.oasis.opendocument.chart-template":{source:"iana",extensions:["otc"]},"application/vnd.oasis.opendocument.database":{source:"iana",extensions:["odb"]},"application/vnd.oasis.opendocument.formula":{source:"iana",extensions:["odf"]},"application/vnd.oasis.opendocument.formula-template":{source:"iana",extensions:["odft"]},"application/vnd.oasis.opendocument.graphics":{source:"iana",extensions:["odg"]},"application/vnd.oasis.opendocument.graphics-template":{source:"iana",extensions:["otg"]},"application/vnd.oasis.opendocument.image":{source:"iana",extensions:["odi"]},"application/vnd.oasis.opendocument.image-template":{source:"iana",extensions:["oti"]},"application/vnd.oasis.opendocument.presentation":{source:"iana",extensions:["odp"]},"application/vnd.oasis.opendocument.presentation-template":{source:"iana",extensions:["otp"]},"application/vnd.oasis.opendocument.spreadsheet":{source:"iana",extensions:["ods"]},"application/vnd.oasis.opendocument.spreadsheet-template":{source:"iana",extensions:["ots"]},"application/vnd.oasis.opendocument.text":{source:"iana",extensions:["odt"]},"application/vnd.oasis.opendocument.text-master":{source:"iana",extensions:["odm"]},"application/vnd.oasis.opendocument.text-template":{source:"iana",extensions:["ott"]},"application/vnd.oasis.opendocument.text-web":{source:"iana",extensions:["oth"]},"application/vnd.olpc-sugar":{source:"iana",extensions:["xo"]},"application/vnd.oma.dd2+xml":{source:"iana",extensions:["dd2"]},"application/vnd.openblox.game+xml":{source:"iana",extensions:["obgx"]},"application/vnd.openofficeorg.extension":{source:"apache",extensions:["oxt"]},"application/vnd.openstreetmap.data+xml":{source:"iana",extensions:["osm"]},"application/vnd.openxmlformats-officedocument.presentationml.presentation":{source:"iana",extensions:["pptx"]},"application/vnd.openxmlformats-officedocument.presentationml.slide":{source:"iana",extensions:["sldx"]},"application/vnd.openxmlformats-officedocument.presentationml.slideshow":{source:"iana",extensions:["ppsx"]},"application/vnd.openxmlformats-officedocument.presentationml.template":{source:"iana",extensions:["potx"]},"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet":{source:"iana",extensions:["xlsx"]},"application/vnd.openxmlformats-officedocument.spreadsheetml.template":{source:"iana",extensions:["xltx"]},"application/vnd.openxmlformats-officedocument.wordprocessingml.document":{source:"iana",extensions:["docx"]},"application/vnd.openxmlformats-officedocument.wordprocessingml.template":{source:"iana",extensions:["dotx"]},"application/vnd.osgeo.mapguide.package":{source:"iana",extensions:["mgp"]},"application/vnd.osgi.dp":{source:"iana",extensions:["dp"]},"application/vnd.osgi.subsystem":{source:"iana",extensions:["esa"]},"application/vnd.palm":{source:"iana",extensions:["pdb","pqa","oprc"]},"application/vnd.pawaafile":{source:"iana",extensions:["paw"]},"application/vnd.pg.format":{source:"iana",extensions:["str"]},"application/vnd.pg.osasli":{source:"iana",extensions:["ei6"]},"application/vnd.picsel":{source:"iana",extensions:["efif"]},"application/vnd.pmi.widget":{source:"iana",extensions:["wg"]},"application/vnd.pocketlearn":{source:"iana",extensions:["plf"]},"application/vnd.powerbuilder6":{source:"iana",extensions:["pbd"]},"application/vnd.previewsystems.box":{source:"iana",extensions:["box"]},"application/vnd.proteus.magazine":{source:"iana",extensions:["mgz"]},"application/vnd.publishare-delta-tree":{source:"iana",extensions:["qps"]},"application/vnd.pvi.ptid1":{source:"iana",extensions:["ptid"]},"application/vnd.quark.quarkxpress":{source:"iana",extensions:["qxd","qxt","qwd","qwt","qxl","qxb"]},"application/vnd.rar":{source:"iana",extensions:["rar"]},"application/vnd.realvnc.bed":{source:"iana",extensions:["bed"]},"application/vnd.recordare.musicxml":{source:"iana",extensions:["mxl"]},"application/vnd.recordare.musicxml+xml":{source:"iana",extensions:["musicxml"]},"application/vnd.rig.cryptonote":{source:"iana",extensions:["cryptonote"]},"application/vnd.rim.cod":{source:"apache",extensions:["cod"]},"application/vnd.rn-realmedia":{source:"apache",extensions:["rm"]},"application/vnd.rn-realmedia-vbr":{source:"apache",extensions:["rmvb"]},"application/vnd.route66.link66+xml":{source:"iana",extensions:["link66"]},"application/vnd.sailingtracker.track":{source:"iana",extensions:["st"]},"application/vnd.seemail":{source:"iana",extensions:["see"]},"application/vnd.sema":{source:"iana",extensions:["sema"]},"application/vnd.semd":{source:"iana",extensions:["semd"]},"application/vnd.semf":{source:"iana",extensions:["semf"]},"application/vnd.shana.informed.formdata":{source:"iana",extensions:["ifm"]},"application/vnd.shana.informed.formtemplate":{source:"iana",extensions:["itp"]},"application/vnd.shana.informed.interchange":{source:"iana",extensions:["iif"]},"application/vnd.shana.informed.package":{source:"iana",extensions:["ipk"]},"application/vnd.simtech-mindmapper":{source:"iana",extensions:["twd","twds"]},"application/vnd.smaf":{source:"iana",extensions:["mmf"]},"application/vnd.smart.teacher":{source:"iana",extensions:["teacher"]},"application/vnd.software602.filler.form+xml":{source:"iana",extensions:["fo"]},"application/vnd.solent.sdkm+xml":{source:"iana",extensions:["sdkm","sdkd"]},"application/vnd.spotfire.dxp":{source:"iana",extensions:["dxp"]},"application/vnd.spotfire.sfs":{source:"iana",extensions:["sfs"]},"application/vnd.stardivision.calc":{source:"apache",extensions:["sdc"]},"application/vnd.stardivision.draw":{source:"apache",extensions:["sda"]},"application/vnd.stardivision.impress":{source:"apache",extensions:["sdd"]},"application/vnd.stardivision.math":{source:"apache",extensions:["smf"]},"application/vnd.stardivision.writer":{source:"apache",extensions:["sdw","vor"]},"application/vnd.stardivision.writer-global":{source:"apache",extensions:["sgl"]},"application/vnd.stepmania.package":{source:"iana",extensions:["smzip"]},"application/vnd.stepmania.stepchart":{source:"iana",extensions:["sm"]},"application/vnd.sun.wadl+xml":{source:"iana",extensions:["wadl"]},"application/vnd.sun.xml.calc":{source:"apache",extensions:["sxc"]},"application/vnd.sun.xml.calc.template":{source:"apache",extensions:["stc"]},"application/vnd.sun.xml.draw":{source:"apache",extensions:["sxd"]},"application/vnd.sun.xml.draw.template":{source:"apache",extensions:["std"]},"application/vnd.sun.xml.impress":{source:"apache",extensions:["sxi"]},"application/vnd.sun.xml.impress.template":{source:"apache",extensions:["sti"]},"application/vnd.sun.xml.math":{source:"apache",extensions:["sxm"]},"application/vnd.sun.xml.writer":{source:"apache",extensions:["sxw"]},"application/vnd.sun.xml.writer.global":{source:"apache",extensions:["sxg"]},"application/vnd.sun.xml.writer.template":{source:"apache",extensions:["stw"]},"application/vnd.sus-calendar":{source:"iana",extensions:["sus","susp"]},"application/vnd.svd":{source:"iana",extensions:["svd"]},"application/vnd.symbian.install":{source:"apache",extensions:["sis","sisx"]},"application/vnd.syncml+xml":{source:"iana",charset:"UTF-8",extensions:["xsm"]},"application/vnd.syncml.dm+wbxml":{source:"iana",charset:"UTF-8",extensions:["bdm"]},"application/vnd.syncml.dm+xml":{source:"iana",charset:"UTF-8",extensions:["xdm"]},"application/vnd.syncml.dmddf+xml":{source:"iana",charset:"UTF-8",extensions:["ddf"]},"application/vnd.tao.intent-module-archive":{source:"iana",extensions:["tao"]},"application/vnd.tcpdump.pcap":{source:"iana",extensions:["pcap","cap","dmp"]},"application/vnd.tmobile-livetv":{source:"iana",extensions:["tmo"]},"application/vnd.trid.tpt":{source:"iana",extensions:["tpt"]},"application/vnd.triscape.mxs":{source:"iana",extensions:["mxs"]},"application/vnd.trueapp":{source:"iana",extensions:["tra"]},"application/vnd.ufdl":{source:"iana",extensions:["ufd","ufdl"]},"application/vnd.uiq.theme":{source:"iana",extensions:["utz"]},"application/vnd.umajin":{source:"iana",extensions:["umj"]},"application/vnd.unity":{source:"iana",extensions:["unityweb"]},"application/vnd.uoml+xml":{source:"iana",extensions:["uoml"]},"application/vnd.vcx":{source:"iana",extensions:["vcx"]},"application/vnd.visio":{source:"iana",extensions:["vsd","vst","vss","vsw"]},"application/vnd.visionary":{source:"iana",extensions:["vis"]},"application/vnd.vsf":{source:"iana",extensions:["vsf"]},"application/vnd.wap.wbxml":{source:"iana",charset:"UTF-8",extensions:["wbxml"]},"application/vnd.wap.wmlc":{source:"iana",extensions:["wmlc"]},"application/vnd.wap.wmlscriptc":{source:"iana",extensions:["wmlsc"]},"application/vnd.webturbo":{source:"iana",extensions:["wtb"]},"application/vnd.wolfram.player":{source:"iana",extensions:["nbp"]},"application/vnd.wordperfect":{source:"iana",extensions:["wpd"]},"application/vnd.wqd":{source:"iana",extensions:["wqd"]},"application/vnd.wt.stf":{source:"iana",extensions:["stf"]},"application/vnd.xara":{source:"iana",extensions:["xar"]},"application/vnd.xfdl":{source:"iana",extensions:["xfdl"]},"application/vnd.yamaha.hv-dic":{source:"iana",extensions:["hvd"]},"application/vnd.yamaha.hv-script":{source:"iana",extensions:["hvs"]},"application/vnd.yamaha.hv-voice":{source:"iana",extensions:["hvp"]},"application/vnd.yamaha.openscoreformat":{source:"iana",extensions:["osf"]},"application/vnd.yamaha.openscoreformat.osfpvg+xml":{source:"iana",extensions:["osfpvg"]},"application/vnd.yamaha.smaf-audio":{source:"iana",extensions:["saf"]},"application/vnd.yamaha.smaf-phrase":{source:"iana",extensions:["spf"]},"application/vnd.yellowriver-custom-menu":{source:"iana",extensions:["cmp"]},"application/vnd.zul":{source:"iana",extensions:["zir","zirz"]},"application/vnd.zzazz.deck+xml":{source:"iana",extensions:["zaz"]},"application/voicexml+xml":{source:"iana",extensions:["vxml"]},"application/wasm":{source:"iana",extensions:["wasm"]},"application/watcherinfo+xml":{source:"iana",extensions:["wif"]},"application/widget":{source:"iana",extensions:["wgt"]},"application/winhlp":{source:"apache",extensions:["hlp"]},"application/wsdl+xml":{source:"iana",extensions:["wsdl"]},"application/wspolicy+xml":{source:"iana",extensions:["wspolicy"]},"application/x-7z-compressed":{source:"apache",extensions:["7z"]},"application/x-abiword":{source:"apache",extensions:["abw"]},"application/x-ace-compressed":{source:"apache",extensions:["ace"]},"application/x-apple-diskimage":{source:"apache",extensions:["dmg"]},"application/x-authorware-bin":{source:"apache",extensions:["aab","x32","u32","vox"]},"application/x-authorware-map":{source:"apache",extensions:["aam"]},"application/x-authorware-seg":{source:"apache",extensions:["aas"]},"application/x-bcpio":{source:"apache",extensions:["bcpio"]},"application/x-bittorrent":{source:"apache",extensions:["torrent"]},"application/x-blorb":{source:"apache",extensions:["blb","blorb"]},"application/x-bzip":{source:"apache",extensions:["bz"]},"application/x-bzip2":{source:"apache",extensions:["bz2","boz"]},"application/x-cbr":{source:"apache",extensions:["cbr","cba","cbt","cbz","cb7"]},"application/x-cdlink":{source:"apache",extensions:["vcd"]},"application/x-cfs-compressed":{source:"apache",extensions:["cfs"]},"application/x-chat":{source:"apache",extensions:["chat"]},"application/x-chess-pgn":{source:"apache",extensions:["pgn"]},"application/x-cocoa":{source:"nginx",extensions:["cco"]},"application/x-conference":{source:"apache",extensions:["nsc"]},"application/x-cpio":{source:"apache",extensions:["cpio"]},"application/x-csh":{source:"apache",extensions:["csh"]},"application/x-debian-package":{source:"apache",extensions:["deb","udeb"]},"application/x-dgc-compressed":{source:"apache",extensions:["dgc"]},"application/x-director":{source:"apache",extensions:["dir","dcr","dxr","cst","cct","cxt","w3d","fgd","swa"]},"application/x-doom":{source:"apache",extensions:["wad"]},"application/x-dtbncx+xml":{source:"apache",extensions:["ncx"]},"application/x-dtbook+xml":{source:"apache",extensions:["dtb"]},"application/x-dtbresource+xml":{source:"apache",extensions:["res"]},"application/x-dvi":{source:"apache",extensions:["dvi"]},"application/x-envoy":{source:"apache",extensions:["evy"]},"application/x-eva":{source:"apache",extensions:["eva"]},"application/x-font-bdf":{source:"apache",extensions:["bdf"]},"application/x-font-ghostscript":{source:"apache",extensions:["gsf"]},"application/x-font-linux-psf":{source:"apache",extensions:["psf"]},"application/x-font-pcf":{source:"apache",extensions:["pcf"]},"application/x-font-snf":{source:"apache",extensions:["snf"]},"application/x-font-type1":{source:"apache",extensions:["pfa","pfb","pfm","afm"]},"application/x-freearc":{source:"apache",extensions:["arc"]},"application/x-futuresplash":{source:"apache",extensions:["spl"]},"application/x-gca-compressed":{source:"apache",extensions:["gca"]},"application/x-glulx":{source:"apache",extensions:["ulx"]},"application/x-gnumeric":{source:"apache",extensions:["gnumeric"]},"application/x-gramps-xml":{source:"apache",extensions:["gramps"]},"application/x-gtar":{source:"apache",extensions:["gtar"]},"application/x-hdf":{source:"apache",extensions:["hdf"]},"application/x-install-instructions":{source:"apache",extensions:["install"]},"application/x-iso9660-image":{source:"apache",extensions:["iso"]},"application/x-java-archive-diff":{source:"nginx",extensions:["jardiff"]},"application/x-java-jnlp-file":{source:"apache",extensions:["jnlp"]},"application/x-latex":{source:"apache",extensions:["latex"]},"application/x-lzh-compressed":{source:"apache",extensions:["lzh","lha"]},"application/x-makeself":{source:"nginx",extensions:["run"]},"application/x-mie":{source:"apache",extensions:["mie"]},"application/x-mobipocket-ebook":{source:"apache",extensions:["prc","mobi"]},"application/x-ms-application":{source:"apache",extensions:["application"]},"application/x-ms-shortcut":{source:"apache",extensions:["lnk"]},"application/x-ms-wmd":{source:"apache",extensions:["wmd"]},"application/x-ms-wmz":{source:"apache",extensions:["wmz"]},"application/x-ms-xbap":{source:"apache",extensions:["xbap"]},"application/x-msaccess":{source:"apache",extensions:["mdb"]},"application/x-msbinder":{source:"apache",extensions:["obd"]},"application/x-mscardfile":{source:"apache",extensions:["crd"]},"application/x-msclip":{source:"apache",extensions:["clp"]},"application/x-msdownload":{source:"apache",extensions:["exe","dll","com","bat","msi"]},"application/x-msmediaview":{source:"apache",extensions:["mvb","m13","m14"]},"application/x-msmetafile":{source:"apache",extensions:["wmf","wmz","emf","emz"]},"application/x-msmoney":{source:"apache",extensions:["mny"]},"application/x-mspublisher":{source:"apache",extensions:["pub"]},"application/x-msschedule":{source:"apache",extensions:["scd"]},"application/x-msterminal":{source:"apache",extensions:["trm"]},"application/x-mswrite":{source:"apache",extensions:["wri"]},"application/x-netcdf":{source:"apache",extensions:["nc","cdf"]},"application/x-nzb":{source:"apache",extensions:["nzb"]},"application/x-perl":{source:"nginx",extensions:["pl","pm"]},"application/x-pilot":{source:"nginx",extensions:["prc","pdb"]},"application/x-pkcs12":{source:"apache",extensions:["p12","pfx"]},"application/x-pkcs7-certificates":{source:"apache",extensions:["p7b","spc"]},"application/x-pkcs7-certreqresp":{source:"apache",extensions:["p7r"]},"application/x-rar-compressed":{source:"apache",extensions:["rar"]},"application/x-redhat-package-manager":{source:"nginx",extensions:["rpm"]},"application/x-research-info-systems":{source:"apache",extensions:["ris"]},"application/x-sea":{source:"nginx",extensions:["sea"]},"application/x-sh":{source:"apache",extensions:["sh"]},"application/x-shar":{source:"apache",extensions:["shar"]},"application/x-shockwave-flash":{source:"apache",extensions:["swf"]},"application/x-silverlight-app":{source:"apache",extensions:["xap"]},"application/x-sql":{source:"apache",extensions:["sql"]},"application/x-stuffit":{source:"apache",extensions:["sit"]},"application/x-stuffitx":{source:"apache",extensions:["sitx"]},"application/x-subrip":{source:"apache",extensions:["srt"]},"application/x-sv4cpio":{source:"apache",extensions:["sv4cpio"]},"application/x-sv4crc":{source:"apache",extensions:["sv4crc"]},"application/x-t3vm-image":{source:"apache",extensions:["t3"]},"application/x-tads":{source:"apache",extensions:["gam"]},"application/x-tar":{source:"apache",extensions:["tar"]},"application/x-tcl":{source:"apache",extensions:["tcl","tk"]},"application/x-tex":{source:"apache",extensions:["tex"]},"application/x-tex-tfm":{source:"apache",extensions:["tfm"]},"application/x-texinfo":{source:"apache",extensions:["texinfo","texi"]},"application/x-tgif":{source:"apache",extensions:["obj"]},"application/x-ustar":{source:"apache",extensions:["ustar"]},"application/x-wais-source":{source:"apache",extensions:["src"]},"application/x-x509-ca-cert":{source:"iana",extensions:["der","crt","pem"]},"application/x-xfig":{source:"apache",extensions:["fig"]},"application/x-xliff+xml":{source:"apache",extensions:["xlf"]},"application/x-xpinstall":{source:"apache",extensions:["xpi"]},"application/x-xz":{source:"apache",extensions:["xz"]},"application/x-zmachine":{source:"apache",extensions:["z1","z2","z3","z4","z5","z6","z7","z8"]},"application/xaml+xml":{source:"apache",extensions:["xaml"]},"application/xcap-att+xml":{source:"iana",extensions:["xav"]},"application/xcap-caps+xml":{source:"iana",extensions:["xca"]},"application/xcap-diff+xml":{source:"iana",extensions:["xdf"]},"application/xcap-el+xml":{source:"iana",extensions:["xel"]},"application/xcap-ns+xml":{source:"iana",extensions:["xns"]},"application/xenc+xml":{source:"iana",extensions:["xenc"]},"application/xhtml+xml":{source:"iana",extensions:["xhtml","xht"]},"application/xliff+xml":{source:"iana",extensions:["xlf"]},"application/xml":{source:"iana",extensions:["xml","xsl","xsd","rng"]},"application/xml-dtd":{source:"iana",extensions:["dtd"]},"application/xop+xml":{source:"iana",extensions:["xop"]},"application/xproc+xml":{source:"apache",extensions:["xpl"]},"application/xslt+xml":{source:"iana",extensions:["xsl","xslt"]},"application/xspf+xml":{source:"apache",extensions:["xspf"]},"application/xv+xml":{source:"iana",extensions:["mxml","xhvml","xvml","xvm"]},"application/yaml":{source:"iana",extensions:["yaml","yml"]},"application/yang":{source:"iana",extensions:["yang"]},"application/yin+xml":{source:"iana",extensions:["yin"]},"application/zip":{source:"iana",extensions:["zip"]},"audio/3gpp":{source:"iana",extensions:["3gpp"]},"audio/adpcm":{source:"apache",extensions:["adp"]},"audio/amr":{source:"iana",extensions:["amr"]},"audio/basic":{source:"iana",extensions:["au","snd"]},"audio/midi":{source:"apache",extensions:["mid","midi","kar","rmi"]},"audio/mobile-xmf":{source:"iana",extensions:["mxmf"]},"audio/mp4":{source:"iana",extensions:["m4a","mp4a"]},"audio/mpeg":{source:"iana",extensions:["mpga","mp2","mp2a","mp3","m2a","m3a"]},"audio/ogg":{source:"iana",extensions:["oga","ogg","spx","opus"]},"audio/s3m":{source:"apache",extensions:["s3m"]},"audio/silk":{source:"apache",extensions:["sil"]},"audio/vnd.dece.audio":{source:"iana",extensions:["uva","uvva"]},"audio/vnd.digital-winds":{source:"iana",extensions:["eol"]},"audio/vnd.dra":{source:"iana",extensions:["dra"]},"audio/vnd.dts":{source:"iana",extensions:["dts"]},"audio/vnd.dts.hd":{source:"iana",extensions:["dtshd"]},"audio/vnd.lucent.voice":{source:"iana",extensions:["lvp"]},"audio/vnd.ms-playready.media.pya":{source:"iana",extensions:["pya"]},"audio/vnd.nuera.ecelp4800":{source:"iana",extensions:["ecelp4800"]},"audio/vnd.nuera.ecelp7470":{source:"iana",extensions:["ecelp7470"]},"audio/vnd.nuera.ecelp9600":{source:"iana",extensions:["ecelp9600"]},"audio/vnd.rip":{source:"iana",extensions:["rip"]},"audio/webm":{source:"apache",extensions:["weba"]},"audio/x-aac":{source:"apache",extensions:["aac"]},"audio/x-aiff":{source:"apache",extensions:["aif","aiff","aifc"]},"audio/x-caf":{source:"apache",extensions:["caf"]},"audio/x-flac":{source:"apache",extensions:["flac"]},"audio/x-m4a":{source:"nginx",extensions:["m4a"]},"audio/x-matroska":{source:"apache",extensions:["mka"]},"audio/x-mpegurl":{source:"apache",extensions:["m3u"]},"audio/x-ms-wax":{source:"apache",extensions:["wax"]},"audio/x-ms-wma":{source:"apache",extensions:["wma"]},"audio/x-pn-realaudio":{source:"apache",extensions:["ram","ra"]},"audio/x-pn-realaudio-plugin":{source:"apache",extensions:["rmp"]},"audio/x-realaudio":{source:"nginx",extensions:["ra"]},"audio/x-wav":{source:"apache",extensions:["wav"]},"audio/x-gsm":{source:"apache",extensions:["gsm"]},"audio/xm":{source:"apache",extensions:["xm"]},"image/aces":{source:"iana",extensions:["exr"]},"image/avci":{source:"iana",extensions:["avci"]},"image/avcs":{source:"iana",extensions:["avcs"]},"image/avif":{source:"iana",extensions:["avif"]},"image/bmp":{source:"iana",extensions:["bmp"]},"image/cgm":{source:"iana",extensions:["cgm"]},"image/dicom-rle":{source:"iana",extensions:["drle"]},"image/emf":{source:"iana",extensions:["emf"]},"image/fits":{source:"iana",extensions:["fits"]},"image/g3fax":{source:"iana",extensions:["g3"]},"image/gif":{source:"iana",extensions:["gif"]},"image/heic":{source:"iana",extensions:["heic"]},"image/heic-sequence":{source:"iana",extensions:["heics"]},"image/heif":{source:"iana",extensions:["heif"]},"image/heif-sequence":{source:"iana",extensions:["heifs"]},"image/hej2k":{source:"iana",extensions:["hej2"]},"image/hsj2":{source:"iana",extensions:["hsj2"]},"image/ief":{source:"iana",extensions:["ief"]},"image/jls":{source:"iana",extensions:["jls"]},"image/jp2":{source:"iana",extensions:["jp2","jpg2"]},"image/jpeg":{source:"iana",extensions:["jpeg","jpg","jpe","jfif","pjpeg","pjp"]},"image/jph":{source:"iana",extensions:["jph"]},"image/jphc":{source:"iana",extensions:["jhc"]},"image/jpm":{source:"iana",extensions:["jpm"]},"image/jpx":{source:"iana",extensions:["jpx","jpf"]},"image/jxr":{source:"iana",extensions:["jxr"]},"image/jxra":{source:"iana",extensions:["jxra"]},"image/jxrs":{source:"iana",extensions:["jxrs"]},"image/jxs":{source:"iana",extensions:["jxs"]},"image/jxsc":{source:"iana",extensions:["jxsc"]},"image/jxsi":{source:"iana",extensions:["jxsi"]},"image/jxss":{source:"iana",extensions:["jxss"]},"image/ktx":{source:"iana",extensions:["ktx"]},"image/ktx2":{source:"iana",extensions:["ktx2"]},"image/png":{source:"iana",extensions:["png"]},"image/prs.btif":{source:"iana",extensions:["btif"]},"image/prs.pti":{source:"iana",extensions:["pti"]},"image/sgi":{source:"apache",extensions:["sgi"]},"image/svg+xml":{source:"iana",extensions:["svg","svgz"]},"image/t38":{source:"iana",extensions:["t38"]},"image/tiff":{source:"iana",extensions:["tif","tiff"]},"image/tiff-fx":{source:"iana",extensions:["tfx"]},"image/vnd.adobe.photoshop":{source:"iana",extensions:["psd"]},"image/vnd.airzip.accelerator.azv":{source:"iana",extensions:["azv"]},"image/vnd.dece.graphic":{source:"iana",extensions:["uvi","uvvi","uvg","uvvg"]},"image/vnd.djvu":{source:"iana",extensions:["djvu","djv"]},"image/vnd.dvb.subtitle":{source:"iana",extensions:["sub"]},"image/vnd.dwg":{source:"iana",extensions:["dwg"]},"image/vnd.dxf":{source:"iana",extensions:["dxf"]},"image/vnd.fastbidsheet":{source:"iana",extensions:["fbs"]},"image/vnd.fpx":{source:"iana",extensions:["fpx"]},"image/vnd.fst":{source:"iana",extensions:["fst"]},"image/vnd.fujixerox.edmics-mmr":{source:"iana",extensions:["mmr"]},"image/vnd.fujixerox.edmics-rlc":{source:"iana",extensions:["rlc"]},"image/vnd.microsoft.icon":{source:"iana",extensions:["ico"]},"image/vnd.ms-modi":{source:"iana",extensions:["mdi"]},"image/vnd.ms-photo":{source:"apache",extensions:["wdp"]},"image/vnd.net-fpx":{source:"iana",extensions:["npx"]},"image/vnd.pco.b16":{source:"iana",extensions:["b16"]},"image/vnd.tencent.tap":{source:"iana",extensions:["tap"]},"image/vnd.valve.source.texture":{source:"iana",extensions:["vtf"]},"image/vnd.wap.wbmp":{source:"iana",extensions:["wbmp"]},"image/vnd.xiff":{source:"iana",extensions:["xif"]},"image/vnd.zbrush.pcx":{source:"iana",extensions:["pcx"]},"image/webp":{source:"apache",extensions:["webp"]},"image/wmf":{source:"iana",extensions:["wmf"]},"image/x-3ds":{source:"apache",extensions:["3ds"]},"image/x-cmu-raster":{source:"apache",extensions:["ras"]},"image/x-cmx":{source:"apache",extensions:["cmx"]},"image/x-freehand":{source:"apache",extensions:["fh","fhc","fh4","fh5","fh7"]},"image/x-icon":{source:"apache",extensions:["ico"]},"image/x-jng":{source:"nginx",extensions:["jng"]},"image/x-mrsid-image":{source:"apache",extensions:["sid"]},"image/x-ms-bmp":{source:"nginx",extensions:["bmp"]},"image/x-pcx":{source:"apache",extensions:["pcx"]},"image/x-pict":{source:"apache",extensions:["pic","pct"]},"image/x-portable-anymap":{source:"apache",extensions:["pnm"]},"image/x-portable-bitmap":{source:"apache",extensions:["pbm"]},"image/x-portable-graymap":{source:"apache",extensions:["pgm"]},"image/x-portable-pixmap":{source:"apache",extensions:["ppm"]},"image/x-rgb":{source:"apache",extensions:["rgb"]},"image/x-tga":{source:"apache",extensions:["tga"]},"image/x-xbitmap":{source:"apache",extensions:["xbm"]},"image/x-xpixmap":{source:"apache",extensions:["xpm"]},"image/x-xwindowdump":{source:"apache",extensions:["xwd"]},"text/cache-manifest":{source:"iana",extensions:["appcache","manifest"]},"text/calendar":{source:"iana",extensions:["ics","ifb"]},"text/css":{source:"iana",charset:"UTF-8",extensions:["css"]},"text/csv":{source:"iana",extensions:["csv"]},"text/html":{source:"iana",extensions:["html","htm","shtml"]},"text/markdown":{source:"iana",extensions:["markdown","md"]},"text/mathml":{source:"nginx",extensions:["mml"]},"text/n3":{source:"iana",charset:"UTF-8",extensions:["n3"]},"text/plain":{source:"iana",extensions:["txt","text","conf","def","list","log","in","ini"]},"text/prs.lines.tag":{source:"iana",extensions:["dsc"]},"text/richtext":{source:"iana",extensions:["rtx"]},"text/rtf":{source:"iana",extensions:["rtf"]},"text/sgml":{source:"iana",extensions:["sgml","sgm"]},"text/shex":{source:"iana",extensions:["shex"]},"text/spdx":{source:"iana",extensions:["spdx"]},"text/tab-separated-values":{source:"iana",extensions:["tsv"]},"text/troff":{source:"iana",extensions:["t","tr","roff","man","me","ms"]},"text/turtle":{source:"iana",charset:"UTF-8",extensions:["ttl"]},"text/uri-list":{source:"iana",extensions:["uri","uris","urls"]},"text/vcard":{source:"iana",extensions:["vcard"]},"text/vnd.curl":{source:"iana",extensions:["curl"]},"text/vnd.curl.dcurl":{source:"apache",extensions:["dcurl"]},"text/vnd.curl.mcurl":{source:"apache",extensions:["mcurl"]},"text/vnd.curl.scurl":{source:"apache",extensions:["scurl"]},"text/vnd.dvb.subtitle":{source:"iana",extensions:["sub"]},"text/vnd.familysearch.gedcom":{source:"iana",extensions:["ged"]},"text/vnd.fly":{source:"iana",extensions:["fly"]},"text/vnd.fmi.flexstor":{source:"iana",extensions:["flx"]},"text/vnd.graphviz":{source:"iana",extensions:["gv"]},"text/vnd.in3d.3dml":{source:"iana",extensions:["3dml"]},"text/vnd.in3d.spot":{source:"iana",extensions:["spot"]},"text/vnd.sun.j2me.app-descriptor":{source:"iana",charset:"UTF-8",extensions:["jad"]},"text/vnd.wap.wml":{source:"iana",extensions:["wml"]},"text/vnd.wap.wmlscript":{source:"iana",extensions:["wmls"]},"text/vtt":{source:"iana",charset:"UTF-8",extensions:["vtt"]},"text/x-asm":{source:"apache",extensions:["s","asm"]},"text/x-c":{source:"apache",extensions:["c","cc","cxx","cpp","h","hh","dic"]},"text/x-component":{source:"nginx",extensions:["htc"]},"text/x-fortran":{source:"apache",extensions:["f","for","f77","f90"]},"text/x-java-source":{source:"apache",extensions:["java"]},"text/x-nfo":{source:"apache",extensions:["nfo"]},"text/x-opml":{source:"apache",extensions:["opml"]},"text/x-pascal":{source:"apache",extensions:["p","pas"]},"text/x-setext":{source:"apache",extensions:["etx"]},"text/x-sfv":{source:"apache",extensions:["sfv"]},"text/x-uuencode":{source:"apache",extensions:["uu"]},"text/x-vcalendar":{source:"apache",extensions:["vcs"]},"text/x-vcard":{source:"apache",extensions:["vcf"]},"text/xml":{source:"iana",extensions:["xml"]},"video/3gpp":{source:"iana",extensions:["3gp","3gpp"]},"video/3gpp2":{source:"iana",extensions:["3g2"]},"video/h261":{source:"iana",extensions:["h261"]},"video/h263":{source:"iana",extensions:["h263"]},"video/h264":{source:"iana",extensions:["h264"]},"video/iso.segment":{source:"iana",extensions:["m4s"]},"video/jpeg":{source:"iana",extensions:["jpgv"]},"video/jpm":{source:"apache",extensions:["jpm","jpgm"]},"video/mj2":{source:"iana",extensions:["mj2","mjp2"]},"video/mp2t":{source:"iana",extensions:["ts"]},"video/mp4":{source:"iana",extensions:["mp4","mp4v","mpg4"]},"video/mpeg":{source:"iana",extensions:["mpeg","mpg","mpe","m1v","m2v"]},"video/ogg":{source:"iana",extensions:["ogv"]},"video/quicktime":{source:"iana",extensions:["qt","mov"]},"video/vnd.dece.hd":{source:"iana",extensions:["uvh","uvvh"]},"video/vnd.dece.mobile":{source:"iana",extensions:["uvm","uvvm"]},"video/vnd.dece.pd":{source:"iana",extensions:["uvp","uvvp"]},"video/vnd.dece.sd":{source:"iana",extensions:["uvs","uvvs"]},"video/vnd.dece.video":{source:"iana",extensions:["uvv","uvvv"]},"video/vnd.dvb.file":{source:"iana",extensions:["dvb"]},"video/vnd.fvt":{source:"iana",extensions:["fvt"]},"video/vnd.mpegurl":{source:"iana",extensions:["mxu","m4u"]},"video/vnd.ms-playready.media.pyv":{source:"iana",extensions:["pyv"]},"video/vnd.uvvu.mp4":{source:"iana",extensions:["uvu","uvvu"]},"video/vnd.vivo":{source:"iana",extensions:["viv"]},"video/webm":{source:"apache",extensions:["webm"]},"video/x-f4v":{source:"apache",extensions:["f4v"]},"video/x-fli":{source:"apache",extensions:["fli"]},"video/x-flv":{source:"apache",extensions:["flv"]},"video/x-m4v":{source:"apache",extensions:["m4v"]},"video/x-matroska":{source:"apache",extensions:["mkv","mk3d","mks"]},"video/x-mng":{source:"apache",extensions:["mng"]},"video/x-ms-asf":{source:"apache",extensions:["asf","asx"]},"video/x-ms-vob":{source:"apache",extensions:["vob"]},"video/x-ms-wm":{source:"apache",extensions:["wm"]},"video/x-ms-wmv":{source:"apache",extensions:["wmv"]},"video/x-ms-wmx":{source:"apache",extensions:["wmx"]},"video/x-ms-wvx":{source:"apache",extensions:["wvx"]},"video/x-msvideo":{source:"apache",extensions:["avi"]},"video/x-sgi-movie":{source:"apache",extensions:["movie"]},"video/x-smv":{source:"apache",extensions:["smv"]},"chemical/x-cdx":{source:"apache",extensions:["cdx"]},"chemical/x-cif":{source:"apache",extensions:["cif"]},"chemical/x-cmdf":{source:"apache",extensions:["cmdf"]},"chemical/x-cml":{source:"apache",extensions:["cml"]},"chemical/x-csml":{source:"apache",extensions:["csml"]},"chemical/x-xyz":{source:"apache",extensions:["xyz"]},"font/collection":{source:"iana",extensions:["ttc"]},"font/otf":{source:"iana",extensions:["otf"]},"font/ttf":{source:"iana",extensions:["ttf"]},"font/woff":{source:"iana",extensions:["woff"]},"font/woff2":{source:"iana",extensions:["woff2"]},"message/disposition-notification":{source:"iana",extensions:["disposition-notification"]},"message/global":{source:"iana",extensions:["u8msg"]},"message/global-delivery-status":{source:"iana",extensions:["u8dsn"]},"message/global-disposition-notification":{source:"iana",extensions:["u8mdn"]},"message/global-headers":{source:"iana",extensions:["u8hdr"]},"message/rfc822":{source:"iana",extensions:["eml","mime"]},"message/vnd.wfa.wsc":{source:"iana",extensions:["wsc"]},"model/3mf":{source:"iana",extensions:["3mf"]},"model/gltf+json":{source:"iana",extensions:["gltf"]},"model/gltf-binary":{source:"iana",extensions:["glb"]},"model/iges":{source:"iana",extensions:["igs","iges"]},"model/mesh":{source:"iana",extensions:["msh","mesh","silo"]},"model/mtl":{source:"iana",extensions:["mtl"]},"model/obj":{source:"iana",extensions:["obj"]},"model/step":{source:"iana",extensions:[".p21",".stp",".step",".stpnc",".210"]},"model/step+xml":{source:"iana",extensions:["stpx"]},"model/step+zip":{source:"iana",extensions:["stpz"]},"model/step-xml+zip":{source:"iana",extensions:["stpxz"]},"model/stl":{source:"iana",extensions:["stl"]},"model/vnd.collada+xml":{source:"iana",extensions:["dae"]},"model/vnd.dwf":{source:"iana",extensions:["dwf"]},"model/vnd.gdl":{source:"iana",extensions:["gdl"]},"model/vnd.gtw":{source:"iana",extensions:["gtw"]},"model/vnd.mts":{source:"iana",extensions:["mts"]},"model/vnd.opengex":{source:"iana",extensions:["ogex"]},"model/vnd.parasolid.transmit.binary":{source:"iana",extensions:["x_b"]},"model/vnd.parasolid.transmit.text":{source:"iana",extensions:["x_t"]},"model/vnd.sap.vds":{source:"iana",extensions:["vds"]},"model/vnd.usdz+zip":{source:"iana",extensions:["usdz"]},"model/vnd.valve.source.compiled-map":{source:"iana",extensions:["bsp"]},"model/vnd.vtu":{source:"iana",extensions:["vtu"]},"model/vrml":{source:"iana",extensions:["wrl","vrml"]},"model/x3d+binary":{source:"apache",extensions:["x3db","x3dbz"]},"model/x3d+fastinfoset":{source:"iana",extensions:["x3db"]},"model/x3d+vrml":{source:"apache",extensions:["x3dv","x3dvz"]},"model/x3d+xml":{source:"iana",extensions:["x3d","x3dz"]},"model/x3d-vrml":{source:"iana",extensions:["x3dv"]},"x-conference/x-cooltalk":{source:"apache",extensions:["ice"]}},By={},Bv={},B_=!1,BS={alphabet:"abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789",minLength:0,blocklist:new Set(["0rgasm","1d10t","1d1ot","1di0t","1diot","1eccacu10","1eccacu1o","1eccacul0","1eccaculo","1mbec11e","1mbec1le","1mbeci1e","1mbecile","a11upat0","a11upato","a1lupat0","a1lupato","aand","ah01e","ah0le","aho1e","ahole","al1upat0","al1upato","allupat0","allupato","ana1","ana1e","anal","anale","anus","arrapat0","arrapato","arsch","arse","ass","b00b","b00be","b01ata","b0ceta","b0iata","b0ob","b0obe","b0sta","b1tch","b1te","b1tte","ba1atkar","balatkar","bastard0","bastardo","batt0na","battona","bitch","bite","bitte","bo0b","bo0be","bo1ata","boceta","boiata","boob","boobe","bosta","bran1age","bran1er","bran1ette","bran1eur","bran1euse","branlage","branler","branlette","branleur","branleuse","c0ck","c0g110ne","c0g11one","c0g1i0ne","c0g1ione","c0gl10ne","c0gl1one","c0gli0ne","c0glione","c0na","c0nnard","c0nnasse","c0nne","c0u111es","c0u11les","c0u1l1es","c0u1lles","c0ui11es","c0ui1les","c0uil1es","c0uilles","c11t","c11t0","c11to","c1it","c1it0","c1ito","cabr0n","cabra0","cabrao","cabron","caca","cacca","cacete","cagante","cagar","cagare","cagna","cara1h0","cara1ho","caracu10","caracu1o","caracul0","caraculo","caralh0","caralho","cazz0","cazz1mma","cazzata","cazzimma","cazzo","ch00t1a","ch00t1ya","ch00tia","ch00tiya","ch0d","ch0ot1a","ch0ot1ya","ch0otia","ch0otiya","ch1asse","ch1avata","ch1er","ch1ng0","ch1ngadaz0s","ch1ngadazos","ch1ngader1ta","ch1ngaderita","ch1ngar","ch1ngo","ch1ngues","ch1nk","chatte","chiasse","chiavata","chier","ching0","chingadaz0s","chingadazos","chingader1ta","chingaderita","chingar","chingo","chingues","chink","cho0t1a","cho0t1ya","cho0tia","cho0tiya","chod","choot1a","choot1ya","chootia","chootiya","cl1t","cl1t0","cl1to","clit","clit0","clito","cock","cog110ne","cog11one","cog1i0ne","cog1ione","cogl10ne","cogl1one","cogli0ne","coglione","cona","connard","connasse","conne","cou111es","cou11les","cou1l1es","cou1lles","coui11es","coui1les","couil1es","couilles","cracker","crap","cu10","cu1att0ne","cu1attone","cu1er0","cu1ero","cu1o","cul0","culatt0ne","culattone","culer0","culero","culo","cum","cunt","d11d0","d11do","d1ck","d1ld0","d1ldo","damn","de1ch","deich","depp","di1d0","di1do","dick","dild0","dildo","dyke","encu1e","encule","enema","enf01re","enf0ire","enfo1re","enfoire","estup1d0","estup1do","estupid0","estupido","etr0n","etron","f0da","f0der","f0ttere","f0tters1","f0ttersi","f0tze","f0utre","f1ca","f1cker","f1ga","fag","fica","ficker","figa","foda","foder","fottere","fotters1","fottersi","fotze","foutre","fr0c10","fr0c1o","fr0ci0","fr0cio","fr0sc10","fr0sc1o","fr0sci0","fr0scio","froc10","froc1o","froci0","frocio","frosc10","frosc1o","frosci0","froscio","fuck","g00","g0o","g0u1ne","g0uine","gandu","go0","goo","gou1ne","gouine","gr0gnasse","grognasse","haram1","harami","haramzade","hund1n","hundin","id10t","id1ot","idi0t","idiot","imbec11e","imbec1le","imbeci1e","imbecile","j1zz","jerk","jizz","k1ke","kam1ne","kamine","kike","leccacu10","leccacu1o","leccacul0","leccaculo","m1erda","m1gn0tta","m1gnotta","m1nch1a","m1nchia","m1st","mam0n","mamahuev0","mamahuevo","mamon","masturbat10n","masturbat1on","masturbate","masturbati0n","masturbation","merd0s0","merd0so","merda","merde","merdos0","merdoso","mierda","mign0tta","mignotta","minch1a","minchia","mist","musch1","muschi","n1gger","neger","negr0","negre","negro","nerch1a","nerchia","nigger","orgasm","p00p","p011a","p01la","p0l1a","p0lla","p0mp1n0","p0mp1no","p0mpin0","p0mpino","p0op","p0rca","p0rn","p0rra","p0uff1asse","p0uffiasse","p1p1","p1pi","p1r1a","p1rla","p1sc10","p1sc1o","p1sci0","p1scio","p1sser","pa11e","pa1le","pal1e","palle","pane1e1r0","pane1e1ro","pane1eir0","pane1eiro","panele1r0","panele1ro","paneleir0","paneleiro","patakha","pec0r1na","pec0rina","pecor1na","pecorina","pen1s","pendej0","pendejo","penis","pip1","pipi","pir1a","pirla","pisc10","pisc1o","pisci0","piscio","pisser","po0p","po11a","po1la","pol1a","polla","pomp1n0","pomp1no","pompin0","pompino","poop","porca","porn","porra","pouff1asse","pouffiasse","pr1ck","prick","pussy","put1za","puta","puta1n","putain","pute","putiza","puttana","queca","r0mp1ba11e","r0mp1ba1le","r0mp1bal1e","r0mp1balle","r0mpiba11e","r0mpiba1le","r0mpibal1e","r0mpiballe","rand1","randi","rape","recch10ne","recch1one","recchi0ne","recchione","retard","romp1ba11e","romp1ba1le","romp1bal1e","romp1balle","rompiba11e","rompiba1le","rompibal1e","rompiballe","ruff1an0","ruff1ano","ruffian0","ruffiano","s1ut","sa10pe","sa1aud","sa1ope","sacanagem","sal0pe","salaud","salope","saugnapf","sb0rr0ne","sb0rra","sb0rrone","sbattere","sbatters1","sbattersi","sborr0ne","sborra","sborrone","sc0pare","sc0pata","sch1ampe","sche1se","sche1sse","scheise","scheisse","schlampe","schwachs1nn1g","schwachs1nnig","schwachsinn1g","schwachsinnig","schwanz","scopare","scopata","sexy","sh1t","shit","slut","sp0mp1nare","sp0mpinare","spomp1nare","spompinare","str0nz0","str0nza","str0nzo","stronz0","stronza","stronzo","stup1d","stupid","succh1am1","succh1ami","succhiam1","succhiami","sucker","t0pa","tapette","test1c1e","test1cle","testic1e","testicle","tette","topa","tr01a","tr0ia","tr0mbare","tr1ng1er","tr1ngler","tring1er","tringler","tro1a","troia","trombare","turd","twat","vaffancu10","vaffancu1o","vaffancul0","vaffanculo","vag1na","vagina","verdammt","verga","w1chsen","wank","wichsen","x0ch0ta","x0chota","xana","xoch0ta","xochota","z0cc01a","z0cc0la","z0cco1a","z0ccola","z1z1","z1zi","ziz1","zizi","zocc01a","zocc0la","zocco1a","zoccola"])};class Bw{constructor(e){var t,r,i;let n=null!==(t=null==e?void 0:e.alphabet)&&void 0!==t?t:BS.alphabet,s=null!==(r=null==e?void 0:e.minLength)&&void 0!==r?r:BS.minLength,a=null!==(i=null==e?void 0:e.blocklist)&&void 0!==i?i:BS.blocklist;if(new Blob([n]).size!==n.length)throw Error("Alphabet cannot contain multibyte characters");if(n.length<3)throw Error("Alphabet length must be at least 3");if(new Set(n).size!==n.length)throw Error("Alphabet must contain unique characters");if("number"!=typeof s||s<0||s>255)throw Error("Minimum length has to be between 0 and 255");let o=new Set,l=n.toLowerCase().split("");for(let e of a)if(e.length>=3){let t=e.toLowerCase(),r=t.split("");r.filter(e=>l.includes(e)).length===r.length&&o.add(t)}this.alphabet=this.shuffle(n),this.minLength=s,this.blocklist=o}encode(e){if(0===e.length)return"";if(e.filter(e=>e>=0&&e<=this.maxValue()).length!==e.length)throw Error(`Encoding supports numbers between 0 and ${this.maxValue()}`);return this.encodeNumbers(e)}decode(e){let t=[];if(""===e)return t;let r=this.alphabet.split("");for(let i of e.split(""))if(!r.includes(i))return t;let i=e.charAt(0),n=this.alphabet.indexOf(i),s=this.alphabet.slice(n)+this.alphabet.slice(0,n);s=s.split("").reverse().join("");let a=e.slice(1);for(;a.length>0;){let e=s.slice(0,1),r=a.split(e);if(r.length>0){if(""===r[0])return t;t.push(this.toNumber(r[0],s.slice(1))),r.length>1&&(s=this.shuffle(s))}a=r.slice(1).join(e)}return t}encodeNumbers(e,t=0){if(t>this.alphabet.length)throw Error("Reached max attempts to re-generate the ID");let r=e.reduce((e,t,r)=>this.alphabet[t%this.alphabet.length].codePointAt(0)+r+e,e.length)%this.alphabet.length;r=(r+t)%this.alphabet.length;let i=this.alphabet.slice(r)+this.alphabet.slice(0,r),n=i.charAt(0);i=i.split("").reverse().join("");let s=[n];for(let t=0;t!==e.length;t++){let r=e[t];s.push(this.toId(r,i.slice(1))),t<e.length-1&&(s.push(i.slice(0,1)),i=this.shuffle(i))}let a=s.join("");if(this.minLength>a.length)for(a+=i.slice(0,1);this.minLength-a.length>0;)i=this.shuffle(i),a+=i.slice(0,Math.min(this.minLength-a.length,i.length));return this.isBlockedId(a)&&(a=this.encodeNumbers(e,t+1)),a}shuffle(e){let t=e.split("");for(let e=0,r=t.length-1;r>0;e++,r--){let i=(e*r+t[e].codePointAt(0)+t[r].codePointAt(0))%t.length;[t[e],t[i]]=[t[i],t[e]]}return t.join("")}toId(e,t){let r=[],i=t.split(""),n=e;do r.unshift(i[n%i.length]),n=Math.floor(n/i.length);while(n>0);return r.join("")}toNumber(e,t){let r=t.split("");return e.split("").reduce((e,t)=>e*r.length+r.indexOf(t),0)}isBlockedId(e){let t=e.toLowerCase();for(let e of this.blocklist)if(e.length<=t.length){if(t.length<=3||e.length<=3){if(t===e)return!0}else if(/\d/.test(e)){if(t.startsWith(e)||t.endsWith(e))return!0}else if(t.includes(e))return!0}return!1}maxValue(){return Number.MAX_SAFE_INTEGER}}class Bk extends mO("InvalidRouteConfig"){constructor(e,t){super({reason:t?`Expected route config to have a ${t} for key ${e} but none was found.`:`Encountered an invalid route config during backfilling. ${e} was not found.`})}}class BC extends mO("UnknownFileType"){constructor(e){super({reason:`Could not determine type for ${e}`})}}class BO extends mO("InvalidFileType"){constructor(e,t){super({reason:`File type ${e} not allowed for ${t}`})}}class BE extends mO("InvalidFileSize"){constructor(e){super({reason:`Invalid file size: ${e}`})}}function BI(e){return{maxFileSize:"image"===e?"4MB":"video"===e?"16MB":"audio"===e||"blob"===e?"8MB":"pdf"===e?"4MB":"text"===e?"64KB":"4MB",maxFileCount:1,minFileCount:1,contentDisposition:"inline"}}let BF=e=>{if(Array.isArray(e))return dN(e.reduce((e,t)=>(e[t]=BI(t),e),{}));let t={};for(let r of Bj(e)){let i=e[r];if(!i)return dj(new Bk(r));t[r]={...BI(r),...i}}return dN(JSON.parse(JSON.stringify(t,BM)))},BR=(e,t)=>{let r=e.type||function(e){if(!e||"string"!=typeof e)return!1;let t=(function(e){let t=e.lastIndexOf(".");return t<0?"":e.substring(t)})("x."+e).toLowerCase().substring(1);return!!t&&((function(e,t){if(B_)return;B_=!0;let r=["nginx","apache",void 0,"iana"];Object.keys(Bx).forEach(i=>{let n=Bx[i],s=n.extensions;if(s?.length)for(let a of(e[i]=s,s)){if(t[a]){let e=r.indexOf(Bx[t[a]].source),i=r.indexOf(n.source);if("application/octet-stream"!==t[a]&&(e>i||e===i&&t[a].startsWith("application/")))continue}t[a]=i}})}(By,Bv),Bv)[t]||!1)}(e.name);if(!r)return t.includes("blob")?dN("blob"):dj(new BC(e.name));if(t.some(e=>e.includes("/"))&&t.includes(r))return dN(r);let i="application/pdf"===r.toLowerCase()?"pdf":r.split("/")[0];return t.includes(i)?dN(i):t.includes("blob")?dN("blob"):dj(new BO(i,e.name))},BT=["B","KB","MB","GB","TB"],BN=e=>{let t=RegExp(`^(\\d+)(\\.\\d+)?\\s*(${BT.join("|")})$`,"i"),r=e.match(t);if(!r?.[1]||!r[3])return dj(new BE(e));let i=parseFloat(r[1]),n=r[3].toUpperCase();return dN(Math.floor(i*Math.pow(1024,BT.indexOf(n))))},BA=e=>{if(0===e||-1===e)return"0B";let t=Math.floor(Math.log(e)/Math.log(1024));return`${(e/Math.pow(1024,t)).toFixed(2)}${BT[t]}`};function Bj(e){return Object.keys(e)}let BM=(e,t)=>"number"!=typeof t||Number.isSafeInteger(t)||t<=Number.MAX_SAFE_INTEGER&&t>=Number.MIN_SAFE_INTEGER?t:t===1/0?Number.MAX_SAFE_INTEGER:t===-1/0?Number.MIN_SAFE_INTEGER:Number.isNaN(t)?0:void 0,Bz={BAD_REQUEST:400,NOT_FOUND:404,FORBIDDEN:403,INTERNAL_SERVER_ERROR:500,INTERNAL_CLIENT_ERROR:500,TOO_LARGE:413,TOO_SMALL:400,TOO_MANY_FILES:400,KEY_TOO_LONG:400,URL_GENERATION_FAILED:500,UPLOAD_FAILED:500,MISSING_ENV:500,INVALID_SERVER_CONFIG:500,FILE_LIMIT_EXCEEDED:500};class BP extends mC{constructor(e){let t="string"==typeof e?{code:"INTERNAL_SERVER_ERROR",message:e}:e;super({message:t.message??function(e,t){return"string"==typeof e?e:e instanceof Error||e&&"object"==typeof e&&"message"in e&&"string"==typeof e.message?e.message:t??"An unknown error occurred"}(t.cause,t.code)}),this._tag="UploadThingError",this.name="UploadThingError",this.code=t.code,this.data=t.data,t.cause instanceof Error?this.cause=t.cause:ec(t.cause)&&V(t.cause.status)&&K(t.cause.statusText)?this.cause=Error(`Response ${t.cause.status} ${t.cause.statusText}`):K(t.cause)?this.cause=Error(t.cause):this.cause=t.cause}static toObject(e){return{code:e.code,message:e.message,data:e.data}}static serialize(e){return JSON.stringify(BP.toObject(e))}}let BD="hmac-sha256=",BL={name:"HMAC",hash:"SHA-256"},B$=new TextEncoder,BU=(e,t)=>dV(function*(){let r=yield*dq({try:()=>crypto.subtle.importKey("raw",B$.encode(zB(t)),BL,!1,["sign"]),catch:e=>new BP({code:"BAD_REQUEST",message:"Invalid signing secret",cause:e})}),i=yield*dZ(dq({try:()=>crypto.subtle.sign(BL,r,B$.encode(e)),catch:e=>new BP({code:"BAD_REQUEST",cause:e})}),e=>PC(new Uint8Array(e)));return`${BD}${i}`}).pipe(mu("signPayload")),Bq=(e,t,r)=>dV(function*(){let i=t?.slice(BD.length);if(!i)return!1;let n=B$.encode(zB(r)),s=yield*dU(()=>crypto.subtle.importKey("raw",n,BL,!1,["verify"])),a=yield*dL(PO(i)),o=B$.encode(e);return yield*dU(()=>crypto.subtle.verify(BL,s,a,o))}).pipe(mu("verifySignature"),ml(()=>!1)),BB=(e,t,r)=>dM(()=>{let i=JSON.stringify(r?.(e)??[e.name,e.size,e.type,e.lastModified,Date.now()]),n=function(e,t){let r,i;let n=e.split(""),s=eT(t);for(let e=0;e<n.length;e++)i=(s%(e+1)+e)%n.length,r=n[e],n[e]=n[i],n[i]=r;return n.join("")}(BS.alphabet,t),s=new Bw({alphabet:n,minLength:36}).encode([Math.abs(eT(i))]);return new Bw({alphabet:n,minLength:12}).encode([Math.abs(eT(t))])+s}).pipe(mu("generateKey")),BJ=(e,t,r)=>dV(function*(){let i=new URL(e),n=r.ttlInSeconds?function(e){if("number"==typeof e)return e;let t=e.split(/(\d+)/).filter(Boolean);return Number(t[0])*({s:1,m:60,h:3600,d:86400})[(t[1]??"s").trim().slice(0,1)]}(r.ttlInSeconds):3600,s=Date.now()+1e3*n;i.searchParams.append("expires",s.toString()),r.data&&Object.entries(r.data).forEach(([e,t])=>{if(null==t)return;let r=encodeURIComponent(t);i.searchParams.append(e,r)});let a=yield*BU(i.toString(),t);return i.searchParams.append("signature",a),i.href}).pipe(mu("generateSignedURL")),BH=e=>pT(new Map(rW(p0(e),([e,t])=>[pX(e).join("\uFEFF"),t])),{pathDelim:"\uFEFF",seqDelim:"\uFEFF"});PK("inline","attachment"),PK("public-read","private");let BK=PK("upload"),BV=PK("callback","error"),BW=DV(D6,P0,{decode:e=>new TextDecoder().decode(e),encode:e=>new TextEncoder().encode(e)}),BG=DI({apiKey:(e=>DV(e,D4(P$(e)),{strict:!0,decode:e=>zq(e),encode:e=>zB(e)}))(P0.pipe(((e,t)=>r=>{let i=JSON.stringify(e);return r.pipe(DJ(t=>t.startsWith(e),{schemaId:DG,[DG]:{startsWith:e},title:`startsWith(${i})`,description:`a string starting with ${i}`,jsonSchema:{pattern:`^${e}`},...t}))})("sk_"))),appId:P0,regions:Dn(P0),ingestHost:P0.pipe(Dw({default:()=>"ingest.uploadthing.com"}))}),BY=D8.pipe(DD(BW),DD(DZ(BG)));class BQ extends Ll("FileUploadData")({name:P0,size:P1,type:P0,lastModified:P1.pipe(DS)}){}class BZ extends BQ.extend("FileUploadDataWithCustomId")({customId:P6(P0)}){}class BX extends BZ.extend("UploadedFileData")({key:P0,url:P0,appUrl:P0,ufsUrl:P0,fileHash:P0}){}class B0 extends Ll("MetadataFetchStreamPart")({payload:P0,signature:P0,hook:BV}){}class B1 extends Ll("MetadataFetchResponse")({ok:P2}){}class B2 extends Ll("CallbackResultResponse")({ok:P2}){}class B3 extends Ll("UploadActionPayload")({files:Di(BQ),input:PX}){}let B5=pR().pipe(pL(()=>pT(new Map(Object.entries(Object.fromEntries(Object.entries({}).filter(e=>null!=e[1])))),{pathDelim:"_"})),pD("uploadthing"),e=>pz(e,pS)),B4=e=>BH(e??{}).pipe(pL(()=>B5)),B6=(e=>{let t=Po("a boolean property",e=>{switch(e){case"true":case"yes":case"on":case"1":return tA(!0);case"false":case"no":case"off":case"0":return tA(!1);default:return tN(h6([],`Expected a boolean value but received ${e}`))}});return void 0===e?t:Pn(t,e)})("isDev").pipe(Ps(()=>Pu("undefined"!=typeof process?"production":void 0).pipe(Pt(e=>"development"===e))),Ph(!1)),B8=((e,t)=>{let r=Eo(t);return Pl(e).pipe(Pi(e=>r(e).pipe(tz(e=>h6([],EE.formatIssueSync(e))))))})("token",BY).pipe(gy({ConfigError:e=>new BP({code:"InvalidData"===e._op?"INVALID_SERVER_CONFIG":"MISSING_ENV",message:"InvalidData"===e._op?"Invalid token. A token is a base64 encoded JSON object matching { apiKey: string, appId: string, regions: string[] }.":"Missing token. Please set the `UPLOADTHING_TOKEN` environment variable or provide a token manually through config.",cause:e})}));Pl("apiUrl").pipe(Ph("https://api.uploadthing.com"),Pr(e=>new URL(e)),Pt(e=>e.href.replace(/\/$/,"")));let B7=k_(function*(){let{regions:e,ingestHost:t}=yield*B8,r=e[0];return yield*Pl("ingestUrl").pipe(Ph(`https://${r}.${t}`),Pr(e=>new URL(e)),Pt(e=>e.href.replace(/\/$/,"")))});Pl("utfsHost").pipe(Ph("utfs.io")),Pl("ufsHost").pipe(Ph("ufs.sh"));let B9=e=>{console.warn(`⚠️ [uploadthing][deprecated] ${e}`)};function Je(e){return{message:e.message}}function Jt(e,t){let r=Object.keys(t)[0];return(r?t[r]?.errorFormatter??Je:Je)(e)}let Jr=(e,t)=>r=>{let i="";return r.pipe(za(),zp(e=>k_(function*(){let t=(i+=e).split("\n"),r=[];for(let e of t)try{r.push(JSON.parse(e)),i=i.slice(e.length+1)}catch{}return yield*gR("Received chunks").pipe(gd("chunk",e),gd("parsedChunks",r),gd("buf",i)),r})),zp(PU(Di(e))),zp(vo(e=>t(e))),zb,gj("handleJsonLineStream"))},Ji=M(2,(e,t)=>e.log({fiberId:aq,logLevel:cr,message:t,cause:nY,context:fE(),spans:on(),annotations:ni(),date:new Date})),Jn=bm,Js=bb,Ja=IR,Jo=IT,Jl=IN,Ju=bx,Jc=by,Jh=bv,Jp=b_,Jf=ve,Jd=y2,Jm=e=>bb(t=>{let r=sK(fz(t.context,fo),p2).unsafe;switch(t.logLevel._tag){case"Debug":return r.debug(e.log(t));case"Info":return r.info(e.log(t));case"Trace":return r.trace(e.log(t));case"Warning":return r.warn(e.log(t));case"Error":case"Fatal":return r.error(e.log(t));default:return r.log(e.log(t))}}),Jg=e=>bb(t=>{sK(fz(t.context,fo),p2).unsafe.error(e.log(t))}),Jb={[bm]:bg,log:$,pipe(){return eX(this,arguments)}},Jx=IA,Jy=Ij,Jv=IM,J_=Iz,JS=bS,Jw=e=>bS(()=>e),Jk=e=>bS(e),JC=Ji,JO=IF,JE=e=>by(e,e=>{let t=t2(fM(e.context,cC),sV(ft));return"None"===t._tag?e:{...e,annotations:U(e.annotations,nl("effect.traceId",t.value.traceId),nl("effect.spanId",t.value.spanId),"Span"===t.value._tag?nl("effect.spanName",t.value.name):z)}}),JI=bw,JF=bk,JR=bC,JT=y3,JN=bA,JA=bR,Jj=bO,JM=bV,Jz=bY,JP=bT,JD=y7,JL=Jy(y3,y5),J$=Jy(y3,y4),JU=Jy(y3,y6),Jq=Jy(y3,y8),JB=e=>wF(vM(y1,e)),JJ=e=>"object"==typeof e&&null!=e&&bm in e,JH=(e=>{let t=Pi(Pl(),e=>{let t=e.toUpperCase(),r=ca.find(e=>e.label===t);return void 0===r?tN(h6([],`Expected a log level but received ${e}`)):tA(r)});return void 0===e?t:Pn(t,e)})("logLevel").pipe(Ph(cr),uy(e=>JB(e)),gH(e=>gA("Invalid log level").pipe(gd("error",e))),gx("ConfigError",e=>new BP({code:"INVALID_SERVER_CONFIG",message:"Invalid server configuration",cause:e})),wD),JK=((...e)=>t=>{let r=e.map(String).join(", "),i=Po(`one of (${r})`,t=>{let i=e.find(e=>String(e)===t);return void 0===i?tN(h6([],`Expected one of (${r}) but received ${t}`)):tA(i)});return void 0===t?i:Pn(i,t)})("json","logFmt","structured","pretty")("logFormat"),JV=k_(function*(){let e=yield*B6;return R[yield*JK.pipe(Ph(e?"pretty":"json"))]}).pipe(gx("ConfigError",e=>new BP({code:"INVALID_SERVER_CONFIG",message:"Invalid server configuration",cause:e})),wD),JW=(e,t)=>{let r=t?.mixin??"json",i=f9(t?.level??"Debug");return t=>ux("None"!==r?t[r]:uG,()=>kO(i,`${e} (${t.status})`).pipe(gd("response",t)))},JG=e=>t=>"ResponseError"===t._tag?JW(e,{level:"Error"})(t.response):gA(e).pipe(gd("error",t));class JY extends kA("ParserError"){constructor(...e){super(...e),this.message="Input validation failed. The original error with it's validation issues is in the error cause."}}class JQ extends kN{constructor(e,t,r){super({reason:`You uploaded a ${e} file that was ${BA(r)}, but the limit for that type is ${t}`}),this._tag="FileSizeMismatch",this.name="FileSizeMismatchError"}}class JZ extends kN{constructor(e,t,r,i){super({reason:`You uploaded ${i} file(s) of type '${e}', but the ${t} for that type is ${r}`}),this._tag="FileCountMismatch",this.name="FileCountMismatchError"}}let JX=(e,t)=>k_(function*(){let r={};for(let i of e){let e=yield*BR(i,Bj(t));r[e]=(r[e]??0)+1;let n=t[e]?.maxFileSize;if(!n)return yield*new Bk(e,"maxFileSize");let s=yield*BN(n);if(i.size>s)return yield*new JQ(e,n,i.size)}for(let e in r){let i=t[e];if(!i)return yield*new Bk(e);let n=r[e],s=i.minFileCount,a=i.maxFileCount;if(s>a)return yield*new BP({code:"BAD_REQUEST",message:"Invalid config during file count - minFileCount > maxFileCount",cause:`minFileCount must be less than maxFileCount for key ${e}. got: ${s} > ${a}`});if(null!=n&&n<s)return yield*new JZ(e,"minimum",s,n);if(null!=n&&n>a)return yield*new JZ(e,"maximum",a,n)}return null}),J0=e=>vo(Bj(e),t=>uN(BF(e[t].routerConfig),e=>({slug:t,config:e}))),J1="@effect/platform/FetchHttpClient/Fetch",J2=(e=>q7(t=>ux(t,t=>l5(r=>{let i=sK(r.getFiberRef(cC),vE),n=new AbortController,s=cJ(i,uB(()=>n.abort())),a=LQ(t.url,t.urlParams,t.hash);if("Left"===a._tag)return up(new qO({request:t,reason:"InvalidUrl",cause:a.left}));let o=a.right;return!r.getFiberRef(cD)||r.getFiberRef(q4)(t)?vC(s,e(t,o,n.signal,r)):vC(s,g1(`http.client ${t.method}`,{kind:"client",captureStackTrace:!1},i=>{i.attribute("http.request.method",t.method),i.attribute("server.address",o.origin),""!==o.port&&i.attribute("server.port",+o.port),i.attribute("url.full",o.toString()),i.attribute("url.path",o.pathname),i.attribute("url.scheme",o.protocol.slice(0,-1));let s=o.search.slice(1);""!==s&&i.attribute("url.query",s);let a=r.getFiberRef(LK),l=LH(t.headers,a);for(let e in l)i.attribute(`http.request.header.${e}`,String(l[e]));return uJ(g2(e(t=r.getFiberRef(q6)?qq(t,UP(i)):t,o,n.signal,r),i),e=>{i.attribute("http.response.status_code",e.status);let t=LH(e.headers,a);for(let e in t)i.attribute(`http.response.header.${e}`,String(t[e]))})}))})),uU))((e,t,r,i)=>{let n=i.getFiberRef(cC),s=n.unsafeMap.get(J1)??globalThis.fetch,a=n.unsafeMap.get("@effect/platform/FetchHttpClient/FetchOptions")??{},o=new globalThis.Headers(e.headers),l=i=>uN(gV({try:()=>s(t,{...a,method:e.method,headers:o,body:i,duplex:"Stream"===e.body._tag?"half":void 0,signal:r}),catch:t=>new qO({request:e,reason:"Transport",cause:t})}),t=>q0(e,t));switch(e.body._tag){case"Raw":case"Uint8Array":return l(e.body.body);case"FormData":return l(e.body.formData);case"Stream":return ux(M7(e.body.stream),l)}return l(void 0)}),J3=(C=uU(J2),wS(q5,ux(hj(),e=>uN(C,t=>Bo(t,hD(t=>sW(e,t)))))));class J5 extends sZ(J1)(){}function J4(e,t){return ux(e.runtimeEffect,e=>l5(r=>(r.setFiberRefs(e.fiberRefs),r.currentRuntimeFlags=e.runtimeFlags,hz(t,e.context))))}let J6={...th,[Sq]:Sq,pipe(){return eX(this,arguments)},commit(){return this.runtimeEffect}},J8=(e,t)=>{let r;t=t??wd();let i=wn(vN()),n=l5(n=>(r||(r=wt(uJ(vA(wj(e,t),i),e=>{s.cachedRuntime=e}),{scope:i,scheduler:n.currentScheduler})),u_(r.await))),s=Object.assign(Object.create(J6),{memoMap:t,scope:i,runtimeEffect:n,cachedRuntime:void 0,runtime:()=>void 0===s.cachedRuntime?wr(s.runtimeEffect):Promise.resolve(s.cachedRuntime),dispose:()=>wr(s.disposeEffect),disposeEffect:uq(()=>(s.runtimeEffect=ul("ManagedRuntime disposed"),s.cachedRuntime=void 0,cK(s.scope,hb))),runFork:(e,t)=>void 0===s.cachedRuntime?wt(J4(s,e),t):SV(s.cachedRuntime)(e,t),runSyncExit:e=>void 0===s.cachedRuntime?ws(J4(s,e)):S3(s.cachedRuntime)(e),runSync:e=>void 0===s.cachedRuntime?wn(J4(s,e)):SG(s.cachedRuntime)(e),runPromiseExit:(e,t)=>void 0===s.cachedRuntime?wi(J4(s,e),t):S4(s.cachedRuntime)(e,t),runCallback:(e,t)=>void 0===s.cachedRuntime?SW(we)(J4(s,e),t):SW(s.cachedRuntime)(e,t),runPromise:(e,t)=>void 0===s.cachedRuntime?wr(J4(s,e),t):S5(s.cachedRuntime)(e,t)});return s},J7=(e,t)=>J8(wM(wE(JV,JH,wz(J3,wT(J5,e)),IP(cf(LK,e=>e.concat(["x-uploadthing-api-key"])))),ID(B4(t)))),J9=Symbol("uploadthing-custom-id-symbol");var He="7.5.2";class Ht extends sZ("uploadthing/AdapterArguments")(){}let Hr=(e,t,r,i)=>{let n=J7(r.config?.fetch,r.config),s=kS(()=>n.runtime().then(UG)),a=(...t)=>uN(kS(()=>n.runPromise(Hi(r,i))),g$(Ht,e(...t)));return async(...e)=>await s.pipe(kI(a(...e)),kI(t(...e)),gj("requestHandler"),n.runPromise)},Hi=(e,t)=>k_(function*(){let r=yield*B6,i=yield*J0(e.router),n=e.config?.handleDaemonPromise?e.config.handleDaemonPromise:r?"void":"await";if(r&&"await"===n)return yield*new BP({code:"INVALID_SERVER_CONFIG",message:'handleDaemonPromise: "await" is forbidden in development.'});let s=k_(function*(){return yield*$p(i)}),a=k_(function*(){let{"uploadthing-hook":r,"x-uploadthing-package":i,"x-uploadthing-version":s}=yield*UN(DI({"uploadthing-hook":BV.pipe(DS),"x-uploadthing-package":P0.pipe(Dw({default:()=>"unknown"})),"x-uploadthing-version":P0.pipe(Dw({default:()=>He}))}));s!==He&&(yield*gN("Client version mismatch. Things may not work as expected, please sync your versions to ensure compatibility.").pipe(gd({clientVersion:s,serverVersion:He})));let{slug:a,actionType:o}=yield*qw(DI({actionType:BK.pipe(DS),slug:P0})),l=e.router[a];if(!l){let e=`No file route found for slug ${a}`;return yield*gA(e),yield*new BP({code:"NOT_FOUND",message:e})}let{body:u,fiber:c}=yield*Bm({actionType:o,uploadthingHook:r}).pipe(Bg({actionType:"upload",uploadthingHook:void 0},()=>Ho({uploadable:l,fePackage:i,beAdapter:t,slug:a})),Bg({actionType:void 0,uploadthingHook:"callback"},()=>Hs({uploadable:l,fePackage:i,beAdapter:t})),Bg({actionType:void 0,uploadthingHook:"error"},()=>Hn({uploadable:l})),Bb(()=>uU({body:null,fiber:null})));return c&&(yield*gR("Running fiber as daemon").pipe(gd("handleDaemon",n)),"void"===n||("await"===n?yield*c.await:"function"==typeof n&&n(wr(c.await)))),yield*gR("Sending response").pipe(gd("body",u)),yield*$p(u)}).pipe(gy({ParseError:t=>$p(Jt(new BP({code:"BAD_REQUEST",message:"Invalid input",cause:t.message}),e.router),{status:400}),UploadThingError:t=>$p(Jt(t,e.router),{status:Bz[t.code]})})),o=uN($h("x-uploadthing-version",He));return qb.pipe(qv("*",s),q_("*",a),qS(o))}).pipe(gj("createRequestHandler")),Hn=e=>k_(function*(){let{uploadable:t}=e,r=yield*UI,{apiKey:i}=yield*B8,n=yield*Bq((yield*r.text),r.headers["x-uploadthing-signature"]??null,i);if(yield*gR(`Signature verified: ${n}`),!n)return yield*gA("Invalid signature"),yield*new BP({code:"BAD_REQUEST",message:"Invalid signature"});let s=yield*UA(DI({fileKey:P0,error:P0}));yield*gR("Handling error callback request with input:").pipe(gd("json",s));let a=yield*Ht;return{body:null,fiber:yield*gV({try:async()=>t.onUploadError({...a,error:new BP({code:"UPLOAD_FAILED",message:`Upload failed for ${s.fileKey}: ${s.error}`}),fileKey:s.fileKey}),catch:e=>new BP({code:"INTERNAL_SERVER_ERROR",message:"Failed to run onUploadError",cause:e})}).pipe(gH(e=>gA("Failed to run onUploadError. You probably shouldn't be throwing errors here.").pipe(gd("error",e)))).pipe(kk,vh)}}).pipe(gj("handleErrorRequest")),Hs=e=>k_(function*(){let{uploadable:t,fePackage:r,beAdapter:i}=e,n=yield*UI,{apiKey:s}=yield*B8,a=yield*Bq((yield*n.text),n.headers["x-uploadthing-signature"]??null,s);if(yield*gR(`Signature verified: ${a}`),!a)return yield*gA("Invalid signature"),yield*new BP({code:"BAD_REQUEST",message:"Invalid signature"});let o=yield*UA(DI({status:P0,file:BX,metadata:DR({key:P0,value:PX})}));return yield*gR("Handling callback request with input:").pipe(gd("json",o)),{body:null,fiber:yield*k_(function*(){let e=yield*Ht,n=yield*gV({try:async()=>t.onUploadComplete({...e,file:{...o.file,get url(){return B9("`file.url` is deprecated and will be removed in uploadthing v9. Use `file.ufsUrl` instead."),o.file.url},get appUrl(){return B9("`file.appUrl` is deprecated and will be removed in uploadthing v9. Use `file.ufsUrl` instead."),o.file.appUrl}},metadata:o.metadata}),catch:e=>new BP({code:"INTERNAL_SERVER_ERROR",message:"Failed to run onUploadComplete. You probably shouldn't be throwing errors here.",cause:e})}),a={fileKey:o.file.key,callbackData:n??null};yield*gR("'onUploadComplete' callback finished. Sending response to UploadThing:").pipe(gd("callbackData",a));let l=yield*B7,u=(yield*q5).pipe(Bl);yield*qj("/callback-result").pipe(qV(l),qq({"x-uploadthing-api-key":zB(s),"x-uploadthing-version":He,"x-uploadthing-be-adapter":i,"x-uploadthing-fe-package":r}),qZ(a),ux(u.execute),gH(JG("Failed to register callback result")),ux($N(B2)),uJ(gF("Sent callback result to UploadThing")),kC)}).pipe(kk,vh)}}).pipe(gj("handleCallbackRequest")),Ha=e=>k_(function*(){let{json:{files:t,input:r},uploadable:i}=e;yield*gR("Running middleware");let n=yield*Ht,s=yield*gV({try:async()=>i.middleware({...n,input:r,files:t}),catch:e=>e instanceof BP?e:new BP({code:"INTERNAL_SERVER_ERROR",message:"Failed to run middleware",cause:e})});if(s[J9]&&s[J9].length!==t.length){let e=`Expected files override to have the same length as original files, got ${s[J9].length} but expected ${t.length}`;return yield*gA(e),yield*new BP({code:"BAD_REQUEST",message:"Files override must have the same length as files",cause:e})}let a=yield*vo(t,(e,t)=>k_(function*(){let r=s[J9]?.[t];return r&&r.size!==e.size&&(yield*gN("File size mismatch. Reverting to original size")),{name:r?.name??e.name,size:e.size,type:e.type,customId:r?.customId,lastModified:r?.lastModified??Date.now()}}));return{metadata:s,filesWithCustomIds:a}}).pipe(gj("runRouteMiddleware")),Ho=e=>k_(function*(){let t=(yield*q5).pipe(Bl),{uploadable:r,fePackage:i,beAdapter:n,slug:s}=e,a=yield*UA(B3);yield*gR("Handling upload request").pipe(gd("json",a)),yield*gR("Parsing user input");let o=yield*gV({try:()=>(function(e){if("parseAsync"in e&&"function"==typeof e.parseAsync)return e.parseAsync;if(PB(e))return t=>Pq(e)(t).catch(e=>{throw new JY({cause:vV(e[SX])})});if("~standard"in e)return async t=>{let r=await e["~standard"].validate(t);if(r.issues)throw new JY({cause:r.issues});return r.value};throw Error("Invalid parser")})(r.inputParser)(a.input),catch:e=>new BP({code:"BAD_REQUEST",message:"Invalid input",cause:e})});yield*gR("Input parsed successfully").pipe(gd("input",o));let{metadata:l,filesWithCustomIds:u}=yield*Ha({json:{input:o,files:a.files},uploadable:r});yield*gR("Parsing route config").pipe(gd("routerConfig",r.routerConfig));let c=yield*BF(r.routerConfig).pipe(gx("InvalidRouteConfig",e=>new BP({code:"BAD_REQUEST",message:"Invalid route config",cause:e})));yield*gR("Route config parsed successfully").pipe(gd("routeConfig",c)),yield*gR("Validating files meet the config requirements").pipe(gd("files",a.files)),yield*JX(a.files,c).pipe(uj(e=>new BP({code:"BAD_REQUEST",message:`Invalid config: ${e._tag}`,cause:"reason"in e?e.reason:e.message}))),yield*gR("Files validated.");let h=yield*vo(u,e=>uN(BR(e,Bj(c)),t=>({name:e.name,size:e.size,type:e.type||t,lastModified:e.lastModified,customId:e.customId,contentDisposition:c[t]?.contentDisposition??"inline",acl:c[t]?.acl}))).pipe(gy({InvalidFileType:e=>ul(e),UnknownFileType:e=>ul(e)})),p=r.routeOptions,{apiKey:f,appId:d}=yield*B8,m=yield*B7,g=yield*B6;yield*gR("Generating presigned URLs").pipe(gd("fileUploadRequests",h),gd("ingestUrl",m));let b=yield*vo(h,e=>k_(function*(){let t=yield*BB(e,d,p.getFileHashParts);return{url:yield*BJ(`${m}/${t}`,f,{ttlInSeconds:p.presignedURLTTL,data:{"x-ut-identifier":d,"x-ut-file-name":e.name,"x-ut-file-size":e.size,"x-ut-file-type":e.type,"x-ut-slug":s,"x-ut-custom-id":e.customId,"x-ut-content-disposition":e.contentDisposition,"x-ut-acl":e.acl}}),key:t}}),{concurrency:"unbounded"}),x=yield*UI,y=yield*UM(x),v=yield*Pl("callbackUrl").pipe(Ph(y.origin+y.pathname),uN(e=>qj(e).pipe(qW("slug",s)))),_=qj("/route-metadata").pipe(qV(m),qq({"x-uploadthing-api-key":zB(f),"x-uploadthing-version":He,"x-uploadthing-be-adapter":n,"x-uploadthing-fe-package":i}),qZ({fileKeys:b.map(({key:e})=>e),metadata:l,isDev:g,callbackUrl:v.url,callbackSlug:s,awaitServerData:p.awaitServerData??!0}),ux(t.execute)),S=kR("handleDevStreamError")(function*(e,r){let s=DZ(DI({file:BX})),a=(yield*PU(s)(r)).file.key;yield*gA("Failed to forward callback request from dev stream").pipe(gd({fileKey:a,error:e.message}));let o=yield*qj("/callback-result").pipe(qV(m),qq({"x-uploadthing-api-key":zB(f),"x-uploadthing-version":He,"x-uploadthing-be-adapter":n,"x-uploadthing-fe-package":i}),qZ({fileKey:a,error:`Failed to forward callback request from dev stream: ${e.message}`}),ux(t.execute));yield*JW("Reported callback error to UploadThing")(o)}),w=yield*uE(g,{onTrue:()=>_.pipe(gJ({onSuccess:JW("Registered metadata",{mixin:"None"}),onFailure:JG("Failed to register metadata")}),Bu,Jr(B0,e=>v.pipe(qq({"uploadthing-hook":e.hook,"x-uploadthing-signature":e.signature}),qQ($r(e.payload,"application/json")),t.execute,uJ(JW("Successfully forwarded callback request from dev stream")),gx("ResponseError",t=>S(t,e.payload)),gd(e),l8,kk,kC))),onFalse:()=>_.pipe(gJ({onSuccess:JW("Registered metadata"),onFailure:JG("Failed to register metadata")}),ux($N(B1)),kC)}).pipe(vh),k=b.map((e,t)=>({url:e.url,key:e.key,name:h[t].name,customId:h[t].customId??null}));return yield*gT("Sending presigned URLs to client").pipe(gd("presignedUrls",k)),{body:k,fiber:w}}).pipe(gj("handleUploadAction"));var Hl=r(50117),Hu=r(51825);let{GET:Hc,POST:Hh}=(e=>{let t=Hr(e=>uU({req:e,res:void 0,event:void 0}),e=>uU(e),e,"nextjs-app");return{POST:t,GET:t}})({router:{imageUploader:(function e(t={}){let r={$types:{},routerConfig:{image:{maxFileSize:"4MB"}},routeOptions:{awaitServerData:!0},inputParser:{parseAsync:()=>Promise.resolve(void 0),_input:void 0,_output:void 0},middleware:()=>({}),onUploadError:()=>{},onUploadComplete:()=>void 0,errorFormatter:t.errorFormatter??Je,...t};return{input:t=>e({...r,inputParser:t}),middleware:t=>e({...r,middleware:t}),onUploadComplete:e=>({...r,onUploadComplete:e}),onUploadError:t=>e({...r,onUploadError:t})}})({routerConfig:{image:{maxFileSize:"4MB"}},routeOptions:(void 0)??{},...E}).middleware(async()=>{let e=await (0,Hu.getServerSession)(Hl.N);if(!e)throw new BP("Unauthorized");return{token:e}}).onUploadComplete(async({file:e})=>e)}}),Hp=new N.AppRouteRouteModule({definition:{kind:A.RouteKind.APP_ROUTE,page:"/api/uploadthing/route",pathname:"/api/uploadthing",filename:"route",bundlePath:"app/api/uploadthing/route"},resolvedPagePath:"D:\\01.ProjectsForPortfolio\\telegram_clone\\client\\app\\api\\uploadthing\\route.ts",nextConfigOutput:"",userland:T}),{workAsyncStorage:Hf,workUnitAsyncStorage:Hd,serverHooks:Hm}=Hp;function Hg(){return(0,j.patchFetch)({workAsyncStorage:Hf,workUnitAsyncStorage:Hd})}},96487:()=>{},78335:()=>{},50117:(e,t,r)=>{"use strict";r.d(t,{N:()=>c});var i=r(56037),n=r.n(i);let s=new i.Schema({email:{type:String,required:!0,unique:!0},isVerified:{type:Boolean,default:!1},firstName:{type:String},lastName:{type:String},bio:{type:String},avatar:{type:String},muted:{type:Boolean,default:!1},notificationSound:{type:String,default:"notification.mp3"},sendingSound:{type:String,default:"sending.mp3"},contacts:[{type:i.Schema.Types.ObjectId,ref:"User"}]}),a=i.models.User||(0,i.model)("User",s);var o=r(91642);let l=!1,u=async()=>{if(n().set("strictQuery",!0),!process.env.MONGODB_URI)return console.error("MONGO_URI is not defined");if(l){console.log("MongoDB is already connected");return}try{await n().connect(process.env.MONGODB_URI,{autoCreate:!0}),l=!0}catch(e){console.log("Couldn't connect to MongoDB",e)}},c={providers:[(0,o.A)({name:"Credentials",credentials:{email:{label:"Email",type:"email"}},authorize:async e=>(await u(),await a.findOne({email:e?.email}))})],callbacks:{async session({session:e}){await u();let t=await a.findOne({email:e.user?.email});if(!t){let t=await a.create({email:e.user?.email,isVerified:!0,avatar:e.user?.image});return e.currentUser=t,e}return e.currentUser=t,e}},session:{strategy:"jwt"},jwt:{secret:"f8HzQ97Km92Lx0Tfs2P3N8a"},secret:process.env.NEXTAUTH_SECRET,pages:{signIn:"/auth",signOut:"/auth"}}},42706:(e,t,r)=>{"use strict";e.exports=r(44870)}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),i=t.X(0,[681,690],()=>r(16047));module.exports=i})();